{"version":3,"sources":["webpack:///D:/Projects/rick-love-master/code/utils/objects.ts","webpack:///D:/Projects/rick-love-master/code/networking/websockets-api/client/websocket-client-smart.ts","webpack:///D:/Projects/rick-love-master/code/networking/web-mesh/web-mesh-client.ts","webpack:///D:/Projects/rick-love-master/code/utils/random.ts","webpack:///D:/Projects/rick-love-master/code/controls-react/icon-kind.ts","webpack:///D:/Projects/rick-love-master/code/games/doodle/doodle-storage.ts","webpack:///D:/Projects/rick-love-master/code/networking/user-data-service/user-profile-selection-view.tsx","webpack:///D:/Projects/rick-love-master/code/games/educational-games/progress-games/emoji-idle-game/emoji-skills/emoji-skill-tree.ts","webpack:///D:/Projects/rick-love-master/code/games/educational-games/progress-games/emoji-idle-game/emoji-idle-service.ts","webpack:///D:/Projects/rick-love-master/code/games/educational-games/progress-games/emoji-idle-game/emoji-idle-view.tsx","webpack:///D:/Projects/rick-love-master/code/games/educational-games/progress-games/progress-game.tsx","webpack:///D:/Projects/rick-love-master/code/utils/email-address.ts","webpack:///D:/Projects/rick-love-master/code/utils/error.ts","webpack:///D:/Projects/rick-love-master/code/games/educational-games/problems/problems-reviewer.ts","webpack:///D:/Projects/rick-love-master/code/networking/upload-api/client/config.ts","webpack:///D:/Projects/rick-love-master/node_modules/dayjs/dayjs.min.js","webpack:///D:/Projects/rick-love-master/node_modules/dayjs/plugin/localizedFormat.js","webpack:///D:/Projects/rick-love-master/code/react-native-lite/index.tsx","webpack:///D:/Projects/rick-love-master/code/games/educational-games/utils/voice-chooser.tsx","webpack:///D:/Projects/rick-love-master/code/utils/subscribable.ts","webpack:///D:/Projects/rick-love-master/code/networking/upload-api/client/uploader.ts","webpack:///D:/Projects/rick-love-master/code/utils/json.ts","webpack:///D:/Projects/rick-love-master/code/controls-react/error-box.tsx","webpack:///D:/Projects/rick-love-master/code/games/doodle/doodle-view.tsx","webpack:///D:/Projects/rick-love-master/code/networking/websockets-api/client/websocket-client.ts","webpack:///D:/Projects/rick-love-master/node_modules/@stripe/react-stripe-js/dist/react-stripe.umd.js","webpack:///D:/Projects/rick-love-master/code/utils/phone-number.ts","webpack:///D:/Projects/rick-love-master/node_modules/@stripe/stripe-js/dist/stripe.esm.js","webpack:///D:/Projects/rick-love-master/code/payments/common/process-steps.ts","webpack:///D:/Projects/rick-love-master/code/payments/common/types.ts","webpack:///D:/Projects/rick-love-master/code/payments/providers/stripe/common/stripe-process-steps.ts","webpack:///D:/Projects/rick-love-master/code/payments/providers/stripe/client/stripe-payment-react.tsx","webpack:///D:/Projects/rick-love-master/code/games/doodle/doodle.ts","webpack:///D:/Projects/rick-love-master/code/payments/providers/stripe/client/stripe-client-tokens.ts","webpack:///D:/Projects/rick-love-master/code/games/doodle/doodle-paths.ts","webpack:///D:/Projects/rick-love-master/node_modules/react-icons/lib/esm/iconsManifest.js","webpack:///D:/Projects/rick-love-master/node_modules/react-icons/lib/esm/iconContext.js","webpack:///D:/Projects/rick-love-master/node_modules/react-icons/lib/esm/iconBase.js","webpack:///D:/Projects/rick-love-master/code/networking/upload-api/client/web-client.ts","webpack:///D:/Projects/rick-love-master/code/games/educational-games/utils/speech.ts","webpack:///D:/Projects/rick-love-master/code/controls-react/button.tsx","webpack:///D:/Projects/rick-love-master/code/controls-react/index.tsx","webpack:///D:/Projects/rick-love-master/code/controls-react/inputs.tsx","webpack:///D:/Projects/rick-love-master/code/utils/dates.ts","webpack:///D:/Projects/rick-love-master/code/utils/delay.ts","webpack:///(webpack)/buildin/global.js","webpack:///D:/Projects/rick-love-master/code/controls-react/icon.tsx","webpack:///D:/Projects/rick-love-master/code/themes/theme.ts","webpack:///D:/Projects/rick-love-master/code/utils/arrays.ts","webpack:///D:/Projects/rick-love-master/node_modules/gatsby/node_modules/core-js/internals/flatten-into-array.js","webpack:///D:/Projects/rick-love-master/node_modules/gatsby/node_modules/core-js/modules/es.array.unscopables.flat-map.js","webpack:///D:/Projects/rick-love-master/code/utils-react/hooks.tsx","webpack:///D:/Projects/rick-love-master/code/controls-react/loading.tsx","webpack:///D:/Projects/rick-love-master/code/games/educational-games/problems/spelling/spelling-problem-service.ts","webpack:///D:/Projects/rick-love-master/code/games/educational-games/components/game-pad-analog.tsx","webpack:///D:/Projects/rick-love-master/code/games/educational-games/utils/vectors.ts","webpack:///D:/Projects/rick-love-master/code/games/educational-games/star-blast-sideways.tsx","webpack:///D:/Projects/rick-love-master/code/games/educational-games/problems/multiples.ts","webpack:///D:/Projects/rick-love-master/code/games/doodle/keyboard-simplified.tsx","webpack:///D:/Projects/rick-love-master/code/games/doodle/doodle-components.tsx","webpack:///D:/Projects/rick-love-master/code/games/educational-games/components/leaderboard.tsx","webpack:///D:/Projects/rick-love-master/code/networking/user-data-service/user-profile-emojis.tsx","webpack:///D:/Projects/rick-love-master/code/networking/user-data-service/user-profile-manager-view.tsx","webpack:///D:/Projects/rick-love-master/node_modules/gatsby/node_modules/@babel/runtime/helpers/esm/getPrototypeOf.js","webpack:///D:/Projects/rick-love-master/node_modules/gatsby/node_modules/@babel/runtime/helpers/esm/setPrototypeOf.js","webpack:///D:/Projects/rick-love-master/node_modules/gatsby/node_modules/@babel/runtime/helpers/esm/isNativeReflectConstruct.js","webpack:///D:/Projects/rick-love-master/node_modules/gatsby/node_modules/@babel/runtime/helpers/esm/construct.js","webpack:///D:/Projects/rick-love-master/node_modules/gatsby/node_modules/@babel/runtime/helpers/esm/wrapNativeSuper.js","webpack:///D:/Projects/rick-love-master/node_modules/gatsby/node_modules/@babel/runtime/helpers/esm/isNativeFunction.js","webpack:///D:/Projects/rick-love-master/code/utils/web-request.ts","webpack:///D:/Projects/rick-love-master/node_modules/dayjs/plugin/relativeTime.js","webpack:///D:/Projects/rick-love-master/code/networking/websockets-api/client/config.ts","webpack:///D:/Projects/rick-love-master/node_modules/gatsby/node_modules/core-js/modules/es.array.flat-map.js","webpack:///D:/Projects/rick-love-master/code/games/educational-games/utils/subject-navigator.tsx","webpack:///D:/Projects/rick-love-master/code/games/educational-games/problems/problem-state-storage.ts","webpack:///D:/Projects/rick-love-master/code/networking/user-data-service/user-data-service.ts","webpack:///D:/Projects/rick-love-master/code/games/console-simulator/utils.ts"],"names":["getValuesAsItems","obj","Object","keys","map","k","filter","x","toKeyValueObject","items","v","forEach","key","value","toMap","Map","toKeyValueArray","createWebMeshClient","channelKey","initialMeshState","initialState","reduceState","reduceClientsState","clientKey","localStorage","getItem","Date","now","Math","floor","random","setItem","config","messageHandler","messages","events","sendRef","outbox","connection","subMessages","subEvents","sendIntervalId","sendOutbox","stateSub","createSubscribable","state","meshState","meshMetaData","clients","firstMessageTimestamp","lastMessageTimestamp","messageHistory","sendSyncStateTimeoutId","setTimeout","websocket","websocketsApiUrl","websocketsApiConfig","message","kind","clearTimeout","c","onStateChange","oldClients","push","lastActivityTimestamp","t","sort","a","b","join","updateClients","pingPongDropTimeoutId","clientKeys","includes","sendPong","some","sendSyncState","distinct_key","m","clientPriority","findIndex","send","createWebsocketClient","connect","subscribeMessages","_r","subscribeConnectionEvents","event","isConnected","setInterval","splice","length","unsubscribe","clearInterval","close","history","sendWebSocketMessage","unshift","pingPongInterval","deadClients2","oldClients2","isClosed","_webSocket","sendMessage","AppError","subscribe","randomIndex","randomItem","IconKind","storageAccess","JSON","parse","stringify","createDoodleDrawingStorageService","remoteDoodle","createSmartUploader","getUploadUrl","doodleUploadUrl","setUploadUrl","uploadApiUrl","uploadApiConfig","uploadUrlPrefix","doodleStoragePaths","doodleDrawingsPrefix","remoteVotes","scoresUploadUrl","doodleVotesPrefix","getSummaryData","uploadUrl","uploadApiWebClient","createUploadApiWebClient","createUploadUrl","serverUrl","getUrl","replace","relativePath","summaryUrl","doodleSummary","console","log","downloadData","summaryDataRaw","summaryData","doodles","prompt","p","timestamp","drawing","decodeDoodleDrawing","d","score","s","memory","doodleScores","doodleVotes","load","voteTotals","doodleKey","service","saveDrawing","doodle","substr","save","encodeDoodleDrawing","saveBestDrawingSelection","find","getDrawings","options","includeOtherPrompts","maxCount","allDoodles","samePromptDrawings","otherPromptDrawings","allDrawings","shuffle","slice","drawings","getAllDrawings","styles","container","flexDirection","flexWrap","justifyContent","profileContainer","alignItems","profileCharacterView","width","height","borderWidth","borderStyle","borderColor","profileCharacterText","fontSize","textAlign","profileNameView","profileNameText","UserProfileSelectionView","props","useAutoLoadingError","doWork","loading","error","useState","userProfiles","setUserProfiles","isManagerVisible","setIsManagerVisible","reload","stopIfObsolete","UserDataService","get","setup","getUserProfiles","profiles","useEffect","onClose","style","onPress","setActiveUser","onUserSelected","emoji","name","buildEmojiSkillTree","maleSkillDoc","child_male","student_male","skillDoc","femaleSkillDoc","child_female","student_female","getFemaleVariant","maleNodes","parseSkillDoc","femaleNodes","babyNode","babyEmoji","gender","pay","requirementEmojis","startEmoji","parent","children","allNodes","root","child","allRequirements","parseRequirementsDoc","requirementsDoc","node","allCosts","r","cost","summary","totalCost","reduce","out","debug_totalRequirementsCost","doc","split","trim","line","parts","Number","parseInt","parseSkillLine","skillLine","payText","p1","end","RegExp","genderCharCodes","male","female","man","woman","String","fromCodePoint","storage","createService","skillTree","reqMap","defaultState","characterEmoji","emotion","lastEmotionTimestamp","money","multiplier","lastMultiplierChangeTimestamp","lastPurchaseTimestamp","townState","characters","sub","changeState","partialState","rewardInner","min","targetEmoji","targetOptions","skillNode","remainingSkills","targetSkillNode","reqs","reqs_remaining","requirementsPurchased","reqs_available","requirementsAvailable","requirementsNeeded","requirementsRemaining","undefined","subscribePetStateChange","reward","reward_major","reward_extreme","punish","max","selectOption","finishedTimestamp","serviceState","instance","EmojiIdleService","fixed","position","top","right","left","zIndex","inner","emotionEmoji","fontFamily","characterEmoji_small","costText","color","costText_small","targetCharacterEmoji","objectEmoji","marginLeft","money_small","foodText","EmojiIdleView","gameState","setGameState","isExpanded","setIsExpanded","purchased","townStyles","background","payText_disabled","moneyText","townMoneyText","TownView","townPersons","character","skill","n","years","missingSkills","townMoney","flex","padding","toLocaleString","toFixed","opacity","CommandsView","offset","setOffset","targetOptionsLength","i","canBuy","borderRadius","paddingLeft","paddingRight","ScoreView","moneySizeOffset","setMoneySizeOffset","multiplierSizeOffset","setMultiplierSizeOffset","lastMultiplier","useRef","multiplierDelta","setMultiplierDelta","update","id","current","transform","padStart","EmojiCharacterView","PurchasedView","EmotionView","text","isEmotion","display","setDisplay","showEmotion","variant","getEmoji","ProgressGameService","onCorrect","onCompleteSection","onCompleteSubject","onWrong","createProgressGameProblemService","problemSource","recordAnswer","problem","answer","isCorrect","isReview","isLastOfSubject","uploadUserData","isLastOfSection","ProgressGameView","hasSelectedProfile","setHasSelectedProfile","userProfile","setUserProfile","getActiveUser","lastPurchase","Platform","OS","window","location","toEmailAddress","email","data","Error","ApiError","createReviewProblemService","maxNewReviewCount","reviewSequencePreviousLength","reviewQuestionPrefix","requiredCorrectInRow","problemSourceHistory","reviewProblems","lastReviewProblem","reviewSequence","repeatState","startReview","getSections","gotoSection","getNextProblem","reviewProblem","rSeq","iNext","iEnd","index","lastReviewProblemIndex","iStart","seq","question","answers","getReviewProblem","correctsInRow","newProblem","problemAlreadyInReview","newReview","_debug_problemKey","module","exports","e","u","o","h","f","Array","z","utcOffset","abs","year","month","clone","add","ceil","M","y","w","D","ms","Q","toLowerCase","$","weekdays","months","l","g","date","args","arguments","locale","$L","utc","$u","$offset","this","prototype","$d","NaN","test","match","UTC","init","$y","getFullYear","$M","getMonth","$D","getDate","$W","getDay","$H","getHours","$m","getMinutes","$s","getSeconds","$ms","getMilliseconds","$utils","isValid","toString","isSame","startOf","endOf","isAfter","isBefore","$g","set","day","hour","minute","second","millisecond","unix","valueOf","getTime","toDate","apply","$locale","weekStart","$set","daysInMonth","round","subtract","format","meridiem","YY","YYYY","MM","MMM","monthsShort","MMMM","DD","dd","weekdaysMin","ddd","weekdaysShort","dddd","H","HH","hh","A","mm","ss","SSS","Z","getTimezoneOffset","diff","toJSON","toISOString","toUTCString","extend","isDayjs","en","Ls","LTS","LT","L","LL","LLL","LLLL","formats","toUpperCase","call","mergeStyles","isArray","item","viewStyleDefaults","textStyleDefaults","whiteSpace","finalizeTextStyle","userSelect","MozUserSelect","WebkitUserSelect","View","Text","numberOfLines","allStyles","overflow","wordWrap","textOverflow","TextInput","type","keyboardType","secureTextEntry","autoCompleteType","onKeyPress","onSubmitEditing","shiftKey","preventDefault","placeholder","disabled","editable","onFocus","onChange","target","onBlur","TouchableOpacity","lastPressTime","hasTouchStarted","onClick","onTouchStart","onTouchMove","onTouchEnd","role","tabIndex","Pressable","onIgnore","stopPropagation","cancelBubble","returnValue","onPressIn","onPressOut","onMouseDown","onMouseUp","onTouchCancel","onMouseLeave","onTouchEndCapture","ActivityIndicator","size","sizePx","CircleSvg","thickness","dashLength","PI","maxWidth","viewBox","xmlns","fill","stroke","strokeWidth","cx","cy","className","strokeDasharray","transformOrigin","Clipboard","setString","navigator","clipboard","writeText","VoiceChooser","languange","speechService","setLoading","setRenderId","refresh","getVoicesForLanguange","voice","setVoiceForLanguange","speak","margin","isSelected","lang","localService","lastState","callbacks","callback","fetchWithTimeout","method","headers","result","json","createUploader","uploadData","body","putUrl","ok","_uploadUrl","setupUploadUrl","prefix","uploader","renewUploadUrl","backupUrl","backupUploader","jsonStringify_safe","shouldFormat","visited","_","val","errorBoxStyle","view","theme","view_error","text_error","text_errorMessage","icon","icon_errorMessage","button","outlineColor","colors","outline","ErrorBox","ErrorBox_Inner","expanded","setExpanded","errorAsString","errorMessage","errorDetails","errorObjText","canExpand","collapsed","copy","retryCallback","retry","ErrorMessage","backgroundColor","DoodleTestView","defaultDoodleDrawing","setDoodle","DoodleDrawerView","DoodleDisplayView","scale","segment","setSegment","segmentClientStart","divHost","nativeEvent","pos","div","rect","getBoundingClientRect","clientX","clientY","points","segments","onClientMove","lastPos","onMove","onIgnoreNative","document","addEventListener","passive","removeEventListener","preserveAspectRatio","doodleSegmentToSvgPath_line","ref","bottom","onMouseMove","touches","redrawId","setRedrawId","enableRedraw","DoodleDisplayView_Inner","shouldAnimate","animatePointsPerSecond","tick","setTick","totalPoints","flatMap","remainingPoints","MAX_SAFE_INTEGER","maxPoints","DoodleBrowser","setDoodles","DoodleBrowseView","grouped","groupItems","subscribable","subscribableEvents","createSocket","socket","WebSocket","activeSocket","connectionStatus","messageContainer","reconnect","readyState","OPEN","React","_typeof","Symbol","iterator","constructor","_objectWithoutProperties","source","excluded","sourceKeys","indexOf","_objectWithoutPropertiesLoose","getOwnPropertySymbols","sourceSymbolKeys","propertyIsEnumerable","_slicedToArray","arr","_arrayWithHoles","_arr","_n","_d","_e","_s","_i","next","done","err","_iterableToArrayLimit","TypeError","_nonIterableRest","emptyFunction","emptyFunctionWithReset","hasOwnProperty","resetWarningCache","propTypes","fn","createCommonjsModule","shim","propName","componentName","propFullName","secret","getShim","isRequired","ReactPropTypes","array","bool","func","number","object","string","symbol","any","arrayOf","element","elementType","instanceOf","objectOf","oneOf","oneOfType","shape","exact","checkPropTypes","PropTypes","factoryWithThrowingShims","isUnknownObject","raw","isEqual","leftArray","leftPlainObject","leftKeys","rightKeys","keySet","allKeys","every","usePrevious","validateStripe","maybeStripe","elements","createToken","createPaymentMethod","confirmCardPayment","parseStripeProp","then","isPromise","tag","stripePromise","Promise","resolve","stripe","ElementsContext","createContext","displayName","useElementsContextWithUseCase","useCaseMessage","ctx","useCase","concat","parseElementsContext","useContext","ElementsConsumer","_ref2","useCallbackReference","cb","extractUpdateableOptions","paymentRequest","noop","createElementComponent","isServer","str","charAt","Element","createElement","_ref","_ref$options","_ref$onBlur","_ref$onFocus","_ref$onReady","onReady","_ref$onChange","_ref$onEscape","onEscape","_ref$onClick","elementRef","domNode","callOnReady","callOnBlur","callOnFocus","callOnClick","callOnChange","callOnEscape","useLayoutEffect","create","mount","on","prevOptions","warn","updateableOptions","destroy","__elementType","AuBankAccountElement","CardElement","CardNumberElement","CardExpiryElement","CardCvcElement","FpxBankElement","IbanElement","IdealBankElement","PaymentRequestButtonElement","Elements","rawStripeProp","_final","isMounted","parsed","useMemo","_React$useState2","setContext","prevStripe","anyStripe","_registerWrapper","version","Provider","useElements","useStripe","defineProperty","factory","formatPhoneNumber_UsaCanada","phoneNumberMask_UsaCanada","corrected","toStandardPhoneNumber","digitsNo1","digits","letters","iDigit","iLast","full","_toConsumableArray","arr2","_arrayWithoutHoles","iter","from","_iterableToArray","_nonIterableSpread","V3_URL","V3_URL_REGEX","EXISTING_SCRIPT_MESSAGE","loadScript","params","reject","Stripe","script","scripts","querySelectorAll","src","findScript","queryString","advancedFraudSignals","headOrBody","head","appendChild","injectScript","initStripe","registerWrapper","stripePromise$1","loadCalled","ProcessSteps_CreateSavedPaymentMethod","PaymentError","ProcessSteps_CreateSavedPaymentMethod_Stripe","_02_Server_SetupSavedPaymentMethod","_03_Client_CollectPaymentDetails","_04_Server_ObtainPaymentMethod","logProcessStep_CreateSavedPaymentMethod_Stripe","step","status","wrapProcessStep_CreateSavedPaymentMethod_Stripe","execute","createPaymentClientComponents_stripe","_len","_key","loadStripe","stripePublicKey","AppWrapperComponent","PaymentMethodEntryComponent","paymentMethodSetupToken","onPaymentMethodReady","stripeError","setStripeError","handleSubmit","_03A_Client_CollectPaymentDetails","setupInfo","stripeDecodeClientSetupToken","confirmCardSetup","clientSecret","payment_method","card","getElement","billing_details","customerBillingDetails","setupIntent","stripeEncodeClientToken","inputStyle","base","textColor","fontSmoothing","invalid","textColor_invalid","iconColor","inputContainerStyle","marginBottom","elementPadding","textPadding","buttonStyle","fontWeight","buttonJustifyContent","buttonAlignment","errorContainerStyle","errorMessageStyle","onSubmit","buttonText","encodeDoodleSegmentPoints","last","decodeDoodleSegmentPoints","pointsString","point","doodleText","stripeEncodeClientSetupToken","doodlePartyDrawingsPrefix","DefaultContext","attr","IconContext","__assign","assign","__rest","GenIcon","IconBase","Tree2Element","tree","elem","conf","computedSize","title","svgProps","Consumer","apiRequest","endpoint","url","requestData","webRequest","resultObj","createSpeechService","synth","speechSynthesis","selectedVoices","voiceLang","SpeechSynthesisUtterance","voices","getVoices","startsWith","language","Button","styleAlt","button_formAction_alt","button_formAction","extractViewStyle","extractTextStyle","C","Loading","LoadingInline","View_Panel","view_panel","View_Form","view_form","View_FormFields","view_formFields","View_FieldRow","view_fieldRow","View_FormActionRow","view_formActionRow","Text_FormTitle","text_formTitle","Text_FieldLabel","text_fieldLabel","Button_FieldInline","button_fieldInline_alt","button_fieldInline","Button_FormAction","Input_Text","input_fieldEntry","Input_Username","Input_Password","showPassword","setShowPassword","marginRight","eye","eyeSlash","Input_Phone","valueActual","setValueActual","Input_Email","Input_Currency","parseFloat","dayjs","localizedFormat","relativeTime","formatDate","formatDate_FromNow","fromNow","delay","timeout","Function","Icon","menu","component","MdMenu","back","MdArrowBack","MdErrorOutline","FiChevronDown","FiChevronRight","MdContentCopy","FaRedo","dashboard","MdDashboard","FaPlus","remove","FaMinus","FaEye","FaEyeSlash","checkChecked","FaCheckSquare","checkUnchecked","FaSquare","MdCheckBoxOutlineBlank","getIcon","IconComponent","sizes","marginTop","paddingTop","paddingBottom","minWidth","lineHeight","basicThemeColors","text_header","text_button","border","border_minor","border_input","background_field","background_button","background_error","loader","getBorderSizes","all","borderLeftWidth","borderRightWidth","borderTopWidth","borderBottomWidth","basicThemeSizes","borderWidth_minor","borderWidth_input","sectionGap","elementGap","rowGap","rowPadding","fontSize_input","fontSize_button","fontSize_header","minWidth_label","minWidth_input","minWidth_button","basicFont","fontWeight_normal","fontWeight_button","fontWeight_header","createTheme","font","borderProps","borderProps_minor","borderProps_input","sTextView","moveItem","to","distinct","Set","getKey","groups","sameArrayContents","toLength","bind","flattenIntoArray","original","sourceLen","start","depth","mapper","thisArg","targetIndex","sourceIndex","mapFn","addToUnscopables","mounted","useMounted","loadingError","setLoadingError","doWorkInner","getContext","contextInit","doCall","createSpellingProblemService","maxAnswers","sectionSize","speech","spellingEntries","getSpellingEntries","sectionCount","nextIndex","completedSectionKeys","getSectionKey","sectionIndex","loaded","isComplete","correctValue","word","wrongAnswerCount","wrongValues","mispellings","onQuestion","sectionKey","GamepadAnalogStateful","moveDirection","buttons","isDown","onPressStateChange","onMovePressIn","dir","onMovePressOut","inputStyles","alignSelf","section","moveSectionWrapper","moveSectionRotation","row","cellTouch","cellView","pointerEvents","cellText","moveCellText","cellEmptyView","cellTextOcclusionView","GamepadAnalog","cellViewStyle","onKeyDown","onKeyUp","DirectionButton","direction","ActionButton","Fragment","getDistanceSq","EducationalGame_StarBlastSideways_Multiples","problemService","createAutoSavedProblemService","bVal","EducationalGame_StarBlastSideways","EducationalGame_StarBlastSideways_Inner","paused","pauseState","setPauseState","pressState","setPressState","problemSourceKey","setProblemSourceKey","gamepad","onOpen","onSubjectNavigation","viewscreen","gameStyles","directAnswerButtonContainer","directAnswerButton","directAnswerButton_hidden","viewscreenView","sprite","viewSize","fontSize_small","gameOver","GameView","getDefaultGameState","lastActualTimeMs","lastGameTime","gameSpeed","lives","getGameTime","actualTimePassed","gameTime","gameTimePassed","playerPositionState","rotation","projectilesState","lastShotActualTime","shots","debris","enemiesState","enemies","problemsState","restartGame","e2","gotoNextProblem","pSize","newProblemState","problemTime","isAnsweredWrong","newEnemyState","ans","enemy","vel","onHit","ignore","destroyed","gameLastTime","requestAnimationFrame","gameLoop","gameDeltaTime","getCommonState","playerPosition","onLoseLife","deadTime","gameOverTime","gameResult","updateGame","playerResult","updatePlayer","projectilesResult","updateProjectiles","enemiesResult","updateEnemies","timeSinceProblem","hasHitGround","explodeTime","weaponsLock","lockedEnemy","lockedAtPlayerPosition","playerTargetPosition","directAnswer","dirPress","targetPos","sign","targetRotation","gw","gh","playerPos","didShoot","destoyed","pad","hPad","shift","newShots","radius","radiusSq","radiusSq_enemies","i2","swap","radiusSq_player","wPad","closestEnemyToPlayer","newEnemies","Sprite","offsetX","offsetY","getSpriteEmoji","stylePosition","styleRotation","TextPositioned","englishKeyboard","rows","rowView","keyView","keyView_disabled","keyText","keyText_wrong","KeyboardSimplified","expectedCharacter","showHints","onExpectedKeyPress","keyboard","hintKeys","setHintKeys","wrongKeys","setWrongKeys","hints","iRow","drawingChoicesView","drawingChoiceWrapper","drawingChoice","titleView","titleText","promptView","promptText","hintText","buttonRowView","buttonView","DoodleGameView_DrawWord","setDrawing","hint","onSkip","onDone","DoodleGameView_ChooseBest","onChooseBest","typeStyles","completedText","DoodleGameView_TypeExpected","completed","remaining","setStatus","sayAgain","nextChar","createLeaderboard","leaderboard","saveScore","loadScore","sortKey","storageKey","sortDescending","leaderboardInputStyles","textInput","LeaderboardNameInput","setName","leaderboardStyles","scoreView","nameText","scoreText","LeaderboardViewInner","scoreColumns","scores","getValue","useLeaderboard","getScore","leaderboardScores","setLeaderboardScores","LeaderboardArea","onScoreSaved","userProfileChracters","UserProfileManagerView","onActiveUserChange","onUserProfileChange","onUserAdded","AddUserProfileView","shareCode","setShareCode","addUserFromShareCode","UserProfileView","setCharacters","setUserProfileInfo","isActive","onNameChange","createShareCode","UserProfileName","isEditingName","setIsEditingName","changeName","_getPrototypeOf","setPrototypeOf","getPrototypeOf","__proto__","_setPrototypeOf","_isNativeReflectConstruct","Reflect","construct","sham","Proxy","Parent","Class","_cache","has","Wrapper","enumerable","writable","configurable","race","fetch","reqData","catch","responseStatus","request","future","past","yy","thresholds","rounding","toNow","toObject","aFunction","arraySpeciesCreate","proto","callbackfn","O","subjectStyles","header","SubjectNavigator","scrollTo","createProblemStateStorage","uploadApi","getUserProfile","getActiveUserProfile","uploadBackup","uploadWithAutoRenew","updateUserProfileFromServer","updateAllProfilesFromServer","isSetupStarted","isSetupDone","getUserDataServiceState","setUserDataServiceState","getUserData","userState","activeUserProfileKey","metadata","clearUserData","removeItem","lastUploadTimestamp","setUserData","userData","userProfileKey","upload","newUploarUrl","doSetup","newUploadUrlResult","newState","changeTimestamp","user","stateJson","downloadUserDataIfNewer","info","uData","shareablePath","shareUrlResult","shareGetUrl","sharedUploadUrl","userKey","randomBinary","fromCharCode"],"mappings":"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","file":"commons-84f50b84b30da4367107.js","sourcesContent":["export const getValuesAsItems = <T>(obj: T) => {\r\n    return Object.keys(obj).map(k => k as keyof typeof obj).map(k => obj[k]).filter(x => x);\r\n};\r\n\r\nexport const toKeyValueObject = <T>(items: { key: string, value: T }[]): { [key: string]: T } => {\r\n    const v = {} as { [key: string]: T };\r\n    items.forEach(x => { v[x.key] = x.value; });\r\n    return v;\r\n};\r\n\r\nexport const toMap = <T>(items: { key: string, value: T }[]): Map<string, T> => {\r\n    const v = new Map(items.map(x => [x.key, x.value]));\r\n    return v;\r\n};\r\n\r\nexport const toKeyValueArray = <T>(obj: { [key: string]: T }): { key: string, value: T }[] => {\r\n    return Object.keys(obj).map(k => k as keyof typeof obj).map(k => ({ key: k as string, value: obj[k] }));\r\n};\r\n","import { WebsocketConnectionEvent } from './types';\r\nimport { createWebsocketClient } from './websocket-client';\r\n\r\nexport const createWebsocketConnection_smart = <TWebsocketMessage>(config: { websocketsApiUrl: string, channelKey: string }, messageHandler: (message: TWebsocketMessage) => void) => {\r\n    const messages = [] as (TWebsocketMessage & { _r: number })[];\r\n    const events = [] as WebsocketConnectionEvent[];\r\n    const sendRef = {\r\n        send: null as null | ((message: TWebsocketMessage) => void),\r\n    };\r\n    const outbox = [] as TWebsocketMessage[];\r\n\r\n    const connection = createWebsocketClient({ websocketsApiUrl: config.websocketsApiUrl })\r\n        .connect<TWebsocketMessage>({ channelKey: config.channelKey });\r\n\r\n    const subMessages = connection.subscribeMessages(message => {\r\n        messageHandler(message);\r\n        messages.push({ ...message, _r: Date.now() });\r\n    });\r\n    const subEvents = connection.subscribeConnectionEvents(event => {\r\n        sendRef.send = connection.isConnected() ? connection.send : null;\r\n        events.push(event);\r\n    });\r\n\r\n    const sendIntervalId = setInterval(() => sendOutbox(), 250);\r\n\r\n    const unsubscribe = () => {\r\n        clearInterval(sendIntervalId);\r\n        sendRef.send = null;\r\n        subMessages.unsubscribe();\r\n        subEvents.unsubscribe();\r\n        connection.close();\r\n    };\r\n\r\n    const sendOutbox = () => {\r\n        if (!sendRef.send) { return; }\r\n\r\n        const o = outbox.splice(0, outbox.length);\r\n        for (const x of o) {\r\n            sendRef.send(x);\r\n        }\r\n    };\r\n\r\n    const sendMessageWithOutbox = (message: TWebsocketMessage) => {\r\n        if (!sendRef.send) {\r\n            outbox.push(message);\r\n            return;\r\n        }\r\n\r\n        sendOutbox();\r\n        sendRef.send(message);\r\n    };\r\n\r\n\r\n    return {\r\n        send: sendMessageWithOutbox,\r\n        unsubscribe,\r\n        history: {\r\n            messages,\r\n            events,\r\n        },\r\n    };\r\n};\r\n","import { createWebsocketConnection_smart } from 'websockets-api/client/websocket-client-smart';\r\nimport { createSubscribable } from 'utils/subscribable';\r\nimport { AppError } from 'utils/error';\r\nimport { websocketsApiConfig } from 'websockets-api/client/config';\r\nimport { distinct_key } from 'utils/arrays';\r\n\r\ntype Timestamp = number & { __type: 'Timestamp' }\r\ntype ClientKey = string & { __type: 'ClientKey' }\r\nconst createWebMeshClient_websocketOnly = <TMeshState, TMeshMessage>({\r\n    channelKey,\r\n    initialState: initialMeshState,\r\n    reduceState,\r\n    reduceClientsState,\r\n}: {\r\n    channelKey: string;\r\n    initialState: TMeshState;\r\n    reduceState: (previousState: TMeshState, message: TMeshMessage) => TMeshState;\r\n    reduceClientsState: (previousState: TMeshState, clients: { key: string, lastActivityTimestamp: Timestamp }[]) => TMeshState;\r\n}) => {\r\n    const WEB_MESH_CLIENT_KEY = `_webMeshClientKey`;\r\n    const clientKey = (localStorage.getItem(WEB_MESH_CLIENT_KEY) ?? (`${Date.now()}-${Math.floor(Math.random() * 999999)}`)) as ClientKey;\r\n    localStorage.setItem(WEB_MESH_CLIENT_KEY, clientKey);\r\n\r\n    const stateSub = createSubscribable<TMeshState>();\r\n    const state = {\r\n        meshState: initialMeshState,\r\n        meshMetaData: {\r\n            clients: [] as { key: string, lastActivityTimestamp: Timestamp }[],\r\n            firstMessageTimestamp: 0 as Timestamp,\r\n            lastMessageTimestamp: 0 as Timestamp,\r\n        },\r\n    };\r\n    const messageHistory = [] as WebSocketMessageWithSenderInfo[];\r\n\r\n    type WebSocketMessage = (\r\n        { kind: 'join' }\r\n        | { kind: 'close' }\r\n        | { kind: 'sync', state: typeof state }\r\n        | { kind: 'ping', clientKeys: string[] }\r\n        | { kind: 'pong' }\r\n        | { kind: 'drop', clientKeys: string[] }\r\n        | { kind: 'message', message: TMeshMessage }\r\n    );\r\n    type WebSocketMessageWithSenderInfo = { t: Timestamp, c: ClientKey } & WebSocketMessage;\r\n\r\n    const updateClients = (message: { c: ClientKey, t: Timestamp }) => {\r\n        const oldClients = [...state.meshMetaData.clients];\r\n        state.meshMetaData.clients = state.meshMetaData.clients.filter(x => x.key !== message.c);\r\n        state.meshMetaData.clients.push({ key: message.c, lastActivityTimestamp: message.t });\r\n        state.meshMetaData.clients.sort((a, b) => -(a.lastActivityTimestamp - b.lastActivityTimestamp));\r\n\r\n        if (oldClients.map(x => x.key).join(`;`) !== state.meshMetaData.clients.map(x => x.key).join(`;`)) {\r\n            state.meshState = reduceClientsState(state.meshState, state.meshMetaData.clients);\r\n            stateSub.onStateChange(state.meshState);\r\n        }\r\n    };\r\n\r\n    let sendSyncStateTimeoutId = setTimeout(() => { }, 0);\r\n    const websocket = createWebsocketConnection_smart<WebSocketMessageWithSenderInfo>({ websocketsApiUrl: websocketsApiConfig.websocketsApiUrl, channelKey: `wm_${channelKey}` }, message => {\r\n\r\n        if (message.kind === `close`) {\r\n            clearTimeout(sendSyncStateTimeoutId);\r\n            state.meshMetaData.clients = state.meshMetaData.clients.filter(x => x.key !== message.c);\r\n            state.meshState = reduceClientsState(state.meshState, state.meshMetaData.clients);\r\n            stateSub.onStateChange(state.meshState);\r\n            return;\r\n        }\r\n\r\n        updateClients(message);\r\n\r\n        if (message.kind === `pong`) {\r\n            clearTimeout(pingPongDropTimeoutId ?? 0);\r\n            pingPongDropTimeoutId = null;\r\n            return;\r\n        }\r\n        if (message.kind === `ping`) {\r\n            clearTimeout(pingPongDropTimeoutId ?? 0);\r\n            pingPongDropTimeoutId = null;\r\n            if (message.clientKeys.includes(clientKey)) {\r\n                setTimeout(sendPong);\r\n            }\r\n            return;\r\n        }\r\n        if (message.kind === `drop`) {\r\n            clearTimeout(pingPongDropTimeoutId ?? 0);\r\n            pingPongDropTimeoutId = null;\r\n            state.meshMetaData.clients = state.meshMetaData.clients.filter(x => !message.clientKeys.some(c => c === x.key));\r\n            state.meshState = reduceClientsState(state.meshState, state.meshMetaData.clients);\r\n            stateSub.onStateChange(state.meshState);\r\n            return;\r\n        }\r\n\r\n        if (message.kind === `join`) {\r\n            clearTimeout(sendSyncStateTimeoutId);\r\n\r\n            // Is self, ignore\r\n            if (message.c === clientKey) { return; }\r\n\r\n            // Respond with sync\r\n            const clientPriority = state.meshMetaData.clients.findIndex(x => x.key === clientKey) - 1;\r\n            const waitTime = clientPriority >= 0 ? clientPriority * 2000 : 10 * 1000;\r\n            sendSyncStateTimeoutId = setTimeout(sendSyncState, waitTime);\r\n            return;\r\n        }\r\n        if (message.kind === `sync`) {\r\n            // Is self, ignore\r\n            if (message.c === clientKey) { return; }\r\n\r\n            if (state.meshMetaData.firstMessageTimestamp\r\n                && state.meshMetaData.firstMessageTimestamp < message.state.meshMetaData.firstMessageTimestamp) {\r\n                // Ignore if the data is not complete (and send new sync message if needed)\r\n                sendSyncStateTimeoutId = setTimeout(sendSyncState, 10 * 1000);\r\n                return;\r\n            }\r\n\r\n            clearTimeout(sendSyncStateTimeoutId);\r\n\r\n            state.meshMetaData.firstMessageTimestamp = message.state.meshMetaData.firstMessageTimestamp;\r\n            state.meshMetaData.lastMessageTimestamp = message.state.meshMetaData.lastMessageTimestamp;\r\n            // state.meshMetaData.clients = message.state.meshMetaData.clients;\r\n            state.meshMetaData.clients = distinct_key([...state.meshMetaData.clients, ...message.state.meshMetaData.clients], x => x.key);\r\n            state.meshState = message.state.meshState;\r\n\r\n            // TODO: What about out of order messages?\r\n            // Replay missing messages\r\n            const missingMessages = messageHistory.filter(x => x.t > state.meshMetaData.lastMessageTimestamp);\r\n            for (const m of missingMessages) {\r\n                if (m.kind !== `message`) { return; }\r\n                state.meshState = reduceState(state.meshState, m.message);\r\n                state.meshMetaData.lastMessageTimestamp = m.t;\r\n            }\r\n\r\n            state.meshState = reduceClientsState(state.meshState, state.meshMetaData.clients);\r\n            stateSub.onStateChange(state.meshState);\r\n            return;\r\n        }\r\n        if (message.kind === `message`) {\r\n            // Accept own message into state once it returns\r\n            messageHistory.push(message);\r\n\r\n            if (!state.meshMetaData.firstMessageTimestamp) { state.meshMetaData.firstMessageTimestamp = message.t; }\r\n            state.meshMetaData.lastMessageTimestamp = message.t;\r\n            state.meshState = reduceState(state.meshState, message.message);\r\n            stateSub.onStateChange(state.meshState);\r\n        }\r\n    });\r\n\r\n    const sendWebSocketMessage = (message: WebSocketMessage) => {\r\n        websocket.send({ ...message, c: clientKey, t: Date.now() as Timestamp });\r\n    };\r\n    const connect = () => {\r\n        sendWebSocketMessage({ kind: `join` });\r\n    };\r\n    const sendSyncState = () => {\r\n        // Move self to front of client list\r\n        state.meshMetaData.clients = state.meshMetaData.clients.filter(x => x.key !== clientKey);\r\n        state.meshMetaData.clients.unshift({ key: clientKey, lastActivityTimestamp: Date.now() as Timestamp });\r\n\r\n        sendWebSocketMessage({ kind: `sync`, state });\r\n    };\r\n\r\n    // Ping-pong (Keep Alive)\r\n    const sendPong = () => {\r\n        sendWebSocketMessage({ kind: `pong` });\r\n    };\r\n    let pingPongDropTimeoutId = null as null | ReturnType<typeof setTimeout>;\r\n    const pingPongInterval = setInterval(() => {\r\n        if (pingPongDropTimeoutId) { return; }\r\n\r\n        const deadClients = state.meshMetaData.clients.filter(x => Date.now() > 45 * 1000 + x.lastActivityTimestamp);\r\n        if (deadClients.length > 0) {\r\n            // state.meshMetaData.clients = state.meshMetaData.clients.filter(x => !deadClients.some(d => d.key === x.key));\r\n            const clientPriority = state.meshMetaData.clients.findIndex(x => x.key === clientKey);\r\n            pingPongDropTimeoutId = setTimeout(() => {\r\n                pingPongDropTimeoutId = null;\r\n                const deadClients2 = state.meshMetaData.clients.filter(x => Date.now() > 45 * 1000 + x.lastActivityTimestamp);\r\n                if (deadClients2.length <= 0) { return; }\r\n                sendWebSocketMessage({ kind: `drop`, clientKeys: deadClients2.map(x => x.key) });\r\n            }, clientPriority * 5000);\r\n            return;\r\n        }\r\n\r\n        const oldClients = state.meshMetaData.clients.filter(x => Date.now() > 30 * 1000 + x.lastActivityTimestamp);\r\n        if (oldClients.length <= 0) { return; }\r\n\r\n        const clientPriority = state.meshMetaData.clients.findIndex(x => x.key === clientKey);\r\n        pingPongDropTimeoutId = setTimeout(() => {\r\n            pingPongDropTimeoutId = null;\r\n            const oldClients2 = state.meshMetaData.clients.filter(x => Date.now() > 30 * 1000 + x.lastActivityTimestamp);\r\n            if (oldClients2.length <= 0) { return; }\r\n\r\n            sendWebSocketMessage({ kind: `ping`, clientKeys: oldClients2.map(x => x.key) });\r\n        }, clientPriority * 5000);\r\n    }, 5000);\r\n\r\n    // Close\r\n    let isClosed = false;\r\n    const close = () => {\r\n        if (isClosed) { return; }\r\n        isClosed = true;\r\n        sendWebSocketMessage({ kind: `close` });\r\n        websocket.unsubscribe();\r\n        clearInterval(pingPongInterval);\r\n    };\r\n    const sendMessage = (message: TMeshMessage) => {\r\n        if (isClosed) { throw new AppError(`The connection is closed`); }\r\n        sendWebSocketMessage({ kind: `message`, message });\r\n    };\r\n\r\n\r\n    // Begin\r\n    connect();\r\n\r\n    return {\r\n        _webSocket: {\r\n            history: websocket.history,\r\n        },\r\n        clientKey,\r\n        sendMessage,\r\n        subscribe: stateSub.subscribe,\r\n        close,\r\n    };\r\n};\r\n\r\nexport type WebMeshClient = ReturnType<typeof createWebMeshClient>;\r\nexport type WebMeshClientWebSocketHistory = WebMeshClient['_webSocket']['history'];\r\nexport const createWebMeshClient = createWebMeshClient_websocketOnly;\r\n","export const randomIndex = (length: number) => {\r\n    const x = Math.floor(length * Math.random());\r\n    return x >= length ? length - 1 : x;\r\n};\r\nexport const randomItem = <T>(items: T[]) => items[randomIndex(items.length)];\r\n","\r\nexport enum IconKind {\r\n    // common icons\r\n    menu,\r\n    back,\r\n    error,\r\n    expanded,\r\n    collapsed,\r\n    copy,\r\n    retry,\r\n    dashboard,\r\n    add,\r\n    remove,\r\n    eye,\r\n    eyeSlash,\r\n\r\n    checkChecked,\r\n    checkUnchecked,\r\n\r\n    // navigation icons\r\n    account,\r\n    message,\r\n    subscription,\r\n    calendar,\r\n    contacts,\r\n    keys,\r\n    resources,\r\n    admin,\r\n}\r\n","import { randomItem } from 'utils/random';\r\nimport { shuffle, distinct_key } from 'utils/arrays';\r\nimport { UploadUrl } from 'upload-api/client/types';\r\nimport { uploadApiConfig } from 'upload-api/client/config';\r\nimport { createSmartUploader, downloadData } from 'upload-api/client/uploader';\r\nimport { toKeyValueArray } from 'utils/objects';\r\nimport { createUploadApiWebClient } from 'upload-api/client/web-client';\r\nimport { DoodleDrawingStorageService, DoodleData, decodeDoodleDrawing, encodeDoodleDrawing, DoodleScoreVote, DoodleScore, DoodleUserDrawingDataJson, DoodleUserVotesDataJson, DoodleSummaryDataJson } from './doodle';\r\nimport { doodleStoragePaths } from './doodle-paths';\r\n\r\ntype DoodleStorageData = {\r\n    doodleUploadUrl?: UploadUrl;\r\n    scoresUploadUrl?: UploadUrl;\r\n};\r\n\r\nconst storageAccess = {\r\n    load: (): null | DoodleStorageData => {\r\n        try {\r\n            return JSON.parse(localStorage.getItem(`doodleStorage.v2`) ?? `NULL!{}`);\r\n        } catch{ return null; }\r\n    },\r\n    save: (value: DoodleStorageData) => {\r\n        localStorage.setItem(`doodleStorage.v2`, JSON.stringify(value));\r\n    },\r\n};\r\n\r\n\r\nexport const createDoodleDrawingStorageService = async () => {\r\n\r\n    const remoteDoodle = createSmartUploader<DoodleUserDrawingDataJson>({\r\n        getUploadUrl: async () => storageAccess.load()?.doodleUploadUrl ?? null,\r\n        setUploadUrl: async (x) => storageAccess.save({ ...(storageAccess.load() ?? {}), doodleUploadUrl: x }),\r\n        uploadApiUrl: uploadApiConfig.uploadApiUrl,\r\n        uploadUrlPrefix: doodleStoragePaths.doodleDrawingsPrefix,\r\n    });\r\n    const remoteVotes = createSmartUploader<DoodleUserVotesDataJson>({\r\n        getUploadUrl: async () => storageAccess.load()?.scoresUploadUrl ?? null,\r\n        setUploadUrl: async (x) => storageAccess.save({ ...(storageAccess.load() ?? {}), scoresUploadUrl: x }),\r\n        uploadApiUrl: uploadApiConfig.uploadApiUrl,\r\n        uploadUrlPrefix: doodleStoragePaths.doodleVotesPrefix,\r\n    });\r\n\r\n    const getSummaryData = async () => {\r\n        try {\r\n            let uploadUrl = storageAccess.load()?.doodleUploadUrl;\r\n\r\n            if (!uploadUrl) {\r\n                const uploadApiWebClient = createUploadApiWebClient(uploadApiConfig);\r\n                uploadUrl = (await uploadApiWebClient.createUploadUrl({})).uploadUrl;\r\n            }\r\n\r\n            const serverUrl = uploadUrl?.getUrl.replace(uploadUrl.relativePath, ``);\r\n            const summaryUrl = `${serverUrl}${doodleStoragePaths.doodleSummary}`;\r\n            console.log(`getSummaryData`, { uploadUrl, serverUrl, summaryUrl });\r\n\r\n            const summaryDataRaw = await downloadData(summaryUrl) as DoodleSummaryDataJson;\r\n            const summaryData = {\r\n                doodles: summaryDataRaw.doodles.map(x => ({\r\n                    key: x.k,\r\n                    prompt: x.p,\r\n                    timestamp: x.t,\r\n                    drawing: decodeDoodleDrawing(x.d),\r\n                    score: x.s,\r\n                })),\r\n            };\r\n            return summaryData;\r\n        } catch{\r\n            return { doodles: [] };\r\n        }\r\n    };\r\n    const summaryData = await getSummaryData();\r\n\r\n    const memory = {\r\n        doodles: [] as DoodleData[],\r\n        doodleScores: [] as DoodleScore[],\r\n        doodleVotes: [] as DoodleScoreVote[],\r\n    };\r\n\r\n\r\n    // Load from server\r\n    memory.doodles = (await remoteDoodle.load())?.doodles.map(x => ({\r\n        key: x.k,\r\n        prompt: x.p,\r\n        timestamp: x.t,\r\n        drawing: x.d ? decodeDoodleDrawing(x.d) : (x as unknown as DoodleData).drawing,\r\n    })) ?? [];\r\n    memory.doodleVotes = (await remoteVotes.load())?.doodleVotes ?? [];\r\n\r\n    const voteTotals = {} as { [key: string]: number };\r\n    // memory.doodleVotes.forEach(x => { voteTotals[x.k] = (voteTotals[x.k] ?? 0) + 1; });\r\n    summaryData.doodles.forEach(x => { voteTotals[x.key] = (voteTotals[x.key] ?? 0) + x.score; });\r\n    memory.doodleScores = toKeyValueArray(voteTotals).map(x => ({\r\n        doodleKey: x.key,\r\n        score: x.value,\r\n    }));\r\n\r\n    const service: DoodleDrawingStorageService = {\r\n        saveDrawing: async (prompt, drawing) => {\r\n            const doodle = { key: `${prompt.substr(0, 8)}:${Date.now()}:${Math.floor(Math.random() * 999999)}`, drawing, prompt, timestamp: Date.now() };\r\n            memory.doodles.push(doodle);\r\n\r\n            // Save to server\r\n            setTimeout(async () => {\r\n                await remoteDoodle.save({\r\n                    doodles: memory.doodles.map(x => ({\r\n                        k: x.key,\r\n                        p: x.prompt,\r\n                        t: x.timestamp,\r\n                        d: encodeDoodleDrawing(x.drawing),\r\n                    })),\r\n                });\r\n            });\r\n        },\r\n        saveBestDrawingSelection: async (doodle) => {\r\n            memory.doodleVotes.push({\r\n                k: doodle.key,\r\n                t: Date.now(),\r\n            });\r\n\r\n            let d = memory.doodleScores.find(x => x.doodleKey === doodle.key);\r\n            if (!d) {\r\n                d = {\r\n                    doodleKey: doodle.key,\r\n                    score: 0,\r\n                };\r\n                memory.doodleScores.push(d);\r\n            }\r\n            d.score = (d.score ?? 0) + 1;\r\n\r\n            // Save to server\r\n            setTimeout(async () => {\r\n                await remoteVotes.save({\r\n                    doodleVotes: memory.doodleVotes,\r\n                });\r\n            });\r\n        },\r\n        getDrawings: async (prompt, options) => {\r\n            const {\r\n                includeOtherPrompts = false,\r\n                maxCount = 4,\r\n            } = options ?? {};\r\n\r\n            const allDoodles = distinct_key([...summaryData.doodles, ...memory.doodles.map(x => ({ ...x, score: memory.doodleScores.find(s => s.doodleKey === x.key)?.score ?? 0 }))], x => x.key);\r\n\r\n            const samePromptDrawings = allDoodles.filter(x => x.prompt === prompt).sort((a, b) => -(a.score - b.score));\r\n            console.log(`getDrawings`, { samePromptDrawings });\r\n\r\n            const otherPromptDrawings = includeOtherPrompts ? allDoodles.filter(x => x.prompt !== prompt) : [];\r\n            const allDrawings =\r\n                includeOtherPrompts ? [randomItem(samePromptDrawings), ...shuffle(otherPromptDrawings).slice(0, maxCount - 1)]\r\n                    : samePromptDrawings;\r\n            const drawings = shuffle(allDrawings).slice(0, maxCount);\r\n            return { doodles: drawings };\r\n        },\r\n        getAllDrawings: async () => {\r\n            const allDoodles = distinct_key([...summaryData.doodles, ...memory.doodles.map(x => ({ ...x, score: memory.doodleScores.find(s => s.doodleKey === x.key)?.score ?? 0 }))], x => x.key);\r\n            return { doodles: allDoodles };\r\n        },\r\n    };\r\n\r\n    return service;\r\n};\r\n","import React, { useState, useEffect } from 'react';\r\nimport { View, Text, TouchableOpacity } from 'react-native-lite';\r\nimport { useAutoLoadingError } from 'utils-react/hooks';\r\nimport { UserDataService, UserProfileInfo } from './user-data-service';\r\nimport { UserProfileManagerView } from './user-profile-manager-view';\r\n\r\nconst styles = {\r\n    container: {\r\n        flexDirection: `row`,\r\n        flexWrap: `wrap`,\r\n        justifyContent: `space-around`,\r\n    },\r\n    profileContainer: {\r\n        flexDirection: `column`,\r\n        alignItems: `center`,\r\n    },\r\n    profileCharacterView: {\r\n        width: 80,\r\n        height: 80,\r\n        borderWidth: 1,\r\n        borderStyle: `solid`,\r\n        borderColor: `#888888`,\r\n    },\r\n    profileCharacterText: {\r\n        fontSize: 48,\r\n        textAlign: `center`,\r\n    },\r\n    profileNameView: {\r\n    },\r\n    profileNameText: {\r\n\r\n    },\r\n} as const;\r\n\r\nexport const UserProfileSelectionView = (props: { onUserSelected: () => void }) => {\r\n    const { loading, error, doWork } = useAutoLoadingError();\r\n    const [userProfiles, setUserProfiles] = useState(null as null | UserProfileInfo[]);\r\n    const [isManagerVisible, setIsManagerVisible] = useState(false);\r\n\r\n    const reload = () => doWork(async (stopIfObsolete) => {\r\n        await UserDataService.get().setup();\r\n        stopIfObsolete();\r\n\r\n        const profiles = await UserDataService.get().getUserProfiles();\r\n        setUserProfiles(profiles);\r\n    });\r\n\r\n    const selectUser = (key: string) => doWork(async (stopIfObsolete) => {\r\n        await UserDataService.get().setActiveUser(key);\r\n        props.onUserSelected();\r\n    });\r\n\r\n    const onEditProfiles = () => {\r\n        setIsManagerVisible(true);\r\n    };\r\n\r\n    useEffect(() => {\r\n        reload();\r\n    }, []);\r\n\r\n    if (!userProfiles) {\r\n        return (<></>);\r\n    }\r\n\r\n    if (isManagerVisible) {\r\n        return <UserProfileManagerView onClose={() => { setIsManagerVisible(false); reload(); }} />;\r\n    }\r\n\r\n    return (\r\n        <View style={styles.container}>\r\n            {userProfiles.map(x => (\r\n                <TouchableOpacity key={x.key} onPress={() => selectUser(x.key)}>\r\n                    <View style={styles.profileContainer}>\r\n                        <View style={styles.profileCharacterView}>\r\n                            <Text style={styles.profileCharacterText}>{x.emoji ?? ``}</Text>\r\n                        </View>\r\n                        <View style={styles.profileNameView}>\r\n                            <Text style={styles.profileNameText}>{x.name}</Text>\r\n                        </View>\r\n                    </View>\r\n                </TouchableOpacity>\r\n            ))}\r\n            <TouchableOpacity onPress={onEditProfiles}>\r\n                <View style={styles.profileContainer}>\r\n                    <View style={styles.profileCharacterView}>\r\n                        <Text style={styles.profileCharacterText}>{`  `}</Text>\r\n                    </View>\r\n                    <View style={styles.profileNameView}>\r\n                        <Text style={styles.profileNameText}>Edit</Text>\r\n                    </View>\r\n                </View>\r\n            </TouchableOpacity>\r\n        </View>\r\n    );\r\n};\r\n","export type EmojiSkillNode = {\r\n    emoji: string;\r\n    name: string;\r\n    gender: `baby` | `male` | `female`;\r\n    pay: number;\r\n    startEmoji: null | string;\r\n    requirementEmojis: string[];\r\n    debug_totalRequirementsCost?: string;\r\n\r\n    parent: null | EmojiSkillNode;\r\n    children: EmojiSkillNode[];\r\n};\r\nexport type EmojiSkillRequirement = {\r\n    emoji: string;\r\n    cost: number;\r\n};\r\nexport type EmojiSkillTree = {\r\n    allNodes: EmojiSkillNode[];\r\n    allRequirements: EmojiSkillRequirement[];\r\n    root: EmojiSkillNode;\r\n};\r\n\r\n\r\nexport const buildEmojiSkillTree = (): EmojiSkillTree => {\r\n    const maleSkillDoc = `${child_male}\\n${student_male}\\n${skillDoc}`;\r\n    const femaleSkillDoc = `${child_female}\\n${student_female}\\n\\n${getFemaleVariant(skillDoc)}`;\r\n    const maleNodes = parseSkillDoc(maleSkillDoc, `male`);\r\n    const femaleNodes = parseSkillDoc(femaleSkillDoc, `female`);\r\n    const babyNode: EmojiSkillNode = {\r\n        emoji: babyEmoji,\r\n        name: `baby`,\r\n        gender: `baby`,\r\n        pay: 0,\r\n        requirementEmojis: [],\r\n        startEmoji: null,\r\n        parent: null,\r\n        children: [],\r\n    };\r\n    const allNodes = [babyNode, ...maleNodes, ...femaleNodes];\r\n    const root = babyNode;\r\n\r\n    allNodes.forEach(child => {\r\n        const parent = allNodes.find(x => child.startEmoji === x.emoji);\r\n        if (!parent) { return; }\r\n\r\n        parent.children.push(child);\r\n        child.parent = parent;\r\n    });\r\n\r\n    const allRequirements = parseRequirementsDoc(requirementsDoc);\r\n\r\n    allNodes.forEach(node => {\r\n        const allCosts = node.requirementEmojis\r\n            .map(r => allRequirements.find(x => x.emoji === r) ?? { emoji: r, cost: 0 });\r\n\r\n        const summary = allCosts\r\n            .map(x => `${x.emoji} = ${x.cost}`)\r\n            .join(`\\n`);\r\n\r\n        // eslint-disable-next-line unicorn/no-reduce\r\n        const totalCost = allCosts.reduce((out, x) => { out += x.cost; return out; }, 0);\r\n        node.debug_totalRequirementsCost = `${totalCost} =\\n${summary}`;\r\n    });\r\n\r\n    const tree: EmojiSkillTree = {\r\n        allNodes,\r\n        root,\r\n        allRequirements,\r\n    };\r\n\r\n    // const allRequirements = distinct(allNodes.flatMap(x => x.requirementEmojis));\r\n    // const allRequirementsDoc = allRequirements.map(x => `${x} = 0`).join(`\\n`);\r\n\r\n    // console.log(`buildSkillTree`, { tree, maleSkillDoc, femaleSkillDoc });\r\n    return tree;\r\n};\r\n// setTimeout(buildEmojiSkillTree);\r\n\r\nconst parseRequirementsDoc = (doc: string) => {\r\n    const lines = doc.split(`\\n`).map(x => x.trim()).filter(x => x);\r\n    const nodes = lines.map(line => {\r\n        const parts = line.split(`=`).map(x => x.trim()).filter(x => x);\r\n        const r: EmojiSkillRequirement = {\r\n            emoji: parts[0],\r\n            cost: Number.parseInt(parts[1], 10),\r\n        };\r\n        return r;\r\n    });\r\n    return nodes;\r\n};\r\n\r\nconst parseSkillDoc = (doc: string, gender: 'male' | 'female') => {\r\n    const lines = doc.split(`\\n`).map(x => x.trim()).filter(x => x);\r\n    const nodes = lines.map(x => parseSkillLine(x, gender));\r\n    return nodes;\r\n};\r\n\r\nconst parseSkillLine = (skillLine: string, gender: 'male' | 'female'): EmojiSkillNode => {\r\n    const [name, payText, p1] = skillLine.split(`:`).map(x => x.trim());\r\n    const pay = Number.parseInt(payText, 10);\r\n    const [end, p2] = p1.split(`=`).map(x => x.trim());\r\n    const [start, requirementsStr] = p2.split(`+`).map(x => x.trim());\r\n    const requirements = requirementsStr.split(` `).map(x => x.trim()).filter(x => x);\r\n    return { name, pay, emoji: end, startEmoji: start, requirementEmojis: requirements, children: [], parent: null, gender };\r\n};\r\n\r\nconst getFemaleVariant = (emoji: string) => {\r\n    return emoji\r\n        .replace(new RegExp(genderCharCodes.male, `g`), genderCharCodes.female)\r\n        .replace(new RegExp(genderCharCodes.man, `g`), genderCharCodes.woman);\r\n};\r\n\r\nconst genderCharCodes = {\r\n    man: String.fromCodePoint(0x1F468),\r\n    woman: String.fromCodePoint(0x1F469),\r\n    male: String.fromCodePoint(0x1F469),\r\n    female: String.fromCodePoint(0x1F469),\r\n};\r\n\r\nconst babyEmoji = ``;\r\nconst child_male = `boy               : 0 :  =  +           `;\r\nconst child_female = `girl            : 0 :  =  +           `;\r\nconst student_male = `  student_boy   : 0 :  =  +          `;\r\nconst student_female = `student_girl  : 0 :  =  +          `;\r\n\r\nconst skillDoc = `\r\nfactory_worker      :   20000 :  =  +                    \r\nmechanic            :   30000 :  =  +               \r\nconstruction_worker :   75000 :  =  +                             \r\nartist              :   35000 :  =  +                     \r\nsinger              :   40000 :  =  +               \r\nfarmer              :   50000 :  =  +                   \r\ncook                :   40000 :  =  +                   \r\nfirefighter         :   55000 :  =  +          \r\npolice_officer      :   60000 :  =  +                    \r\ndetective           :   70000 :  =  +                 \r\nteacher             :   50000 :  =  +       \r\noffice_worker       :   60000 :  =  +                     \r\ntechnologist        :   80000 :  =  +                      \r\nscientist           :   90000 :  =  +                    \r\njudge               :  120000 :  =  +          \r\nhealth_worker       :  100000 :  =  +          \r\npilot               :  110000 :  =  +            \r\nastronaut           :  130000 :  =  +       \r\n`;\r\n\r\nconst requirementsDoc = `\r\n = 10\r\n = 10\r\n = 20\r\n = 20\r\n = 10\r\n = 20\r\n = 30\r\n = 50\r\n = 25\r\n = 150\r\n = 200\r\n\r\n = 20\r\n = 20\r\n = 10\r\n = 20\r\n = 30\r\n\r\n = 30\r\n = 10\r\n = 20\r\n = 500\r\n = 15\r\n = 350\r\n = 1250\r\n = 7000\r\n = 800\r\n = 10000\r\n\r\n = 20\r\n = 80\r\n = 110\r\n = 25\r\n = 15\r\n = 300\r\n = 700\r\n = 35000\r\n = 150\r\n = 75\r\n = 150\r\n = 3000\r\n = 16000\r\n = 32000\r\n = 100\r\n = 70\r\n = 50\r\n = 35\r\n = 15\r\n = 15\r\n = 80\r\n = 150\r\n = 400\r\n = 150\r\n = 120\r\n = 750\r\n = 320\r\n = 450\r\n = 320\r\n = 1450\r\n = 25\r\n = 10\r\n = 35\r\n = 25\r\n = 30\r\n = 350\r\n = 150\r\n = 120\r\n = 100\r\n = 15000\r\n = 25\r\n = 30\r\n = 20\r\n = 75\r\n = 100\r\n = 50\r\n = 120\r\n = 350\r\n = 120\r\n = 225\r\n = 150\r\n = 250\r\n = 50\r\n = 75\r\n = 135000\r\n = 15000\r\n = 750\r\n = 500\r\n = 1250\r\n = 150\r\n = 55000\r\n = 250\r\n = 55\r\n = 85\r\n = 125\r\n = 25\r\n = 75\r\n = 25\r\n = 60\r\n = 30\r\n = 16000\r\n = 250\r\n = 150\r\n = 50\r\n = 750\r\n = 75\r\n = 150\r\n = 50\r\n = 1500\r\n = 150\r\n = 25\r\n = 3500\r\n = 150\r\n = 300\r\n = 250\r\n = 150\r\n = 650\r\n = 150\r\n = 100\r\n = 120\r\n = 1200\r\n = 1500\r\n = 75000\r\n = 550\r\n = 50\r\n = 850\r\n = 1500000\r\n = 350\r\n = 150000000\r\n`;\r\n","import { createSubscribable } from 'utils/subscribable';\r\nimport { toMap } from 'utils/objects';\r\nimport { buildEmojiSkillTree } from './emoji-skills/emoji-skill-tree';\r\n\r\nexport type EmojiIdleEmotionKind = 'excited' | 'happy' | 'normal' | 'angry' | 'sick' | 'dead';\r\nexport type EmojiIdleState = {\r\n    characterEmoji: string;\r\n    targetEmoji?: string;\r\n    targetOptions?: { emoji: string }[];\r\n    requirementsPurchased?: string[];\r\n    requirementsAvailable?: { emoji: string, cost: number }[];\r\n    requirementsRemaining?: { emoji: string, cost: number }[];\r\n    requirementsNeeded?: { emoji: string, cost: number }[];\r\n    lastPurchaseTimestamp: number;\r\n\r\n    emotion: EmojiIdleEmotionKind;\r\n    lastEmotionTimestamp: number;\r\n\r\n    money: number;\r\n\r\n    multiplier: number;\r\n    lastMultiplierChangeTimestamp: number;\r\n\r\n    townState: {\r\n        characters: {\r\n            characterEmoji: string;\r\n            finishedTimestamp: number;\r\n            // requirementsPurchased: string[];\r\n        }[];\r\n    };\r\n};\r\n\r\nconst storageKey = `EmojiIdleState`;\r\nconst storage = {\r\n    save: (value: EmojiIdleState) => { localStorage.setItem(storageKey, JSON.stringify(value)); },\r\n    load: () => {\r\n        if (!localStorage.getItem(storageKey)) { return null; }\r\n        try {\r\n            return JSON.parse(localStorage.getItem(storageKey) ?? ``);\r\n        } catch{\r\n            return null;\r\n        }\r\n    },\r\n};\r\n\r\nconst createService = () => {\r\n    const skillTree = buildEmojiSkillTree();\r\n    const reqMap = toMap(skillTree.allRequirements.map(x => ({ key: x.emoji, value: x })));\r\n\r\n    const defaultState: EmojiIdleState = {\r\n        characterEmoji: skillTree.root.emoji,\r\n        emotion: `normal`,\r\n        lastEmotionTimestamp: Date.now(),\r\n        money: 0,\r\n        multiplier: 1,\r\n        lastMultiplierChangeTimestamp: Date.now(),\r\n        lastPurchaseTimestamp: Date.now(),\r\n        townState: {\r\n            characters: [],\r\n        },\r\n    };\r\n    let s: EmojiIdleState = storage.load() ?? defaultState;\r\n\r\n    // Load missing state fields\r\n    s = { ...defaultState, ...s };\r\n\r\n    // // Hard code Missing Town Characters for Kids Accounts\r\n    // s.townState = {\r\n    //     // characters: [...skillTree.allNodes.filter(x => x.children.length <= 0).slice(0, 5).map(x => ({\r\n    //     //     characterEmoji: x.emoji,\r\n    //     //     finishedTimestamp: Date.now() - Math.random() * 1000 * 60 * 60 * 24 * 7,\r\n    //     // }))],\r\n    //     characters: [...skillTree.allNodes\r\n    //         .filter(x => x.name === `artist` && x.gender === `female`)\r\n    //         .map(x => ({\r\n    //             characterEmoji: x.emoji,\r\n    //             finishedTimestamp: Math.floor(Date.now() - 0.25 * 1000 * 60 * 60 * 24),\r\n    //         }))],\r\n    // };\r\n\r\n    const sub = createSubscribable<EmojiIdleState>(s);\r\n\r\n    const changeState = (partialState: Partial<EmojiIdleState>) => {\r\n        // console.log(`changePetState`, { partialState, before: { ...s } });\r\n        s = { ...s, ...partialState };\r\n        sub.onStateChange(s);\r\n        storage.save(s);\r\n    };\r\n\r\n    const rewardInner = (value: number) => {\r\n        // max multiplier - keeps things more linear?\r\n        const maxMultiplier = 100;\r\n        changeState({\r\n            money: s.money + s.multiplier,\r\n            multiplier: Math.min(maxMultiplier, s.multiplier + value),\r\n            lastMultiplierChangeTimestamp: Date.now(),\r\n        });\r\n    };\r\n\r\n    const punish = () => {\r\n        // This is the only way to lose multiplier\r\n        changeState({\r\n            multiplier: Math.max(1, s.multiplier - 5),\r\n            lastMultiplierChangeTimestamp: Date.now(),\r\n        });\r\n    };\r\n\r\n    const selectOption = (emoji: string) => {\r\n        // console.log(`selectOption`, { emoji });\r\n\r\n        // Choose character\r\n        if (s.targetOptions?.find(x => x.emoji === emoji)) {\r\n            if (emoji === skillTree.root.emoji) {\r\n                // Add finished character to town\r\n                s.townState.characters.push({\r\n                    characterEmoji: s.characterEmoji,\r\n                    finishedTimestamp: Date.now(),\r\n                });\r\n            }\r\n\r\n            changeState({\r\n                targetEmoji: emoji,\r\n                targetOptions: undefined,\r\n                emotion: `excited`,\r\n                lastEmotionTimestamp: Date.now(),\r\n                lastPurchaseTimestamp: Date.now(),\r\n\r\n                money: 0,\r\n                // money: emoji === skillTree.root.emoji ? 0 : s.money,\r\n            });\r\n        }\r\n\r\n        // Purchases\r\n        const r = s.requirementsAvailable?.find(x => x.emoji === emoji);\r\n        if (r && r.cost <= s.money) {\r\n            // Purchase \r\n            changeState({\r\n                requirementsPurchased: [...s.requirementsPurchased ?? [], r.emoji],\r\n                requirementsRemaining: undefined,\r\n                money: s.money - r.cost,\r\n                requirementsAvailable: undefined,\r\n                emotion: `excited`,\r\n                lastEmotionTimestamp: Date.now(),\r\n                lastPurchaseTimestamp: Date.now(),\r\n            });\r\n        }\r\n\r\n        // Ignore\r\n    };\r\n\r\n    // Update state\r\n    setInterval(() => {\r\n        const second = 1000;\r\n        const minute = 60 * second;\r\n        const hour = 60 * minute;\r\n\r\n        // console.log(`emoji - idle - service update`, {});\r\n\r\n        // This is too powerful against slow players\r\n        // // Decrease Multiplier over time\r\n        // const decTime = 3 * second;\r\n        // if (s.multiplier > 1 && Date.now() > s.lastMultiplierChangeTimestamp + decTime) {\r\n        //     const timeDelta = Date.now() - s.lastMultiplierChangeTimestamp;\r\n        //     const multChange = Math.floor(timeDelta / decTime);\r\n\r\n        //     // console.log(`emoji - idle - service`, { timeDelta, multChange });\r\n        //     changeState({\r\n        //         multiplier: Math.max(1, s.multiplier - multChange),\r\n        //         lastMultiplierChangeTimestamp: Date.now(),\r\n        //     });\r\n        // }\r\n\r\n        // Choose target\r\n        if (!s.targetEmoji && !s.targetOptions) {\r\n            const skillNode = skillTree.allNodes.find(x => x.emoji === s.characterEmoji);\r\n            if (skillNode) {\r\n                let t = skillNode.children.map(x => ({ emoji: x.emoji }));\r\n                const remainingSkills = t.filter(x => !s.townState.characters.find(c => c.characterEmoji));\r\n\r\n                if (remainingSkills.length > 0) {\r\n                    t = remainingSkills;\r\n                }\r\n\r\n                if (t.length === 0) {\r\n                    // Top of skill tree\r\n                    changeState({\r\n                        targetOptions: [{ emoji: skillTree.root.emoji }],\r\n                    });\r\n                }\r\n                // else if (t.length === 1) {\r\n                //     // Auto select\r\n                //     changeState({\r\n                //         targetEmoji: t[0].emoji,\r\n                //     });\r\n                // } \r\n                else {\r\n                    changeState({\r\n                        targetOptions: t,\r\n                    });\r\n                }\r\n            }\r\n        }\r\n\r\n        // Populate Available Requirements\r\n        if (s.targetEmoji) {\r\n            const targetSkillNode = skillTree.allNodes.find(x => x.emoji === s.targetEmoji);\r\n            if (targetSkillNode) {\r\n                // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\r\n                const reqs = targetSkillNode.requirementEmojis.map(x => reqMap.get(x)).filter(x => x).map(x => x!);\r\n                const reqs_remaining = reqs.filter(x => !s.requirementsPurchased?.includes(x.emoji));\r\n                reqs_remaining.sort((a, b) => a.cost - b.cost);\r\n                const reqs_available = reqs_remaining.filter(x => x.cost <= s.money);\r\n\r\n                if (reqs_available.length !== s.requirementsAvailable?.length) {\r\n                    changeState({\r\n                        requirementsNeeded: reqs,\r\n                        requirementsAvailable: reqs_available,\r\n                    });\r\n                }\r\n\r\n                if (reqs_remaining.length !== s.requirementsRemaining?.length) {\r\n                    changeState({\r\n                        requirementsRemaining: reqs_remaining,\r\n                    });\r\n                }\r\n\r\n                // Target completed\r\n                if (reqs_remaining.length <= 0) {\r\n                    changeState({\r\n                        characterEmoji: s.targetEmoji,\r\n                        targetEmoji: undefined,\r\n                        targetOptions: undefined,\r\n                        requirementsAvailable: undefined,\r\n                        requirementsNeeded: undefined,\r\n                        requirementsPurchased: undefined,\r\n                    });\r\n                }\r\n            }\r\n\r\n            // Emotion\r\n            if (Date.now() > (s.lastEmotionTimestamp ?? 0) + 15 * second) {\r\n                // TODO: Sickness\r\n                const emotion = Date.now() > (s.lastPurchaseTimestamp ?? 0) + 5 * minute ? `angry`\r\n                    : `normal`;\r\n\r\n                if (s.emotion !== emotion) {\r\n                    changeState({ emotion, lastEmotionTimestamp: Date.now() });\r\n                }\r\n            }\r\n        }\r\n\r\n    }, 1000);\r\n\r\n    return {\r\n        subscribePetStateChange: sub.subscribe,\r\n        reward: () => rewardInner(1),\r\n        reward_major: () => rewardInner(10),\r\n        reward_extreme: () => rewardInner(100),\r\n        punish,\r\n\r\n        selectOption,\r\n    };\r\n};\r\n\r\nexport type EmojiIdleService = ReturnType<typeof createService>;\r\n\r\nconst serviceState = {\r\n    instance: null as null | EmojiIdleService,\r\n};\r\nexport const EmojiIdleService = {\r\n    get: () => {\r\n        // eslint-disable-next-line no-return-assign\r\n        return serviceState.instance ?? (serviceState.instance = createService());\r\n    },\r\n    reset: () => {\r\n        serviceState.instance = createService();\r\n    },\r\n};\r\n","import React, { useState, useEffect, useRef } from 'react';\r\nimport { View, Text, TouchableOpacity } from 'react-native-lite';\r\nimport { shuffle } from 'utils/arrays';\r\nimport { EmojiIdleService, EmojiIdleState, EmojiIdleEmotionKind } from './emoji-idle-service';\r\nimport { buildEmojiSkillTree } from './emoji-skills/emoji-skill-tree';\r\n\r\nexport const styles = {\r\n    container: {\r\n        height: 40,\r\n    },\r\n    fixed: {\r\n        position: `fixed`,\r\n        top: 0, right: 0, left: 0,\r\n        zIndex: 1000,\r\n    },\r\n    inner: {\r\n        position: `relative`,\r\n        height: 40,\r\n    },\r\n    emotionEmoji: {\r\n        fontFamily: `\"Lucida Console\", Monaco, monospace`,\r\n        fontSize: 24,\r\n    },\r\n    characterEmoji: {\r\n        fontFamily: `\"Lucida Console\", Monaco, monospace`,\r\n        fontSize: 24,\r\n    },\r\n    characterEmoji_small: {\r\n        fontFamily: `\"Lucida Console\", Monaco, monospace`,\r\n        fontSize: 16,\r\n    },\r\n    costText: {\r\n        fontFamily: `\"Lucida Console\", Monaco, monospace`,\r\n        fontSize: 16,\r\n        color: `#00FF00`,\r\n    },\r\n    costText_small: {\r\n        fontFamily: `\"Lucida Console\", Monaco, monospace`,\r\n        fontSize: 10,\r\n        color: `#00FF00`,\r\n    },\r\n    targetCharacterEmoji: {\r\n        fontFamily: `\"Lucida Console\", Monaco, monospace`,\r\n        fontSize: 16,\r\n    },\r\n    objectEmoji: {\r\n        fontFamily: `\"Lucida Console\", Monaco, monospace`,\r\n        fontSize: 12,\r\n    },\r\n\r\n    money: {\r\n        fontFamily: `\"Lucida Console\", Monaco, monospace`,\r\n        fontSize: 20,\r\n        color: `#FFFF00`,\r\n        marginLeft: 8,\r\n    },\r\n    money_small: {\r\n        fontFamily: `\"Lucida Console\", Monaco, monospace`,\r\n        fontSize: 16,\r\n        color: `#FFFF00`,\r\n    },\r\n    multiplier: {\r\n        fontFamily: `\"Lucida Console\", Monaco, monospace`,\r\n        fontSize: 14,\r\n        color: `#FF00FF`,\r\n        marginLeft: 8,\r\n    },\r\n    foodText: {\r\n        fontFamily: `\"Lucida Console\", Monaco, monospace`,\r\n        fontSize: 12,\r\n        color: `#333300`,\r\n    },\r\n} as const;\r\n\r\nexport const EmojiIdleView = (props: {}) => {\r\n    const [gameState, setGameState] = useState(null as null | EmojiIdleState);\r\n    const [isExpanded, setIsExpanded] = useState(false);\r\n    useEffect(() => {\r\n        const service = EmojiIdleService.get();\r\n        const sub = service.subscribePetStateChange(setGameState);\r\n        return () => sub.unsubscribe();\r\n    });\r\n\r\n    if (isExpanded && gameState) {\r\n        return (\r\n            <TownView gameState={gameState} onClose={() => setIsExpanded(false)} />\r\n        );\r\n    }\r\n\r\n    return (\r\n        <View style={styles.container}>\r\n            <View style={styles.fixed}>\r\n                <View style={styles.inner}>\r\n                    <EmojiCharacterView\r\n                        emoji={gameState?.characterEmoji ?? ``}\r\n                        targetEmoji={gameState?.targetEmoji ?? ``}\r\n                        emotion={gameState?.emotion ?? null}\r\n                        purchased={gameState?.requirementsPurchased ?? []}\r\n                        onPress={() => setIsExpanded(s => !s)}\r\n                    />\r\n                    {gameState && <CommandsView gameState={gameState} />}\r\n                    {/* {gameState && gameState.food > 0 && [...new Array(gameState.food)].map((x, i) => (\r\n                        // eslint-disable-next-line react/no-array-index-key\r\n                        <View key={`${i}`} style={{ position: `absolute`, transform: `translate(${100 + i * 87 % 100}px,${4 + i * 43 % 12}px)` }} >\r\n                            <Text style={styles.foodText}>{getFoodVariant(i)}</Text>\r\n                        </View>\r\n                    ))} */}\r\n                </View>\r\n            </View>\r\n        </View>\r\n    );\r\n};\r\n\r\nexport const townStyles = {\r\n    container: {\r\n        background: `#555555`,\r\n    },\r\n    payText: {\r\n        fontFamily: `\"Lucida Console\", Monaco, monospace`,\r\n        fontSize: 14,\r\n        color: `#FFFFFF`,\r\n    },\r\n    payText_disabled: {\r\n        fontFamily: `\"Lucida Console\", Monaco, monospace`,\r\n        fontSize: 14,\r\n        color: `#CCCCCC`,\r\n    },\r\n    moneyText: {\r\n        fontFamily: `\"Lucida Console\", Monaco, monospace`,\r\n        fontSize: 16,\r\n        color: `#FFFF00`,\r\n    },\r\n    townMoneyText: {\r\n        fontFamily: `\"Lucida Console\", Monaco, monospace`,\r\n        fontSize: 16,\r\n        color: `#00FF00`,\r\n    },\r\n} as const;\r\n\r\nconst skillTree = buildEmojiSkillTree();\r\nconst TownView = ({ gameState, onClose }: { gameState: EmojiIdleState, onClose: () => void }) => {\r\n    // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\r\n    const townPersons = gameState.townState.characters.map(x => ({\r\n        character: x,\r\n        skill: skillTree.allNodes.find(n => n.emoji === x.characterEmoji) ?? skillTree.root,\r\n    }))\r\n        .filter(x => x.skill.pay)\r\n        .map(x => ({\r\n            ...x,\r\n            years: (Date.now() - x.character.finishedTimestamp) / (24 * 60 * 60 * 1000),\r\n            money: Math.floor((Date.now() - x.character.finishedTimestamp) / (24 * 60 * 60 * 1000) * x.skill.pay),\r\n        }));\r\n    const missingSkills = skillTree.allNodes.filter(x => x.children.length <= 0 && !gameState.townState.characters.find(t => t.characterEmoji === x.emoji));\r\n    // eslint-disable-next-line unicorn/no-reduce\r\n    const townMoney = townPersons.reduce((out, x) => { out += x.money ?? 0; return out; }, 0);\r\n    return (\r\n        <View style={townStyles.container}>\r\n            <View>\r\n                <View style={{ background: `#333333`, flexDirection: `row`, alignItems: `center` }}>\r\n                    <View style={{ position: `relative`, width: 100, height: 40 }}>\r\n                        <View style={{ position: `absolute`, left: 0, top: 0, flexDirection: `column`, alignItems: `flex-end` }} >\r\n                            <TouchableOpacity onPress={() => onClose()}>\r\n                                <Text style={styles.characterEmoji}>{`  `}</Text>\r\n                            </TouchableOpacity>\r\n                        </View>\r\n                    </View>\r\n                    <View style={{ flex: 1 }} />\r\n                    <View style={{ padding: 4 }}>\r\n                        <Text style={townStyles.townMoneyText}>{`$${(townMoney).toLocaleString()}`}</Text>\r\n                    </View>\r\n                </View>\r\n            </View>\r\n            <View style={{ background: `#333333`, flexDirection: `row`, alignItems: `center` }}>\r\n                <View style={{ position: `relative`, width: 100, height: 40 }}>\r\n                    <EmojiCharacterView\r\n                        emoji={gameState?.characterEmoji ?? ``}\r\n                        targetEmoji={gameState?.targetEmoji ?? ``}\r\n                        emotion={gameState?.emotion ?? null}\r\n                        purchased={gameState?.requirementsPurchased ?? []}\r\n                        onPress={() => onClose()}\r\n                    />\r\n                </View>\r\n            </View>\r\n            {/* Finished Characters */}\r\n            {townPersons.map(x => (\r\n                <View style={{ background: `#333333`, flexDirection: `row`, alignItems: `center` }}>\r\n                    <View style={{ position: `relative`, width: 100, height: 40 }}>\r\n                        <EmojiCharacterView\r\n                            emoji={x.character.characterEmoji}\r\n                            targetEmoji=''\r\n                            emotion='happy'\r\n                            purchased={x.skill?.requirementEmojis ?? []}\r\n                        />\r\n                    </View>\r\n                    <View style={{ padding: 4 }}>\r\n                        <Text style={townStyles.payText}>{`$${(x.skill?.pay ?? 0).toLocaleString()}`}</Text>\r\n                    </View>\r\n                    <View style={{ padding: 4 }}>\r\n                        <Text style={townStyles.payText}>{`x${(x.years).toFixed(1)}`}</Text>\r\n                    </View>\r\n                    <View style={{ flex: 1 }} />\r\n                    <View style={{ padding: 4 }}>\r\n                        <Text style={townStyles.moneyText}>{`$${(x.money).toLocaleString()}`}</Text>\r\n                    </View>\r\n                </View>\r\n            ))}\r\n            {/* Missing Characters */}\r\n            {missingSkills.map(x => (\r\n                <View style={{ background: `#555555`, flexDirection: `row`, alignItems: `center` }}>\r\n                    <View style={{ position: `relative`, width: 100, height: 40, opacity: 0.5 }}>\r\n                        <EmojiCharacterView\r\n                            emoji={x.emoji}\r\n                            targetEmoji=''\r\n                            emotion={null}\r\n                            purchased={[]}\r\n                        />\r\n                    </View>\r\n                    <View style={{ padding: 4 }}>\r\n                        <Text style={townStyles.payText_disabled}>{`$${(x.pay).toLocaleString()}`}</Text>\r\n                    </View>\r\n                </View>\r\n            ))}\r\n        </View>\r\n    );\r\n};\r\n\r\nconst CommandsView = ({ gameState }: { gameState: EmojiIdleState }) => {\r\n\r\n    const [offset, setOffset] = useState(0);\r\n    useEffect(() => {\r\n        setOffset(0);\r\n    }, [gameState.targetOptions, gameState.requirementsAvailable]);\r\n\r\n    if (gameState.targetOptions && gameState.targetOptions.length > 0) {\r\n        const listSize = 4;\r\n        const targetOptionsLength = gameState.targetOptions.length;\r\n        return (\r\n            <View style={{ position: `absolute`, top: 0, left: 0, right: 0 }} >\r\n                <View style={{ flexDirection: `row`, justifyContent: `center` }}>\r\n                    {gameState.targetOptions.slice(offset, offset + listSize).map(x => (\r\n                        <TouchableOpacity key={x.emoji} onPress={() => EmojiIdleService.get().selectOption(x.emoji)}>\r\n                            <View>\r\n                                <Text style={styles.characterEmoji}>{x.emoji}</Text>\r\n                            </View>\r\n                        </TouchableOpacity>\r\n                    ))}\r\n                    {targetOptionsLength > listSize && (\r\n                        <TouchableOpacity onPress={() => setOffset(s => { const i = s + 5; return i >= targetOptionsLength ? 0 : i; })}>\r\n                            <View>\r\n                                <Text style={styles.characterEmoji}>{offset + listSize < targetOptionsLength ? `` : ``}</Text>\r\n                            </View>\r\n                        </TouchableOpacity>\r\n                    )}\r\n                </View>\r\n            </View>\r\n        );\r\n    }\r\n\r\n    // if (gameState.requirementsAvailable && gameState.requirementsAvailable.length > 0) {\r\n    //     return (\r\n    //         <View style={{ position: `absolute`, top: 0, left: 0, right: 0 }} >\r\n    //             <View style={{ alignSelf: `center`, alignItems: `center`, background: `#222222`, borderRadius: 4, padding: 4 }}>\r\n    //                 <View style={{ flexDirection: `row`, justifyContent: `center` }}>\r\n    //                     {gameState.requirementsAvailable.slice(0, 5).map(x => (\r\n    //                         <TouchableOpacity key={x.emoji} onPress={() => EmojiIdleService.get().selectOption(x.emoji)}>\r\n    //                             <View style={{ flexDirection: `column`, margin: 4, alignItems: `center`, background: `#333333`, borderRadius: 4 }}>\r\n    //                                 <Text style={styles.characterEmoji}>{x.emoji}</Text>\r\n    //                                 <Text style={styles.costText}>{`$${x.cost.toLocaleString()}`}</Text>\r\n    //                             </View>\r\n    //                         </TouchableOpacity>\r\n    //                     ))}\r\n    //                 </View>\r\n    //                 <Text style={styles.money_small}>{`$${(gameState.money ?? 0).toLocaleString()}`}</Text>\r\n    //             </View>\r\n    //         </View>\r\n    //     );\r\n    // }\r\n\r\n    const reqs = gameState.requirementsRemaining ?? [];\r\n    const reqShowLength = 3;\r\n    return (\r\n        <View>\r\n            <ScoreView {...gameState ?? { money: 0, multiplier: 1 }} />\r\n            <View style={{ position: `absolute`, left: 90, top: 0, flexDirection: `row`, zIndex: 10 }} >\r\n                {reqs.slice(0, reqShowLength).map(x => {\r\n                    const canBuy = x.cost <= gameState.money;\r\n                    return (\r\n                        <TouchableOpacity key={x.emoji} onPress={() => EmojiIdleService.get().selectOption(x.emoji)}>\r\n                            <View style={{ flexDirection: `column`, alignItems: `center`, background: canBuy ? `#003300` : `#553300`, borderRadius: 4, paddingLeft: 2, paddingRight: 2 }}>\r\n                                <Text style={styles.characterEmoji_small}>{x.emoji}</Text>\r\n                                <Text style={{ ...styles.costText_small, ...(canBuy ? {} : { color: `#FF0000` }) }}>{`$${x.cost.toLocaleString()}`}</Text>\r\n                            </View>\r\n                        </TouchableOpacity>\r\n                    );\r\n                })}\r\n            </View>\r\n        </View>\r\n    );\r\n};\r\n\r\n\r\nconst ScoreView = ({ money, multiplier }: { money: number, multiplier: number }) => {\r\n\r\n    const [moneySizeOffset, setMoneySizeOffset] = useState(0);\r\n    const [multiplierSizeOffset, setMultiplierSizeOffset] = useState(0);\r\n    const lastMultiplier = useRef(multiplier);\r\n    const [multiplierDelta, setMultiplierDelta] = useState(0);\r\n\r\n\r\n    useEffect(() => {\r\n        setMoneySizeOffset(5);\r\n\r\n        const update = () => {\r\n            setMoneySizeOffset(s => {\r\n                if (s > 0) {\r\n                    return s - 1;\r\n                }\r\n                clearInterval(id);\r\n                return 0;\r\n            });\r\n        };\r\n        update();\r\n\r\n        const id = setInterval(update, 25);\r\n        return () => clearInterval(id);\r\n    }, [money]);\r\n\r\n    useEffect(() => {\r\n        setMultiplierSizeOffset(10);\r\n        setMultiplierDelta(multiplier - lastMultiplier.current);\r\n        lastMultiplier.current = multiplier;\r\n\r\n        const update = () => {\r\n            setMultiplierSizeOffset(s => {\r\n                if (s > 0) {\r\n                    return s - 1;\r\n                }\r\n                clearInterval(id);\r\n                return 0;\r\n            });\r\n        };\r\n        update();\r\n\r\n        const id = setInterval(update, 25);\r\n        return () => clearInterval(id);\r\n    }, [multiplier]);\r\n\r\n\r\n    return (\r\n        <View style={{ position: `absolute`, top: 0, right: 4 }} >\r\n            <View style={{ flexDirection: `row`, justifyContent: `flex-end` }}>\r\n                <View style={{ transform: `translate(-${moneySizeOffset}px,${2 * moneySizeOffset}px) scale(${moneySizeOffset * 0.1 + 1})` }}>\r\n                    <Text style={styles.money}>{`$${(money ?? 0).toLocaleString()}`}</Text>\r\n                </View>\r\n                <View style={{ transform: `translate(-${multiplierSizeOffset}px,${2 * multiplierSizeOffset}px) scale(${multiplierSizeOffset * 0.1 + 1})` }}>\r\n                    <Text style={{ ...styles.multiplier, ...(multiplierDelta < -5 ? { color: `#FF0000` } : multiplierDelta < 0 ? { color: `#FFFF00` } : { color: `#00FF00` }) }}>{`x${(multiplier ?? 1).toLocaleString()}`.padStart(4, ` `)}</Text>\r\n                </View>\r\n            </View>\r\n        </View>\r\n    );\r\n};\r\n\r\nconst EmojiCharacterView = ({ emoji, targetEmoji, emotion, purchased, onPress }: { emoji: string, targetEmoji: string, emotion: null | EmojiIdleEmotionKind, purchased: string[], onPress?: () => void }) => {\r\n    return (\r\n        <>\r\n            <PurchasedView purchased={purchased} />\r\n            <View style={{ position: `absolute`, left: 20, top: 0, flexDirection: `column`, alignItems: `flex-end` }} >\r\n                <TouchableOpacity onPress={() => onPress?.()}>\r\n                    <EmotionView emotion={emotion ?? null} emoji={emoji} />\r\n                </TouchableOpacity>\r\n            </View>\r\n            <View style={{ position: `absolute`, left: 66, top: 0, flexDirection: `column`, alignItems: `flex-end` }} >\r\n                <Text style={styles.targetCharacterEmoji}>{`${targetEmoji}`}</Text>\r\n            </View>\r\n        </>\r\n    );\r\n};\r\n\r\nconst PurchasedView = ({ purchased }: { purchased: string[] }) => {\r\n    const [offset, setOffset] = useState(0);\r\n    useEffect(() => {\r\n        const update = () => {\r\n            setOffset(s => s + 1);\r\n        };\r\n        update();\r\n\r\n        const id = setInterval(update, 200);\r\n        return () => clearInterval(id);\r\n    }, [purchased.length]);\r\n\r\n    return (\r\n        <>\r\n            {purchased.map((x, i) => (\r\n                <View key={x} style={{ position: `absolute`, left: 0, top: 0, flexDirection: `column`, alignItems: `flex-end` }} >\r\n                    <View style={{ transform: `translate(${((i * 17) + offset) % 60}px,${((i * 5) + offset) % 24}px)` }}>\r\n                        <Text style={styles.objectEmoji}>{`${x}`}</Text>\r\n                    </View>\r\n                </View>\r\n            ))}\r\n        </>\r\n    );\r\n};\r\n\r\nconst EmotionView = ({ emotion, emoji }: { emotion: null | EmojiIdleEmotionKind, emoji: string }) => {\r\n    const [display, setDisplay] = useState({ text: emoji, isEmotion: false });\r\n    useEffect(() => {\r\n        if (!emotion) {\r\n            return () => { };\r\n        }\r\n        let showEmotion = false;\r\n        let variant = 0;\r\n        const update = () => {\r\n            showEmotion = !showEmotion;\r\n            if (!showEmotion) {\r\n                setDisplay({ text: emoji, isEmotion: false });\r\n                return;\r\n            }\r\n            setDisplay({ text: getEmoji(emotion, variant++), isEmotion: true });\r\n        };\r\n        update();\r\n\r\n        const id = setInterval(update, 3000);\r\n        return () => clearInterval(id);\r\n    }, [emotion, emoji]);\r\n\r\n    return (\r\n        <Text style={display.isEmotion ? styles.emotionEmoji : styles.characterEmoji}>{display.text}</Text>\r\n    );\r\n};\r\n\r\n// \r\n// \r\n// \r\n// \r\n// \r\nconst getEmoji = (emotion: null | EmojiIdleEmotionKind, variant: number) => {\r\n    // console.log(`getEmoji`, { emotion, variant });\r\n\r\n    // Setup State\r\n    if (!emotion) { return ``; }\r\n\r\n    if (emotion === `excited`) {\r\n        const items = shuffle([``, ``, ``, ``, ``, ``, ``]);\r\n        return items[variant % items.length];\r\n    }\r\n    if (emotion === `happy`) {\r\n        const items = [``, ``, ``, ``, ``];\r\n        return items[variant % items.length];\r\n    }\r\n    if (emotion === `normal`) {\r\n        // const items = [``, ``, ``, ``, ``, ``, ``];\r\n        const items = [``, ``, ``, ``];\r\n        return items[variant % items.length];\r\n    }\r\n    if (emotion === `angry`) {\r\n        const items = [``, ``, ``, ``, ``, ``, ``];\r\n        return items[variant % items.length];\r\n    }\r\n    if (emotion === `sick`) {\r\n        const items = [``, ``, ``, ``, ``, ``, ``];\r\n        return items[variant % items.length];\r\n    }\r\n    if (emotion === `dead`) {\r\n        const items = [``, ``, ``];\r\n        return items[variant % items.length];\r\n    }\r\n\r\n    // Unknown\r\n    return ``;\r\n};\r\n\r\nconst foodItems = shuffle(` \r\n                             \r\n                            \r\n                       `\r\n    .replace(`\\n`, ` `).split(` `).map(x => x.trim()).filter(x => x));\r\n\r\nconst getFoodVariant = (variant: number) => {\r\n    return foodItems[variant % foodItems.length];\r\n};\r\n","import React, { useEffect, useState } from 'react';\r\nimport { UserDataService, UserProfileInfo } from 'user-data-service/user-data-service';\r\nimport { useAutoLoadingError } from 'utils-react/hooks';\r\nimport { UserProfileManagerView } from 'user-data-service/user-profile-manager-view';\r\nimport { UserProfileSelectionView } from 'user-data-service/user-profile-selection-view';\r\nimport { View, Text, TouchableOpacity, Platform } from 'react-native-lite';\r\nimport { ProblemService } from '../problems/problems-service';\r\nimport { EmojiIdleView } from './emoji-idle-game/emoji-idle-view';\r\nimport { EmojiIdleService } from './emoji-idle-game/emoji-idle-service';\r\n\r\nexport const ProgressGameService = {\r\n    onCorrect: () => {\r\n        EmojiIdleService.get().reward();\r\n    },\r\n    onCompleteSection: () => {\r\n        EmojiIdleService.get().reward_major();\r\n    },\r\n    onCompleteSubject: () => {\r\n        EmojiIdleService.get().reward_extreme();\r\n    },\r\n    onWrong: () => {\r\n        EmojiIdleService.get().punish();\r\n    },\r\n};\r\n\r\nexport const createProgressGameProblemService = (problemSource: ProblemService, options?: {}): ProblemService => {\r\n    const service: ProblemService = {\r\n        ...problemSource,\r\n        recordAnswer: (problem, answer) => {\r\n            // (async () => UserDataService.get().markUserDataChanged())();\r\n\r\n            if (answer.isCorrect) {\r\n                ProgressGameService.onCorrect();\r\n\r\n                if (!problem.isReview && problem.isLastOfSubject) {\r\n                    ProgressGameService.onCompleteSubject();\r\n\r\n                    // Save User Data (delayed to let other state update)\r\n                    setTimeout(async () => {\r\n                        await UserDataService.get().uploadUserData();\r\n                    }, 1000);\r\n                } else if (!problem.isReview && problem.isLastOfSection) {\r\n                    ProgressGameService.onCompleteSection();\r\n\r\n                    // Save User Data (delayed to let other state update)\r\n                    setTimeout(async () => {\r\n                        await UserDataService.get().uploadUserData();\r\n                    }, 1000);\r\n                }\r\n\r\n            } else {\r\n                ProgressGameService.onWrong();\r\n            }\r\n\r\n            return problemSource.recordAnswer(problem, answer);\r\n        },\r\n    };\r\n    return service;\r\n};\r\n\r\nexport const ProgressGameView = () => {\r\n    const { loading, error, doWork } = useAutoLoadingError();\r\n    const [hasSelectedProfile, setHasSelectedProfile] = useState(false);\r\n    const [userProfile, setUserProfile] = useState(null as null | UserProfileInfo);\r\n\r\n    // Save UserData after Purchase\r\n    const subscribeToSaveOnPurchase = () => {\r\n        let lastPurchase = Date.now();\r\n        const subscription = EmojiIdleService.get().subscribePetStateChange((x) => {\r\n            console.log(`ProgressGameView subscribePetStateChange`, { lastPurchase, x });\r\n            if (lastPurchase >= x.lastPurchaseTimestamp) { return; }\r\n            lastPurchase = x.lastPurchaseTimestamp;\r\n            // Save User Data (delayed to let other state update)\r\n            setTimeout(async () => {\r\n                await UserDataService.get().uploadUserData();\r\n            }, 1000);\r\n        });\r\n        return subscription;\r\n    };\r\n\r\n    useEffect(() => {\r\n        setUserProfile(UserDataService.get().getActiveUser() ?? null);\r\n        EmojiIdleService.reset();\r\n\r\n        const sub = subscribeToSaveOnPurchase();\r\n        return () => {\r\n            sub.unsubscribe();\r\n        };\r\n    }, [hasSelectedProfile]);\r\n\r\n    useEffect(() => {\r\n        // Load User Data\r\n        doWork(async () => {\r\n            await UserDataService.get().setup();\r\n            EmojiIdleService.reset();\r\n        });\r\n    }, []);\r\n\r\n    const onChangeProfile = () => {\r\n        // setHasSelectedProfile(false);\r\n        // Force Reload Page\r\n        if (Platform.OS === `web`) {\r\n            window.location.reload();\r\n        }\r\n    };\r\n\r\n    if (loading) {\r\n        return <></>;\r\n    }\r\n\r\n    if (!hasSelectedProfile) {\r\n        return <UserProfileSelectionView onUserSelected={() => setHasSelectedProfile(true)} />;\r\n    }\r\n\r\n    return (\r\n        <>\r\n            <EmojiIdleView />\r\n            <View>\r\n                <TouchableOpacity onPress={onChangeProfile}>\r\n                    <View style={{ flexDirection: `row`, alignItems: `center`, justifyContent: `flex-start`, padding: 4 }}>\r\n                        <Text style={{ fontSize: 32 }}>{userProfile?.emoji ?? ``}</Text>\r\n                        <Text style={{ fontSize: 14 }}>{userProfile?.name ?? ``}</Text>\r\n                    </View>\r\n                </TouchableOpacity>\r\n            </View>\r\n        </>\r\n    );\r\n};\r\n","\r\nexport type EmailAddress = string & { __type: 'email' };\r\nexport const toEmailAddress = (email: string): EmailAddress => {\r\n    return email.trim() as EmailAddress;\r\n};\r\n","/* eslint-disable max-classes-per-file */\r\nexport type ErrorState = { message: string, data?: unknown, error?: unknown, retryCallback?: () => void };\r\n\r\nexport class AppError extends Error implements ErrorState {\r\n    constructor(public message: string, public data?: unknown) {\r\n        super();\r\n    }\r\n}\r\n\r\nexport class ApiError extends Error implements ErrorState {\r\n    constructor(public message: string, public data?: unknown) {\r\n        super();\r\n    }\r\n}\r\n\r\nexport class MockError extends Error implements ErrorState {\r\n    constructor(public message: string, public data?: unknown) {\r\n        super();\r\n    }\r\n}\r\n\r\nexport class NotImplementedError extends Error implements ErrorState {\r\n    constructor(public message: string = `Not Implemented`, public data?: unknown) {\r\n        super();\r\n    }\r\n}\r\n","import { shuffle } from 'utils/arrays';\r\nimport { ProblemService, Problem, ProblemResult } from './problems-service';\r\n\r\nexport const createReviewProblemService = (problemSource: ProblemService, {\r\n    maxNewReviewCount = 3,\r\n    reviewSequencePreviousLength = 1,\r\n    reviewQuestionPrefix = ` `,\r\n    requiredCorrectInRow = 3,\r\n}: {\r\n    maxNewReviewCount?: number;\r\n    reviewSequencePreviousLength?: number;\r\n    reviewQuestionPrefix?: string;\r\n    requiredCorrectInRow?: number;\r\n}): ProblemService => {\r\n    const state = {\r\n        problemSourceHistory: [] as Problem[],\r\n        reviewProblems: [] as { index: number, correctsInRow: number }[],\r\n        lastReviewProblem: null as null | { index: number, correctsInRow: number },\r\n        reviewSequence: null as null | { iNext: number, iStart: number, iEnd: number },\r\n        repeatState: `new` as 'new' | 'review',\r\n    };\r\n\r\n    const startReview = () => {\r\n        console.log(`createReviewProblemService startReview`, state);\r\n        state.repeatState = `review`;\r\n    };\r\n\r\n    const getReviewProblem = (): null | Problem => {\r\n        console.log(`createReviewProblemService getReviewProblem`, state);\r\n\r\n        const rSeq = state.reviewSequence;\r\n        if (rSeq && rSeq.iNext > rSeq.iEnd) {\r\n            console.log(`createReviewProblemService getReviewProblem - End of Sequence`, { rSeq, state });\r\n            state.reviewSequence = null;\r\n        }\r\n\r\n        if (!state.reviewSequence) {\r\n            // If reached end of review problems, exit review mode\r\n            const reviewProblem = state.reviewProblems.find(x => x.index > (state.lastReviewProblem?.index ?? -1));\r\n            if (!reviewProblem) {\r\n                console.log(`createReviewProblemService getReviewProblem - No Review Problem (with greater order than last)`, { reviewProblems: state.reviewProblems, lastReviewProblem: state.lastReviewProblem, state });\r\n                state.lastReviewProblem = null;\r\n                return null;\r\n            }\r\n\r\n            const lastReviewProblemIndex = state.lastReviewProblem?.index ?? -1;\r\n            state.lastReviewProblem = reviewProblem;\r\n\r\n            console.log(`createReviewProblemService getReviewProblem - Start Review Sequence`, state);\r\n            const iStart = Math.max(0, reviewProblem.index - reviewSequencePreviousLength, lastReviewProblemIndex + 1);\r\n\r\n            state.reviewSequence = {\r\n                iNext: iStart,\r\n                iStart,\r\n                iEnd: reviewProblem.index,\r\n            };\r\n        }\r\n\r\n        // Next in sequence\r\n        const seq = state.reviewSequence;\r\n        const p = state.problemSourceHistory[seq.iNext];\r\n        seq.iNext++;\r\n\r\n        return {\r\n            ...p,\r\n            question: reviewQuestionPrefix + p.question,\r\n            answers: shuffle(p.answers),\r\n        };\r\n    };\r\n\r\n    const service: ProblemService = {\r\n        load: problemSource.load,\r\n        save: problemSource.save,\r\n\r\n        getSections: problemSource.getSections,\r\n        gotoSection: problemSource.gotoSection,\r\n\r\n        getNextProblem: (): ProblemResult => {\r\n            console.log(`createReviewProblemService getNextProblem`, state);\r\n\r\n            if (state.repeatState === `review`) {\r\n                const reviewProblem = getReviewProblem();\r\n                if (reviewProblem) {\r\n                    return { ...reviewProblem, isReview: true };\r\n                }\r\n\r\n                console.log(`createReviewProblemService getNextProblem - No Review Problem - Change Mode to NEW`, state);\r\n                state.repeatState = `new`;\r\n            }\r\n\r\n            if (state.reviewProblems.filter(x => x.correctsInRow <= 1).length >= maxNewReviewCount) {\r\n                startReview();\r\n                return service.getNextProblem();\r\n            }\r\n\r\n            const newProblem = problemSource.getNextProblem();\r\n            if (newProblem.question) {\r\n                state.problemSourceHistory.push(newProblem);\r\n            } else {\r\n                // Done - Finish Review\r\n                startReview();\r\n                return service.getNextProblem();\r\n            }\r\n            return newProblem;\r\n        },\r\n        recordAnswer: (problem, answer) => {\r\n            console.log(`createReviewProblemService recordAnswer`, state);\r\n\r\n            // if (answer.isCorrect) {\r\n\r\n            //     problemSource.recordAnswer(problem, answer);\r\n            //     return;\r\n            // }\r\n\r\n            const i = state.problemSourceHistory.findIndex(x => x.key === problem.key);\r\n            if (i < 0) {\r\n                problemSource.recordAnswer(problem, answer);\r\n                return;\r\n            }\r\n\r\n            const problemAlreadyInReview = state.reviewProblems.find(x => x.index === i);\r\n            if (answer.isCorrect) {\r\n                // Correct\r\n                if (problemAlreadyInReview) {\r\n                    problemAlreadyInReview.correctsInRow++;\r\n\r\n                    // Remove if enough corrects in a row \r\n                    state.reviewProblems = state.reviewProblems.filter(x => x.correctsInRow <= requiredCorrectInRow);\r\n                }\r\n            } else {\r\n                // Wrong \r\n                // eslint-disable-next-line no-lonely-if\r\n                if (problemAlreadyInReview) {\r\n                    problemAlreadyInReview.correctsInRow = 0;\r\n                } else {\r\n                    // Insert Review Problem in Index order\r\n                    const newReview = { index: i, correctsInRow: 0, _debug_problemKey: problem.key };\r\n                    state.reviewProblems.push(newReview);\r\n                    state.reviewProblems.sort((a, b) => a.index - b.index);\r\n                    // state.problemsToReview = distinct_key(state.problemsToReview, x => `${x.index}`);\r\n                }\r\n            }\r\n\r\n\r\n            problemSource.recordAnswer(problem, answer);\r\n        },\r\n    };\r\n\r\n    return service;\r\n};\r\n","export const uploadApiConfig = {\r\n    uploadApiUrl: `https://s7mrgkmtk5.execute-api.us-east-1.amazonaws.com/prod/upload-api`,\r\n};\r\n","!function (t, e) {\n  \"object\" == typeof exports && \"undefined\" != typeof module ? module.exports = e() : \"function\" == typeof define && define.amd ? define(e) : t.dayjs = e();\n}(this, function () {\n  \"use strict\";\n\n  var t = \"millisecond\",\n      e = \"second\",\n      n = \"minute\",\n      r = \"hour\",\n      i = \"day\",\n      s = \"week\",\n      u = \"month\",\n      o = \"quarter\",\n      a = \"year\",\n      h = /^(\\d{4})-?(\\d{1,2})-?(\\d{0,2})[^0-9]*(\\d{1,2})?:?(\\d{1,2})?:?(\\d{1,2})?.?(\\d{1,3})?$/,\n      f = /\\[([^\\]]+)]|Y{2,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,\n      c = function c(t, e, n) {\n    var r = String(t);\n    return !r || r.length >= e ? t : \"\" + Array(e + 1 - r.length).join(n) + t;\n  },\n      d = {\n    s: c,\n    z: function z(t) {\n      var e = -t.utcOffset(),\n          n = Math.abs(e),\n          r = Math.floor(n / 60),\n          i = n % 60;\n      return (e <= 0 ? \"+\" : \"-\") + c(r, 2, \"0\") + \":\" + c(i, 2, \"0\");\n    },\n    m: function m(t, e) {\n      var n = 12 * (e.year() - t.year()) + (e.month() - t.month()),\n          r = t.clone().add(n, u),\n          i = e - r < 0,\n          s = t.clone().add(n + (i ? -1 : 1), u);\n      return Number(-(n + (e - r) / (i ? r - s : s - r)) || 0);\n    },\n    a: function a(t) {\n      return t < 0 ? Math.ceil(t) || 0 : Math.floor(t);\n    },\n    p: function p(h) {\n      return {\n        M: u,\n        y: a,\n        w: s,\n        d: i,\n        D: \"date\",\n        h: r,\n        m: n,\n        s: e,\n        ms: t,\n        Q: o\n      }[h] || String(h || \"\").toLowerCase().replace(/s$/, \"\");\n    },\n    u: function u(t) {\n      return void 0 === t;\n    }\n  },\n      $ = {\n    name: \"en\",\n    weekdays: \"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday\".split(\"_\"),\n    months: \"January_February_March_April_May_June_July_August_September_October_November_December\".split(\"_\")\n  },\n      l = \"en\",\n      m = {};\n\n  m[l] = $;\n\n  var y = function y(t) {\n    return t instanceof v;\n  },\n      M = function M(t, e, n) {\n    var r;\n    if (!t) return l;\n    if (\"string\" == typeof t) m[t] && (r = t), e && (m[t] = e, r = t);else {\n      var i = t.name;\n      m[i] = t, r = i;\n    }\n    return !n && r && (l = r), r || !n && l;\n  },\n      g = function g(t, e) {\n    if (y(t)) return t.clone();\n    var n = \"object\" == typeof e ? e : {};\n    return n.date = t, n.args = arguments, new v(n);\n  },\n      D = d;\n\n  D.l = M, D.i = y, D.w = function (t, e) {\n    return g(t, {\n      locale: e.$L,\n      utc: e.$u,\n      $offset: e.$offset\n    });\n  };\n\n  var v = function () {\n    function c(t) {\n      this.$L = this.$L || M(t.locale, null, !0), this.parse(t);\n    }\n\n    var d = c.prototype;\n    return d.parse = function (t) {\n      this.$d = function (t) {\n        var e = t.date,\n            n = t.utc;\n        if (null === e) return new Date(NaN);\n        if (D.u(e)) return new Date();\n        if (e instanceof Date) return new Date(e);\n\n        if (\"string\" == typeof e && !/Z$/i.test(e)) {\n          var r = e.match(h);\n          if (r) return n ? new Date(Date.UTC(r[1], r[2] - 1, r[3] || 1, r[4] || 0, r[5] || 0, r[6] || 0, r[7] || 0)) : new Date(r[1], r[2] - 1, r[3] || 1, r[4] || 0, r[5] || 0, r[6] || 0, r[7] || 0);\n        }\n\n        return new Date(e);\n      }(t), this.init();\n    }, d.init = function () {\n      var t = this.$d;\n      this.$y = t.getFullYear(), this.$M = t.getMonth(), this.$D = t.getDate(), this.$W = t.getDay(), this.$H = t.getHours(), this.$m = t.getMinutes(), this.$s = t.getSeconds(), this.$ms = t.getMilliseconds();\n    }, d.$utils = function () {\n      return D;\n    }, d.isValid = function () {\n      return !(\"Invalid Date\" === this.$d.toString());\n    }, d.isSame = function (t, e) {\n      var n = g(t);\n      return this.startOf(e) <= n && n <= this.endOf(e);\n    }, d.isAfter = function (t, e) {\n      return g(t) < this.startOf(e);\n    }, d.isBefore = function (t, e) {\n      return this.endOf(e) < g(t);\n    }, d.$g = function (t, e, n) {\n      return D.u(t) ? this[e] : this.set(n, t);\n    }, d.year = function (t) {\n      return this.$g(t, \"$y\", a);\n    }, d.month = function (t) {\n      return this.$g(t, \"$M\", u);\n    }, d.day = function (t) {\n      return this.$g(t, \"$W\", i);\n    }, d.date = function (t) {\n      return this.$g(t, \"$D\", \"date\");\n    }, d.hour = function (t) {\n      return this.$g(t, \"$H\", r);\n    }, d.minute = function (t) {\n      return this.$g(t, \"$m\", n);\n    }, d.second = function (t) {\n      return this.$g(t, \"$s\", e);\n    }, d.millisecond = function (e) {\n      return this.$g(e, \"$ms\", t);\n    }, d.unix = function () {\n      return Math.floor(this.valueOf() / 1e3);\n    }, d.valueOf = function () {\n      return this.$d.getTime();\n    }, d.startOf = function (t, o) {\n      var h = this,\n          f = !!D.u(o) || o,\n          c = D.p(t),\n          d = function d(t, e) {\n        var n = D.w(h.$u ? Date.UTC(h.$y, e, t) : new Date(h.$y, e, t), h);\n        return f ? n : n.endOf(i);\n      },\n          $ = function $(t, e) {\n        return D.w(h.toDate()[t].apply(h.toDate(\"s\"), (f ? [0, 0, 0, 0] : [23, 59, 59, 999]).slice(e)), h);\n      },\n          l = this.$W,\n          m = this.$M,\n          y = this.$D,\n          M = \"set\" + (this.$u ? \"UTC\" : \"\");\n\n      switch (c) {\n        case a:\n          return f ? d(1, 0) : d(31, 11);\n\n        case u:\n          return f ? d(1, m) : d(0, m + 1);\n\n        case s:\n          var g = this.$locale().weekStart || 0,\n              v = (l < g ? l + 7 : l) - g;\n          return d(f ? y - v : y + (6 - v), m);\n\n        case i:\n        case \"date\":\n          return $(M + \"Hours\", 0);\n\n        case r:\n          return $(M + \"Minutes\", 1);\n\n        case n:\n          return $(M + \"Seconds\", 2);\n\n        case e:\n          return $(M + \"Milliseconds\", 3);\n\n        default:\n          return this.clone();\n      }\n    }, d.endOf = function (t) {\n      return this.startOf(t, !1);\n    }, d.$set = function (s, o) {\n      var h,\n          f = D.p(s),\n          c = \"set\" + (this.$u ? \"UTC\" : \"\"),\n          d = (h = {}, h[i] = c + \"Date\", h.date = c + \"Date\", h[u] = c + \"Month\", h[a] = c + \"FullYear\", h[r] = c + \"Hours\", h[n] = c + \"Minutes\", h[e] = c + \"Seconds\", h[t] = c + \"Milliseconds\", h)[f],\n          $ = f === i ? this.$D + (o - this.$W) : o;\n\n      if (f === u || f === a) {\n        var l = this.clone().set(\"date\", 1);\n        l.$d[d]($), l.init(), this.$d = l.set(\"date\", Math.min(this.$D, l.daysInMonth())).toDate();\n      } else d && this.$d[d]($);\n\n      return this.init(), this;\n    }, d.set = function (t, e) {\n      return this.clone().$set(t, e);\n    }, d.get = function (t) {\n      return this[D.p(t)]();\n    }, d.add = function (t, o) {\n      var h,\n          f = this;\n      t = Number(t);\n\n      var c = D.p(o),\n          d = function d(e) {\n        var n = g(f);\n        return D.w(n.date(n.date() + Math.round(e * t)), f);\n      };\n\n      if (c === u) return this.set(u, this.$M + t);\n      if (c === a) return this.set(a, this.$y + t);\n      if (c === i) return d(1);\n      if (c === s) return d(7);\n      var $ = (h = {}, h[n] = 6e4, h[r] = 36e5, h[e] = 1e3, h)[c] || 1,\n          l = this.$d.getTime() + t * $;\n      return D.w(l, this);\n    }, d.subtract = function (t, e) {\n      return this.add(-1 * t, e);\n    }, d.format = function (t) {\n      var e = this;\n      if (!this.isValid()) return \"Invalid Date\";\n\n      var n = t || \"YYYY-MM-DDTHH:mm:ssZ\",\n          r = D.z(this),\n          i = this.$locale(),\n          s = this.$H,\n          u = this.$m,\n          o = this.$M,\n          a = i.weekdays,\n          h = i.months,\n          c = function c(t, r, i, s) {\n        return t && (t[r] || t(e, n)) || i[r].substr(0, s);\n      },\n          d = function d(t) {\n        return D.s(s % 12 || 12, t, \"0\");\n      },\n          $ = i.meridiem || function (t, e, n) {\n        var r = t < 12 ? \"AM\" : \"PM\";\n        return n ? r.toLowerCase() : r;\n      },\n          l = {\n        YY: String(this.$y).slice(-2),\n        YYYY: this.$y,\n        M: o + 1,\n        MM: D.s(o + 1, 2, \"0\"),\n        MMM: c(i.monthsShort, o, h, 3),\n        MMMM: c(h, o),\n        D: this.$D,\n        DD: D.s(this.$D, 2, \"0\"),\n        d: String(this.$W),\n        dd: c(i.weekdaysMin, this.$W, a, 2),\n        ddd: c(i.weekdaysShort, this.$W, a, 3),\n        dddd: a[this.$W],\n        H: String(s),\n        HH: D.s(s, 2, \"0\"),\n        h: d(1),\n        hh: d(2),\n        a: $(s, u, !0),\n        A: $(s, u, !1),\n        m: String(u),\n        mm: D.s(u, 2, \"0\"),\n        s: String(this.$s),\n        ss: D.s(this.$s, 2, \"0\"),\n        SSS: D.s(this.$ms, 3, \"0\"),\n        Z: r\n      };\n\n      return n.replace(f, function (t, e) {\n        return e || l[t] || r.replace(\":\", \"\");\n      });\n    }, d.utcOffset = function () {\n      return 15 * -Math.round(this.$d.getTimezoneOffset() / 15);\n    }, d.diff = function (t, h, f) {\n      var c,\n          d = D.p(h),\n          $ = g(t),\n          l = 6e4 * ($.utcOffset() - this.utcOffset()),\n          m = this - $,\n          y = D.m(this, $);\n      return y = (c = {}, c[a] = y / 12, c[u] = y, c[o] = y / 3, c[s] = (m - l) / 6048e5, c[i] = (m - l) / 864e5, c[r] = m / 36e5, c[n] = m / 6e4, c[e] = m / 1e3, c)[d] || m, f ? y : D.a(y);\n    }, d.daysInMonth = function () {\n      return this.endOf(u).$D;\n    }, d.$locale = function () {\n      return m[this.$L];\n    }, d.locale = function (t, e) {\n      if (!t) return this.$L;\n      var n = this.clone(),\n          r = M(t, e, !0);\n      return r && (n.$L = r), n;\n    }, d.clone = function () {\n      return D.w(this.$d, this);\n    }, d.toDate = function () {\n      return new Date(this.valueOf());\n    }, d.toJSON = function () {\n      return this.isValid() ? this.toISOString() : null;\n    }, d.toISOString = function () {\n      return this.$d.toISOString();\n    }, d.toString = function () {\n      return this.$d.toUTCString();\n    }, c;\n  }();\n\n  return g.prototype = v.prototype, g.extend = function (t, e) {\n    return t(e, v, g), g;\n  }, g.locale = M, g.isDayjs = y, g.unix = function (t) {\n    return g(1e3 * t);\n  }, g.en = m[l], g.Ls = m, g;\n});","!function (e, t) {\n  \"object\" == typeof exports && \"undefined\" != typeof module ? module.exports = t() : \"function\" == typeof define && define.amd ? define(t) : e.dayjs_plugin_localizedFormat = t();\n}(this, function () {\n  \"use strict\";\n\n  return function (e, t, o) {\n    var n = t.prototype,\n        r = n.format,\n        M = {\n      LTS: \"h:mm:ss A\",\n      LT: \"h:mm A\",\n      L: \"MM/DD/YYYY\",\n      LL: \"MMMM D, YYYY\",\n      LLL: \"MMMM D, YYYY h:mm A\",\n      LLLL: \"dddd, MMMM D, YYYY h:mm A\"\n    };\n    o.en.formats = M;\n\n    n.format = function (e) {\n      void 0 === e && (e = \"YYYY-MM-DDTHH:mm:ssZ\");\n      var t = this.$locale().formats,\n          o = void 0 === t ? {} : t,\n          n = e.replace(/(\\[[^\\]]+])|(LTS?|l{1,4}|L{1,4})/g, function (e, t, n) {\n        var r = n && n.toUpperCase();\n        return t || o[n] || M[n] || o[r].replace(/(\\[[^\\]]+])|(MMMM|MM|DD|dddd)/g, function (e, t, o) {\n          return t || o.slice(1);\n        });\n      });\n      return r.call(this, n);\n    };\n  };\n});","import './index.css';\r\nimport React, { ReactNode, useRef } from 'react';\r\nimport { ThemeTextStyle, ThemeViewStyle } from 'themes/theme';\r\n\r\nfunction mergeStyles<T>(items: (T | undefined | null) | (T | T[] | undefined | null)[]): T {\r\n    if (Array.isArray(items)) {\r\n        if (items.length === 1) { return mergeStyles(items[0]) ?? {} as T; }\r\n        let item = { ...mergeStyles(items[0]) };\r\n        items.forEach(x => { item = { ...item, ...mergeStyles(x ?? {}) }; });\r\n        return (item ?? {}) as T;\r\n    }\r\n    return items as T;\r\n};\r\n\r\nconst viewStyleDefaults = {\r\n    display: `flex`,\r\n    flexDirection: `column`,\r\n} as const;\r\n\r\nconst textStyleDefaults = {\r\n    whiteSpace: `pre`,\r\n} as const;\r\n\r\nconst finalizeTextStyle = <T extends unknown>(style: T) => {\r\n    const s = style as {\r\n        userSelect?: 'none';\r\n        MozUserSelect?: 'none';\r\n        WebkitUserSelect?: 'none';\r\n    };\r\n    if (s.userSelect === `none`) {\r\n        s.MozUserSelect = `none`;\r\n        s.WebkitUserSelect = `none`;\r\n    }\r\n\r\n    return style;\r\n};\r\n\r\nexport const View = (props: { style?: ThemeViewStyle | ThemeViewStyle[], children?: ReactNode }) => { return (<div style={mergeStyles([viewStyleDefaults, props.style])}>{props.children}</div>); };\r\nexport const Text = (props: { style?: ThemeTextStyle | ThemeTextStyle[], children?: string, numberOfLines?: undefined | 1 }) => {\r\n    if (props.numberOfLines === 1) {\r\n        const singleLineStyle = {\r\n            overflow: `hidden`,\r\n            whiteSpace: `nowrap`,\r\n            wordWrap: `break-word`,\r\n            textOverflow: `ellipsis`,\r\n        } as const;\r\n        const allStyles = mergeStyles([textStyleDefaults, props.style, singleLineStyle]);\r\n        return (<span style={finalizeTextStyle(allStyles)}>{props.children}</span>);\r\n    }\r\n    const allStyles = mergeStyles([textStyleDefaults, props.style]);\r\n    return (<span style={finalizeTextStyle(allStyles)}>{props.children}</span>);\r\n};\r\nexport const TextInput = (props: {\r\n    style?: ThemeTextStyle | ThemeTextStyle[];\r\n    keyboardType: 'default' | 'numeric' | 'phone-pad' | 'email-address';\r\n    autoCompleteType: 'off' | 'username' | 'password' | 'email' | 'name' | 'tel' | 'street-address' | 'postal-code';\r\n    secureTextEntry?: boolean;\r\n    placeholder?: string;\r\n    editable?: boolean;\r\n    value: string;\r\n    onChange: (value: string) => void;\r\n    onSubmitEditing?: () => void;\r\n    onFocus?: () => void;\r\n    onBlur?: () => void;\r\n}) => {\r\n    const type = props.keyboardType === `numeric` ? `number`\r\n        : (props.secureTextEntry ? `password`\r\n            : `text`);\r\n\r\n    const name = props.autoCompleteType === `username` ? `username`\r\n        : (props.autoCompleteType === `password` ? `password`\r\n            : undefined);\r\n\r\n    const onKeyPress = props.onSubmitEditing && ((e: React.KeyboardEvent<HTMLInputElement>) => {\r\n        if (e.key === `Enter` && !e.shiftKey) {\r\n            e.preventDefault();\r\n            props.onSubmitEditing?.();\r\n        }\r\n    }) || undefined;\r\n\r\n    return (<input type={type}\r\n        name={name} id={name}\r\n        style={mergeStyles([textStyleDefaults, props.style])}\r\n        placeholder={props.placeholder}\r\n        disabled={!(props.editable ?? true)}\r\n        value={props.value}\r\n        onFocus={props.onFocus}\r\n        onChange={(e) => props.onChange(e.target.value)}\r\n        onKeyPress={onKeyPress}\r\n        onBlur={props.onBlur}\r\n    />);\r\n\r\n};\r\nexport const TouchableOpacity = (props: { style?: ThemeViewStyle | ThemeViewStyle[], children?: ReactNode, onPress: () => void }) => {\r\n\r\n    // Prevent Initial Press (already pressing when created)\r\n    const lastPressTime = useRef(Date.now());\r\n    const onPress = () => {\r\n        // Prevent duplicate triggers\r\n        if (Date.now() < lastPressTime.current + 250) {\r\n            // console.log(`TouchableOpacity - prevented duplicate trigger`, { lastPressTime: lastPressTime.current, now: Date.now() });\r\n            return;\r\n        }\r\n        lastPressTime.current = Date.now();\r\n\r\n        props.onPress();\r\n    };\r\n\r\n    const hasTouchStarted = useRef(true);\r\n\r\n    return (\r\n        <div style={mergeStyles([viewStyleDefaults, props.style])}\r\n            onClick={onPress}\r\n            onKeyPress={onPress}\r\n            onTouchStart={() => { hasTouchStarted.current = true; }}\r\n            onTouchMove={() => { hasTouchStarted.current = false; }}\r\n            onTouchEnd={() => { if (hasTouchStarted.current) { onPress(); } }}\r\n            role='button'\r\n            tabIndex={0}>\r\n            {props.children}\r\n        </div>\r\n    );\r\n};\r\n\r\nexport const Pressable = (props: { style?: ThemeViewStyle | ThemeViewStyle[], children?: ReactNode, onPressIn: () => void, onPressOut: () => void }) => {\r\n\r\n    const onIgnore = (e: React.MouseEvent | React.TouchEvent) => {\r\n        e.preventDefault();\r\n        e.stopPropagation?.();\r\n        (e as unknown as { [key: string]: boolean }).cancelBubble = true;\r\n        (e as unknown as { [key: string]: boolean }).returnValue = false;\r\n        return false;\r\n    };\r\n\r\n    const onPressIn = (e: React.MouseEvent | React.TouchEvent) => {\r\n        props.onPressIn();\r\n        return onIgnore(e);\r\n    };\r\n    const onPressOut = (e: React.MouseEvent | React.TouchEvent) => {\r\n        props.onPressOut();\r\n        return onIgnore(e);\r\n    };\r\n\r\n    return (\r\n        <div style={mergeStyles([viewStyleDefaults, props.style])}\r\n            onMouseDown={onPressIn}\r\n            onMouseUp={onPressOut}\r\n            onTouchStart={onPressIn}\r\n            onTouchEnd={onPressOut}\r\n            onTouchCancel={onPressOut}\r\n            onTouchMove={onIgnore}\r\n            onMouseLeave={onPressOut}\r\n            onTouchEndCapture={onPressOut}\r\n            role='button'\r\n            tabIndex={0}>\r\n            {props.children}\r\n        </div>\r\n    );\r\n};\r\n\r\nexport const ActivityIndicator = ({ size, color }: { size: 'large' | 'small', color: string }) => {\r\n    const sizePx = size === `small` ? 16 : 32;\r\n    return (\r\n        <CircleSvg size={sizePx} thickness={sizePx / 8} color={color} />\r\n    );\r\n};\r\n\r\n// Based on: https://glennmccomb.com/articles/building-a-pure-css-animated-svg-spinner/\r\nconst CircleSvg = ({ size, thickness, color }: { size: number, thickness: number, color: string }) => {\r\n    const circumference = 2 * Math.PI * (size - thickness) * 0.5;\r\n    const dashLength = circumference * 0.6;\r\n    return (\r\n        <svg style={{ maxWidth: size }} viewBox={`0 0 ${size} ${size}`} xmlns='http://www.w3.org/2000/svg'>\r\n            <circle style={{\r\n                fill: `transparent`,\r\n                stroke: color,\r\n                strokeWidth: thickness,\r\n                opacity: 0.5,\r\n            }} cx={size * 0.5} cy={size * 0.5} r={size * 0.5 - thickness} />\r\n            <circle className='activity-spinner' style={{\r\n                strokeDasharray: dashLength,\r\n                fill: `transparent`,\r\n                stroke: color,\r\n                strokeWidth: thickness,\r\n                transformOrigin: `${size * 0.5}px ${size * 0.5}px`,\r\n            }} cx={size * 0.5} cy={size * 0.5} r={size * 0.5 - thickness} />\r\n        </svg>\r\n    );\r\n};\r\n\r\n\r\nexport const Platform = {\r\n    OS: `web` as 'web' | 'ios' | 'android',\r\n};\r\n\r\nexport const Clipboard = {\r\n    setString: async (value: string) => { await navigator.clipboard.writeText(value); },\r\n};\r\n","import React, { useState, useEffect } from 'react';\r\nimport { Text, View, ActivityIndicator, TouchableOpacity } from 'react-native-lite';\r\nimport { SpeechService } from './speech';\r\n\r\nexport const VoiceChooser = ({ languange, speechService }: { languange: string, speechService: SpeechService }) => {\r\n    const [loading, setLoading] = useState(true);\r\n    // eslint-disable-next-line @typescript-eslint/no-unused-vars\r\n    const [renderId, setRenderId] = useState(0);\r\n\r\n    const refresh = () => {\r\n        setLoading(true);\r\n        setTimeout(() => {\r\n            setLoading(false);\r\n        }, 1000);\r\n    };\r\n\r\n    useEffect(() => {\r\n        refresh();\r\n    }, []);\r\n\r\n    const selectVoice = (voice: SpeechSynthesisVoice) => {\r\n        speechService.setVoiceForLanguange(languange, voice);\r\n        setRenderId(s => s + 1);\r\n        speechService.speak(voice.name, languange);\r\n    };\r\n\r\n    return (\r\n        <View>\r\n            <TouchableOpacity onPress={refresh}>\r\n                <Text style={{ fontSize: 24 }}>{`Voice for ${languange}`}</Text>\r\n            </TouchableOpacity>\r\n            {loading && <ActivityIndicator size='small' color='red' />}\r\n            {!loading && (\r\n                <>\r\n                    {speechService.getVoicesForLanguange(languange).map(x => (\r\n                        <TouchableOpacity key={x.voice.name} onPress={() => { selectVoice(x.voice); }}>\r\n                            <View>\r\n                                <Text style={{ margin: 4, fontSize: 14, whiteSpace: `normal` }} >{`${x.isSelected ? `` : ``} ${x.voice.lang} - ${x.voice.name} - ${x.voice.localService ? `local` : `web`}`}</Text>\r\n                            </View>\r\n                        </TouchableOpacity>\r\n                    ))}\r\n                </>\r\n            )}\r\n        </View>\r\n    );\r\n};\r\n","\r\nexport type Subscription<T> = (state: T) => void;\r\n\r\nexport const createSubscribable = <T>(initialState?: T) => {\r\n    let lastState = initialState;\r\n    const callbacks = [] as (null | Subscription<T>)[];\r\n    const subscribe = (callback: Subscription<T>) => {\r\n        const i = callbacks.length;\r\n        callbacks.push(callback);\r\n\r\n        // Send Initial State if it exists\r\n        setTimeout(() => {\r\n            if (!lastState) { return; }\r\n            callback(lastState);\r\n        });\r\n\r\n        return {\r\n            unsubscribe: () => {\r\n                callbacks[i] = null;\r\n            },\r\n        };\r\n    };\r\n    const onStateChange = (state: T) => {\r\n        lastState = state;\r\n        callbacks.forEach(x => x?.(state));\r\n    };\r\n    return {\r\n        subscribe,\r\n        onStateChange,\r\n    };\r\n};\r\n","import { fetchWithTimeout } from 'utils/web-request';\r\nimport { AppError } from 'utils/error';\r\nimport { UploadUrl } from './types';\r\nimport { createUploadApiWebClient } from './web-client';\r\n\r\nexport const downloadData = async (getUrl: string) => {\r\n    const result = await fetchWithTimeout(getUrl, {\r\n        method: `GET`,\r\n        headers: {\r\n            'Accept': `application/json`,\r\n        },\r\n    });\r\n    const json = await result.json() as { data: unknown };\r\n    return json.data;\r\n};\r\n\r\n\r\nexport const createUploader = (uploadUrl: UploadUrl) => {\r\n    return {\r\n        uploadData: async (data: unknown) => {\r\n            const body = JSON.stringify({ data });\r\n            const result = await fetchWithTimeout(uploadUrl.putUrl, {\r\n                method: `PUT`,\r\n                headers: {\r\n                    'Accept': `application/json`,\r\n                    'Content-Type': `application/json`,\r\n                    'Content-Length': `${body.length}`,\r\n                },\r\n                body,\r\n            });\r\n\r\n            if (!result.ok) {\r\n                throw new AppError(`Upload Failed`);\r\n            }\r\n        },\r\n        downloadData: async (): Promise<unknown> => {\r\n            return await downloadData(uploadUrl.getUrl);\r\n        },\r\n    };\r\n};\r\n\r\nexport const createSmartUploader = <T extends {}>(args: { getUploadUrl: () => Promise<null | UploadUrl>, setUploadUrl: (uploadUrl: UploadUrl) => Promise<void>, uploadUrlPrefix: string, uploadApiUrl: string }) => {\r\n    const uploadApiWebClient = createUploadApiWebClient(args);\r\n\r\n    let _uploadUrl = null as null | UploadUrl;\r\n\r\n    const setupUploadUrl = async () => {\r\n        if (_uploadUrl) { return _uploadUrl; }\r\n\r\n        _uploadUrl = await args.getUploadUrl();\r\n        if (_uploadUrl) { return _uploadUrl; }\r\n\r\n        _uploadUrl = (await uploadApiWebClient.createUploadUrl({ prefix: args.uploadUrlPrefix })).uploadUrl;\r\n        await args.setUploadUrl(_uploadUrl);\r\n        return _uploadUrl;\r\n    };\r\n\r\n    return {\r\n        load: async (): Promise<null | T> => {\r\n            const uploadUrl = await setupUploadUrl();\r\n\r\n            try {\r\n                const data = await downloadData(uploadUrl.getUrl);\r\n                return data as T;\r\n            } catch{\r\n                return null;\r\n            }\r\n        },\r\n        save: async (data: T) => {\r\n            let uploadUrl = await setupUploadUrl();\r\n\r\n            try {\r\n                const uploader = createUploader(uploadUrl);\r\n                await uploader.uploadData(data);\r\n            } catch{\r\n                // Try again after renew upload token\r\n                uploadUrl = (await uploadApiWebClient.renewUploadUrl({ uploadUrl })).uploadUrl;\r\n                await args.setUploadUrl(uploadUrl);\r\n                _uploadUrl = uploadUrl;\r\n\r\n                const uploader = createUploader(uploadUrl);\r\n                await uploader.uploadData(data);\r\n            }\r\n\r\n            // Upload backup (temp)\r\n            const backupUrl = (await uploadApiWebClient.createUploadUrl({ prefix: `backup/${uploadUrl.relativePath}` })).uploadUrl;\r\n            const backupUploader = createUploader(backupUrl);\r\n            await backupUploader.uploadData(data);\r\n        },\r\n    };\r\n};\r\n","export type JsonTyped<T> = string & { __json: T };\r\n\r\nexport const jsonParse = <T>(json: JsonTyped<T>): T => {\r\n    return JSON.parse(json) as T;\r\n};\r\nexport const jsonParse_smart = <T>(json: T | JsonTyped<T>): T => {\r\n    if (typeof json === `string`) {\r\n        return JSON.parse(json) as T;\r\n    }\r\n    return json as T;\r\n};\r\nexport const jsonStringify = <T>(obj: T) => JSON.stringify(obj) as JsonTyped<T>;\r\n\r\nexport const jsonStringify_safe = (obj: unknown, shouldFormat?: boolean): string => {\r\n    const visited = [] as unknown[];\r\n\r\n    return JSON.stringify(obj, (_, val: unknown) => {\r\n        if (val != null && typeof val == `object`) {\r\n            if (visited.includes(val)) {\r\n                return `[OBJ-DUPLICATED]`;\r\n            }\r\n            visited.push(val);\r\n        }\r\n        return val;\r\n    }, shouldFormat ? 2 : 0);\r\n};\r\n","import React, { useState } from 'react';\r\nimport { View, Text, TouchableOpacity, Clipboard } from 'react-native-lite';\r\nimport { theme } from 'themes/theme';\r\nimport { ErrorState } from 'utils/error';\r\nimport { jsonStringify_safe } from 'utils/json';\r\nimport { Icon } from './icon';\r\nimport { IconKind } from './icon-kind';\r\n\r\nconst DEBUG = true;\r\n\r\nconst errorBoxStyle = {\r\n    view: theme.view_error,\r\n    text: theme.text_error,\r\n    text_errorMessage: theme.text_errorMessage,\r\n    icon: theme.icon,\r\n    icon_errorMessage: theme.icon_errorMessage,\r\n    button: { outlineColor: theme.colors.outline },\r\n};\r\n\r\nexport const ErrorBox = ({ error }: { error: ErrorState | null | undefined }) => {\r\n    if (!error) { return (<></>); }\r\n    return (<ErrorBox_Inner error={error} />);\r\n};\r\n\r\nconst ErrorBox_Inner = (props: { error: ErrorState }) => {\r\n    const [expanded, setExpanded] = useState(false);\r\n\r\n    // console.log(`ErrorBox`, { error: props.error, expanded });\r\n\r\n    const errorAsString = typeof props.error === `string` ? `${props.error}` : null;\r\n    const errorMessage = props.error.message ?? errorAsString ?? `Unknown Error`;\r\n    const errorDetails = props.error.data && jsonStringify_safe(props.error.data, true) || undefined;\r\n    const errorObjText = DEBUG && props.error && jsonStringify_safe(props.error, true) || undefined;\r\n    const canExpand = !!errorDetails || !!errorObjText;\r\n\r\n    return (\r\n        <View style={errorBoxStyle.view}>\r\n            <View style={{ flexDirection: `row` }}>\r\n                <TouchableOpacity style={{ flex: 1, flexDirection: `row`, alignItems: `center`, ...errorBoxStyle.button }} onPress={() => setExpanded(!expanded)}>\r\n                    {canExpand && (expanded ? <Icon style={errorBoxStyle.icon} kind={IconKind.expanded} /> : <Icon style={errorBoxStyle.icon} kind={IconKind.collapsed} />)}\r\n                    <View style={{ paddingRight: 8 }}>\r\n                        <Icon style={errorBoxStyle.icon} kind={IconKind.error} />\r\n                    </View>\r\n                    <View style={{ flex: 1, overflow: `hidden` }}>\r\n                        <Text style={errorBoxStyle.text} numberOfLines={!expanded ? 1 : undefined}>{errorMessage}</Text>\r\n                    </View>\r\n                </TouchableOpacity>\r\n                {DEBUG && (\r\n                    <TouchableOpacity style={{ flexDirection: `row`, alignItems: `center`, paddingLeft: 8, ...errorBoxStyle.button }} onPress={() => Clipboard.setString(jsonStringify_safe({ errorMessage, errorDetails, errorObjText }, true))}>\r\n                        <Icon style={errorBoxStyle.icon} kind={IconKind.copy} />\r\n                    </TouchableOpacity>\r\n                )}\r\n                {props.error.retryCallback && (\r\n                    <TouchableOpacity style={{ flexDirection: `row`, alignItems: `center`, paddingLeft: 8, ...errorBoxStyle.button }} onPress={props.error.retryCallback}>\r\n                        <Icon style={errorBoxStyle.icon} kind={IconKind.retry} />\r\n                    </TouchableOpacity>\r\n                )}\r\n            </View>\r\n            {canExpand && expanded && !!errorDetails && (<Text style={{ ...errorBoxStyle.text }}>{errorDetails}</Text>)}\r\n            {canExpand && expanded && !!errorObjText && (<Text style={{ ...errorBoxStyle.text }}>{errorObjText}</Text>)}\r\n        </View>\r\n    );\r\n};\r\n\r\n\r\nexport const ErrorMessage = (props: { children: string }) => {\r\n    return (\r\n        <View style={{ flexDirection: `row`, alignItems: `center` }}>\r\n            <View style={{ paddingLeft: 8, paddingRight: 8 }}>\r\n                <Icon style={errorBoxStyle.icon_errorMessage} kind={IconKind.error} />\r\n            </View>\r\n            <View style={{ overflow: `hidden` }}>\r\n                <Text style={errorBoxStyle.text_errorMessage} numberOfLines={1}>{props.children}</Text>\r\n            </View>\r\n        </View>\r\n    );\r\n};\r\n","/* eslint-disable react/no-array-index-key */\r\n/* eslint-disable jsx-a11y/no-static-element-interactions */\r\nimport React, { useState, useRef, useEffect } from 'react';\r\nimport { View, Text, ActivityIndicator, TouchableOpacity } from 'react-native-lite';\r\nimport { groupItems } from 'utils/arrays';\r\nimport { toKeyValueArray } from 'utils/objects';\r\nimport { useAutoLoadingError } from 'utils-react/hooks';\r\nimport { defaultDoodleDrawing, DoodleSegment, DoodleDrawing, doodleSegmentToSvgPath_line, DoodleDataWithScore } from './doodle';\r\nimport { createDoodleDrawingStorageService } from './doodle-storage';\r\n\r\nexport const styles = {\r\n    drawing: {\r\n        width: 312,\r\n        height: 312,\r\n        color: `#FFFFFF`,\r\n        backgroundColor: `#000000`,\r\n    },\r\n};\r\n\r\nexport const DoodleTestView = (props: {}) => {\r\n    const [doodle, setDoodle] = useState(defaultDoodleDrawing());\r\n\r\n    return (\r\n        <>\r\n            <DoodleDrawerView style={styles.drawing} drawing={doodle} onChange={setDoodle} />\r\n            <DoodleDisplayView style={styles.drawing} drawing={doodle} />\r\n        </>\r\n    );\r\n};\r\n\r\n// export const DoodleDrawingView = (props: { drawing?: DoodleDrawing, onDrawingChanged: (drawing: DoodleDrawing) => void }) => {\r\n\r\n//     const [doodle, setDoodle] = useState(props.drawing ?? defaultDoodleDrawing());\r\n//     const changeDoodle = (value: DoodleDrawing) => {\r\n//         setDoodle(value);\r\n//         props.onDrawingChanged(value);\r\n//     };\r\n\r\n//     return (\r\n//         <>\r\n//             <DoodleDrawer style={styles.drawing} drawing={doodle} onChange={changeDoodle} />\r\n//             {/* <div>\r\n//                 {JSON.stringify(doodle)}\r\n//             </div> */}\r\n//             {/* <div>\r\n//                 {JSON.stringify(decodeDoodleDrawing(encodeDoodleDrawing(doodle)))}\r\n//             </div> */}\r\n\r\n//             {/* <div>\r\n//                 {encodeDoodleDrawing(doodle).doodleText}\r\n//             </div> */}\r\n//             {/* <div>\r\n//                 {encodeDoodleDrawing(decodeDoodleDrawing(encodeDoodleDrawing(doodle))).doodleText}\r\n//             </div>  */}\r\n//         </>\r\n//     );\r\n// };\r\n\r\n\r\nexport const DoodleDrawerView = (props: { style: { width: number, height: number, color: string, backgroundColor: string }, drawing: DoodleDrawing, onChange: (drawing: DoodleDrawing) => void }) => {\r\n    const { style, drawing, onChange } = props;\r\n    const scale = style.width / drawing.width;\r\n\r\n    const [segment, setSegment] = useState(null as null | DoodleSegment);\r\n    const segmentClientStart = useRef(null as null | { clientX: number, clientY: number, x: number, y: number });\r\n    const divHost = useRef(null as null | HTMLDivElement);\r\n\r\n    type Ev = React.SyntheticEvent;\r\n\r\n    const onIgnore = (e: Ev) => {\r\n        e.preventDefault();\r\n        e.stopPropagation();\r\n        e.nativeEvent.cancelBubble = true;\r\n        e.nativeEvent.returnValue = false;\r\n        return false;\r\n    };\r\n\r\n    const onPressIn = (event: (Ev) & { clientX?: number, clientY?: number }, pos?: { clientX: number, clientY: number }) => {\r\n        // console.log(`onPressIn`, { event, pos });\r\n        const div = divHost.current;\r\n        if (!div) { return onIgnore(event); }\r\n\r\n        const rect = div.getBoundingClientRect();\r\n\r\n\r\n        const p = {\r\n            clientX: pos?.clientX ?? event.clientX ?? 0,\r\n            clientY: pos?.clientY ?? event.clientY ?? 0,\r\n        };\r\n\r\n        segmentClientStart.current = {\r\n            clientX: p.clientX,\r\n            clientY: p.clientY,\r\n            x: Math.floor((p.clientX - rect.x) / scale),\r\n            y: Math.floor((p.clientY - rect.y) / scale),\r\n        };\r\n\r\n        setSegment({\r\n            points: [{\r\n                x: segmentClientStart.current.x,\r\n                y: segmentClientStart.current.y,\r\n            }],\r\n        });\r\n\r\n        return onIgnore(event);\r\n    };\r\n    const onPressOut = (event: Ev) => {\r\n        // console.log(`onPressOut`, { event });\r\n        const s = segment;\r\n        if (!s) { return onIgnore(event); }\r\n\r\n        onChange({\r\n            ...drawing,\r\n            segments: [...drawing.segments, s],\r\n        });\r\n        setSegment(null);\r\n        segmentClientStart.current = null;\r\n\r\n        return onIgnore(event);\r\n    };\r\n    const onMove = (pos: { x: number, y: number }) => {\r\n        setSegment(s => {\r\n            if (!s) { return null; }\r\n            const lastPos = s.points[s.points.length - 1];\r\n            if (Math.abs(lastPos.x - pos.x) + Math.abs(lastPos.y - pos.y) <= 2) {\r\n                return s;\r\n            }\r\n            return { points: [...s.points, pos] };\r\n        });\r\n    };\r\n    const onClientMove = (event: (Ev) & { clientX?: number, clientY?: number }, pos?: { clientX: number, clientY: number }) => {\r\n        if (!segmentClientStart.current) {\r\n            return onIgnore(event);\r\n        }\r\n\r\n        // console.log(`onClientMove`, { event, pos });\r\n        const p = {\r\n            clientX: pos?.clientX ?? event.clientX ?? 0,\r\n            clientY: pos?.clientY ?? event.clientY ?? 0,\r\n        };\r\n        const dPos = {\r\n            x: Math.floor((p.clientX - segmentClientStart.current.clientX) / scale) + segmentClientStart.current.x,\r\n            y: Math.floor((p.clientY - segmentClientStart.current.clientY) / scale) + segmentClientStart.current.y,\r\n        };\r\n\r\n        onMove(dPos);\r\n        return onIgnore(event);\r\n    };\r\n\r\n    // useEffect(() => {\r\n    //     console.log(`divHost`, { divHost });\r\n    //     const div = divHost.current;\r\n    //     if (!div) { return () => { }; }\r\n\r\n    //     const onTouchStart = (x: Event) => onPressIn(x, (x as TouchEvent).touches[0]);\r\n    //     const onTouchMove = (x: Event) => onClientMove(x, (x as TouchEvent).touches[0]);\r\n\r\n    //     div.addEventListener(`mouseDown`, onPressIn, { passive: false });\r\n    //     div.addEventListener(`onTouchStart`, onTouchStart, { passive: false });\r\n    //     div.addEventListener(`onMouseUp`, onPressOut, { passive: false });\r\n    //     div.addEventListener(`onTouchEnd`, onPressOut, { passive: false });\r\n    //     div.addEventListener(`onMouseLeave`, onPressOut, { passive: false });\r\n    //     div.addEventListener(`onTouchEndCapture`, onPressOut, { passive: false });\r\n    //     div.addEventListener(`onMouseMove`, onClientMove, { passive: false });\r\n    //     div.addEventListener(`onTouchMove`, onTouchMove, { passive: false });\r\n\r\n    //     return () => {\r\n    //         div.removeEventListener(`mouseDown`, onPressIn);\r\n    //         div.removeEventListener(`onTouchStart`, onTouchStart);\r\n    //         div.removeEventListener(`onMouseUp`, onPressOut);\r\n    //         div.removeEventListener(`onTouchEnd`, onPressOut);\r\n    //         div.removeEventListener(`onMouseLeave`, onPressOut);\r\n    //         div.removeEventListener(`onTouchEndCapture`, onPressOut);\r\n    //         div.removeEventListener(`onMouseMove`, onClientMove);\r\n    //         div.removeEventListener(`onTouchMove`, onTouchMove);\r\n    //     };\r\n    // }, [divHost.current]);\r\n\r\n    useEffect(() => {\r\n        // console.log(`Disable scroll on touch`);\r\n        // Disable document scroll\r\n        const onIgnoreNative = (e: Event) => {\r\n            // If not drawing, don't ignore\r\n            if (!segmentClientStart.current) { return true; }\r\n\r\n            // console.log(`Prevent scroll on touch`);\r\n            e.preventDefault();\r\n            e.stopPropagation();\r\n            e.cancelBubble = true;\r\n            e.returnValue = false;\r\n            return false;\r\n        };\r\n        document.addEventListener(`touchmove`, onIgnoreNative, { passive: false });\r\n        return () => {\r\n            document.removeEventListener(`touchmove`, onIgnoreNative);\r\n        };\r\n    }, []);\r\n\r\n    return (\r\n        <>\r\n            <div style={{ position: `relative`, width: style.width, height: style.height, backgroundColor: style.backgroundColor }}>\r\n                <svg style={{ width: style.width, height: style.height }} viewBox={`0 0 ${drawing.width} ${drawing.height}`} preserveAspectRatio='none' xmlns='http://www.w3.org/2000/svg'>\r\n                    {drawing.segments.map((x, i) => (\r\n                        <path key={i} d={doodleSegmentToSvgPath_line(x)} stroke={style.color} fill='transparent' />\r\n                    ))}\r\n                    {segment && (\r\n                        <path d={doodleSegmentToSvgPath_line(segment)} stroke={style.color} fill='transparent' />\r\n                    )}\r\n                </svg>\r\n                <div ref={divHost} style={{ position: `absolute`, left: 0, right: 0, top: 0, bottom: 0, zIndex: 10 }}\r\n                    onMouseDown={onPressIn}\r\n                    onMouseUp={onPressOut}\r\n                    onMouseMove={onClientMove}\r\n                    onMouseLeave={onPressOut}\r\n                    onTouchStart={x => onPressIn(x, x.touches[0])}\r\n                    onTouchEnd={onPressOut}\r\n                    onTouchCancel={onPressOut}\r\n                    onTouchMove={x => onClientMove(x, x.touches[0])}\r\n                    onTouchEndCapture={onPressOut}\r\n                />\r\n            </div>\r\n            {/* <div>{doodleToSvg(drawing)}</div>\r\n            <div>{encodeDoodleDrawing(drawing).doodleText}</div> */}\r\n        </>\r\n    );\r\n};\r\n\r\nexport const DoodleDisplayView = (props: {\r\n    style: { width: number, height: number, color: string, backgroundColor: string };\r\n    drawing: DoodleDrawing;\r\n    shouldAnimate?: boolean;\r\n    animatePointsPerSecond?: number;\r\n    enableRedraw?: boolean;\r\n}) => {\r\n\r\n    const [redrawId, setRedrawId] = useState(0);\r\n\r\n    const redraw = () => {\r\n        if (!props.enableRedraw) { return; }\r\n        setRedrawId(s => s + 1);\r\n    };\r\n\r\n    if (props.enableRedraw) {\r\n        return (\r\n            <TouchableOpacity onPress={redraw}>\r\n                <DoodleDisplayView_Inner key={redrawId} {...props} shouldAnimate={redrawId > 0 ? true : (props.shouldAnimate ?? true)} />\r\n            </TouchableOpacity>\r\n        );\r\n    }\r\n    return (\r\n        <DoodleDisplayView_Inner {...props} />\r\n    );\r\n};\r\nconst DoodleDisplayView_Inner = ({\r\n    style,\r\n    drawing,\r\n    shouldAnimate = true,\r\n    animatePointsPerSecond = 20,\r\n}: {\r\n    style: { width: number, height: number, color: string, backgroundColor: string };\r\n    drawing: DoodleDrawing;\r\n    shouldAnimate?: boolean;\r\n    animatePointsPerSecond?: number;\r\n}) => {\r\n    const [tick, setTick] = useState(0);\r\n    const totalPoints = drawing.segments.flatMap(x => x.points).length;\r\n\r\n    useEffect(() => {\r\n        if (!shouldAnimate) { return () => { }; }\r\n\r\n        // console.log(`DoodleDisplayView_Inner.useEffect`);\r\n        const id = setInterval(() => {\r\n            // console.log(`DoodleDisplayView_Inner.useEffect.setInterval`);\r\n            setTick(s => {\r\n                if (s > totalPoints) { clearInterval(id); }\r\n                return s + Math.ceil(animatePointsPerSecond / 10);\r\n            });\r\n        }, 10);\r\n\r\n        return () => {\r\n            clearInterval(id);\r\n        };\r\n    }, [drawing]);\r\n\r\n    let remainingPoints = shouldAnimate ? tick : Number.MAX_SAFE_INTEGER;\r\n    return (\r\n        <div style={{ width: style.width, height: style.height, backgroundColor: style.backgroundColor }}>\r\n            <svg style={{ width: style.width, height: style.height }} viewBox={`0 0 ${drawing.width} ${drawing.height}`} preserveAspectRatio='none' xmlns='http://www.w3.org/2000/svg'>\r\n                {drawing.segments.map((x, i) => {\r\n                    const maxPoints = remainingPoints;\r\n                    remainingPoints = Math.max(0, remainingPoints - x.points.length);\r\n                    return (\r\n                        <path key={i} d={doodleSegmentToSvgPath_line({ points: [...x.points.slice(0, maxPoints)] })} stroke={style.color} fill='transparent' />\r\n                    );\r\n                })}\r\n            </svg>\r\n        </div>\r\n    );\r\n};\r\n\r\nexport const DoodleBrowser = () => {\r\n    const { loading, error, doWork } = useAutoLoadingError();\r\n    const [doodles, setDoodles] = useState([] as DoodleDataWithScore[]);\r\n    useEffect(() => {\r\n        doWork(async () => {\r\n            const service = await createDoodleDrawingStorageService();\r\n            const result = await service.getAllDrawings();\r\n            setDoodles(result.doodles);\r\n        });\r\n    }, []);\r\n\r\n    if (loading) {\r\n        return (\r\n            <ActivityIndicator size='large' color='#FFFF00' />\r\n        );\r\n    }\r\n\r\n    return (\r\n        <DoodleBrowseView doodles={doodles} />\r\n    );\r\n};\r\nexport const DoodleBrowseView = ({ doodles }: { doodles: DoodleDataWithScore[] }) => {\r\n\r\n    const grouped = toKeyValueArray(groupItems(doodles, x => x.prompt));\r\n\r\n    return (\r\n        <>\r\n            {grouped.map(g => (\r\n                <View key={g.key} style={{ padding: 4 }}>\r\n                    <Text style={{ fontSize: 12 }} >{g.key}</Text>\r\n                    <View style={{ padding: 4, flexDirection: `row`, flexWrap: `wrap` }}>\r\n                        {g.value.map(x => (\r\n                            <View key={x.key} style={{ padding: 4, alignItems: `center` }}>\r\n                                <DoodleDisplayView style={{ width: 104, height: 104, color: `#FFFFFF`, backgroundColor: `#000000` }} drawing={x.drawing} shouldAnimate={false} enableRedraw />\r\n                                <Text >{`${x.score}`}</Text>\r\n                            </View>\r\n                        ))}\r\n                    </View>\r\n                </View>\r\n            ))}\r\n        </>\r\n    );\r\n};\r\n","import { createSubscribable } from 'utils/subscribable';\r\nimport { AppError } from 'utils/error';\r\nimport { WebsocketApi, WebsocketConnectionEvent, WebsocketConnectionData } from './types';\r\n\r\nexport const createWebsocketClient = (config: { websocketsApiUrl: string }): WebsocketApi => {\r\n\r\n    const api: WebsocketApi = {\r\n        connect: <T>({ channelKey }: WebsocketConnectionData) => {\r\n            // With this implementation, the server simply echos all messages to all clients\r\n            // The client will filter those messages client-side with the key\r\n            // NOTE: When the server filters via keys (providing privacy), this will continue to work without changes\r\n\r\n            type MessageContainer = {\r\n                message: T | null;\r\n                key: string;\r\n            };\r\n\r\n            const subscribable = createSubscribable<T>();\r\n            const subscribableEvents = createSubscribable<WebsocketConnectionEvent>();\r\n\r\n            // Connect to websocket (and reconnect, etc.)\r\n            const createSocket = () => {\r\n                const socket = new WebSocket(`${config.websocketsApiUrl}`);\r\n\r\n                // Connection opened\r\n                socket.addEventListener(`open`, (event) => {\r\n                    if (socket !== activeSocket) {\r\n                        socket.close();\r\n                        return;\r\n                    }\r\n\r\n                    subscribableEvents.onStateChange({ connectionStatus: `opened` });\r\n\r\n                    // Send a key message\r\n                    const messageContainer: MessageContainer = {\r\n                        message: null,\r\n                        key: channelKey,\r\n                    };\r\n                    socket.send(JSON.stringify(messageContainer));\r\n\r\n                });\r\n                socket.addEventListener(`close`, (event) => {\r\n                    if (socket !== activeSocket) {\r\n                        socket.close();\r\n                        return;\r\n                    }\r\n\r\n                    subscribableEvents.onStateChange({ connectionStatus: `closed` });\r\n                    reconnect();\r\n                });\r\n                socket.addEventListener(`error`, (event) => {\r\n                    if (socket !== activeSocket) {\r\n                        socket.close();\r\n                        return;\r\n                    }\r\n\r\n                    subscribableEvents.onStateChange({ connectionStatus: `error`, error: { message: `Websocket Error`, error: event } });\r\n                    reconnect();\r\n                });\r\n\r\n                // Listen for messages\r\n                socket.addEventListener(`message`, (event) => {\r\n                    // console.log(`socket message`, { event });\r\n                    if (socket !== activeSocket) {\r\n                        socket.close();\r\n                        return;\r\n                    }\r\n\r\n                    const m = JSON.parse(event.data) as MessageContainer;\r\n                    if (m.key !== channelKey || !m.message) { return; }\r\n                    subscribable.onStateChange(m.message);\r\n                });\r\n\r\n                return socket;\r\n            };\r\n\r\n            let isClosed = false;\r\n            let activeSocket: null | WebSocket = createSocket();\r\n            const reconnect = () => {\r\n                if (isClosed) { return; }\r\n\r\n                setTimeout(() => {\r\n                    activeSocket = createSocket();\r\n                }, 50);\r\n            };\r\n\r\n            // Send Messages\r\n            const send = (message: T) => {\r\n                if (!activeSocket || activeSocket.readyState !== WebSocket.OPEN) {\r\n                    throw new AppError(`Websocket is not open`);\r\n                }\r\n                const messageContainer: MessageContainer = {\r\n                    message,\r\n                    key: channelKey,\r\n                };\r\n                activeSocket.send(JSON.stringify(messageContainer));\r\n            };\r\n\r\n            return {\r\n                send,\r\n                isConnected: () => activeSocket?.readyState === WebSocket.OPEN,\r\n                subscribeMessages: subscribable.subscribe,\r\n                subscribeConnectionEvents: subscribableEvents.subscribe,\r\n                close: () => {\r\n                    isClosed = true;\r\n                    activeSocket?.close();\r\n                    activeSocket = null;\r\n                },\r\n            };\r\n        },\r\n    };\r\n\r\n    return api;\r\n};\r\n","(function (global, factory) {\n  typeof exports === 'object' && typeof module !== 'undefined' ? factory(exports, require('react')) : typeof define === 'function' && define.amd ? define(['exports', 'react'], factory) : (global = global || self, factory(global.ReactStripe = {}, global.React));\n})(this, function (exports, React) {\n  'use strict';\n\n  React = React && React.hasOwnProperty('default') ? React['default'] : React;\n\n  function _typeof(obj) {\n    \"@babel/helpers - typeof\";\n\n    if (typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\") {\n      _typeof = function _typeof(obj) {\n        return typeof obj;\n      };\n    } else {\n      _typeof = function _typeof(obj) {\n        return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj;\n      };\n    }\n\n    return _typeof(obj);\n  }\n\n  function _objectWithoutPropertiesLoose(source, excluded) {\n    if (source == null) return {};\n    var target = {};\n    var sourceKeys = Object.keys(source);\n    var key, i;\n\n    for (i = 0; i < sourceKeys.length; i++) {\n      key = sourceKeys[i];\n      if (excluded.indexOf(key) >= 0) continue;\n      target[key] = source[key];\n    }\n\n    return target;\n  }\n\n  function _objectWithoutProperties(source, excluded) {\n    if (source == null) return {};\n\n    var target = _objectWithoutPropertiesLoose(source, excluded);\n\n    var key, i;\n\n    if (Object.getOwnPropertySymbols) {\n      var sourceSymbolKeys = Object.getOwnPropertySymbols(source);\n\n      for (i = 0; i < sourceSymbolKeys.length; i++) {\n        key = sourceSymbolKeys[i];\n        if (excluded.indexOf(key) >= 0) continue;\n        if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue;\n        target[key] = source[key];\n      }\n    }\n\n    return target;\n  }\n\n  function _slicedToArray(arr, i) {\n    return _arrayWithHoles(arr) || _iterableToArrayLimit(arr, i) || _nonIterableRest();\n  }\n\n  function _arrayWithHoles(arr) {\n    if (Array.isArray(arr)) return arr;\n  }\n\n  function _iterableToArrayLimit(arr, i) {\n    if (!(Symbol.iterator in Object(arr) || Object.prototype.toString.call(arr) === \"[object Arguments]\")) {\n      return;\n    }\n\n    var _arr = [];\n    var _n = true;\n    var _d = false;\n    var _e = undefined;\n\n    try {\n      for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) {\n        _arr.push(_s.value);\n\n        if (i && _arr.length === i) break;\n      }\n    } catch (err) {\n      _d = true;\n      _e = err;\n    } finally {\n      try {\n        if (!_n && _i[\"return\"] != null) _i[\"return\"]();\n      } finally {\n        if (_d) throw _e;\n      }\n    }\n\n    return _arr;\n  }\n\n  function _nonIterableRest() {\n    throw new TypeError(\"Invalid attempt to destructure non-iterable instance\");\n  }\n\n  function createCommonjsModule(fn, module) {\n    return module = {\n      exports: {}\n    }, fn(module, module.exports), module.exports;\n  }\n  /**\n   * Copyright (c) 2013-present, Facebook, Inc.\n   *\n   * This source code is licensed under the MIT license found in the\n   * LICENSE file in the root directory of this source tree.\n   */\n\n\n  var ReactPropTypesSecret = 'SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED';\n  var ReactPropTypesSecret_1 = ReactPropTypesSecret;\n\n  function emptyFunction() {}\n\n  function emptyFunctionWithReset() {}\n\n  emptyFunctionWithReset.resetWarningCache = emptyFunction;\n\n  var factoryWithThrowingShims = function factoryWithThrowingShims() {\n    function shim(props, propName, componentName, location, propFullName, secret) {\n      if (secret === ReactPropTypesSecret_1) {\n        // It is still safe when called from React.\n        return;\n      }\n\n      var err = new Error('Calling PropTypes validators directly is not supported by the `prop-types` package. ' + 'Use PropTypes.checkPropTypes() to call them. ' + 'Read more at http://fb.me/use-check-prop-types');\n      err.name = 'Invariant Violation';\n      throw err;\n    }\n\n    shim.isRequired = shim;\n\n    function getShim() {\n      return shim;\n    } // Keep this list in sync with production version in `./factoryWithTypeCheckers.js`.\n\n\n    var ReactPropTypes = {\n      array: shim,\n      bool: shim,\n      func: shim,\n      number: shim,\n      object: shim,\n      string: shim,\n      symbol: shim,\n      any: shim,\n      arrayOf: getShim,\n      element: shim,\n      elementType: shim,\n      instanceOf: getShim,\n      node: shim,\n      objectOf: getShim,\n      oneOf: getShim,\n      oneOfType: getShim,\n      shape: getShim,\n      exact: getShim,\n      checkPropTypes: emptyFunctionWithReset,\n      resetWarningCache: emptyFunction\n    };\n    ReactPropTypes.PropTypes = ReactPropTypes;\n    return ReactPropTypes;\n  };\n\n  var propTypes = createCommonjsModule(function (module) {\n    /**\n     * Copyright (c) 2013-present, Facebook, Inc.\n     *\n     * This source code is licensed under the MIT license found in the\n     * LICENSE file in the root directory of this source tree.\n     */\n    {\n      // By explicitly using `prop-types` you are opting into new production behavior.\n      // http://fb.me/prop-types-in-prod\n      module.exports = factoryWithThrowingShims();\n    }\n  });\n\n  var isUnknownObject = function isUnknownObject(raw) {\n    return raw !== null && _typeof(raw) === 'object';\n  };\n\n  var isPromise = function isPromise(raw) {\n    return isUnknownObject(raw) && typeof raw.then === 'function';\n  }; // We are using types to enforce the `stripe` prop in this lib,\n  // but in an untyped integration `stripe` could be anything, so we need\n  // to do some sanity validation to prevent type errors.\n\n\n  var isStripe = function isStripe(raw) {\n    return isUnknownObject(raw) && typeof raw.elements === 'function' && typeof raw.createToken === 'function' && typeof raw.createPaymentMethod === 'function' && typeof raw.confirmCardPayment === 'function';\n  };\n\n  var PLAIN_OBJECT_STR = '[object Object]';\n\n  var isEqual = function isEqual(left, right) {\n    if (!isUnknownObject(left) || !isUnknownObject(right)) {\n      return left === right;\n    }\n\n    var leftArray = Array.isArray(left);\n    var rightArray = Array.isArray(right);\n    if (leftArray !== rightArray) return false;\n    var leftPlainObject = Object.prototype.toString.call(left) === PLAIN_OBJECT_STR;\n    var rightPlainObject = Object.prototype.toString.call(right) === PLAIN_OBJECT_STR;\n    if (leftPlainObject !== rightPlainObject) return false;\n    if (!leftPlainObject && !leftArray) return false;\n    var leftKeys = Object.keys(left);\n    var rightKeys = Object.keys(right);\n    if (leftKeys.length !== rightKeys.length) return false;\n    var keySet = {};\n\n    for (var i = 0; i < leftKeys.length; i += 1) {\n      keySet[leftKeys[i]] = true;\n    }\n\n    for (var _i = 0; _i < rightKeys.length; _i += 1) {\n      keySet[rightKeys[_i]] = true;\n    }\n\n    var allKeys = Object.keys(keySet);\n\n    if (allKeys.length !== leftKeys.length) {\n      return false;\n    }\n\n    var l = left;\n    var r = right;\n\n    var pred = function pred(key) {\n      return isEqual(l[key], r[key]);\n    };\n\n    return allKeys.every(pred);\n  };\n\n  var usePrevious = function usePrevious(value) {\n    var ref = React.useRef(value);\n    React.useEffect(function () {\n      ref.current = value;\n    }, [value]);\n    return ref.current;\n  };\n\n  var INVALID_STRIPE_ERROR = 'Invalid prop `stripe` supplied to `Elements`. We recommend using the `loadStripe` utility from `@stripe/stripe-js`. See https://stripe.com/docs/stripe-js/react#elements-props-stripe for details.'; // We are using types to enforce the `stripe` prop in this lib, but in a real\n  // integration `stripe` could be anything, so we need to do some sanity\n  // validation to prevent type errors.\n\n  var validateStripe = function validateStripe(maybeStripe) {\n    if (maybeStripe === null || isStripe(maybeStripe)) {\n      return maybeStripe;\n    }\n\n    throw new Error(INVALID_STRIPE_ERROR);\n  };\n\n  var parseStripeProp = function parseStripeProp(raw) {\n    if (isPromise(raw)) {\n      return {\n        tag: 'async',\n        stripePromise: Promise.resolve(raw).then(validateStripe)\n      };\n    }\n\n    var stripe = validateStripe(raw);\n\n    if (stripe === null) {\n      return {\n        tag: 'empty'\n      };\n    }\n\n    return {\n      tag: 'sync',\n      stripe: stripe\n    };\n  };\n\n  var ElementsContext = React.createContext(null);\n  ElementsContext.displayName = 'ElementsContext';\n\n  var parseElementsContext = function parseElementsContext(ctx, useCase) {\n    if (!ctx) {\n      throw new Error(\"Could not find Elements context; You need to wrap the part of your app that \".concat(useCase, \" in an <Elements> provider.\"));\n    }\n\n    return ctx;\n  };\n  /**\n   * The `Elements` provider allows you to use [Element components](https://stripe.com/docs/stripe-js/react#element-components) and access the [Stripe object](https://stripe.com/docs/js/initializing) in any nested component.\n   * Render an `Elements` provider at the root of your React app so that it is available everywhere you need it.\n   *\n   * To use the `Elements` provider, call `loadStripe` from `@stripe/stripe-js` with your publishable key.\n   * The `loadStripe` function will asynchronously load the Stripe.js script and initialize a `Stripe` object.\n   * Pass the returned `Promise` to `Elements`.\n   *\n   * @docs https://stripe.com/docs/stripe-js/react#elements-provider\n   */\n\n\n  var Elements = function Elements(_ref) {\n    var rawStripeProp = _ref.stripe,\n        options = _ref.options,\n        children = _ref.children;\n\n    var _final = React.useRef(false);\n\n    var isMounted = React.useRef(true);\n    var parsed = React.useMemo(function () {\n      return parseStripeProp(rawStripeProp);\n    }, [rawStripeProp]);\n\n    var _React$useState = React.useState(function () {\n      return {\n        stripe: null,\n        elements: null\n      };\n    }),\n        _React$useState2 = _slicedToArray(_React$useState, 2),\n        ctx = _React$useState2[0],\n        setContext = _React$useState2[1];\n\n    var prevStripe = usePrevious(rawStripeProp);\n    var prevOptions = usePrevious(options);\n\n    if (prevStripe !== null) {\n      if (prevStripe !== rawStripeProp) {\n        console.warn('Unsupported prop change on Elements: You cannot change the `stripe` prop after setting it.');\n      }\n\n      if (!isEqual(options, prevOptions)) {\n        console.warn('Unsupported prop change on Elements: You cannot change the `options` prop after setting the `stripe` prop.');\n      }\n    }\n\n    if (!_final.current) {\n      if (parsed.tag === 'sync') {\n        _final.current = true;\n        setContext({\n          stripe: parsed.stripe,\n          elements: parsed.stripe.elements(options)\n        });\n      }\n\n      if (parsed.tag === 'async') {\n        _final.current = true;\n        parsed.stripePromise.then(function (stripe) {\n          if (stripe && isMounted.current) {\n            // Only update Elements context if the component is still mounted\n            // and stripe is not null. We allow stripe to be null to make\n            // handling SSR easier.\n            setContext({\n              stripe: stripe,\n              elements: stripe.elements(options)\n            });\n          }\n        });\n      }\n    }\n\n    React.useEffect(function () {\n      return function () {\n        isMounted.current = false;\n      };\n    }, []);\n    React.useEffect(function () {\n      var anyStripe = ctx.stripe;\n\n      if (!anyStripe || !anyStripe._registerWrapper) {\n        return;\n      }\n\n      anyStripe._registerWrapper({\n        name: 'react-stripe-js',\n        version: \"1.1.2\"\n      });\n    }, [ctx.stripe]);\n    return React.createElement(ElementsContext.Provider, {\n      value: ctx\n    }, children);\n  };\n\n  var useElementsContextWithUseCase = function useElementsContextWithUseCase(useCaseMessage) {\n    var ctx = React.useContext(ElementsContext);\n    return parseElementsContext(ctx, useCaseMessage);\n  };\n  /**\n   * @docs https://stripe.com/docs/stripe-js/react#useelements-hook\n   */\n\n\n  var useElements = function useElements() {\n    var _useElementsContextWi = useElementsContextWithUseCase('calls useElements()'),\n        elements = _useElementsContextWi.elements;\n\n    return elements;\n  };\n  /**\n   * @docs https://stripe.com/docs/stripe-js/react#usestripe-hook\n   */\n\n\n  var useStripe = function useStripe() {\n    var _useElementsContextWi2 = useElementsContextWithUseCase('calls useStripe()'),\n        stripe = _useElementsContextWi2.stripe;\n\n    return stripe;\n  };\n  /**\n   * @docs https://stripe.com/docs/stripe-js/react#elements-consumer\n   */\n\n\n  var ElementsConsumer = function ElementsConsumer(_ref2) {\n    var children = _ref2.children;\n    var ctx = useElementsContextWithUseCase('mounts <ElementsConsumer>'); // Assert to satisfy the busted React.FC return type (it should be ReactNode)\n\n    return children(ctx);\n  };\n\n  ElementsConsumer.propTypes = {\n    children: propTypes.func.isRequired\n  };\n\n  var useCallbackReference = function useCallbackReference(cb) {\n    var ref = React.useRef(cb);\n    React.useEffect(function () {\n      ref.current = cb;\n    }, [cb]);\n    return function () {\n      if (ref.current) {\n        ref.current.apply(ref, arguments);\n      }\n    };\n  };\n\n  var extractUpdateableOptions = function extractUpdateableOptions(options) {\n    if (!isUnknownObject(options)) {\n      return {};\n    }\n\n    var _ = options.paymentRequest,\n        rest = _objectWithoutProperties(options, [\"paymentRequest\"]);\n\n    return rest;\n  };\n\n  var noop = function noop() {};\n\n  var capitalized = function capitalized(str) {\n    return str.charAt(0).toUpperCase() + str.slice(1);\n  };\n\n  var createElementComponent = function createElementComponent(type, isServer) {\n    var displayName = \"\".concat(capitalized(type), \"Element\");\n\n    var ClientElement = function ClientElement(_ref) {\n      var id = _ref.id,\n          className = _ref.className,\n          _ref$options = _ref.options,\n          options = _ref$options === void 0 ? {} : _ref$options,\n          _ref$onBlur = _ref.onBlur,\n          onBlur = _ref$onBlur === void 0 ? noop : _ref$onBlur,\n          _ref$onFocus = _ref.onFocus,\n          onFocus = _ref$onFocus === void 0 ? noop : _ref$onFocus,\n          _ref$onReady = _ref.onReady,\n          onReady = _ref$onReady === void 0 ? noop : _ref$onReady,\n          _ref$onChange = _ref.onChange,\n          onChange = _ref$onChange === void 0 ? noop : _ref$onChange,\n          _ref$onEscape = _ref.onEscape,\n          onEscape = _ref$onEscape === void 0 ? noop : _ref$onEscape,\n          _ref$onClick = _ref.onClick,\n          onClick = _ref$onClick === void 0 ? noop : _ref$onClick;\n\n      var _useElementsContextWi = useElementsContextWithUseCase(\"mounts <\".concat(displayName, \">\")),\n          elements = _useElementsContextWi.elements;\n\n      var elementRef = React.useRef(null);\n      var domNode = React.useRef(null);\n      var callOnReady = useCallbackReference(onReady);\n      var callOnBlur = useCallbackReference(onBlur);\n      var callOnFocus = useCallbackReference(onFocus);\n      var callOnClick = useCallbackReference(onClick);\n      var callOnChange = useCallbackReference(onChange);\n      var callOnEscape = useCallbackReference(onEscape);\n      React.useLayoutEffect(function () {\n        if (elementRef.current == null && elements && domNode.current != null) {\n          var element = elements.create(type, options);\n          elementRef.current = element;\n          element.mount(domNode.current);\n          element.on('ready', function () {\n            return callOnReady(element);\n          });\n          element.on('change', callOnChange);\n          element.on('blur', callOnBlur);\n          element.on('focus', callOnFocus);\n          element.on('escape', callOnEscape); // Users can pass an an onClick prop on any Element component\n          // just as they could listen for the `click` event on any Element,\n          // but only the PaymentRequestButton will actually trigger the event.\n\n          element.on('click', callOnClick);\n        }\n      });\n      var prevOptions = React.useRef(options);\n      React.useEffect(function () {\n        if (prevOptions.current && prevOptions.current.paymentRequest !== options.paymentRequest) {\n          console.warn('Unsupported prop change: options.paymentRequest is not a customizable property.');\n        }\n\n        var updateableOptions = extractUpdateableOptions(options);\n\n        if (Object.keys(updateableOptions).length !== 0 && !isEqual(updateableOptions, extractUpdateableOptions(prevOptions.current))) {\n          if (elementRef.current) {\n            elementRef.current.update(updateableOptions);\n            prevOptions.current = options;\n          }\n        }\n      }, [options]);\n      React.useEffect(function () {\n        return function () {\n          if (elementRef.current) {\n            elementRef.current.destroy();\n          }\n        };\n      }, []);\n      return React.createElement(\"div\", {\n        id: id,\n        className: className,\n        ref: domNode\n      });\n    }; // Only render the Element wrapper in a server environment.\n\n\n    var ServerElement = function ServerElement(props) {\n      // Validate that we are in the right context by calling useElementsContextWithUseCase.\n      useElementsContextWithUseCase(\"mounts <\".concat(displayName, \">\"));\n      var id = props.id,\n          className = props.className;\n      return React.createElement(\"div\", {\n        id: id,\n        className: className\n      });\n    };\n\n    var Element = isServer ? ServerElement : ClientElement;\n    Element.propTypes = {\n      id: propTypes.string,\n      className: propTypes.string,\n      onChange: propTypes.func,\n      onBlur: propTypes.func,\n      onFocus: propTypes.func,\n      onReady: propTypes.func,\n      onClick: propTypes.func,\n      options: propTypes.object\n    };\n    Element.displayName = displayName;\n    Element.__elementType = type;\n    return Element;\n  };\n\n  var isServer = typeof window === 'undefined';\n  /**\n   * Requires beta access:\n   * Contact [Stripe support](https://support.stripe.com/) for more information.\n   *\n   * @docs https://stripe.com/docs/stripe-js/react#element-components\n   */\n\n  var AuBankAccountElement = createElementComponent('auBankAccount', isServer);\n  /**\n   * @docs https://stripe.com/docs/stripe-js/react#element-components\n   */\n\n  var CardElement = createElementComponent('card', isServer);\n  /**\n   * @docs https://stripe.com/docs/stripe-js/react#element-components\n   */\n\n  var CardNumberElement = createElementComponent('cardNumber', isServer);\n  /**\n   * @docs https://stripe.com/docs/stripe-js/react#element-components\n   */\n\n  var CardExpiryElement = createElementComponent('cardExpiry', isServer);\n  /**\n   * @docs https://stripe.com/docs/stripe-js/react#element-components\n   */\n\n  var CardCvcElement = createElementComponent('cardCvc', isServer);\n  /**\n   * @docs https://stripe.com/docs/stripe-js/react#element-components\n   */\n\n  var FpxBankElement = createElementComponent('fpxBank', isServer);\n  /**\n   * @docs https://stripe.com/docs/stripe-js/react#element-components\n   */\n\n  var IbanElement = createElementComponent('iban', isServer);\n  /**\n   * @docs https://stripe.com/docs/stripe-js/react#element-components\n   */\n\n  var IdealBankElement = createElementComponent('idealBank', isServer);\n  /**\n   * @docs https://stripe.com/docs/stripe-js/react#element-components\n   */\n\n  var PaymentRequestButtonElement = createElementComponent('paymentRequestButton', isServer);\n  exports.AuBankAccountElement = AuBankAccountElement;\n  exports.CardCvcElement = CardCvcElement;\n  exports.CardElement = CardElement;\n  exports.CardExpiryElement = CardExpiryElement;\n  exports.CardNumberElement = CardNumberElement;\n  exports.Elements = Elements;\n  exports.ElementsConsumer = ElementsConsumer;\n  exports.FpxBankElement = FpxBankElement;\n  exports.IbanElement = IbanElement;\n  exports.IdealBankElement = IdealBankElement;\n  exports.PaymentRequestButtonElement = PaymentRequestButtonElement;\n  exports.useElements = useElements;\n  exports.useStripe = useStripe;\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n});","export type PhoneNumber = string & { __type: 'PhoneNumber', format: '+19785551234' };\r\nexport type PhoneNumberFormatted = string & { __type: 'PhoneNumber', format: '(###) ###-####' };\r\n\r\nexport function formatPhoneNumber_UsaCanada(text: string): PhoneNumberFormatted {\r\n    return phoneNumberMask_UsaCanada(text).corrected as PhoneNumberFormatted;\r\n}\r\n\r\nexport function toStandardPhoneNumber(text: string): PhoneNumber {\r\n    return `+1${phoneNumberMask_UsaCanada(text).digitsNo1}` as PhoneNumber;\r\n}\r\n\r\nexport function toStandardPhoneNumber_optional(text: string | null | undefined): PhoneNumber | undefined {\r\n    if (!text) { return undefined; }\r\n    return `+1${phoneNumberMask_UsaCanada(text).digitsNo1}` as PhoneNumber;\r\n}\r\n\r\nexport function phoneNumberMask_UsaCanada(x: string | null | undefined) {\r\n    const numberMask = `(###) ###-####`;\r\n    const digits = x\r\n        ?.replace(/^(\\+1|1)/, ``)\r\n        .replace(/\\D/g, ``)\r\n        .split(``) ?? [];\r\n    const letters = numberMask.split(``);\r\n    let iDigit = 0;\r\n    let iLast = -1;\r\n    for (let i = 0; i < letters.length; i++) {\r\n        if (letters[i] === `#` && iDigit < digits.length) {\r\n            letters[i] = digits[iDigit];\r\n            iDigit++;\r\n            iLast = i;\r\n        }\r\n    }\r\n    const full = letters.join(``);\r\n    const corrected = letters.slice(0, iLast + 1).join(``);\r\n    return { corrected, full, digitsNo1: digits.join(``) };\r\n}\r\n","function _toConsumableArray(arr) {\n  return _arrayWithoutHoles(arr) || _iterableToArray(arr) || _nonIterableSpread();\n}\n\nfunction _arrayWithoutHoles(arr) {\n  if (Array.isArray(arr)) {\n    for (var i = 0, arr2 = new Array(arr.length); i < arr.length; i++) {\n      arr2[i] = arr[i];\n    }\n\n    return arr2;\n  }\n}\n\nfunction _iterableToArray(iter) {\n  if (Symbol.iterator in Object(iter) || Object.prototype.toString.call(iter) === \"[object Arguments]\") return Array.from(iter);\n}\n\nfunction _nonIterableSpread() {\n  throw new TypeError(\"Invalid attempt to spread non-iterable instance\");\n}\n\nvar V3_URL = 'https://js.stripe.com/v3';\nvar V3_URL_REGEX = /^https:\\/\\/js\\.stripe\\.com\\/v3\\/?(\\?.*)?$/;\nvar EXISTING_SCRIPT_MESSAGE = 'loadStripe.setLoadParameters was called but an existing Stripe.js script already exists in the document; existing script parameters will be used';\n\nvar findScript = function findScript() {\n  var scripts = document.querySelectorAll(\"script[src^=\\\"\".concat(V3_URL, \"\\\"]\"));\n\n  for (var i = 0; i < scripts.length; i++) {\n    var script = scripts[i];\n\n    if (!V3_URL_REGEX.test(script.src)) {\n      continue;\n    }\n\n    return script;\n  }\n\n  return null;\n};\n\nvar injectScript = function injectScript(params) {\n  var queryString = params && !params.advancedFraudSignals ? '?advancedFraudSignals=false' : '';\n  var script = document.createElement('script');\n  script.src = \"\".concat(V3_URL).concat(queryString);\n  var headOrBody = document.head || document.body;\n\n  if (!headOrBody) {\n    throw new Error('Expected document.body not to be null. Stripe.js requires a <body> element.');\n  }\n\n  headOrBody.appendChild(script);\n  return script;\n};\n\nvar registerWrapper = function registerWrapper(stripe) {\n  if (!stripe || !stripe._registerWrapper) {\n    return;\n  }\n\n  stripe._registerWrapper({\n    name: 'stripe-js',\n    version: \"1.5.0\"\n  });\n};\n\nvar stripePromise = null;\n\nvar loadScript = function loadScript(params) {\n  // Ensure that we only attempt to load Stripe.js at most once\n  if (stripePromise !== null) {\n    return stripePromise;\n  }\n\n  stripePromise = new Promise(function (resolve, reject) {\n    if (typeof window === 'undefined') {\n      // Resolve to null when imported server side. This makes the module\n      // safe to import in an isomorphic code base.\n      resolve(null);\n      return;\n    }\n\n    if (window.Stripe && params) {\n      console.warn(EXISTING_SCRIPT_MESSAGE);\n    }\n\n    if (window.Stripe) {\n      resolve(window.Stripe);\n      return;\n    }\n\n    try {\n      var script = findScript();\n\n      if (script && params) {\n        console.warn(EXISTING_SCRIPT_MESSAGE);\n      } else if (!script) {\n        script = injectScript(params);\n      }\n\n      script.addEventListener('load', function () {\n        if (window.Stripe) {\n          resolve(window.Stripe);\n        } else {\n          reject(new Error('Stripe.js not available'));\n        }\n      });\n      script.addEventListener('error', function () {\n        reject(new Error('Failed to load Stripe.js'));\n      });\n    } catch (error) {\n      reject(error);\n      return;\n    }\n  });\n  return stripePromise;\n};\n\nvar initStripe = function initStripe(maybeStripe, args) {\n  if (maybeStripe === null) {\n    return null;\n  }\n\n  var stripe = maybeStripe.apply(void 0, _toConsumableArray(args));\n  registerWrapper(stripe);\n  return stripe;\n}; // own script injection.\n\n\nvar stripePromise$1 = Promise.resolve().then(function () {\n  return loadScript(null);\n});\nvar loadCalled = false;\nstripePromise$1[\"catch\"](function (err) {\n  if (!loadCalled) {\n    console.warn(err);\n  }\n});\n\nvar loadStripe = function loadStripe() {\n  for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n    args[_key] = arguments[_key];\n  }\n\n  loadCalled = true;\n  return stripePromise$1.then(function (maybeStripe) {\n    return initStripe(maybeStripe, args);\n  });\n};\n\nexport { loadStripe };","\r\nexport enum ProcessSteps_CreateSavedPaymentMethod {\r\n    _01_Client_BeginCreateSavedPaymentMethod = 100,\r\n    _02_Server_SetupSavedPaymentMethod = 200,\r\n    _03_Client_CollectPaymentDetails = 300,\r\n    _04_Server_ObtainPaymentMethod = 400,\r\n    _05_Server_SavePaymentMethod = 500,\r\n};\r\n\r\nexport const logProcessStep_CreateSavedPaymentMethod = (step: ProcessSteps_CreateSavedPaymentMethod, status?: 'BEGIN' | 'END' | 'FAIL', data?: unknown) => {\r\n    // TODO: Implement Universal Logger\r\n\r\n    // eslint-disable-next-line no-console\r\n    console.log(`CreateSavedPaymentMethod: ${ProcessSteps_CreateSavedPaymentMethod[step]} ${status}`, data);\r\n};\r\n\r\nexport const wrapProcessStep_CreateSavedPaymentMethod = async <TResult>(step: ProcessSteps_CreateSavedPaymentMethod, execute: () => Promise<TResult>): Promise<TResult> => {\r\n    try {\r\n        logProcessStep_CreateSavedPaymentMethod(step, `BEGIN`);\r\n\r\n        const result = await execute();\r\n        logProcessStep_CreateSavedPaymentMethod(step, `END`);\r\n        return result;\r\n    } catch (error) {\r\n        logProcessStep_CreateSavedPaymentMethod(step, `FAIL`, { error });\r\n        throw error;\r\n    }\r\n};\r\n","/** This token is used to identify a specific app user with the user's id in the provider's context (i.e. customer id) */\r\nexport type PaymentProviderUserToken = unknown & { __type: 'PaymentProviderUserToken' };\r\n/** This token is used to identify the client as it negotiates directly with the provider to enter payment method data */\r\nexport type PaymentProviderSavedPaymentMethodClientSetupToken = unknown & { __type: 'PaymentProviderSavedPaymentMethodClientSetupToken' };\r\n/** This token is used to identify the payment method obtained on the client from the provider */\r\nexport type PaymentProviderSavedPaymentMethodClientToken = unknown & { __type: 'PaymentProviderSavedPaymentMethodClientToken' };\r\n/** This token is used to identify the payment method long term after being verified by the provider on the server */\r\nexport type PaymentProviderSavedPaymentMethodStorageToken = unknown & { __type: 'PaymentProviderSavedPaymentMethodStorageToken' };\r\n\r\n/** PaymentProviderName identifies the payment provider and it's implementation (i.e. stripe, paypal, etc.) */\r\nexport type PaymentProviderName = string & { __type: 'PaymentProviderName' };\r\n\r\n/** PaymentMethodStorageKey is the auto generated storage key to uniquely identify a stored payment method */\r\nexport type PaymentMethodStorageKey = string & { __type: 'PaymentMethodStorageKey' };\r\n\r\nexport type PaymentMethodExpiration = {\r\n    year: number;\r\n    month: number;\r\n};\r\nexport type PaymentMethodClientInfo = {\r\n    key: PaymentMethodStorageKey;\r\n    providerName: PaymentProviderName;\r\n    title: string;\r\n    expiration: PaymentMethodExpiration;\r\n};\r\n\r\nexport type PaymentAmount = { currency: 'usd', usdCents: number };\r\n\r\nexport type PaymentTransaction = {\r\n    providerName: PaymentProviderName;\r\n    created: Date;\r\n    amount: PaymentAmount;\r\n    status: 'success' | 'incomplete' | 'terminated';\r\n}\r\n\r\n/** Payment Client to Server Calls\r\n * \r\n * These are the calls made on the client to the server, it supports multiple payment provider types\r\n * \r\n * Note: this is scoped to the user associated with the client\r\n */\r\nexport type PaymentClientApi = {\r\n    // Normal Flow\r\n    setupSavedPaymentMethod: (params: { providerName: PaymentProviderName }) => Promise<PaymentProviderSavedPaymentMethodClientSetupToken>;\r\n    saveSavedPaymentMethod: (params: { providerName: PaymentProviderName, paymentMethodClientToken: PaymentProviderSavedPaymentMethodClientToken }) => Promise<void>;\r\n\r\n    // Management of Payment Methods\r\n    getSavedPaymentMethods: () => Promise<PaymentMethodClientInfo[]>;\r\n    deleteSavedPaymentMethod: (params: { key: PaymentMethodStorageKey }) => Promise<void>;\r\n\r\n    // Management of Payments\r\n    debug_triggerPayment: (params: { amount: PaymentAmount }) => Promise<void>;\r\n    getPayments: () => Promise<PaymentTransaction[]>;\r\n    // getPaymentsRequiringUserAction: () => Promise<PaymentTransaction[]>;\r\n}\r\n\r\n\r\n/** Payment Server to Server Calls\r\n * \r\n * These are the calls intended to be used server-side to process payments\r\n * \r\n */\r\nexport type PaymentServerApi = {\r\n    /** This will use the payment methods in order until one succeeds */\r\n    chargeUsingSavedPaymentMethods: (params: { amount: PaymentAmount }) => Promise<void>;\r\n}\r\n\r\n/** Payment Server to Payment Provider Api Calls\r\n * \r\n * This wraps the provider-specific server code\r\n */\r\nexport type PaymentProviderApi = {\r\n    providerName: PaymentProviderName;\r\n    setupSavedPaymentMethod: (userToken: PaymentProviderUserToken | null) => Promise<{\r\n        newUserToken?: PaymentProviderUserToken;\r\n        setupToken: PaymentProviderSavedPaymentMethodClientSetupToken;\r\n    }>;\r\n    obtainSavedPaymentMethod: (userToken: PaymentProviderUserToken, clientToken: PaymentProviderSavedPaymentMethodClientToken) => Promise<{\r\n        token: PaymentProviderSavedPaymentMethodStorageToken;\r\n        title: string;\r\n        expiration: PaymentMethodExpiration;\r\n    }>;\r\n    chargeSavedPaymentMethod: (userToken: PaymentProviderUserToken, token: PaymentProviderSavedPaymentMethodStorageToken, amount: PaymentAmount) => Promise<void>;\r\n\r\n    getPayments: (userToken: PaymentProviderUserToken) => Promise<PaymentTransaction[]>;\r\n}\r\n\r\n/** Payment Server Dependencies */\r\nexport type PaymentMethodStorageData = {\r\n    /** Key should be auto-generated by storage provider */\r\n    key: PaymentMethodStorageKey;\r\n    title: string;\r\n    expiration: PaymentMethodExpiration;\r\n    providerName: PaymentProviderName;\r\n    paymentMethodStorageToken: PaymentProviderSavedPaymentMethodStorageToken;\r\n};\r\n\r\nexport type PaymentUserTokenData = {\r\n    providerName: PaymentProviderName;\r\n    userToken: PaymentProviderUserToken;\r\n};\r\n\r\nexport type PaymentStorageProviderApi = {\r\n    getUserToken: (params: { providerName: PaymentProviderName }) => Promise<PaymentUserTokenData | null>;\r\n    setUserToken: (params: PaymentUserTokenData) => Promise<void>;\r\n\r\n    savePaymentMethod: (params: Omit<PaymentMethodStorageData, 'key'>) => Promise<void>;\r\n    /** Return all saved payment methods - In the order that they were created */\r\n    getSavedPaymentMethods: () => Promise<PaymentMethodStorageData[]>;\r\n    deleteSavedPaymentMethod: (params: { key: PaymentMethodStorageKey }) => Promise<void>;\r\n}\r\n\r\nexport class PaymentError extends Error {\r\n    constructor(public message: string, public data?: unknown) { super(); }\r\n}\r\n","/* eslint-disable @typescript-eslint/quotes */\r\n/* eslint-disable prefer-template */\r\nimport { ProcessSteps_CreateSavedPaymentMethod } from '../../../common/process-steps';\r\n\r\n// Saved Payments: https://stripe.com/docs/payments/save-and-reuse\r\nexport enum ProcessSteps_CreateSavedPaymentMethod_Stripe {\r\n    _02A_Server_GetOrCreateCustomer = ProcessSteps_CreateSavedPaymentMethod._02_Server_SetupSavedPaymentMethod + 1,\r\n    _02B_Server_CreateSetupIntent = ProcessSteps_CreateSavedPaymentMethod._02_Server_SetupSavedPaymentMethod + 2,\r\n    _03A_Client_CollectPaymentDetails = ProcessSteps_CreateSavedPaymentMethod._03_Client_CollectPaymentDetails + 1,\r\n    _04A_Server_ObtainPaymentMethod = ProcessSteps_CreateSavedPaymentMethod._04_Server_ObtainPaymentMethod + 1,\r\n    _04B_Server_ObtainPaymentMethodDetails = ProcessSteps_CreateSavedPaymentMethod._04_Server_ObtainPaymentMethod + 2,\r\n};\r\n\r\nexport const logProcessStep_CreateSavedPaymentMethod_Stripe = (step: ProcessSteps_CreateSavedPaymentMethod_Stripe, status?: 'BEGIN' | 'END' | 'FAIL', data?: unknown) => {\r\n    // TODO: Implement Universal Logger\r\n\r\n    // eslint-disable-next-line no-console\r\n    console.log(`CreateSavedPaymentMethod_Stripe: ${ProcessSteps_CreateSavedPaymentMethod_Stripe[step]} ${status}`, data);\r\n};\r\n\r\nexport const wrapProcessStep_CreateSavedPaymentMethod_Stripe = async <TResult>(step: ProcessSteps_CreateSavedPaymentMethod_Stripe, execute: () => Promise<TResult>): Promise<TResult> => {\r\n    try {\r\n        logProcessStep_CreateSavedPaymentMethod_Stripe(step, `BEGIN`);\r\n\r\n        const result = await execute();\r\n        logProcessStep_CreateSavedPaymentMethod_Stripe(step, `END`);\r\n        return result;\r\n    } catch (error) {\r\n        logProcessStep_CreateSavedPaymentMethod_Stripe(step, `FAIL`, { error });\r\n        throw error;\r\n    }\r\n};\r\n","import React, { useState } from 'react';\r\nimport { Elements, CardElement, useStripe, useElements } from '@stripe/react-stripe-js';\r\nimport { loadStripe, PaymentMethod, PaymentMethodCreateParams } from '@stripe/stripe-js';\r\nimport { PaymentClientComponents } from '../../../common/types-react';\r\nimport { PaymentError } from '../../../common/types';\r\nimport { stripeDecodeClientSetupToken, stripeEncodeClientToken } from './stripe-client-tokens';\r\nimport { wrapProcessStep_CreateSavedPaymentMethod_Stripe, ProcessSteps_CreateSavedPaymentMethod_Stripe } from '../common/stripe-process-steps';\r\n\r\nexport const createPaymentClientComponents_stripe = (params: { stripePublicKey: string }): PaymentClientComponents => {\r\n\r\n    const stripePromise = loadStripe(params.stripePublicKey);\r\n\r\n    const components: PaymentClientComponents = {\r\n        AppWrapperComponent: ({ children }) => (<Elements stripe={stripePromise}>{children}</Elements>),\r\n        PaymentMethodEntryComponent: ({ style, paymentMethodSetupToken, onPaymentMethodReady }) => {\r\n            const stripe = useStripe();\r\n            const elements = useElements();\r\n\r\n            const [stripeError, setStripeError] = useState(null as null | { message: string, error: unknown });\r\n\r\n            const handleSubmit = async (event: React.FormEvent<HTMLFormElement>) => {\r\n                event.preventDefault();\r\n                if (!stripe || !elements) { return; }\r\n\r\n                try {\r\n                    // Completed SetupIntent -> Used to get PaymentMethod\r\n                    const setupIntent = await wrapProcessStep_CreateSavedPaymentMethod_Stripe(\r\n                        ProcessSteps_CreateSavedPaymentMethod_Stripe._03A_Client_CollectPaymentDetails,\r\n                        async () => {\r\n\r\n                            const setupInfo = stripeDecodeClientSetupToken(paymentMethodSetupToken);\r\n\r\n                            const result = await stripe.confirmCardSetup(setupInfo.clientSecret, {\r\n                                payment_method: {\r\n                                    // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\r\n                                    card: elements.getElement(CardElement)!,\r\n                                    billing_details: setupInfo.customerBillingDetails,\r\n                                },\r\n                            });\r\n\r\n                            if (result.error || !result.setupIntent) {\r\n                                throw new PaymentError(`Stripe Payment Error`, result.error);\r\n                            }\r\n\r\n                            return result.setupIntent;\r\n                        });\r\n                    if (!setupIntent) { return; }\r\n\r\n                    onPaymentMethodReady(stripeEncodeClientToken({ setupIntent }));\r\n                } catch (error) {\r\n                    setStripeError({ message: `Stripe Payment Error`, error });\r\n                }\r\n            };\r\n\r\n            const s = style;\r\n            const inputStyle = {\r\n                base: {\r\n                    color: s.textColor,\r\n                    fontSize: s.fontSize ? `${s.fontSize}px` : ``,\r\n                    fontFamily: s.fontFamily,\r\n                    fontSmoothing: `antialiased`,\r\n                    \"::placeholder\": {\r\n                        color: s.textColor,\r\n                        opacity: 0.8,\r\n                    },\r\n                },\r\n                invalid: {\r\n                    color: s.textColor_invalid,\r\n                    iconColor: s.textColor_invalid,\r\n                },\r\n            };\r\n            const inputContainerStyle = {\r\n                marginBottom: s.elementPadding,\r\n                padding: s.textPadding,\r\n                backgroundColor: s.backgroundColor,\r\n                borderWidth: 1, borderStyle: `solid`, borderColor: s.borderColor, borderRadius: s.borderRadius,\r\n            };\r\n            const buttonStyle = {\r\n                color: s.textColor,\r\n                backgroundColor: s.backgroundColor,\r\n                borderWidth: 1, borderStyle: `solid`, borderColor: s.borderColor, borderRadius: s.borderRadius,\r\n\r\n                fontSize: s.fontSize ? `${s.fontSize}px` : ``,\r\n                fontFamily: s.fontFamily,\r\n                fontSmoothing: `antialiased`,\r\n                fontWeight: `bold`,\r\n                padding: s.textPadding,\r\n                marginBottom: s.elementPadding,\r\n            } as const;\r\n            const buttonJustifyContent = s.buttonAlignment === `left` ? `flex-start`\r\n                : (s.buttonAlignment === `right` ? `flex-end`\r\n                    : `center`);\r\n\r\n            const errorContainerStyle = {\r\n                marginBottom: s.elementPadding,\r\n                padding: s.textPadding,\r\n                backgroundColor: s.backgroundColor,\r\n                borderWidth: 1, borderStyle: `solid`, borderColor: s.borderColor, borderRadius: s.borderRadius,\r\n            };\r\n            const errorMessageStyle = {\r\n                color: s.textColor_invalid,\r\n\r\n                fontSize: s.fontSize ? `${s.fontSize}px` : ``,\r\n                fontFamily: s.fontFamily,\r\n                fontSmoothing: `antialiased`,\r\n                fontWeight: `bold`,\r\n                padding: s.textPadding,\r\n                marginBottom: s.elementPadding,\r\n            } as const;\r\n\r\n            return (\r\n                <form onSubmit={handleSubmit}>\r\n                    <div style={inputContainerStyle}>\r\n                        <CardElement options={{ style: inputStyle }} />\r\n                    </div>\r\n                    {stripeError && (\r\n                        <>\r\n                            <div style={errorContainerStyle}>\r\n                                <span style={errorMessageStyle}>{stripeError.message}</span>\r\n                            </div>\r\n                        </>\r\n                    )}\r\n\r\n                    {!stripeError && (\r\n                        <div style={{ display: `flex`, flexDirection: `row`, justifyContent: buttonJustifyContent }}>\r\n                            <button type='submit' disabled={!stripe || !elements} style={buttonStyle}>{s.buttonText ?? `Subscribe`}</button>\r\n                        </div>\r\n                    )}\r\n                </form>\r\n            );\r\n        },\r\n    };\r\n\r\n    return components;\r\n};\r\n","export type DoodleDrawingStorageService = {\r\n    saveDrawing: (prompt: string, drawing: DoodleDrawing) => Promise<void>;\r\n    saveBestDrawingSelection: (doodle: DoodleData) => Promise<void>;\r\n    getDrawings: (prompt: string, options?: { includeOtherPrompts?: boolean, maxCount?: number }) => Promise<{ doodles: DoodleData[] }>;\r\n    getAllDrawings: () => Promise<{ doodles: DoodleDataWithScore[] }>;\r\n};\r\n\r\n\r\nexport type DoodleSummaryDataJson = {\r\n    doodles: DoodleData_EncodedWithScore[];\r\n};\r\nexport type DoodleData_EncodedWithScore = DoodleData_Encoded & {\r\n    s: number;\r\n};\r\n\r\nexport type DoodleUserDrawingDataJson = {\r\n    doodles: DoodleData_Encoded[];\r\n};\r\n\r\nexport type DoodleUserVotesDataJson = {\r\n    doodleVotes: DoodleScoreVote[];\r\n};\r\n\r\nexport type DoodleScoreVote = {\r\n    // Doodle Key\r\n    k: string;\r\n    // Doodle Timestamp\r\n    t: number;\r\n};\r\n\r\nexport type DoodleScore = {\r\n    doodleKey: string;\r\n    score: number;\r\n};\r\n\r\nexport type DoodleDataWithScore = {\r\n    key: string;\r\n    drawing: DoodleDrawing;\r\n    prompt: string;\r\n    timestamp: number;\r\n    score: number;\r\n};\r\n\r\nexport type DoodleData = {\r\n    key: string;\r\n    drawing: DoodleDrawing;\r\n    prompt: string;\r\n    timestamp: number;\r\n};\r\nexport type DoodleData_Encoded = {\r\n    // Doodle Key\r\n    k: string;\r\n    // Doodle Drawing\r\n    d: DoodleDrawingEncoded;\r\n    // Prompt\r\n    p: string;\r\n    // Doodle Timestamp\r\n    t: number;\r\n};\r\n\r\nexport type DoodleDrawing = {\r\n    width: number;\r\n    height: number;\r\n    segments: DoodleSegment[];\r\n};\r\nexport type DoodleSegment = {\r\n    points: { x: number, y: number }[];\r\n};\r\n\r\n// const sampleDrawing: DoodleDrawing = {\r\n//     width: 128,\r\n//     height: 128,\r\n//     segments: [{\r\n//         points: [\r\n//             { x: 10, y: 10 },\r\n//             { x: 50, y: 10 },\r\n//             { x: 50, y: 50 },\r\n//             { x: 10, y: 50 },\r\n//             { x: 10, y: 10 },\r\n//         ],\r\n//     }],\r\n// };\r\n\r\nexport const defaultDoodleDrawing = (): DoodleDrawing => ({\r\n    width: 104,\r\n    height: 104,\r\n    segments: [],\r\n});\r\n\r\nexport type DoodleDrawingEncoded = {\r\n    doodleText: string;\r\n};\r\ntype DoodleDrawingEncodedObj = {\r\n    w: number;\r\n    h: number;\r\n    s: {\r\n        x: number;\r\n        y: number;\r\n        p: string;\r\n    }[];\r\n};\r\nconst encodeDoodleSegmentPoints = (points: { x: number, y: number }[]): string => {\r\n    if (points.length <= 0) { return ``; }\r\n    let last = points[0];\r\n    let t = ``;\r\n\r\n    points.slice(1).forEach(p => {\r\n        t += `${p.x - last.x},${p.y - last.y};`;\r\n        last = p;\r\n    });\r\n\r\n    return t;\r\n};\r\nconst decodeDoodleSegmentPoints = (x: number, y: number, pointsString: string): { x: number, y: number }[] => {\r\n    if (!pointsString) { return [{ x, y }]; }\r\n    let last = { x, y };\r\n    const pointRelPos = pointsString.split(`;`).filter(p => p);\r\n    const points = pointRelPos.map(p => {\r\n        const parts = p.split(`,`);\r\n        const point = {\r\n            x: last.x + Number.parseInt(parts[0], 10),\r\n            y: last.y + Number.parseInt(parts[1], 10),\r\n        };\r\n        last = point;\r\n        return point;\r\n    });\r\n\r\n    return [...points];\r\n};\r\n\r\nexport const encodeDoodleDrawing = (doodle: DoodleDrawing): DoodleDrawingEncoded => {\r\n    const o: DoodleDrawingEncodedObj = {\r\n        w: doodle.width,\r\n        h: doodle.height,\r\n        s: doodle.segments.map(x => ({\r\n            x: x.points[0].x,\r\n            y: x.points[0].y,\r\n            p: encodeDoodleSegmentPoints(x.points),\r\n        })),\r\n    };\r\n    return { doodleText: JSON.stringify(o) };\r\n};\r\nexport const decodeDoodleDrawing = (doodle: DoodleDrawingEncoded): DoodleDrawing => {\r\n    const o: DoodleDrawingEncodedObj = JSON.parse(doodle.doodleText) as DoodleDrawingEncodedObj;\r\n    return {\r\n        width: o.w,\r\n        height: o.h,\r\n        segments: o.s.map(p => {\r\n            return {\r\n                points: [{ x: p.x, y: p.y }, ...decodeDoodleSegmentPoints(p.x, p.y, p.p)],\r\n            };\r\n        }),\r\n    };\r\n};\r\n\r\n\r\n// const doodleSegmentToSvgPath_bezier = (segment: DoodleSegment) => {\r\n//     const delta1 = {\r\n//         x: segment.points[2].x - segment.points[1].x,\r\n//         y: segment.points[2].y - segment.points[1].y,\r\n//     };\r\n//     const controlPoint = {\r\n//         x: segment.points[1].x - delta1.x * 0.5,\r\n//         y: segment.points[1].y - delta1.y * 0.5,\r\n//     };\r\n//     return `M${segment.points[0].x} ${segment.points[0].y} Q${controlPoint.x} ${controlPoint.y} ${segment.points[1].x} ${segment.points[1].y}T${segment.points.slice(2, -1).map(p => `${p.x} ${p.y}`).join(` `)}`;\r\n// };\r\n\r\n\r\nexport const doodleSegmentToSvgPath_line = (segment: DoodleSegment) => {\r\n    if (segment.points.length <= 0) { return ``; }\r\n    if (segment.points.length === 1) { return `M${segment.points[0].x} ${segment.points[0].y} L${segment.points[0].x} ${segment.points[0].y}`; }\r\n\r\n    let last = segment.points[0];\r\n    return `M${segment.points[0].x} ${segment.points[0].y} l${segment.points.slice(1).map(p => {\r\n        const t = `${p.x - last.x} ${p.y - last.y}`;\r\n        last = p;\r\n        return t;\r\n    }).join(` `)}`;\r\n};\r\n\r\nexport const doodleToSvg = (drawing: DoodleDrawing) => {\r\n    // preserveAspectRatio='none' stroke='#000000' fill='transparent' xmlns='http://www.w3.org/2000/svg'\r\n    return `\r\n<svg viewBox='0 0 ${drawing.width} ${drawing.height}' stroke='#000000' fill='transparent'>\r\n    ${drawing.segments.map((x, i) => (\r\n        `<path d='${doodleSegmentToSvgPath_line(x)}' />`\r\n    )).join(``)}\r\n</svg>\r\n    `.trim();\r\n};\r\n","import { PaymentMethodCreateParams, SetupIntent } from '@stripe/stripe-js';\r\nimport { PaymentProviderSavedPaymentMethodClientSetupToken, PaymentProviderSavedPaymentMethodClientToken } from '../../../common/types';\r\n\r\nexport type StripeCustomerBillingDetails = PaymentMethodCreateParams.BillingDetails;\r\n\r\nexport type StripePaymentClientSetupToken = {\r\n    clientSecret: string;\r\n    customerBillingDetails: StripeCustomerBillingDetails;\r\n};\r\n\r\nexport const stripeEncodeClientSetupToken = (params: StripePaymentClientSetupToken): PaymentProviderSavedPaymentMethodClientSetupToken => {\r\n    return params as unknown as PaymentProviderSavedPaymentMethodClientSetupToken;\r\n};\r\nexport const stripeDecodeClientSetupToken = (params: PaymentProviderSavedPaymentMethodClientSetupToken): StripePaymentClientSetupToken => {\r\n    return params as unknown as StripePaymentClientSetupToken;\r\n};\r\n\r\nexport type StripePaymentClientToken = {\r\n    setupIntent: SetupIntent;\r\n};\r\n\r\nexport const stripeEncodeClientToken = (params: StripePaymentClientToken): PaymentProviderSavedPaymentMethodClientToken => {\r\n    return params as unknown as PaymentProviderSavedPaymentMethodClientToken;\r\n};\r\nexport const stripeDecodeClientToken = (params: PaymentProviderSavedPaymentMethodClientToken): StripePaymentClientToken => {\r\n    return params as unknown as StripePaymentClientToken;\r\n};\r\n","export const doodleStoragePaths = {\r\n    doodleSummary: `doodle/summary`,\r\n    doodleDrawingsPrefix: `doodle/drawings`,\r\n    doodlePartyDrawingsPrefix: `doodle/party/drawings`,\r\n    doodleVotesPrefix: `doodle/votes`,\r\n} as const;\r\n","export var IconsManifest = [{\n  \"id\": \"fa\",\n  \"name\": \"Font Awesome\",\n  \"projectUrl\": \"https://fontawesome.com/\",\n  \"license\": \"CC BY 4.0 License\",\n  \"licenseUrl\": \"https://creativecommons.org/licenses/by/4.0/\"\n}, {\n  \"id\": \"io\",\n  \"name\": \"Ionicons\",\n  \"projectUrl\": \"https://ionicons.com/\",\n  \"license\": \"MIT\",\n  \"licenseUrl\": \"https://github.com/ionic-team/ionicons/blob/master/LICENSE\"\n}, {\n  \"id\": \"md\",\n  \"name\": \"Material Design icons\",\n  \"projectUrl\": \"http://google.github.io/material-design-icons/\",\n  \"license\": \"Apache License Version 2.0\",\n  \"licenseUrl\": \"https://github.com/google/material-design-icons/blob/master/LICENSE\"\n}, {\n  \"id\": \"ti\",\n  \"name\": \"Typicons\",\n  \"projectUrl\": \"http://s-ings.com/typicons/\",\n  \"license\": \"CC BY-SA 3.0\",\n  \"licenseUrl\": \"https://creativecommons.org/licenses/by-sa/3.0/\"\n}, {\n  \"id\": \"go\",\n  \"name\": \"Github Octicons icons\",\n  \"projectUrl\": \"https://octicons.github.com/\",\n  \"license\": \"MIT\",\n  \"licenseUrl\": \"https://github.com/primer/octicons/blob/master/LICENSE\"\n}, {\n  \"id\": \"fi\",\n  \"name\": \"Feather\",\n  \"projectUrl\": \"https://feathericons.com/\",\n  \"license\": \"MIT\",\n  \"licenseUrl\": \"https://github.com/feathericons/feather/blob/master/LICENSE\"\n}, {\n  \"id\": \"gi\",\n  \"name\": \"Game Icons\",\n  \"projectUrl\": \"https://game-icons.net/\",\n  \"license\": \"CC BY 3.0\",\n  \"licenseUrl\": \"https://creativecommons.org/licenses/by/3.0/\"\n}, {\n  \"id\": \"wi\",\n  \"name\": \"Weather Icons\",\n  \"projectUrl\": \"https://erikflowers.github.io/weather-icons/\",\n  \"license\": \"SIL OFL 1.1\",\n  \"licenseUrl\": \"http://scripts.sil.org/OFL\"\n}, {\n  \"id\": \"di\",\n  \"name\": \"Devicons\",\n  \"projectUrl\": \"https://vorillaz.github.io/devicons/\",\n  \"license\": \"MIT\",\n  \"licenseUrl\": \"https://opensource.org/licenses/MIT\"\n}, {\n  \"id\": \"ai\",\n  \"name\": \"Ant Design Icons\",\n  \"projectUrl\": \"https://github.com/ant-design/ant-design-icons\",\n  \"license\": \"MIT\",\n  \"licenseUrl\": \"https://opensource.org/licenses/MIT\"\n}, {\n  \"id\": \"bs\",\n  \"name\": \"Bootstrap Icons\",\n  \"projectUrl\": \"https://github.com/twbs/icons\",\n  \"license\": \"MIT\",\n  \"licenseUrl\": \"https://opensource.org/licenses/MIT\"\n}, {\n  \"id\": \"ri\",\n  \"name\": \"Remix Icon\",\n  \"projectUrl\": \"https://github.com/Remix-Design/RemixIcon\",\n  \"license\": \"Apache License Version 2.0\",\n  \"licenseUrl\": \"http://www.apache.org/licenses/\"\n}, {\n  \"id\": \"fc\",\n  \"name\": \"Flat Color Icons\",\n  \"projectUrl\": \"https://github.com/icons8/flat-color-icons\",\n  \"license\": \"MIT\",\n  \"licenseUrl\": \"https://opensource.org/licenses/MIT\"\n}, {\n  \"id\": \"gr\",\n  \"name\": \"Grommet-Icons\",\n  \"projectUrl\": \"https://github.com/grommet/grommet-icons\",\n  \"license\": \"Apache License Version 2.0\",\n  \"licenseUrl\": \"http://www.apache.org/licenses/\"\n}];","import * as React from 'react';\nexport var DefaultContext = {\n  color: undefined,\n  size: undefined,\n  className: undefined,\n  style: undefined,\n  attr: undefined\n};\nexport var IconContext = React.createContext && React.createContext(DefaultContext);","var __assign = this && this.__assign || function () {\n  __assign = Object.assign || function (t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n      s = arguments[i];\n\n      for (var p in s) {\n        if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n      }\n    }\n\n    return t;\n  };\n\n  return __assign.apply(this, arguments);\n};\n\nvar __rest = this && this.__rest || function (s, e) {\n  var t = {};\n\n  for (var p in s) {\n    if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0) t[p] = s[p];\n  }\n\n  if (s != null && typeof Object.getOwnPropertySymbols === \"function\") for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\n    if (e.indexOf(p[i]) < 0) t[p[i]] = s[p[i]];\n  }\n  return t;\n};\n\nimport * as React from 'react';\nimport { IconContext, DefaultContext } from './iconContext';\n\nfunction Tree2Element(tree) {\n  return tree && tree.map(function (node, i) {\n    return React.createElement(node.tag, __assign({\n      key: i\n    }, node.attr), Tree2Element(node.child));\n  });\n}\n\nexport function GenIcon(data) {\n  return function (props) {\n    return React.createElement(IconBase, __assign({\n      attr: __assign({}, data.attr)\n    }, props), Tree2Element(data.child));\n  };\n}\nexport function IconBase(props) {\n  var elem = function elem(conf) {\n    var computedSize = props.size || conf.size || \"1em\";\n    var className;\n    if (conf.className) className = conf.className;\n    if (props.className) className = (className ? className + ' ' : '') + props.className;\n\n    var attr = props.attr,\n        title = props.title,\n        svgProps = __rest(props, [\"attr\", \"title\"]);\n\n    return React.createElement(\"svg\", __assign({\n      stroke: \"currentColor\",\n      fill: \"currentColor\",\n      strokeWidth: \"0\"\n    }, conf.attr, attr, svgProps, {\n      className: className,\n      style: __assign({\n        color: props.color || conf.color\n      }, conf.style, props.style),\n      height: computedSize,\n      width: computedSize,\n      xmlns: \"http://www.w3.org/2000/svg\"\n    }), title && React.createElement(\"title\", null, title), props.children);\n  };\n\n  return IconContext !== undefined ? React.createElement(IconContext.Consumer, null, function (conf) {\n    return elem(conf);\n  }) : elem(DefaultContext);\n}","import { webRequest } from 'utils/web-request';\r\nimport { UploadApi, UploadApiEndpointName, UploadApiRequestData } from './types';\r\n\r\nexport const createUploadApiWebClient = (config: { uploadApiUrl: string }): UploadApi => {\r\n\r\n    async function apiRequest<T>(endpoint: UploadApiEndpointName, data: unknown): Promise<T> {\r\n        const url = `${config.uploadApiUrl}/${endpoint}`;\r\n\r\n        const requestData: UploadApiRequestData = {\r\n            endpoint,\r\n            data,\r\n        };\r\n\r\n        const resultObj = (await webRequest(url, requestData)) as { data: T };\r\n\r\n        return resultObj.data;\r\n    };\r\n\r\n    const api: UploadApi = {\r\n        createUploadUrl: (data) => apiRequest(`createUploadUrl`, data),\r\n        renewUploadUrl: (data) => apiRequest(`renewUploadUrl`, data),\r\n    };\r\n\r\n    return api;\r\n};\r\n","import { Platform } from 'react-native-lite';\r\n\r\nexport const createSpeechService = (): {\r\n    speak: (text: string, languange?: string) => void;\r\n    getVoicesForLanguange: (languange: string) => { voice: SpeechSynthesisVoice, isSelected: boolean }[];\r\n    setVoiceForLanguange: (languange: string, voice: SpeechSynthesisVoice) => void;\r\n} => {\r\n    if (Platform.OS !== `web`) {\r\n        return {\r\n            speak: () => { },\r\n            getVoicesForLanguange: () => [],\r\n            setVoiceForLanguange: () => { },\r\n        };\r\n    }\r\n\r\n    const synth = window.speechSynthesis;\r\n\r\n    const selectedVoices = {} as { [languange: string]: SpeechSynthesisVoice };\r\n\r\n    const speak = (text: string, languange?: string) => {\r\n        const voiceLang = selectedVoices[languange ?? `en`] ?? null;\r\n\r\n        try {\r\n            const u = new SpeechSynthesisUtterance(text);\r\n            u.voice = voiceLang;\r\n            synth.speak(u);\r\n        } catch {\r\n            // Ignore\r\n        }\r\n    };\r\n\r\n    return {\r\n        speak,\r\n        getVoicesForLanguange: (languange) => {\r\n            const voices = synth.getVoices();\r\n            console.log(`voices`, { voices });\r\n            const v = voices.filter(x => x.lang.startsWith(languange)).map(x => ({\r\n                voice: x,\r\n                isSelected: selectedVoices[languange] === x,\r\n            }));\r\n            return v;\r\n        },\r\n        setVoiceForLanguange: (language, voice) => {\r\n            selectedVoices[language] = voice;\r\n        },\r\n    };\r\n};\r\n\r\nexport type SpeechService = ReturnType<typeof createSpeechService>;\r\n","import React, { } from 'react';\r\nimport { Text, TouchableOpacity } from 'react-native-lite';\r\nimport { theme, ThemeTextStyle, ThemeViewStyle, extractViewStyle, extractTextStyle } from 'themes/theme';\r\n\r\nexport const Button = (props: { style?: ThemeTextStyle & ThemeViewStyle, styleAlt?: boolean, children: string, onPress: () => void }) => {\r\n    const s = props.style ?? (props.styleAlt ? theme.button_formAction_alt : theme.button_formAction);\r\n    return (\r\n        <TouchableOpacity style={extractViewStyle(s)} onPress={props.onPress}>\r\n            <Text style={extractTextStyle(s)}>{props.children}</Text>\r\n        </TouchableOpacity>\r\n    );\r\n};\r\n","import React, { } from 'react';\r\nimport { View, Text } from 'react-native-lite';\r\nimport { theme } from 'themes/theme';\r\nimport { Loading, LoadingInline } from './loading';\r\nimport { ErrorBox, ErrorMessage } from './error-box';\r\nimport { Input_Text, Input_Username, Input_Password, Input_Phone, Input_Email, Input_Currency } from './inputs';\r\nimport { Button } from './button';\r\n\r\ntype PropsOf<T> = T extends (props: infer P) => JSX.Element ? P : never;\r\n\r\nexport const C = {\r\n    Loading,\r\n    LoadingInline,\r\n    ErrorBox,\r\n    ErrorMessage,\r\n    View_Panel: (props: PropsOf<typeof View>) => (<View style={theme.view_panel} {...props} />),\r\n    View_Form: (props: PropsOf<typeof View>) => (<View style={theme.view_form} {...props} />),\r\n    View_FormFields: (props: PropsOf<typeof View>) => (<View style={theme.view_formFields} {...props} />),\r\n    View_FieldRow: (props: PropsOf<typeof View>) => (<View style={theme.view_fieldRow} {...props} />),\r\n    View_FormActionRow: (props: PropsOf<typeof View>) => (<View style={theme.view_formActionRow} {...props} />),\r\n    Text_FormTitle: (props: PropsOf<typeof Text>) => (<Text style={theme.text_formTitle} {...props} />),\r\n    Text_FieldLabel: (props: PropsOf<typeof Text>) => (<Text style={theme.text_fieldLabel} numberOfLines={1} {...props} />),\r\n    Button_FieldInline: (props: PropsOf<typeof Button>) => (<Button style={props.styleAlt ? theme.button_fieldInline_alt : theme.button_fieldInline} {...props} />),\r\n    Button_FormAction: (props: PropsOf<typeof Button>) => (<Button style={props.styleAlt ? theme.button_formAction_alt : theme.button_formAction} {...props} />),\r\n    Input_Text,\r\n    Input_Username,\r\n    Input_Password,\r\n    Input_Phone,\r\n    Input_Email,\r\n    Input_Currency,\r\n};\r\n","import React, { useState } from 'react';\r\nimport { TextInput, View, TouchableOpacity } from 'react-native-lite';\r\nimport { theme, ThemeTextStyle } from 'themes/theme';\r\nimport { PhoneNumber, toStandardPhoneNumber, formatPhoneNumber_UsaCanada } from 'utils/phone-number';\r\nimport { EmailAddress, toEmailAddress } from 'utils/email-address';\r\nimport { Icon } from './icon';\r\nimport { IconKind } from './icon-kind';\r\n\r\nexport const Input_Text = (props: { style?: ThemeTextStyle, value: string, onChange: (value: string) => void, onSubmit?: () => void, placeholder?: string, editable?: boolean, onFocus?: () => void, onBlur?: () => void }) => {\r\n    return (\r\n        <TextInput style={props.style ?? theme.input_fieldEntry}\r\n            keyboardType='default'\r\n            autoCompleteType='off'\r\n            placeholder={props.placeholder}\r\n            editable={props.editable}\r\n            value={`${props.value}`}\r\n            onChange={(x) => props.onChange(x)}\r\n            onSubmitEditing={props.onSubmit}\r\n            onFocus={props.onFocus}\r\n            onBlur={props.onBlur}\r\n        />\r\n    );\r\n};\r\n\r\nexport const Input_Username = (props: { style?: ThemeTextStyle, value: string, onChange: (value: string) => void, onSubmit?: () => void, placeholder?: string, editable?: boolean }) => {\r\n    return (\r\n        <TextInput style={props.style ?? theme.input_fieldEntry}\r\n            keyboardType='default'\r\n            autoCompleteType='username'\r\n            placeholder={props.placeholder}\r\n            editable={props.editable}\r\n            value={`${props.value}`}\r\n            onChange={(x) => props.onChange(x)}\r\n            onSubmitEditing={props.onSubmit}\r\n        />\r\n    );\r\n};\r\n\r\nexport const Input_Password = (props: { style?: ThemeTextStyle, value: string, onChange: (value: string) => void, onSubmit?: () => void, onBlur?: () => void, placeholder?: string, editable?: boolean }) => {\r\n\r\n    const [showPassword, setShowPassword] = useState(false);\r\n\r\n    const inputStyle = props.style ?? theme.input_fieldEntry;\r\n    const { marginRight } = inputStyle;\r\n    return (\r\n        <View style={{ flexDirection: `row`, alignItems: `center` }}>\r\n            <TextInput style={{ ...inputStyle, marginRight: 0 }}\r\n                keyboardType='default'\r\n                autoCompleteType='password'\r\n                secureTextEntry={!showPassword}\r\n                placeholder={props.placeholder}\r\n                editable={props.editable}\r\n                value={`${props.value}`}\r\n                onChange={(x) => props.onChange(x)}\r\n                onSubmitEditing={props.onSubmit}\r\n                onBlur={props.onBlur}\r\n            />\r\n            <TouchableOpacity onPress={() => setShowPassword(s => !s)} style={{ outlineColor: theme.icon.outlineColor }}>\r\n                <View style={{ paddingLeft: 4, paddingRight: 4, marginRight }}>\r\n                    <Icon style={theme.icon} kind={showPassword ? IconKind.eye : IconKind.eyeSlash} />\r\n                </View>\r\n            </TouchableOpacity>\r\n        </View>\r\n    );\r\n};\r\n\r\nexport type Currency = number;// & { __type: 'currency' };\r\nexport const Input_Currency = (props: { style?: ThemeTextStyle, value: Currency, onChange: (value: Currency) => void, onSubmit?: () => void, placeholder?: string, editable?: boolean }) => {\r\n    return (\r\n        <TextInput style={props.style ?? theme.input_fieldEntry}\r\n            keyboardType='numeric'\r\n            autoCompleteType='off'\r\n            placeholder={props.placeholder}\r\n            editable={props.editable}\r\n            value={`${props.value}`}\r\n            onChange={(x) => props.onChange(Number.parseFloat(x) || 0)}\r\n            onSubmitEditing={props.onSubmit}\r\n        />\r\n    );\r\n};\r\n\r\nexport const Input_Phone = (props: { style?: ThemeTextStyle, value: PhoneNumber, onChange: (value: PhoneNumber) => void, onSubmit?: () => void, placeholder?: string, editable?: boolean }) => {\r\n\r\n    const [valueActual, setValueActual] = useState(formatPhoneNumber_UsaCanada(props.value));\r\n    const changeValueActual = (v: string) => {\r\n        setValueActual(formatPhoneNumber_UsaCanada(v));\r\n        props.onChange(toStandardPhoneNumber(v));\r\n    };\r\n    return (\r\n        <TextInput style={props.style ?? theme.input_fieldEntry}\r\n            keyboardType='phone-pad'\r\n            autoCompleteType='tel'\r\n            placeholder={props.placeholder}\r\n            editable={props.editable}\r\n            value={valueActual}\r\n            onChange={changeValueActual}\r\n            onSubmitEditing={props.onSubmit}\r\n        />\r\n    );\r\n};\r\n\r\n\r\nexport const Input_Email = (props: { style?: ThemeTextStyle, value: EmailAddress, onChange: (value: EmailAddress) => void, onSubmit?: () => void, placeholder?: string, editable?: boolean }) => {\r\n\r\n    const [valueActual, setValueActual] = useState(toEmailAddress(props.value));\r\n    const changeValueActual = (v: string) => {\r\n        setValueActual(toEmailAddress(v));\r\n        props.onChange(toEmailAddress(v));\r\n    };\r\n    return (\r\n        <TextInput style={props.style ?? theme.input_fieldEntry}\r\n            keyboardType='email-address'\r\n            autoCompleteType='email'\r\n            placeholder={props.placeholder}\r\n            editable={props.editable}\r\n            value={valueActual}\r\n            onChange={changeValueActual}\r\n            onSubmitEditing={props.onSubmit}\r\n        />\r\n    );\r\n};\r\n","import dayjs from 'dayjs';\r\nimport localizedFormat from 'dayjs/plugin/localizedFormat';\r\nimport relativeTime from 'dayjs/plugin/relativeTime';\r\n\r\ndayjs.extend(localizedFormat);\r\ndayjs.extend(relativeTime);\r\n\r\nexport const formatDate = (date: Date | number | string) => {\r\n    return dayjs(date).format(`L`);\r\n};\r\n\r\nexport const formatDate_FromNow = (date: Date | number | string) => {\r\n    return dayjs(date).fromNow();\r\n};\r\n","export async function delay(timeout: number): Promise<void> {\r\n    return await new Promise((resolve) => {\r\n        setTimeout(resolve, timeout);\r\n    });\r\n}\r\n","var g;\n\n// This works in non-strict mode\ng = (function() {\n\treturn this;\n})();\n\ntry {\n\t// This works if eval is allowed (see CSP)\n\tg = g || new Function(\"return this\")();\n} catch (e) {\n\t// This works if the window reference is available\n\tif (typeof window === \"object\") g = window;\n}\n\n// g can still be undefined, but nothing to do about it...\n// We return undefined, instead of nothing here, so it's\n// easier to handle this case. if(!global) { ...}\n\nmodule.exports = g;\n","import React from 'react';\r\nimport { ThemeIconStyle, theme } from 'themes/theme';\r\nimport { MdMenu, MdArrowBack, MdCheckBoxOutlineBlank, MdErrorOutline, MdContentCopy, MdDashboard } from 'react-icons/md';\r\nimport { FiChevronRight, FiChevronDown } from 'react-icons/fi';\r\nimport { FaRedo, FaPlus, FaMinus, FaEye, FaEyeSlash, FaCheck, FaCheckSquare, FaSquare } from 'react-icons/fa';\r\nimport { View } from 'react-native-lite';\r\nimport { IconKind } from './icon-kind';\r\n\r\nfunction getIcon(kind: IconKind) {\r\n    switch (kind) {\r\n        case IconKind.menu: return { name: `menu`, component: MdMenu };\r\n        case IconKind.back: return { name: `arrow-back`, component: MdArrowBack };\r\n        case IconKind.error: return { name: `error-outline`, component: MdErrorOutline };\r\n        case IconKind.expanded: return { name: `chevron-down`, component: FiChevronDown };\r\n        case IconKind.collapsed: return { name: `chevron-right`, component: FiChevronRight };\r\n        case IconKind.copy: return { name: `content-copy`, component: MdContentCopy };\r\n        case IconKind.retry: return { name: `reload`, component: FaRedo };\r\n        case IconKind.dashboard: return { name: `dashboard`, component: MdDashboard };\r\n        case IconKind.add: return { name: `plus`, component: FaPlus };\r\n        case IconKind.remove: return { name: `minus`, component: FaMinus };\r\n        case IconKind.eye: return { name: `eye`, component: FaEye };\r\n        case IconKind.eyeSlash: return { name: `eye-slash`, component: FaEyeSlash };\r\n        case IconKind.checkChecked: return { name: `checked`, component: FaCheckSquare };\r\n        case IconKind.checkUnchecked: return { name: `unchecked`, component: FaSquare };\r\n\r\n        // case IconKind.Account: return { name: `account-circle`, component: MaterialIcons };\r\n        // case IconKind.Message: return { name: `message`, component: MaterialIcons };\r\n        // case IconKind.Subscription: return { name: `ticket-account`, component: MaterialCommunityIcons };\r\n        // case IconKind.Campaigns: return { name: `calendar-multiselect`, component: MaterialCommunityIcons };\r\n        // case IconKind.Contacts: return { name: `contacts`, component: MaterialIcons };\r\n        // case IconKind.Keywords: return { name: `key-variant`, component: MaterialCommunityIcons };\r\n        // case IconKind.Resources: return { name: `collections-bookmark`, component: MaterialIcons };\r\n        // case IconKind.Admin: return { name: `settings`, component: MaterialIcons };\r\n        // case IconKind.Solutions: return { name: '', component: FontAwesome };\r\n        // case IconKind.Texting: return { name: '', component: FontAwesome };\r\n        // case IconKind.Pricing: return { name: '', component: FontAwesome };\r\n        // case IconKind.Download: return { name: '', component: FontAwesome };\r\n\r\n        default:\r\n            return { name: `unknown`, component: MdCheckBoxOutlineBlank };\r\n    }\r\n}\r\n\r\nexport const Icon = (props: { kind: IconKind, style?: ThemeIconStyle }) => {\r\n    const icon = getIcon(props.kind);\r\n    const IconComponent = icon.component;\r\n    const size = props.style?.size ?? theme.icon.size ?? theme.sizes.fontSize;\r\n    return (\r\n        <View style={{ width: size, height: size }}>\r\n            <IconComponent name={icon.name} size={size} color={props.style?.color ?? theme.icon.color} />\r\n        </View>\r\n    );\r\n};\r\n","/* eslint-disable @typescript-eslint/no-unused-vars */\r\nexport type ThemeViewStyle = {\r\n    display?: 'flex';\r\n    flexDirection?: 'row' | 'column' | 'row-reverse' | 'column-reverse';\r\n    flexWrap?: 'wrap' | 'nowrap';\r\n    flex?: number;\r\n    justifyContent?: 'flex-start' | 'center' | 'flex-end' | 'space-around' | 'space-between';\r\n    alignItems?: 'flex-start' | 'center' | 'flex-end';\r\n    alignSelf?: 'center' | 'stretch' | 'flex-start' | 'flex-end';\r\n    overflow?: 'visible' | 'hidden';\r\n\r\n    background?: string;\r\n\r\n    margin?: number;\r\n    marginLeft?: number;\r\n    marginRight?: number;\r\n    marginTop?: number;\r\n    marginBottom?: number;\r\n    padding?: number;\r\n    paddingRight?: number;\r\n    paddingLeft?: number;\r\n    paddingTop?: number;\r\n    paddingBottom?: number;\r\n\r\n    width?: number;\r\n    minWidth?: number;\r\n    maxWidth?: number;\r\n    height?: number;\r\n\r\n    borderWidth?: number;\r\n    borderLeftWidth?: number;\r\n    borderRightWidth?: number;\r\n    borderTopWidth?: number;\r\n    borderBottomWidth?: number;\r\n\r\n    borderColor?: string;\r\n    borderLeftColor?: string;\r\n    borderRightColor?: string;\r\n    borderTopColor?: string;\r\n    borderBottomColor?: string;\r\n\r\n\r\n    borderRadius?: number;\r\n    borderStyle?: 'solid';\r\n    outlineColor?: string;\r\n    outline?: `none`;\r\n\r\n    transform?: string;\r\n\r\n    opacity?: number;\r\n\r\n    position?: 'absolute' | 'relative' | 'fixed';\r\n    top?: number;\r\n    bottom?: number;\r\n    left?: number;\r\n    right?: number;\r\n    zIndex?: number;\r\n};\r\nexport type ThemeTextStyle = {\r\n    margin?: number;\r\n    marginLeft?: number;\r\n    marginRight?: number;\r\n    marginTop?: number;\r\n    marginBottom?: number;\r\n    padding?: number;\r\n    paddingRight?: number;\r\n    paddingLeft?: number;\r\n    paddingTop?: number;\r\n    paddingBottom?: number;\r\n\r\n    color?: string;\r\n\r\n    fontFamily?: string;\r\n    fontSize?: number;\r\n    fontWeight?: 'normal' | 'bold' | 'lighter';\r\n    lineHeight?: string;\r\n    whiteSpace?: 'normal' | 'nowrap' | 'pre' | 'pre-wrap';\r\n    minWidth?: number;\r\n\r\n    outlineColor?: string;\r\n    userSelect?: `none`;\r\n};\r\nexport type ThemeIconStyle = {\r\n    color?: string;\r\n    size?: number;\r\n    outlineColor?: string;\r\n};\r\n\r\nexport const extractViewStyle = (style: ThemeViewStyle & ThemeTextStyle): ThemeViewStyle => {\r\n    return {\r\n        display: style.display,\r\n        flexDirection: style.flexDirection,\r\n        flex: style.flex,\r\n        justifyContent: style.justifyContent,\r\n        alignItems: style.alignItems,\r\n        overflow: style.overflow,\r\n\r\n        background: style.background,\r\n\r\n        margin: style.margin,\r\n        marginLeft: style.margin ?? style.marginLeft,\r\n        marginRight: style.margin ?? style.marginRight,\r\n        marginTop: style.margin ?? style.marginTop,\r\n        marginBottom: style.margin ?? style.marginBottom,\r\n        padding: style.padding,\r\n        paddingRight: style.padding ?? style.paddingRight,\r\n        paddingLeft: style.padding ?? style.paddingLeft,\r\n        paddingTop: style.padding ?? style.paddingTop,\r\n        paddingBottom: style.padding ?? style.paddingBottom,\r\n\r\n        width: style.width,\r\n        minWidth: style.minWidth,\r\n        maxWidth: style.maxWidth,\r\n        height: style.height,\r\n\r\n        borderWidth: style.borderWidth,\r\n        borderRadius: style.borderRadius,\r\n        borderColor: style.borderColor,\r\n        borderStyle: style.borderStyle,\r\n\r\n        outlineColor: style.outlineColor,\r\n    };\r\n};\r\nexport const extractTextStyle = (style: ThemeViewStyle & ThemeTextStyle): ThemeTextStyle => {\r\n    return {\r\n        // padding: style.padding,\r\n        color: style.color,\r\n\r\n        fontFamily: style.fontFamily,\r\n        fontSize: style.fontSize,\r\n        fontWeight: style.fontWeight,\r\n        lineHeight: style.lineHeight,\r\n        // whiteSpace: style.whiteSpace,\r\n\r\n        outlineColor: style.outlineColor,\r\n    };\r\n};\r\n\r\nexport const basicThemeColors = {\r\n    text: `#333333`,\r\n    text_header: `#333333`,\r\n    text_button: `#333333`,\r\n    text_error: `#333333`,\r\n    text_errorMessage: `#ff3333`,\r\n    border: `#cccccc`,\r\n    border_minor: `#cccccc`,\r\n    border_input: `#cccccc`,\r\n    outline: `#888888`,\r\n    background: `#ffffff`,\r\n    background_field: `#dddddd`,\r\n    background_button: `#eeeeee`,\r\n    background_error: `#ffcccc`,\r\n    loader: `#3333ff`,\r\n    icon: `#3333ff`,\r\n};\r\nexport type RectSize = { all?: number, left?: number, right?: number, top?: number, bottom?: number };\r\nconst getBorderSizes = (size: RectSize) => {\r\n    return {\r\n        borderWidth: size.all,\r\n        borderLeftWidth: size.left ?? size.all,\r\n        borderRightWidth: size.right ?? size.all,\r\n        borderTopWidth: size.top ?? size.all,\r\n        borderBottomWidth: size.bottom ?? size.all,\r\n    };\r\n};\r\n\r\nexport const basicThemeSizes = {\r\n    textPadding: 4,\r\n    borderWidth: { all: 1 } as RectSize,\r\n    borderWidth_minor: { all: 1 } as RectSize,\r\n    borderWidth_input: { all: 1 } as RectSize,\r\n    borderRadius: 4,\r\n    sectionGap: 16,\r\n    elementGap: 8,\r\n    rowGap: 4,\r\n    rowPadding: 4,\r\n\r\n    fontSize: 14,\r\n    fontSize_input: 16,\r\n    fontSize_button: 14,\r\n    fontSize_header: 16,\r\n\r\n    lineHeight: `18px`,\r\n\r\n    minWidth_label: 120,\r\n    minWidth_input: 120,\r\n    minWidth_button: 120,\r\n\r\n    icon: 14,\r\n};\r\n\r\nexport const basicFont = {\r\n    fontFamily: `\"Trebuchet MS\", Helvetica, Roboto, sans-serif`,\r\n    fontWeight_normal: `normal` as 'normal' | 'bold',\r\n    fontWeight_button: `bold` as 'normal' | 'bold',\r\n    fontWeight_header: `bold` as 'normal' | 'bold',\r\n};\r\n\r\nexport type ThemeColors = typeof basicThemeColors;\r\nexport type ThemeSizes = typeof basicThemeSizes;\r\nexport type ThemeFont = typeof basicFont;\r\n\r\nconst createTheme = (colors: ThemeColors, sizes: ThemeSizes, font: ThemeFont) => {\r\n\r\n    const borderProps = {\r\n        ...getBorderSizes(sizes.borderWidth),\r\n\r\n        borderRadius: sizes.borderRadius,\r\n        borderColor: colors.border,\r\n        borderStyle: `solid`,\r\n        outlineColor: colors.outline,\r\n    } as const;\r\n\r\n    const borderProps_minor = {\r\n        ...getBorderSizes(sizes.borderWidth_minor),\r\n\r\n        borderRadius: sizes.borderRadius,\r\n        borderColor: colors.border_minor,\r\n        borderStyle: `solid`,\r\n        outlineColor: colors.outline,\r\n    } as const;\r\n\r\n    const borderProps_input = {\r\n        ...getBorderSizes(sizes.borderWidth_input),\r\n\r\n        borderRadius: sizes.borderRadius,\r\n        borderColor: colors.border_input,\r\n        borderStyle: `solid`,\r\n        outlineColor: colors.outline,\r\n    } as const;\r\n\r\n    let sView: ThemeViewStyle = {};\r\n    let sText: ThemeTextStyle = {};\r\n    let sIcon: ThemeIconStyle = {};\r\n    let sTextView: ThemeTextStyle & ThemeViewStyle = {};\r\n\r\n    const theme = {\r\n        colors,\r\n        sizes,\r\n        font,\r\n\r\n        view_panel: sView = {\r\n            background: colors.background,\r\n            padding: sizes.elementGap,\r\n        },\r\n        view_form: sView = {\r\n            ...borderProps,\r\n            marginBottom: sizes.sectionGap,\r\n            padding: sizes.elementGap,\r\n            // background: colors.background_field,\r\n        },\r\n        text_formTitle: sText = {\r\n            padding: sizes.textPadding,\r\n            color: colors.text_header,\r\n            fontSize: sizes.fontSize_header,\r\n            fontFamily: font.fontFamily,\r\n            fontWeight: font.fontWeight_header,\r\n        },\r\n        view_formFields: sView = {\r\n            // ...borderProps,\r\n            ...borderProps_minor,\r\n            // padding: sizes.elementGap,\r\n            marginBottom: sizes.rowGap,\r\n            background: colors.background_field,\r\n            // alignItems: `center`,\r\n        },\r\n        view_fieldRow: sView = {\r\n            // ...borderProps,\r\n            // ...borderProps_minor,\r\n            // marginBottom: sizes.rowGap,\r\n            // padding: sizes.rowPadding,\r\n            marginLeft: sizes.rowPadding,\r\n            // background: colors.background_field,\r\n            display: `flex`,\r\n            flexDirection: `row`,\r\n\r\n            alignItems: `center`,\r\n            flexWrap: `wrap`,\r\n        },\r\n        text_fieldLabel: sText = {\r\n            padding: sizes.textPadding,\r\n            color: colors.text,\r\n            fontSize: sizes.fontSize,\r\n            fontWeight: font.fontWeight_normal,\r\n            minWidth: sizes.minWidth_label,\r\n            //  whiteSpace: `nowrap`,\r\n        },\r\n        input_fieldEntry: sText = {\r\n            ...borderProps_input,\r\n            marginBottom: sizes.rowGap,\r\n            marginRight: sizes.rowGap,\r\n            padding: sizes.textPadding,\r\n            color: colors.text,\r\n            fontSize: sizes.fontSize_input,\r\n            fontWeight: font.fontWeight_normal,\r\n            lineHeight: sizes.lineHeight,\r\n            minWidth: sizes.minWidth_input,\r\n        },\r\n        button_fieldInline: sTextView = {\r\n            ...borderProps,\r\n            // marginLeft: sizes.elementGap,\r\n            marginBottom: sizes.rowGap,\r\n            marginRight: sizes.rowGap,\r\n            padding: sizes.textPadding,\r\n            background: colors.background_button,\r\n            color: colors.text_button,\r\n            fontSize: sizes.fontSize_button,\r\n            fontWeight: font.fontWeight_button,\r\n            lineHeight: sizes.lineHeight,\r\n            display: `flex`,\r\n            minWidth: sizes.minWidth_button,\r\n        },\r\n        button_fieldInline_alt: sTextView = {\r\n            ...sTextView,\r\n            background: colors.text_button,\r\n            color: colors.background_button,\r\n            borderColor: colors.background_button,\r\n        },\r\n        view_formActionRow: sView = {\r\n            display: `flex`,\r\n            flexDirection: `row`,\r\n            justifyContent: `flex-end`,\r\n            marginBottom: sizes.elementGap,\r\n        },\r\n        button_formAction: sTextView = {\r\n            ...borderProps,\r\n            marginLeft: sizes.elementGap,\r\n            padding: sizes.textPadding,\r\n            background: colors.background_button,\r\n            color: colors.text_button,\r\n            fontSize: sizes.fontSize_button,\r\n            fontWeight: font.fontWeight_button,\r\n            lineHeight: sizes.lineHeight,\r\n            minWidth: sizes.minWidth_button,\r\n        },\r\n        button_formAction_alt: sTextView = {\r\n            ...sTextView,\r\n            background: colors.text_button,\r\n            color: colors.background_button,\r\n            borderColor: colors.background_button,\r\n        },\r\n\r\n        view_error: sView = {\r\n            ...borderProps,\r\n            marginBottom: sizes.sectionGap,\r\n            padding: sizes.rowPadding,\r\n            background: colors.background_error,\r\n        },\r\n        text_error: sText = {\r\n            padding: sizes.textPadding,\r\n            color: colors.text_error,\r\n            fontSize: sizes.fontSize,\r\n            fontFamily: font.fontFamily,\r\n            fontWeight: font.fontWeight_button,\r\n        },\r\n        text_errorMessage: sText = {\r\n            padding: sizes.textPadding,\r\n            color: colors.text_errorMessage,\r\n            fontSize: sizes.fontSize,\r\n            fontFamily: font.fontFamily,\r\n            fontWeight: font.fontWeight_button,\r\n        },\r\n\r\n        icon: sIcon = {\r\n            size: sizes.icon,\r\n            color: colors.icon,\r\n            outlineColor: colors.outline,\r\n        },\r\n        icon_errorMessage: sIcon = {\r\n            size: sizes.icon,\r\n            color: colors.text_errorMessage,\r\n            outlineColor: colors.outline,\r\n        },\r\n    } as const;\r\n\r\n    return theme;\r\n};\r\n\r\nexport const purpleColors = {\r\n    purple: `#863d8f`,\r\n    purpleLite: `#a75da7`,\r\n    purpleBackgroundLite: `#ddbfdd`,\r\n    blue: `#3baccf`,\r\n    gray: `#656364`,\r\n    lightGray: `#f8f6f7`,\r\n    lightBackgroundGray: `#e8e6e7`,\r\n    borderGray: `#d7c7d7`,\r\n    headerWhite: `#ffffff`,\r\n    headerGray: `#cecece`,\r\n    menuWhite: `#ffffff`,\r\n    bodyWhite: `#ffffff`,\r\n    buttonGray: `#a0a1a5`,\r\n    buttonWhite: `#e2e3e9`,\r\n    headingGray: `#f8f6f7`,\r\n    cardLightGray: `#f8f8f8`,\r\n    textWhite: `#ffffff`,\r\n    textBlack: `#2b2b2b`,\r\n    textGray: `#696768`,\r\n\r\n    // New Colors\r\n    warnRed: `#C56364`,\r\n    errorRed: `#C56364`,\r\n    deleteRed: `#C56364`,\r\n    changedYellow: `#F5F5C5`,\r\n};\r\n\r\nexport const purpleThemeColors: typeof basicThemeColors = {\r\n    ...basicThemeColors,\r\n    text: `#2b2b2b`,\r\n    text_header: `#863d8f`,\r\n    text_button: `#ffffff`,\r\n    // text_error: `#ffffff`,\r\n    border: `#863d8f`,\r\n    border_minor: `#863d8f`,\r\n    // border_minor: `#aaaaaa`,\r\n    border_input: `#aaaaaa`,\r\n    background: `#ffffff`,\r\n    background_field: `#dddddd`,\r\n    background_button: `#863d8f`,\r\n    // background_error: `#C56364`,\r\n    loader: `#863d8f`,\r\n    icon: `#863d8f`,\r\n};\r\n\r\nexport const purpleSizes: typeof basicThemeSizes = {\r\n    ...basicThemeSizes,\r\n    borderWidth: { all: 1, bottom: 4 },\r\n    borderWidth_minor: { all: 0, bottom: 1 },\r\n};\r\n\r\nexport const vscodeThemeColors = {\r\n    colors: {\r\n        text: `#569CD6`,\r\n        border: `#6796E6`,\r\n        background: `#1e1e1e`,\r\n        background_field: `#2e2e2e`,\r\n    },\r\n};\r\n\r\n// eslint-disable-next-line import/no-mutable-exports\r\nexport let theme = createTheme(basicThemeColors, basicThemeSizes, basicFont);\r\n// eslint-disable-next-line import/no-mutable-exports\r\n// export let theme = createTheme(purpleThemeColors, purpleSizes, basicFont);\r\n\r\nexport const setTheme = (colors: ThemeColors, sizes: ThemeSizes, font: ThemeFont) => {\r\n    theme = createTheme(purpleThemeColors, basicThemeSizes, basicFont);\r\n};\r\n","import { getValuesAsItems } from './objects';\r\n\r\nexport const moveItem = <T>(obj: T, from: T[], to: T[]) => {\r\n    const i = from.indexOf(obj);\r\n    if (i < 0) { throw new Error(`moveItem Failed to find an item in the from array: ${JSON.stringify({ obj, from, to })}`); }\r\n    from.splice(i, 1);\r\n    to.push(obj);\r\n};\r\n\r\nexport const distinct = <T>(items: T[]): T[] => {\r\n    const set = new Set(items);\r\n    return [...set];\r\n};\r\n\r\nexport const shuffle = <T>(items: T[]): T[] => {\r\n    return items.map(x => ({ x, value: Math.random() })).sort((a, b) => a.value - b.value).map(x => x.x);\r\n};\r\n\r\nexport const distinct_key = <T>(items: T[], getKey: (item: T) => string): T[] => {\r\n    const set = {} as { [key: string]: T };\r\n    items.forEach(x => { set[getKey(x)] = x; });\r\n    return getValuesAsItems(set);\r\n};\r\n\r\nexport const groupItems = <T>(items: T[], getKey: (item: T) => string): { [key: string]: T[] } => {\r\n    const groups = {} as { [key: string]: T[] };\r\n    for (const x of items) {\r\n        const g = groups[getKey(x)] ?? (groups[getKey(x)] = []);\r\n        g.push(x);\r\n    }\r\n    return groups;\r\n};\r\n\r\nexport const mergeItems = <T>(items: T[], getKey: (item: T) => string, getMerged: (item: T[], key: string) => T): T[] => {\r\n    const groups = groupItems(items, getKey);\r\n    const merged = getValuesAsItems(groups).map(g => getMerged(g, getKey(g[0])));\r\n    return merged;\r\n};\r\n\r\nexport function sameArrayContents<T>(a: undefined | null | T[], b?: undefined | null | T[]) {\r\n    if (a === b) { return true; }\r\n    if (a == null && b == null) { return true; }\r\n    if (a == null || b == null) { return false; }\r\n    if (a.length !== b.length) { return false; }\r\n    for (const i in a) {\r\n        if (a[i] !== b[i]) { return false; }\r\n    }\r\n    return true;\r\n}\r\n","'use strict';\nvar isArray = require('../internals/is-array');\nvar toLength = require('../internals/to-length');\nvar bind = require('../internals/function-bind-context');\n\n// `FlattenIntoArray` abstract operation\n// https://tc39.github.io/proposal-flatMap/#sec-FlattenIntoArray\nvar flattenIntoArray = function (target, original, source, sourceLen, start, depth, mapper, thisArg) {\n  var targetIndex = start;\n  var sourceIndex = 0;\n  var mapFn = mapper ? bind(mapper, thisArg, 3) : false;\n  var element;\n\n  while (sourceIndex < sourceLen) {\n    if (sourceIndex in source) {\n      element = mapFn ? mapFn(source[sourceIndex], sourceIndex, original) : source[sourceIndex];\n\n      if (depth > 0 && isArray(element)) {\n        targetIndex = flattenIntoArray(target, original, element, toLength(element.length), targetIndex, depth - 1) - 1;\n      } else {\n        if (targetIndex >= 0x1FFFFFFFFFFFFF) throw TypeError('Exceed the acceptable array length');\n        target[targetIndex] = element;\n      }\n\n      targetIndex++;\n    }\n    sourceIndex++;\n  }\n  return targetIndex;\n};\n\nmodule.exports = flattenIntoArray;\n","// this method was added to unscopables after implementation\n// in popular engines, so it's moved to a separate module\nvar addToUnscopables = require('../internals/add-to-unscopables');\n\naddToUnscopables('flatMap');\n","import { useEffect, useState, useRef } from 'react';\r\nimport { sameArrayContents } from 'utils/arrays';\r\nimport { ErrorState } from 'utils/error';\r\n\r\ntype TDoWork = (\r\n    doWorkInner: (stopIfObsolete: (() => void)) => Promise<void>,\r\n    getContext?: () => unknown[]) => void;\r\n\r\n\r\nexport function useMounted() {\r\n    const mounted = useRef(true);\r\n    useEffect(() => {\r\n        // Unmount on unsub\r\n        return () => {\r\n            mounted.current = false;\r\n        };\r\n    }, [/* Init Only */]);\r\n    return { mounted };\r\n}\r\n\r\n/** Automatically handle loading and error objects with asyncronous calls\r\n * @return The { loading, error, doWork } values\r\n * @example\r\n *\r\n *      const { loading, error, doWork } = ChatHooks.useAutoLoadingError();\r\n *      ...\r\n *          doWork(async (stopIfObsolete) => {\r\n *              ...\r\n *              const result = async DoAsyncWork());\r\n *              stopIfObsolete(); // Stop work if component has been unmounted, or if contextValues have changed since beginning of doWork\r\n *              ...\r\n *              setResult(result);\r\n *          }, () => [ contextValueA, contextValueB ]); // Optional context values to stop work if changed\r\n *    \r\n */\r\nexport function useAutoLoadingError() {\r\n    const { mounted } = useMounted();\r\n    const [loadingError, setLoadingError] = useState({ loading: false, error: null as null | ErrorState });\r\n\r\n    const UNMOUNTED = `unmounted`;\r\n    const CHANGED_CONTEXT = `changedContext`;\r\n\r\n    const doWork: TDoWork = (\r\n        doWorkInner: (stopIfObsolete: (() => void)) => Promise<void>,\r\n        getContext?: () => unknown[]) => {\r\n\r\n        let contextInit = undefined as undefined | unknown[];\r\n\r\n        const stopIfObsolete = () => {\r\n            if (!mounted.current) {\r\n                // eslint-disable-next-line @typescript-eslint/no-throw-literal\r\n                throw UNMOUNTED;\r\n            }\r\n            const c = getContext?.();\r\n\r\n            if (!sameArrayContents(contextInit, c)) {\r\n                // eslint-disable-next-line @typescript-eslint/no-throw-literal\r\n                throw CHANGED_CONTEXT;\r\n            }\r\n        };\r\n\r\n        const doCall = async () => {\r\n            contextInit = getContext?.();\r\n            setLoadingError({ loading: true, error: null });\r\n\r\n            // eslint-disable-next-line @typescript-eslint/no-unused-vars\r\n            let hadError = false;\r\n\r\n            try {\r\n                try {\r\n                    await doWorkInner(stopIfObsolete);\r\n                    stopIfObsolete();\r\n                    setLoadingError({ loading: false, error: null });\r\n                }\r\n                catch (error) {\r\n                    // Ignore unmounted or changed context\r\n                    if (error !== UNMOUNTED && error !== CHANGED_CONTEXT) {\r\n                        throw error;\r\n                    }\r\n                }\r\n            } catch (error) {\r\n                // console.log(`doWork catch`, { err: error });\r\n                hadError = true;\r\n\r\n                if (!mounted.current) {\r\n                    // console.warn(`doWork Error when not Mounted`, { err: error });\r\n                    return;\r\n                }\r\n\r\n                setLoadingError({ loading: false, error: { message: error.message ?? `Unknown Error in doWork`, error, retryCallback: doCall } });\r\n            }\r\n        };\r\n\r\n        // Start Async\r\n        (async () => await doCall())();\r\n    };\r\n\r\n    return { loading: loadingError.loading, error: loadingError.error, doWork };\r\n}\r\n\r\nexport function useLoadData<T>(doWork: TDoWork, getData: () => Promise<T>, getDataDeps?: () => unknown[]) {\r\n    const [data, setData] = useState(null as null | T);\r\n    useEffect(() => {\r\n        // console.log(`useLoadData.useEffect`);\r\n        doWork(async (stopIfObsolete) => {\r\n            // console.log(`useLoadData.useEffect.doWork`);\r\n            const d = await getData();\r\n            stopIfObsolete();\r\n            setData(d);\r\n        }, getDataDeps);\r\n    }, getDataDeps?.() ?? []);\r\n    return { data };\r\n}\r\n","import React, { useState, useEffect } from 'react';\r\nimport { ActivityIndicator, View } from 'react-native-lite';\r\nimport { theme } from 'themes/theme';\r\n\r\nexport const Loading = ({ loading }: { loading?: boolean }) => {\r\n\r\n    const visible = loading;\r\n\r\n    // // Show loading for a min time\r\n    // const [visible, setVisible] = useState(loading);\r\n    // const MIN_TIME_MS = 500;\r\n    // useEffect(() => {\r\n    //     if (loading) { setVisible(true); return () => { }; }\r\n    //     const timeoutId = setTimeout(() => {\r\n    //         setVisible(false);\r\n    //     }, MIN_TIME_MS);\r\n    //     return () => {\r\n    //         clearTimeout(timeoutId);\r\n    //     };\r\n    // }, [loading]);\r\n\r\n    if (!visible) { return <></>; }\r\n\r\n    return (\r\n        <View>\r\n            <ActivityIndicator size='large' color={theme.colors.loader} />\r\n        </View>\r\n    );\r\n};\r\n\r\nexport const LoadingInline = ({ loading }: { loading?: boolean }) => {\r\n\r\n    const visible = loading;\r\n\r\n    // // Show loading for a min time\r\n    // const [visible, setVisible] = useState(loading);\r\n    // const MIN_TIME_MS = 500;\r\n    // useEffect(() => {\r\n    //     if (loading) { setVisible(true); return () => { }; }\r\n    //     const timeoutId = setTimeout(() => {\r\n    //         setVisible(false);\r\n    //     }, MIN_TIME_MS);\r\n    //     return () => {\r\n    //         clearTimeout(timeoutId);\r\n    //     };\r\n    // }, [loading]);\r\n\r\n    if (!visible) { return <></>; }\r\n\r\n    return (\r\n        <>\r\n            <ActivityIndicator size='small' color={theme.colors.loader} />\r\n        </>\r\n    );\r\n};\r\n","import { distinct, shuffle } from 'utils/arrays';\r\nimport { SpeechService } from '../../utils/speech';\r\nimport { ProblemService, ProblemAnswer } from '../problems-service';\r\nimport { getSpellingEntries } from './spelling-entries';\r\n\r\nexport const createSpellingProblemService = ({ speechService, maxAnswers = 4, sectionSize = 25 }: { speechService: SpeechService, maxAnswers?: number, sectionSize?: number }): ProblemService => {\r\n    const speech = speechService;\r\n    const spellingEntries = getSpellingEntries();\r\n    const sectionCount = Math.ceil(spellingEntries.length / sectionSize);\r\n\r\n    let state = {\r\n        nextIndex: 0,\r\n        completedSectionKeys: [] as string[],\r\n    };\r\n\r\n    const getSectionKey = (sectionIndex: number) => {\r\n        return `${sectionIndex}`;\r\n    };\r\n    const getSectionName = (sectionIndex: number) => {\r\n        return `Spelling ${sectionIndex + 1}`;\r\n    };\r\n\r\n    const service: ProblemService = {\r\n        load: async (storage) => {\r\n            const loaded = await storage.load<typeof state>();\r\n            if (loaded) {\r\n                state = loaded;\r\n            }\r\n        },\r\n        save: async (storage) => {\r\n            await storage.save(state);\r\n        },\r\n        getSections: () => [...new Array(sectionCount)].map((x, i) => ({\r\n            key: getSectionKey(i),\r\n            name: getSectionName(i),\r\n            isComplete: state.completedSectionKeys.includes(getSectionKey(i)),\r\n        })),\r\n        gotoSection: ({ key }) => {\r\n            const a = Number.parseInt(key, 10);\r\n            state.nextIndex = a * sectionSize;\r\n            console.log(`createSpellingProblemService gotoSection`, { key, a, state });\r\n        },\r\n        getNextProblem: () => {\r\n            if (state.nextIndex >= spellingEntries.length) {\r\n                state.nextIndex = 0;\r\n            }\r\n\r\n            const i = state.nextIndex;\r\n            state.nextIndex++;\r\n\r\n            const p = spellingEntries[i];\r\n            const correctValue = p.word;\r\n            const wrongAnswerCount = maxAnswers - 1;\r\n            const wrongValues =\r\n                shuffle(distinct(p.mispellings)).slice(0, wrongAnswerCount);\r\n\r\n            const answers: ProblemAnswer[] = shuffle([...wrongValues.map(x => ({ value: `${x}`, isCorrect: false })), { value: `${correctValue}`, isCorrect: true }]).map(x => ({ ...x, key: x.value }));\r\n\r\n            const isLastOfSection = (i + 1) % sectionSize === 0;\r\n            const isLastOfSubject = i === spellingEntries.length - 1;\r\n            return {\r\n                key: `${i + 1}`,\r\n                question: `Word ${i + 1}`,\r\n                onQuestion: () => { speech.speak(correctValue); },\r\n                answers,\r\n                sectionKey: getSectionKey(Math.floor(i / sectionSize)),\r\n                isLastOfSection,\r\n                isLastOfSubject,\r\n            };\r\n        },\r\n        recordAnswer: (problem, answer) => {\r\n            if (answer.isCorrect && problem.isLastOfSection) {\r\n                state.completedSectionKeys.push(problem.sectionKey);\r\n            }\r\n        },\r\n    };\r\n\r\n    return service;\r\n};\r\n","import React, { useState, useRef, useEffect } from 'react';\r\nimport { View, Text, Pressable, Platform } from 'react-native-lite';\r\n\r\nexport type GamepadPressState = { moveDirection: { x: number, y: number }, buttons: { key: string, text: string, isDown: boolean }[] };\r\nexport const GamepadAnalogStateful = (props: {\r\n    style: { backgroundColor: string, borderColor: string };\r\n    onPressStateChange: (value: GamepadPressState) => void;\r\n    buttons: { text: string, key: string }[];\r\n}) => {\r\n\r\n    const state = useRef({\r\n        moveDirection: { x: 0, y: 0 },\r\n        buttons: props.buttons.map((x, i) => ({\r\n            isDown: false,\r\n            key: x.key,\r\n            text: x.text,\r\n            onPressIn: () => {\r\n                state.current.buttons[i].isDown = true;\r\n                props.onPressStateChange(state.current);\r\n            },\r\n            onPressOut: () => {\r\n                state.current.buttons[i].isDown = false;\r\n                props.onPressStateChange(state.current);\r\n            },\r\n        })),\r\n    });\r\n\r\n    const onMovePressIn = (dir: { x: number, y: number }) => {\r\n        const s = state.current;\r\n\r\n        state.current.moveDirection = {\r\n            x: dir.x ? dir.x : s.moveDirection.x,\r\n            y: dir.y ? dir.y : s.moveDirection.y,\r\n        };\r\n\r\n        console.log(`onMovePressIn`, { dir, s, moveDirection: state.current.moveDirection });\r\n\r\n        props.onPressStateChange(state.current);\r\n    };\r\n\r\n    const onMovePressOut = (dir: { x: number, y: number }) => {\r\n        const s = state.current;\r\n        state.current.moveDirection = {\r\n            x: dir.x ? 0 : s.moveDirection.x,\r\n            y: dir.y ? 0 : s.moveDirection.y,\r\n        };\r\n        props.onPressStateChange(state.current);\r\n    };\r\n\r\n    return (\r\n        <GamepadAnalog {...props} onMovePressIn={onMovePressIn} onMovePressOut={onMovePressOut} buttons={state.current.buttons} />\r\n    );\r\n};\r\n\r\nconst inputStyles = {\r\n    container: { flex: 1, alignSelf: `stretch`, flexDirection: `row`, justifyContent: `space-between`, alignItems: `center`, padding: 4 },\r\n    section: { justifyContent: `center`, alignItems: `center`, padding: 4 },\r\n    moveSectionWrapper: { overflow: `hidden` },\r\n    moveSectionRotation: { transform: `rotate(0.125turn)`, margin: 0 },\r\n    row: { flexDirection: `row` },\r\n    cellTouch: { outline: `none` },\r\n    cellView: { pointerEvents: `none`, position: `relative`, margin: 4, width: 56, height: 56, justifyContent: `center`, alignItems: `center`, borderWidth: 0, borderStyle: `solid`, outline: `none` },\r\n    cellText: { userSelect: `none`, pointerEvents: `none` },\r\n    moveCellText: { userSelect: `none`, pointerEvents: `none`, transform: `rotate(-0.125turn)` },\r\n    cellEmptyView: { margin: 2, width: 56, height: 56 },\r\n    cellTextOcclusionView: { position: `absolute`, top: 0, bottom: 0, left: 0, right: 0, backgroundColor: `red`, opacity: 0 },\r\n} as const;\r\n\r\nexport const GamepadAnalog = (props: {\r\n    style: { backgroundColor: string, borderColor: string };\r\n    onMovePressIn: (direction: { x: number, y: number }) => void;\r\n    onMovePressOut: (direction: { x: number, y: number }) => void;\r\n    buttons: { text: string, onPressIn: () => void, onPressOut: () => void }[];\r\n}) => {\r\n    const { onMovePressIn, onMovePressOut } = props;\r\n\r\n    const cellViewStyle = { ...inputStyles.cellView, ...props.style };\r\n\r\n    // Keyboard\r\n    useEffect(() => {\r\n        const onIgnore = (e: KeyboardEvent) => {\r\n            e.preventDefault();\r\n            e.stopPropagation?.();\r\n            return false;\r\n        };\r\n        if (Platform.OS === `web`) {\r\n            const onKeyDown = (e: KeyboardEvent) => {\r\n                if (e.key === `ArrowUp`) { onMovePressIn({ x: 0, y: +1 }); return onIgnore(e); }\r\n                if (e.key === `ArrowDown`) { onMovePressIn({ x: 0, y: -1 }); return onIgnore(e); }\r\n                if (e.key === `ArrowLeft`) { onMovePressIn({ x: -1, y: 0 }); return onIgnore(e); }\r\n                if (e.key === `ArrowRight`) { onMovePressIn({ x: +1, y: 0 }); return onIgnore(e); }\r\n                if (e.key === ` `) { props.buttons[0]?.onPressIn(); return onIgnore(e); }\r\n                // console.log(`onKeyDown`, { key: e.key });\r\n                return true;\r\n            };\r\n            const onKeyUp = (e: KeyboardEvent) => {\r\n                if (e.key === `ArrowUp`) { onMovePressOut({ x: 0, y: +1 }); return onIgnore(e); }\r\n                if (e.key === `ArrowDown`) { onMovePressOut({ x: 0, y: -1 }); return onIgnore(e); }\r\n                if (e.key === `ArrowLeft`) { onMovePressOut({ x: -1, y: 0 }); return onIgnore(e); }\r\n                if (e.key === `ArrowRight`) { onMovePressOut({ x: +1, y: 0 }); return onIgnore(e); }\r\n                if (e.key === ` `) { props.buttons[0]?.onPressOut(); return onIgnore(e); }\r\n                return true;\r\n            };\r\n            window.addEventListener(`keydown`, onKeyDown);\r\n            window.addEventListener(`keyup`, onKeyUp);\r\n            return () => {\r\n                window.removeEventListener(`keydown`, onKeyDown);\r\n                window.removeEventListener(`keyup`, onKeyUp);\r\n            };\r\n        }\r\n\r\n        return () => { };\r\n    });\r\n\r\n    const DirectionButton = ({ text, direction }: { text: string, direction: { x: number, y: number } }) => {\r\n        return (\r\n            <Pressable style={inputStyles.cellTouch} onPressIn={() => onMovePressIn(direction)} onPressOut={() => onMovePressOut(direction)}>\r\n                <View style={cellViewStyle}>\r\n                    <Text style={inputStyles.moveCellText}>{text}</Text>\r\n                    <View style={inputStyles.cellTextOcclusionView} />\r\n                </View>\r\n            </Pressable>\r\n        );\r\n    };\r\n\r\n    const ActionButton = ({ text, onPressIn, onPressOut }: { text: string, onPressIn: () => void, onPressOut: () => void }) => {\r\n        return (\r\n            <Pressable style={inputStyles.cellTouch} onPressIn={onPressIn} onPressOut={onPressOut}>\r\n                <View style={cellViewStyle}>\r\n                    <Text style={inputStyles.cellText}>{text}</Text>\r\n                    <View style={inputStyles.cellTextOcclusionView} />\r\n                </View>\r\n            </Pressable>\r\n        );\r\n    };\r\n\r\n    return (\r\n        <View style={inputStyles.container}>\r\n            <View style={inputStyles.moveSectionWrapper}>\r\n                <View style={inputStyles.moveSectionRotation}>\r\n                    <View style={inputStyles.section}>\r\n                        <View style={inputStyles.row} >\r\n                            <DirectionButton direction={{ x: 0, y: +1 }} text='' />\r\n                            <DirectionButton direction={{ x: +1, y: 0 }} text='' />\r\n                        </View>\r\n                        <View style={inputStyles.row} >\r\n                            <DirectionButton direction={{ x: -1, y: 0 }} text='' />\r\n                            <DirectionButton direction={{ x: 0, y: -1 }} text='' />\r\n                        </View>\r\n                    </View>\r\n                </View>\r\n            </View>\r\n            <View style={inputStyles.section} >\r\n                <View style={inputStyles.row} >\r\n                    {props.buttons.map(x => (\r\n                        <React.Fragment key={`${x.text}`}>\r\n                            <View style={inputStyles.cellEmptyView} />\r\n                            <ActionButton {...x} />\r\n                        </React.Fragment>\r\n                    ))}\r\n                </View>\r\n            </View>\r\n        </View>\r\n    );\r\n};\r\n","export type Vector2 = { x: number, y: number };\r\nexport const getDistanceSq = (a: Vector2, b: Vector2) => {\r\n    const x = a.x - b.x;\r\n    const y = a.y - b.y;\r\n    return x * x + y * y;\r\n};\r\n","/* eslint-disable react/no-array-index-key */\r\n/* eslint-disable jsx-a11y/accessible-emoji */\r\nimport React, { useState, useEffect, useRef } from 'react';\r\nimport { View, Text, Pressable, TouchableOpacity, Platform } from 'react-native-lite';\r\nimport { createMultiplesProblemService } from './problems/multiples';\r\nimport { ProblemService, Problem } from './problems/problems-service';\r\nimport { GamepadAnalogStateful, GamepadPressState } from './components/game-pad-analog';\r\nimport { getDistanceSq, Vector2 } from './utils/vectors';\r\nimport { createReviewProblemService } from './problems/problems-reviewer';\r\nimport { createProgressGameProblemService } from './progress-games/progress-game';\r\nimport { createAutoSavedProblemService } from './problems/problem-state-storage';\r\nimport { SubjectNavigator } from './utils/subject-navigator';\r\n\r\nexport const EducationalGame_StarBlastSideways_Multiples = (props: {}) => {\r\n    return <EducationalGame_StarBlastSideways problemService={createAutoSavedProblemService(createReviewProblemService(createMultiplesProblemService({ min: 1, max: 12 }), {}), `ProblemsMultiples`)} />;\r\n};\r\n\r\nexport const EducationalGame_StarBlastSideways = (props: { problemService: ProblemService }) => {\r\n    // Add Pet Feeder\r\n    return <EducationalGame_StarBlastSideways_Inner problemService={createProgressGameProblemService(props.problemService)} />;\r\n};\r\n\r\nconst EducationalGame_StarBlastSideways_Inner = (props: { problemService: ProblemService }) => {\r\n    const [pauseState, setPauseState] = useState({ paused: false } as { paused: boolean });\r\n    const [pressState, setPressState] = useState({ moveDirection: { x: 0, y: 0 }, buttons: [] } as GamepadPressState);\r\n    const onPressStateChange = (value: GamepadPressState) => {\r\n        // console.log(`onPressStateChange`, { ...x, dir: { ...x.moveDirection }, buttons: x.buttons.map(b => ({ ...b })) });\r\n        setPressState(value);\r\n    };\r\n\r\n    const [problemSourceKey, setProblemSourceKey] = useState(0);\r\n\r\n    return (\r\n        <>\r\n            <View>\r\n                <View style={{ alignItems: `center`, alignSelf: `stretch` }} >\r\n                    <View style={{ overflow: `hidden`, padding: 10, paddingTop: 4, paddingBottom: 64 }}>\r\n                        <View style={{ position: `relative` }}>\r\n                            <GameView pressState={pressState} pauseState={pauseState} problemService={props.problemService} problemSourceKey={`${problemSourceKey}`} />\r\n                            {/* <Pressable style={{ position: `absolute`, top: 0, bottom: 0, left: 0, right: 0, opacity: 0 }} onPressIn={() => { }} onPressOut={() => { }} /> */}\r\n                            <View style={{ zIndex: 10, flex: 1, alignSelf: `stretch` }}>\r\n                                <GamepadAnalogStateful style={colors.gamepad} onPressStateChange={onPressStateChange} buttons={[{ key: `A`, text: `` }]} />\r\n                            </View>\r\n                        </View>\r\n                    </View>\r\n                </View>\r\n                <SubjectNavigator problemService={props.problemService}\r\n                    onOpen={() => setPauseState({ paused: true })}\r\n                    onClose={() => setPauseState({ paused: false })}\r\n                    onSubjectNavigation={() => { setPauseState({ paused: false }); setProblemSourceKey(s => s + 1); }}\r\n                />\r\n            </View>\r\n        </>\r\n    );\r\n};\r\n\r\n\r\nconst colors = {\r\n    gamepad: {\r\n        backgroundColor: `#333333`,\r\n        borderColor: `#000033`,\r\n    },\r\n    viewscreen: {\r\n        borderColor: `#000033`,\r\n        backgroundColor: `#000000`,\r\n    },\r\n};\r\n\r\nconst gameStyles = {\r\n    directAnswerButtonContainer: { alignSelf: `flex-end`, justifyContent: `space-around`, height: 250, padding: 4 },\r\n    directAnswerButton: { width: 40, height: 40, backgroundColor: `#FFFFFF`, opacity: 0.1 },\r\n    directAnswerButton_hidden: { width: 40, height: 40 },\r\n    viewscreenView: {\r\n        height: 300,\r\n        width: 300,\r\n        backgroundColor: colors.viewscreen.backgroundColor,\r\n        borderColor: colors.viewscreen.borderColor,\r\n        borderWidth: 1,\r\n        borderStyle: `solid`,\r\n    },\r\n    sprite: {\r\n        viewSize: { width: 32, height: 32 },\r\n        text: {\r\n            fontFamily: `\"Lucida Console\", Monaco, monospace`,\r\n            fontSize: 32,\r\n            textAlign: `center`,\r\n        },\r\n    },\r\n    answer: {\r\n        text: {\r\n            fontFamily: `\"Lucida Console\", Monaco, monospace`,\r\n            fontSize: 24,\r\n            fontSize_small: 14,\r\n            textAlign: `center`,\r\n            whiteSpace: `pre-wrap`,\r\n        },\r\n    },\r\n    question: {\r\n        view: { flex: 1, justifyContent: `center`, padding: 4 },\r\n        text: {\r\n            fontFamily: `\"Lucida Console\", Monaco, monospace`,\r\n            fontSize: 24,\r\n            fontSize_small: 14,\r\n            whiteSpace: `pre-wrap`,\r\n        },\r\n    },\r\n    gameOver: {\r\n        view: { flex: 1, justifyContent: `center`, padding: 4 },\r\n        text: {\r\n            fontFamily: `\"Lucida Console\", Monaco, monospace`,\r\n            fontSize: 24,\r\n            textAlign: `center`,\r\n        },\r\n    },\r\n} as const;\r\n\r\ntype GamePosition = {\r\n    x: number;\r\n    y: number;\r\n    rotation: number;\r\n};\r\n\r\ntype GameState = {\r\n    lastActualTimeMs: number;\r\n    lastGameTime: number;\r\n    gameSpeed: number;\r\n\r\n    lives: number;\r\n    deadTime?: number;\r\n    gameOverTime?: number;\r\n    score: number;\r\n\r\n    weaponsLock?: {\r\n        lockedAtPlayerPosition: GamePosition;\r\n        lockedEnemy: { pos: GamePosition };\r\n    };\r\n    playerTargetPosition?: { x: number, y: number };\r\n};\r\n\r\n\r\ntype AnswerState = { key: string, value: string, isCorrect: boolean, isAnsweredWrong: boolean };\r\nconst GameView = (props: { pressState: GamepadPressState, pauseState: { paused: boolean }, problemService: ProblemService, problemSourceKey: string }) => {\r\n\r\n    const pressState = useRef(props.pressState);\r\n    pressState.current = props.pressState;\r\n\r\n    const pauseState = useRef(props.pauseState);\r\n    pauseState.current = props.pauseState;\r\n\r\n    const gameAcceleration = 0.1;\r\n    const gameDeceleration = 0.2;\r\n    const maxGameSpeed = 5;\r\n    const minGameSpeed = 0.5;\r\n\r\n    const getDefaultGameState = (): GameState => ({\r\n        lastActualTimeMs: Date.now(),\r\n        lastGameTime: 0,\r\n        gameSpeed: 1,\r\n        lives: 3,\r\n        score: 0,\r\n    });\r\n    const gameState = useRef(getDefaultGameState());\r\n    const getGameTime = () => {\r\n        const now = Date.now();\r\n        let actualTimePassed = (now - gameState.current.lastActualTimeMs) / 1000;\r\n        gameState.current.lastActualTimeMs = now;\r\n\r\n        if (actualTimePassed === 0) {\r\n            return { gameTime: gameState.current.lastGameTime };\r\n        }\r\n\r\n        // Left App, frozen, etc?\r\n        if (actualTimePassed > 0.1) {\r\n            actualTimePassed = 0.1;\r\n        }\r\n\r\n        const gameTimePassed = actualTimePassed * gameState.current.gameSpeed;\r\n        const gameTime = gameState.current.lastGameTime + gameTimePassed;\r\n        gameState.current.lastGameTime = gameTime;\r\n\r\n        return {\r\n            gameTime,\r\n        };\r\n    };\r\n\r\n    const playerPositionState = useRef({\r\n        y: gameStyles.viewscreenView.height * 0.5, x: gameStyles.viewscreenView.width * 0.15, rotation: 0,\r\n    } as GamePosition);\r\n    const projectilesState = useRef({ lastShotActualTime: 0, shots: [], debris: [] } as ProjectilesState);\r\n    const enemiesState = useRef({ enemies: [] } as EnemiesState);\r\n\r\n    const problemsState = useRef(null as null | { problemTime: number, question: string, answers: (Problem['answers'][0] & { key: string, pos: GamePosition, isAnsweredWrong: boolean })[] });\r\n    const [renderId, setRenderId] = useState(0);\r\n\r\n    const restartGame = () => {\r\n        // Move enemies back\r\n        enemiesState.current.enemies.forEach(e2 => { e2.pos.x += gameStyles.viewscreenView.width * 0.5; });\r\n\r\n        // Reset Player\r\n        playerPositionState.current.y = gameStyles.viewscreenView.height * 0.5;\r\n        playerPositionState.current.x = gameStyles.viewscreenView.width * 0.15;\r\n\r\n        gameState.current = { ...getDefaultGameState(), lastGameTime: gameState.current.lastGameTime };\r\n    };\r\n\r\n    const gameOver = () => {\r\n        gameState.current = {\r\n            ...gameState.current,\r\n            lives: 0,\r\n            gameOverTime: getGameTime().gameTime,\r\n        };\r\n    };\r\n\r\n    const gotoNextProblem = () => {\r\n        const p = props.problemService.getNextProblem();\r\n\r\n        console.log(`gotoNextProblem`, { p });\r\n\r\n        if (!p.question) {\r\n            // Game over - problems done\r\n            return;\r\n        }\r\n\r\n        const pSize = gameStyles.viewscreenView.width / (p.answers.length + 1);\r\n        const newProblemState = {\r\n            problemTime: getGameTime().gameTime,\r\n            question: p.question,\r\n            answers: p.answers.map((x, i) => ({ ...x, key: `${p.question} ${x.value}`, pos: { y: pSize * (0.5 + i), x: gameStyles.viewscreenView.width - gameStyles.sprite.viewSize.width * 0.5, rotation: 0 }, isAnsweredWrong: false })),\r\n        };\r\n        const newEnemyState = {\r\n            enemies: newProblemState.answers.map((ans, i) => {\r\n                const enemy = {\r\n                    key: `${p.question} ${ans.value}`,\r\n                    answer: ans,\r\n                    pos: { y: pSize * (0.5 + i), x: gameStyles.viewscreenView.width - gameStyles.sprite.viewSize.width * 1.5, rotation: 0 },\r\n                    vel: { x: -5, y: 0 },\r\n                    onHit: () => {\r\n                        setTimeout(() => {\r\n                            console.log(`onHit`, { ans });\r\n                            props.problemService.recordAnswer(p, ans);\r\n                            if (ans.isCorrect) {\r\n                                // TODO: Update score, etc.\r\n                                // Let bullets clear\r\n                                projectilesState.current.shots.forEach(x => { x.ignore = true; });\r\n                                gotoNextProblem();\r\n\r\n                                gameState.current = {\r\n                                    ...gameState.current,\r\n                                    score: gameState.current.score += Math.floor(enemy.pos.x) * 1000,\r\n                                    gameSpeed: Math.min(maxGameSpeed, gameState.current.gameSpeed * 1 + gameAcceleration),\r\n                                };\r\n                            } else {\r\n                                ans.isAnsweredWrong = true;\r\n\r\n                                gameState.current = {\r\n                                    ...gameState.current,\r\n                                    score: gameState.current.score -= Math.floor(enemy.pos.x) * 1500,\r\n                                    gameSpeed: Math.max(minGameSpeed, gameState.current.gameSpeed * 1 - gameDeceleration),\r\n                                };\r\n                            }\r\n                        });\r\n                    },\r\n                    destroyed: false,\r\n                };\r\n\r\n                return enemy;\r\n            }),\r\n        };\r\n\r\n        problemsState.current = newProblemState;\r\n        enemiesState.current = newEnemyState;\r\n        setRenderId(s => s + 1);\r\n\r\n        setTimeout(() => {\r\n            p.onQuestion?.();\r\n        }, 250);\r\n    };\r\n\r\n    useEffect(() => {\r\n        gotoNextProblem();\r\n    }, [props.problemSourceKey]);\r\n\r\n    useEffect(() => {\r\n        // Game Loop\r\n        let gameLastTime = getGameTime().gameTime;\r\n        const gameLoop = () => {\r\n            const { gameTime } = getGameTime();\r\n            const gameDeltaTime = gameTime - gameLastTime;\r\n            gameLastTime = gameTime;\r\n\r\n            if (pauseState.current.paused || gameDeltaTime <= 0) {\r\n                requestAnimationFrame(gameLoop);\r\n                return;\r\n            }\r\n\r\n            // if (!pressState.current.moveDirection.x\r\n            //     && !pressState.current.moveDirection.y) {\r\n            //     // No change\r\n            //     requestAnimationFrame(gameLoop);\r\n            //     return;\r\n            // }\r\n\r\n            // console.log(`gameLoop Update`);\r\n\r\n            // Update\r\n\r\n            const getCommonState = (): CommonGameState => {\r\n                return {\r\n                    gameTime,\r\n                    gameDeltaTime,\r\n                    gameState: gameState.current,\r\n                    pressState: pressState.current,\r\n                    playerPosition: playerPositionState.current,\r\n                    projectilesState: projectilesState.current,\r\n                    enemiesState: enemiesState.current,\r\n                    onLoseLife: () => {\r\n                        if (gameState.current.deadTime || gameState.current.gameOverTime) { return; }\r\n\r\n                        projectilesState.current.debris.push({ key: `player${gameTime}`, kind: `player-character`, pos: { ...playerPositionState.current }, vel: { x: 0, y: 0 } });\r\n\r\n\r\n                        if (gameState.current.lives <= 1) {\r\n                            // Game over\r\n                            gameOver();\r\n                            return;\r\n                        }\r\n\r\n                        // Move enemies back\r\n                        // enemiesState.current.enemies.forEach(e2 => { e2.pos.x += gameStyles.viewscreenView.width * 0.5; });\r\n\r\n                        gameState.current = {\r\n                            ...gameState.current,\r\n                            lives: gameState.current.lives - 1,\r\n                            deadTime: gameTime,\r\n                        };\r\n                    },\r\n                };\r\n            };\r\n\r\n\r\n            // Game\r\n            const gameResult = updateGame(getCommonState());\r\n            gameState.current = gameResult;\r\n\r\n            if (!gameState.current.gameOverTime) {\r\n                // Player\r\n                const playerResult = updatePlayer(getCommonState());\r\n                playerPositionState.current = playerResult.playerPosition;\r\n            } else if (getGameTime().gameTime > 1 + gameState.current.gameOverTime\r\n                && pressState.current.buttons[0]?.isDown) {\r\n                setTimeout(() => {\r\n                    restartGame();\r\n                }, 250);\r\n            }\r\n\r\n            // Projectiles\r\n            const projectilesResult = updateProjectiles(getCommonState());\r\n            projectilesState.current = projectilesResult;\r\n\r\n            // Enemies\r\n            const enemiesResult = updateEnemies(getCommonState());\r\n            enemiesState.current = enemiesResult;\r\n\r\n\r\n            // Game Loop\r\n            requestAnimationFrame(gameLoop);\r\n            setRenderId(s => s + 1);\r\n        };\r\n\r\n        requestAnimationFrame(gameLoop);\r\n    }, []);\r\n\r\n\r\n    // console.log(`GameView render`, { playerStylePosition });\r\n\r\n    const timeSinceProblem = getGameTime().gameTime - (problemsState.current?.problemTime ?? 0);\r\n\r\n    const directAnswer = (enemy: EnemiesState['enemies'][0]) => {\r\n        if (gameState.current.gameOverTime) { restartGame(); return; }\r\n        if (gameState.current.deadTime) { return; }\r\n        if (enemy.destroyed || enemy.explodeTime) { return; }\r\n        gameState.current.weaponsLock = { lockedEnemy: enemy, lockedAtPlayerPosition: playerPositionState.current };\r\n        const { shots } = projectilesState.current;\r\n        shots.push({ key: `${getGameTime()}${shots.length}`, pos: { ...playerPositionState.current }, lockedEnemy: enemy });\r\n        gameState.current.playerTargetPosition = { x: playerPositionState.current.x, y: enemy.pos.y };\r\n    };\r\n\r\n    return (\r\n        <>\r\n            <View style={gameStyles.viewscreenView} >\r\n                {/* <TextPositioned text={`${gameState.current.score.toLocaleString()}`} position={{ x: 0, y: -0.8 * gameStyles.sprite.viewSize.height, rotation: 0 }} /> */}\r\n                {[... new Array(gameState.current.lives)].map((x, i) => (\r\n                    <Sprite key={`life${i}`} kind='life' position={{ x: gameStyles.viewscreenView.width - (gameStyles.sprite.viewSize.width * (1 + i)), y: gameStyles.viewscreenView.height - 0.5 * gameStyles.sprite.viewSize.height, rotation: 0 }} />\r\n                ))}\r\n                {projectilesState.current.debris.map(x => (\r\n                    <Sprite key={x.key} kind={x.hasHitGround ? `${x.kind}-splat` as SpriteKind : x.kind} position={x.pos} />\r\n                ))}\r\n                {enemiesState.current?.enemies.filter(e => !e.destroyed).map(e => (\r\n                    <React.Fragment key={e.key}>\r\n                        {!e.answer.isAnsweredWrong && (<TextPositioned position={{ y: e.pos.y, x: e.pos.x + gameStyles.sprite.viewSize.width, rotation: 0 }} text={e.answer.value} />)}\r\n                        {e.answer.isAnsweredWrong && (<Sprite kind='answer-wrong' position={{ y: e.pos.y, x: e.pos.x + gameStyles.sprite.viewSize.width, rotation: 0 }} />)}\r\n                    </React.Fragment>\r\n                ))}\r\n                {enemiesState.current?.enemies.filter(x => !x.destroyed).map(x => (\r\n                    <React.Fragment key={x.key}>\r\n                        <Sprite kind={x.explodeTime ? `enemy-explode` : `enemy`} position={x.pos} />\r\n                        {x === gameState.current.weaponsLock?.lockedEnemy && (\r\n                            <Sprite kind='lock' position={x.pos} />\r\n                        )}\r\n                    </React.Fragment>\r\n                ))}\r\n                {!gameState.current.gameOverTime && !gameState.current.deadTime && (\r\n                    <Sprite kind='player' position={playerPositionState.current} />\r\n                )}\r\n                {projectilesState.current.shots.map(x => (\r\n                    <Sprite key={x.key} kind={x.explodeTime ? `shot-explode` : `shot`} position={x.pos} />\r\n                ))}\r\n                {gameState.current.gameOverTime && (\r\n                    <View>\r\n                        <View style={{ position: `absolute`, top: gameStyles.viewscreenView.height * 0.5, width: gameStyles.viewscreenView.width }}>\r\n                            <Text style={gameStyles.gameOver.text}>Game Over</Text>\r\n                            {getGameTime().gameTime > 1 + gameState.current.gameOverTime && (<Text style={gameStyles.gameOver.text}>Continue?</Text>)}\r\n                        </View>\r\n                    </View>\r\n                )}\r\n\r\n                <View style={gameStyles.directAnswerButtonContainer}>\r\n                    {enemiesState.current?.enemies.map(e => (\r\n                        <TouchableOpacity key={e.key} onPress={() => directAnswer(e)} >\r\n                            <View style={!e.destroyed && !e.explodeTime ? gameStyles.directAnswerButton : gameStyles.directAnswerButton_hidden} />\r\n                        </TouchableOpacity>\r\n                    ))}\r\n                </View>\r\n            </View>\r\n            <View style={{ position: `relative`, height: gameStyles.question.text.fontSize * 3, alignSelf: `stretch` }}>\r\n                <TextPositioned text={problemsState.current?.question ?? ``} position={{ x: gameStyles.viewscreenView.width * 0.25, y: gameStyles.question.text.fontSize * 1 - Math.max(0, gameStyles.viewscreenView.height * 0.5 - 125 * timeSinceProblem), rotation: 0 }} />\r\n            </View>\r\n            {/* <View>\r\n                <Text>{`${renderId}`}</Text>\r\n            </View> */}\r\n            {/* <View style={[gameStyles.question.view, { transform: `translate(0px,${-Math.max(0, gameStyles.viewscreenView.height * 0.5 - 125 * timeSinceProblem)}px)` }]}>\r\n                <Text style={{...gameStyles.question.text, text.length > 10 ? s.fontSize_small * 0.5 : s.fontSize}} >{problemsState.current?.question}</Text>\r\n            </View> */}\r\n\r\n        </>\r\n    );\r\n};\r\n\r\ntype CommonGameState = { gameTime: number, gameDeltaTime: number, gameState: GameState, pressState: GamepadPressState, playerPosition: GamePosition, projectilesState: ProjectilesState, enemiesState: EnemiesState, onLoseLife: () => void };\r\n\r\nconst updateGame = ({ gameTime, gameDeltaTime, pressState, playerPosition, gameState, enemiesState }: CommonGameState): GameState => {\r\n\r\n    // Respawn Player\r\n    if (gameState.deadTime && gameTime > 3 + gameState.deadTime) {\r\n        playerPosition.y = gameStyles.viewscreenView.height * 0.5;\r\n        playerPosition.x = gameStyles.viewscreenView.width * 0.15;\r\n\r\n        enemiesState.enemies.forEach(e2 => { e2.pos.x += gameStyles.viewscreenView.width * 0.5; });\r\n\r\n        return { ...gameState, deadTime: undefined };\r\n    }\r\n\r\n    return gameState;\r\n};\r\n\r\nconst updatePlayer = ({ gameTime, gameDeltaTime, pressState, playerPosition, gameState }: CommonGameState): { playerPosition: GamePosition } => {\r\n    if (gameState.deadTime) { return { playerPosition }; }\r\n\r\n    const dirPress = pressState.moveDirection;\r\n    const targetPos = gameState.playerTargetPosition;\r\n    const dir = dirPress.x || dirPress.y ? { x: dirPress.x, y: -dirPress.y }\r\n        : targetPos ? { x: targetPos.x - playerPosition.x, y: targetPos.y - playerPosition.y }\r\n            : { x: 0, y: 0 };\r\n    dir.x = dir.x === 0 ? 0 : Math.sign(dir.x);\r\n    dir.y = dir.y === 0 ? 0 : Math.sign(dir.y);\r\n\r\n    if (gameState.playerTargetPosition) {\r\n        console.log(`updatePlayer`, { dirPress, dir, targetPos, playerPosition });\r\n    }\r\n\r\n    if (dirPress.x || dirPress.y) {\r\n        gameState.playerTargetPosition = undefined;\r\n    }\r\n    if (gameState.playerTargetPosition && getDistanceSq(playerPosition, gameState.playerTargetPosition) < 5 * 5) {\r\n        gameState.playerTargetPosition = undefined;\r\n    }\r\n\r\n    const targetRotation = dir.y * 0.05;\r\n\r\n    const pos = {\r\n        x: playerPosition.x + dir.x * gameDeltaTime * 250,\r\n        y: playerPosition.y + dir.y * gameDeltaTime * 250,\r\n        rotation: playerPosition.rotation * 0.9 + targetRotation * 0.1,\r\n    };\r\n\r\n    const w = gameStyles.viewscreenView.width;\r\n    const gw = gameStyles.sprite.viewSize.width * 0.5;\r\n    const h = gameStyles.viewscreenView.height;\r\n    const gh = gameStyles.sprite.viewSize.height * 0.5;\r\n    pos.x = pos.x < gw ? gw : pos.x > w - gw ? w - gw : pos.x;\r\n    pos.y = pos.y < gh ? gh : pos.y > h - gh ? h - gh : pos.y;\r\n\r\n    return { playerPosition: pos };\r\n};\r\n\r\ntype ProjectilesState = {\r\n    lastShotActualTime: number;\r\n    shots: { key: string, pos: GamePosition, explodeTime?: number, ignore?: boolean, lockedEnemy?: { pos: GamePosition, explodeTime?: number, destoyed?: boolean } }[];\r\n    debris: { key: string, vel: Vector2, pos: GamePosition, kind: SpriteKind, hasHitGround?: boolean }[];\r\n};\r\nconst updateProjectiles = ({ gameTime, gameDeltaTime, pressState, playerPosition: playerPos, enemiesState, projectilesState, gameState, onLoseLife }: CommonGameState): ProjectilesState => {\r\n    const { shots, debris, lastShotActualTime } = projectilesState;\r\n\r\n    const canShoot = !gameState.deadTime && !gameState.gameOverTime && (Date.now() / 1000) > 0.25 + lastShotActualTime;\r\n\r\n    // console.log(`updateProjectiles`, { canShoot, gameTime, lastShotTime });\r\n\r\n    const didShoot = canShoot && pressState.buttons.find(x => x.key === `A`)?.isDown;\r\n    if (didShoot) {\r\n        const lockedEnemy = gameState.weaponsLock?.lockedEnemy;\r\n        shots.push({ key: `${gameTime}${shots.length}`, pos: { ...playerPos }, lockedEnemy });\r\n    }\r\n\r\n    // Move shots\r\n    shots.forEach(x => {\r\n        if (x.explodeTime) { return; }\r\n\r\n        if (x.lockedEnemy && !x.lockedEnemy.explodeTime && !x.lockedEnemy.destoyed) {\r\n            x.pos.y += (x.lockedEnemy.pos.y - x.pos.y) * 0.25;\r\n            x.pos.x += Math.min(250 * gameDeltaTime, (x.lockedEnemy.pos.x - x.pos.x) * 0.5);\r\n        } else {\r\n            x.pos.x += 250 * gameDeltaTime;\r\n        }\r\n    });\r\n\r\n    // Move debris\r\n    debris.forEach(d => {\r\n        if (d.hasHitGround) { return; }\r\n\r\n        // Gravity\r\n        d.vel.y += 100 * gameDeltaTime;\r\n\r\n        d.pos.y += d.vel.y * gameDeltaTime;\r\n        d.pos.x += d.vel.x * gameDeltaTime;\r\n\r\n        const pad = gameStyles.sprite.viewSize.width * 0.5;\r\n        const w = gameStyles.viewscreenView.width;\r\n        if (d.pos.x < pad) { d.pos.x = pad; d.vel.x = -d.vel.x; }\r\n        if (d.pos.x > w - pad) { d.pos.x = w - pad; d.vel.x = -d.vel.x; }\r\n\r\n        const hPad = gameStyles.sprite.viewSize.width * 0.8;\r\n        const h = gameStyles.viewscreenView.height;\r\n        if (d.pos.y > h - hPad + Math.random() * 10) {\r\n            d.hasHitGround = true;\r\n\r\n            if (d.kind === `kitten`) {\r\n                onLoseLife();\r\n            }\r\n        }\r\n\r\n    });\r\n\r\n    // Clean up too much debris\r\n    if (debris.length > 25) {\r\n        debris.shift();\r\n    }\r\n\r\n    const newShots = shots\r\n        // Remove shots offscreen\r\n        .filter(x => x.pos.x < gameStyles.viewscreenView.width)\r\n        // Remove exploded\r\n        .filter(x => !x.explodeTime || gameTime < 1 + x.explodeTime)\r\n        ;\r\n\r\n    return {\r\n        ...projectilesState,\r\n        lastShotActualTime: didShoot ? (Date.now() / 1000) : lastShotActualTime,\r\n        shots: newShots,\r\n    };\r\n};\r\n\r\ntype EnemiesState = {\r\n    enemies: {\r\n        key: string;\r\n        pos: GamePosition;\r\n        vel: Vector2;\r\n        explodeTime?: number;\r\n        answer: AnswerState;\r\n        onHit: () => void;\r\n        destroyed?: boolean;\r\n    }[];\r\n};\r\nconst updateEnemies = ({ gameTime, gameDeltaTime, projectilesState, enemiesState, gameState, playerPosition, onLoseLife }: CommonGameState): EnemiesState => {\r\n    const { enemies } = enemiesState;\r\n    const { shots } = projectilesState;\r\n\r\n    // Detect Collisions\r\n\r\n    // Enemies - Bullets\r\n    const radius = gameStyles.sprite.viewSize.width * 0.75;\r\n    const radiusSq = radius * radius;\r\n\r\n    enemies.forEach(e => shots.forEach(s => {\r\n        // console.log(`Checking!`, { e, s });\r\n\r\n        if (e.explodeTime) { return; }\r\n        if (s.explodeTime || s.ignore) { return; }\r\n\r\n        // Only shoot locked enemy\r\n        if (s.lockedEnemy && s.lockedEnemy !== e) { return; }\r\n\r\n        if (getDistanceSq(e.pos, s.pos) < radiusSq) {\r\n            console.log(`Exploded!`, { e, s });\r\n\r\n            e.explodeTime = gameTime;\r\n            s.explodeTime = gameTime;\r\n\r\n            e.onHit();\r\n\r\n            if (e.answer.isCorrect) {\r\n                projectilesState.debris.push({ key: `${e.key} ${gameTime}`, kind: `alien`, pos: { ...e.pos }, vel: { ...e.vel } });\r\n            } else {\r\n                projectilesState.debris.push({ key: `${e.key} ${gameTime}`, kind: `kitten`, pos: { ...e.pos }, vel: { ...e.vel } });\r\n            }\r\n        }\r\n    }));\r\n\r\n    // Enemies - Enemies (bounce)\r\n    const radiusSq_enemies = radius * radius * 1.5 * 1.5;\r\n    enemies.forEach((e, i) => enemies.forEach((e2, i2) => {\r\n\r\n        if (i >= i2) { return; }\r\n        if (e.explodeTime) { return; }\r\n        if (e2.explodeTime) { return; }\r\n\r\n        if (getDistanceSq(e.pos, e2.pos) < radiusSq_enemies) {\r\n\r\n            // Transfer momentum\r\n            const frictionRatio = 0.95;\r\n            const swap = e.vel.y;\r\n            e.vel.y = e2.vel.y * frictionRatio;\r\n            e2.vel.y = swap * frictionRatio;\r\n            // }\r\n\r\n            // if (getDistanceSq(e.pos, e2.pos) < radiusSq_enemies * 0.8 * 0.8) {\r\n            // Move apart\r\n            const a = e.pos.y < e2.pos.y ? e : e2;\r\n            const b = e.pos.y < e2.pos.y ? e2 : e;\r\n\r\n            a.pos.y -= 10 * gameDeltaTime;\r\n            b.pos.y += 10 * gameDeltaTime;\r\n            a.vel.y -= 10 * gameDeltaTime;\r\n            b.vel.y += 10 * gameDeltaTime;\r\n        }\r\n    }));\r\n\r\n    // Enemies - Player\r\n    const radiusSq_player = radius * radius * 0.8 * 0.8;\r\n    enemies.forEach((e, i) => {\r\n        if (e.explodeTime) { return; }\r\n        if (gameState.deadTime || gameState.gameOverTime) { return; }\r\n\r\n        if (getDistanceSq(e.pos, playerPosition) < radiusSq_player) {\r\n            onLoseLife();\r\n\r\n            // e.explodeTime = gameTime;\r\n            // e.onHit();\r\n\r\n            return;\r\n        }\r\n    });\r\n\r\n    // Enemies move\r\n    enemies.forEach(e => {\r\n        if (e.explodeTime) { return; }\r\n\r\n        e.vel.y += (-1 + 2 * Math.random()) * 250 * gameDeltaTime;\r\n        // e.vel.x += -3 * gameDeltaTime;\r\n\r\n        if (!gameState.deadTime && !gameState.gameOverTime) {\r\n            e.vel.x = -25;\r\n        } else {\r\n            e.vel.x = 0;\r\n        }\r\n\r\n        // Move away from ground\r\n        if (e.pos.y > gameStyles.viewscreenView.height * 0.7) {\r\n            // e.vel.y += -100 * gameDeltaTime;\r\n            e.vel.y = -5;\r\n        }\r\n\r\n        // Keep on screen\r\n        if (e.pos.x > gameStyles.viewscreenView.width - gameStyles.sprite.viewSize.width * 2) {\r\n            e.pos.x = gameStyles.viewscreenView.width - gameStyles.sprite.viewSize.width * 2;\r\n        }\r\n\r\n        e.pos.x += e.vel.x * gameDeltaTime;\r\n        e.pos.y += e.vel.y * gameDeltaTime;\r\n\r\n        const pad = gameStyles.sprite.viewSize.height * 0.5;\r\n        const h = gameStyles.viewscreenView.height;\r\n        if (e.pos.y < pad) { e.pos.y = pad; e.vel.y = 5; }\r\n        if (e.pos.y > h - pad) { e.pos.y = h - pad; e.vel.y = -e.vel.y; }\r\n\r\n        const wPad = gameStyles.sprite.viewSize.width * 0.5;\r\n        if (e.pos.x < wPad) {\r\n            e.pos.x = wPad;\r\n        }\r\n\r\n        // // Attack player\r\n        // if (e.pos.x < playerPosition.x) {\r\n        //     e.pos.y = playerPosition.y;\r\n        //     // e.vel.y = (playerPosition.y - e.pos.y) * 5;\r\n        // }\r\n    });\r\n\r\n    // Closest Enemy\r\n    const closestEnemyToPlayer = enemiesState.enemies.filter(x => !x.explodeTime && !x.destroyed)\r\n        .sort((a, b) => Math.abs(a.pos.y - playerPosition.y) < Math.abs(b.pos.y - playerPosition.y) ? -1 : 1)[0];\r\n\r\n    const updateWeaponsLock = (enemy: typeof enemiesState.enemies[0]) => {\r\n        // Only update on player movement\r\n        if (gameState.weaponsLock?.lockedAtPlayerPosition.y === playerPosition.y) {\r\n            return;\r\n        }\r\n\r\n        gameState.weaponsLock = {\r\n            lockedAtPlayerPosition: playerPosition,\r\n            lockedEnemy: enemy,\r\n        };\r\n    };\r\n\r\n    // Attack Player\r\n    if (closestEnemyToPlayer?.pos.x < playerPosition.x + gameStyles.sprite.viewSize.width * 0.5) {\r\n        closestEnemyToPlayer.pos.y = playerPosition.y;\r\n    } else {\r\n        // Lock on Enemy\r\n        updateWeaponsLock(closestEnemyToPlayer);\r\n    }\r\n\r\n    // Cleanup\r\n    const newEnemies = enemies;\r\n    newEnemies.filter(x => x.explodeTime && gameTime > 1 + x.explodeTime).forEach(x => {\r\n        x.destroyed = true;\r\n\r\n    });\r\n    // // Remove exploded\r\n    // .filter(x => !x.explodeTime || gameTime < 1 + x.explodeTime)\r\n    // ;\r\n\r\n    return {\r\n        enemies: newEnemies,\r\n    };\r\n};\r\n\r\ntype SpriteKind = 'text' | 'player' | 'player-character' | 'player-character-splat' | 'shot' | 'shot-explode' | 'lock' | 'enemy' | 'enemy-explode' | 'answer-wrong' | 'alien' | 'kitten' | 'alien-splat' | 'kitten-splat' | 'super-kitten' | 'life';\r\nconst getSpriteEmoji = (kind: SpriteKind) => {\r\n    // \r\n    // \r\n    // \r\n    // \r\n    // \r\n    switch (kind) {\r\n        case `player`: return { text: ``, rotation: +0.125, offsetX: 0, offsetY: -0.25 };\r\n        case `player-character`: return { text: `` };\r\n        case `player-character-splat`: return { text: ``, rotation: 0.15 };\r\n        case `shot`: return { text: ``, rotation: -0.25 };\r\n        case `shot-explode`: return { text: ``, rotation: 0, scale: 0.5 };\r\n        case `lock`: return { text: ``, offsetX: -0.25, offsetY: -0.125, scale: 1.5 };\r\n        case `enemy`: return { text: ``, offsetX: -0.125, offsetY: -0.125 };\r\n        case `enemy-explode`: return { text: ``, offsetX: -0.125, offsetY: -0.125 };\r\n        case `answer-wrong`: return { text: ``, offsetX: -0.125, offsetY: -0.125 };\r\n        case `alien`: return { text: ``, offsetX: 0, offsetY: 0 };\r\n        // case `kitten`: return { text: ``, offsetX: 0, offsetY: 0 };\r\n        case `kitten`: return { text: ``, offsetX: 0, offsetY: 0 };\r\n        case `alien-splat`: return { text: ``, offsetX: 0, offsetY: 0 };\r\n        case `kitten-splat`: return { text: ``, offsetX: 0, offsetY: 0 };\r\n        case `super-kitten`: return { text: ``, offsetX: 0, offsetY: 0 };\r\n        // case `kitten-splat`: return { text: ``, offsetX: 0, offsetY: 0 };\r\n        case `life`: return { text: ``, scale: 0.5 };\r\n        case `text`: return { text: ``, offsetX: 0, offsetY: -0.125 };\r\n        default: return { text: `` };\r\n    }\r\n};\r\n\r\nconst Sprite = ({ kind, position, text }: { kind: SpriteKind, position: { x: number, y: number, rotation: number }, text?: string }) => {\r\n    const s = getSpriteEmoji(kind);\r\n    const size = gameStyles.sprite.viewSize;\r\n    const { fontSize } = gameStyles.sprite.text;\r\n\r\n    const stylePosition = {\r\n        position: `absolute`,\r\n        ...size,\r\n        transform: `translate(${position.x}px, ${position.y}px) rotate(${position.rotation ?? 0}turn)`,\r\n        // backgroundColor: `red`,\r\n        pointerEvents: `none`,\r\n    } as const;\r\n    const styleRotation = {\r\n        ...size,\r\n        transform: `translate( ${size.width * -0.5 + Math.floor((s.offsetX ?? 0) * fontSize)}px, ${size.height * -0.5 + Math.floor((s.offsetY ?? 0) * fontSize)}px) rotate(${s.rotation ?? 0}turn) scale(${s.scale ?? 1})`,\r\n    };\r\n    return (\r\n        <View style={stylePosition}>\r\n            <View style={styleRotation}>\r\n                <Text style={gameStyles.sprite.text}>{text ?? s.text}</Text>\r\n            </View>\r\n        </View>\r\n    );\r\n};\r\n\r\nconst TextPositioned = ({ text, position }: { text: string, position: { x: number, y: number, rotation: number } }) => {\r\n    const s = gameStyles.answer.text;\r\n    const fontSize = text.length > 10 ? s.fontSize_small : s.fontSize;\r\n\r\n    const offsetY = -fontSize * 0.5 - 4;\r\n\r\n    const stylePosition = {\r\n        position: `absolute`,\r\n        transform: `translate(${position.x}px, ${position.y + offsetY}px) rotate(${position.rotation ?? 0}turn)`,\r\n        pointerEvents: `none`,\r\n        maxWidth: gameStyles.viewscreenView.width * 0.5,\r\n        // backgroundColor: `red`,\r\n    } as const;\r\n\r\n    return (\r\n        <View style={stylePosition}>\r\n            <Text style={{ ...gameStyles.answer.text, fontSize }}>{text}</Text>\r\n        </View>\r\n    );\r\n};\r\n","import { shuffle, distinct } from 'utils/arrays';\r\nimport { ProblemService, ProblemResult, ProblemAnswer } from './problems-service';\r\n\r\nexport const createMultiplesProblemService = ({\r\n    min = 1,\r\n    max = 12,\r\n    maxAnswers = 4,\r\n}: {\r\n    min?: number;\r\n    max?: number;\r\n    maxAnswers?: number;\r\n}): ProblemService => {\r\n\r\n    let state = {\r\n        n: min - 1,\r\n        m: min,\r\n        completedSectionKeys: [] as string[],\r\n    };\r\n    const getSectionKey = (m: number) => {\r\n        return `${m}`;\r\n    };\r\n    const getSectionName = (m: number) => {\r\n        return `Multiples of ${m}`;\r\n    };\r\n\r\n    const problemService: ProblemService = {\r\n        load: async (storage) => {\r\n            const loaded = await storage.load<typeof state>();\r\n            if (loaded) {\r\n                state = loaded;\r\n            }\r\n        },\r\n        save: async (storage) => {\r\n            await storage.save(state);\r\n        },\r\n        getSections: () => [...new Array(max - min + 1)].map((x, i) => ({\r\n            key: getSectionKey(i + min),\r\n            name: getSectionName(i + min),\r\n            isComplete: state.completedSectionKeys.includes(getSectionKey(i + min)),\r\n        })),\r\n        gotoSection: ({ key }) => {\r\n            const bVal = Number.parseInt(key, 10);\r\n            state.m = bVal;\r\n            state.n = min - 1;\r\n        },\r\n        getNextProblem: (): ProblemResult => {\r\n            state.n++;\r\n            if (state.n > max) {\r\n                state.n = min;\r\n                state.m++;\r\n                if (state.m > max) {\r\n                    // Loop\r\n                    state.n = min;\r\n                    state.m = min;\r\n                    // return { done: true, key: `done` };\r\n                }\r\n            }\r\n\r\n            const { n, m } = state;\r\n            const correctValue = n * m;\r\n            const wrongAnswerCount = maxAnswers - 1;\r\n            const wrongValues =\r\n                distinct(\r\n                    [...new Array(100)].map(() =>\r\n                        Math.round(n + 1 - 2 * Math.random())\r\n                        * Math.round(m + 1 - 2 * Math.random())\r\n                        + Math.round(2 - 4 * Math.random()))\r\n                        .filter(x => x !== correctValue)\r\n                        .filter(x => x > 0),\r\n                ).slice(0, wrongAnswerCount);\r\n\r\n            const answers: ProblemAnswer[] = shuffle([...wrongValues.map(x => ({ value: `${x}`, isCorrect: false })), { value: `${correctValue}`, isCorrect: true }]).map(x => ({ ...x, key: x.value }));\r\n\r\n            return {\r\n                key: `${m} x ${n}`,\r\n                question: `${m} x ${n}`,\r\n                answers,\r\n                sectionKey: getSectionKey(m),\r\n                isLastOfSection: n === max,\r\n                isLastOfSubject: n === max && m === max,\r\n            };\r\n        },\r\n        recordAnswer: (problem, answer) => {\r\n            if (answer.isCorrect && problem.isLastOfSection) {\r\n                state.completedSectionKeys.push(problem.sectionKey);\r\n            }\r\n        },\r\n    };\r\n\r\n    return problemService;\r\n};\r\n","/* eslint-disable react/no-array-index-key */\r\nimport React, { useEffect, useState } from 'react';\r\nimport { View, Text, TouchableOpacity } from 'react-native-lite';\r\nimport { shuffle } from 'utils/arrays';\r\n\r\nconst englishKeyboard = {\r\n    rows: [\r\n        { keys: `qwertyuiop`.split(``) },\r\n        { keys: ` asdfghjkl`.split(``) },\r\n        { keys: `  zxcvbnm `.split(``) },\r\n    ],\r\n};\r\n\r\nconst styles = {\r\n    container: {},\r\n    rowView: { flex: 1, flexDirection: `row` },\r\n    keyView: {\r\n        margin: 2,\r\n        padding: 2,\r\n        // width: 20,\r\n        flex: 1,\r\n        height: 20,\r\n        backgroundColor: `#111111`,\r\n        justifyContent: `center`,\r\n        alignItems: `center`,\r\n    },\r\n    keyView_disabled: { opacity: 0.5 },\r\n    keyText: {\r\n        fontSize: 16,\r\n    },\r\n    keyText_wrong: {\r\n        fontSize: 16,\r\n        color: `#FF0000`,\r\n    },\r\n} as const;\r\n\r\nexport const KeyboardSimplified = ({ expectedCharacter, showHints, onExpectedKeyPress }: { expectedCharacter: string, showHints: boolean, onExpectedKeyPress: () => void }) => {\r\n    const keyboard = englishKeyboard;\r\n\r\n    const [hintKeys, setHintKeys] = useState(null as null | string[]);\r\n    const [wrongKeys, setWrongKeys] = useState([] as string[]);\r\n    useEffect(() => {\r\n        if (!showHints) { setHintKeys(null); }\r\n\r\n        const hints = [expectedCharacter, ...shuffle(keyboard.rows.flatMap(x => x.keys).map(x => x.trim()).filter(x => x)).slice(0, 3)];\r\n        setHintKeys(hints);\r\n        setWrongKeys([]);\r\n    }, [expectedCharacter, showHints]);\r\n\r\n    const onKeyPress = (key: string) => {\r\n        if (key === expectedCharacter) {\r\n            onExpectedKeyPress();\r\n            return;\r\n        }\r\n        // Remove from choices\r\n        if (showHints) {\r\n            setHintKeys(s => (s ?? []).filter(x => x !== key));\r\n            setWrongKeys(s => [...s, key]);\r\n        }\r\n    };\r\n\r\n    return (\r\n        <>\r\n            <View style={styles.container}>\r\n                {keyboard.rows.map((row, iRow) => (\r\n                    <View style={styles.rowView} key={`${iRow}`} >\r\n                        {row.keys.map((k, i) => (\r\n                            <TouchableOpacity key={`${k}${i}`} style={{ outline: `none` }} onPress={() => onKeyPress(k)}>\r\n                                <View style={!hintKeys || hintKeys.includes(k) ? {} : styles.keyView_disabled} >\r\n                                    <View style={styles.keyView}>\r\n                                        <Text style={wrongKeys.includes(k) ? styles.keyText_wrong : styles.keyText}>{k}</Text>\r\n                                    </View>\r\n                                </View>\r\n                            </TouchableOpacity>\r\n                        ))}\r\n                    </View>\r\n                ))}\r\n            </View>\r\n        </>\r\n    );\r\n};\r\n","import React, { useState, useEffect } from 'react';\r\nimport { View, Text, TouchableOpacity } from 'react-native-lite';\r\nimport { DoodleDrawing, defaultDoodleDrawing, DoodleData } from './doodle';\r\nimport { DoodleDrawerView, DoodleDisplayView } from './doodle-view';\r\nimport { KeyboardSimplified } from './keyboard-simplified';\r\n\r\nexport const styles = {\r\n    container: {\r\n        alignItems: `center`,\r\n    },\r\n    drawing: {\r\n        width: 312,\r\n        height: 312,\r\n        color: `#FFFFFF`,\r\n        backgroundColor: `#000000`,\r\n    },\r\n    drawingChoicesView: {\r\n        maxWidth: 312 + 4 * 4 + 4,\r\n        flexDirection: `row`,\r\n        flexWrap: `wrap`,\r\n    },\r\n    drawingChoiceWrapper: {\r\n        padding: 4,\r\n    },\r\n    drawingChoice: {\r\n        width: 78,\r\n        height: 78,\r\n        color: `#FFFFFF`,\r\n        backgroundColor: `#000000`,\r\n    },\r\n    titleView: {\r\n        justifyContent: `center`,\r\n        alignItems: `center`,\r\n    },\r\n    titleText: {\r\n        fontSize: 20,\r\n        color: `#FFFFFF`,\r\n    },\r\n    promptView: {\r\n        justifyContent: `center`,\r\n        alignItems: `center`,\r\n    },\r\n    promptText: {\r\n        fontSize: 20,\r\n        color: `#FFFF00`,\r\n    },\r\n    hintText: {\r\n        fontSize: 14,\r\n        color: `#FFFF00`,\r\n    },\r\n    buttonRowView: {\r\n        flexDirection: `row`,\r\n    },\r\n    buttonView: {\r\n        margin: 4,\r\n        padding: 8,\r\n        backgroundColor: `#111111`,\r\n    },\r\n    buttonText: {\r\n        fontSize: 20,\r\n        color: `#FFFF00`,\r\n    },\r\n} as const;\r\n\r\nexport const DoodleGameView_DrawWord = (props: { prompt: string, hint?: string, onDone: (drawing: DoodleDrawing) => void, onSkip?: () => void }) => {\r\n    const [drawing, setDrawing] = useState(defaultDoodleDrawing());\r\n    const changeDoodle = (value: DoodleDrawing) => {\r\n        setDrawing(value);\r\n    };\r\n\r\n    const done = () => {\r\n        props.onDone(drawing);\r\n    };\r\n    const skip = () => {\r\n        props.onSkip?.();\r\n    };\r\n\r\n    useEffect(() => {\r\n        // Reset problem when prompt changes\r\n        setDrawing(defaultDoodleDrawing());\r\n    }, [props.prompt]);\r\n\r\n    return (\r\n        <View style={styles.container}>\r\n            <View style={styles.titleView}>\r\n                <Text style={styles.titleText}>Draw</Text>\r\n            </View>\r\n            <DoodleDrawerView style={styles.drawing} drawing={drawing} onChange={changeDoodle} />\r\n            <View style={styles.promptView}>\r\n                <Text style={styles.promptText}>{props.prompt}</Text>\r\n                {!!props.hint && (<Text style={styles.hintText}>{props.hint}</Text>)}\r\n            </View>\r\n            <View style={styles.buttonRowView}>\r\n                {!!props.onSkip && (\r\n                    <TouchableOpacity onPress={skip}>\r\n                        <View style={styles.buttonView}>\r\n                            <Text style={styles.buttonText}>Skip</Text>\r\n                        </View>\r\n                    </TouchableOpacity>\r\n                )}\r\n                <TouchableOpacity onPress={done}>\r\n                    <View style={styles.buttonView}>\r\n                        <Text style={styles.buttonText}>Done</Text>\r\n                    </View>\r\n                </TouchableOpacity>\r\n            </View>\r\n        </View>\r\n    );\r\n};\r\n\r\nexport const DoodleGameView_ChooseBest = (props: { prompt: string, drawings: DoodleData[], onChooseBest: (drawing: DoodleData) => void }) => {\r\n    return (\r\n        <View style={styles.container}>\r\n            <View style={styles.titleView}>\r\n                <Text style={styles.titleText}>Choose Best</Text>\r\n            </View>\r\n            <View style={styles.promptView}>\r\n                <Text style={styles.promptText}>{props.prompt}</Text>\r\n            </View>\r\n            <View style={styles.drawingChoicesView} >\r\n                {props.drawings.map(x => (\r\n                    <TouchableOpacity key={x.key} onPress={() => props.onChooseBest(x)}>\r\n                        <View style={styles.drawingChoiceWrapper} >\r\n                            <DoodleDisplayView style={styles.drawingChoice} drawing={x.drawing} />\r\n                        </View>\r\n                    </TouchableOpacity>\r\n                ))}\r\n            </View>\r\n        </View>\r\n    );\r\n};\r\n\r\nconst typeStyles = {\r\n    completedText: {\r\n        fontSize: 16,\r\n        color: `#FFFF00`,\r\n    },\r\n} as const;\r\nexport const DoodleGameView_TypeExpected = (props: { prompt: string, drawings: DoodleData[], onDone: () => void, sayAgain: () => void }) => {\r\n\r\n    const [status, setStatus] = useState({ completed: ``, remaining: props.prompt });\r\n    useEffect(() => {\r\n        setStatus({ completed: ``, remaining: props.prompt });\r\n    }, [props.prompt, props.drawings]);\r\n\r\n    const onExpectedKeyPress = () => {\r\n        setStatus(s => {\r\n            if (s.remaining.length <= 1) {\r\n                props.onDone();\r\n            }\r\n            const nextChar = s.remaining[0];\r\n            return {\r\n                completed: s.completed + nextChar,\r\n                remaining: s.remaining.substr(1),\r\n            };\r\n        });\r\n    };\r\n\r\n    return (\r\n        <View style={styles.container}>\r\n            <View style={styles.titleView}>\r\n                <Text style={styles.titleText}>Type Word</Text>\r\n            </View>\r\n            <View style={styles.drawingChoicesView} >\r\n                {props.drawings.map(x => (\r\n                    <View key={x.key} style={styles.drawingChoiceWrapper} >\r\n                        <DoodleDisplayView style={styles.drawingChoice} drawing={x.drawing} />\r\n                    </View>\r\n                ))}\r\n            </View>\r\n            <TouchableOpacity onPress={props.sayAgain}>\r\n                <View style={styles.buttonView}>\r\n                    <Text style={styles.buttonText}>Say Again</Text>\r\n                </View>\r\n            </TouchableOpacity>\r\n            <View>\r\n                <Text style={typeStyles.completedText}>{`${status.completed}${status.remaining.length > 0 ? `_` : ``}`}</Text>\r\n            </View>\r\n            <KeyboardSimplified expectedCharacter={status.remaining[0] ?? ` `} showHints onExpectedKeyPress={onExpectedKeyPress} />\r\n        </View>\r\n    );\r\n};\r\n","import React, { useState } from 'react';\r\nimport { View, Text, TouchableOpacity, TextInput } from 'react-native-lite';\r\n\r\n\r\nexport const createLeaderboard = <TScoreState extends {}>(args: {\r\n    storageKey: string;\r\n    sortKey: (item: TScoreState) => string | number;\r\n    sortDescending?: boolean;\r\n    scoreColumns: { name: string, getValue: (item: TScoreState) => string }[];\r\n}) => {\r\n\r\n    type LeaderboardScore = { name: string, score: TScoreState };\r\n    const leaderboard = {\r\n        saveScore: (name: string, score: TScoreState) => {\r\n            const data = leaderboard.loadScore();\r\n\r\n            data.push({ name, score });\r\n            data.sort((a, b) => args.sortKey(a.score) < args.sortKey(b.score) ? -1 : 1);\r\n\r\n            localStorage.setItem(args.storageKey, JSON.stringify(data));\r\n        },\r\n        loadScore: () => {\r\n            const json = localStorage.getItem(args.storageKey);\r\n            if (!json) { return []; }\r\n\r\n            const data = JSON.parse(json) as LeaderboardScore[];\r\n            data.sort((a, b) => (args.sortKey(a.score) > args.sortKey(b.score) ? -1 : 1) * (args.sortDescending ? -1 : 1));\r\n            return data;\r\n        },\r\n    };\r\n\r\n    const leaderboardInputStyles = {\r\n        container: {\r\n            flex: 1,\r\n            alignItems: `center`,\r\n            margin: 16,\r\n        },\r\n        textInput: {\r\n            fontFamily: `\"Lucida Console\", Monaco, monospace`,\r\n            fontSize: 16,\r\n            color: `#0000FF`,\r\n        },\r\n        buttonView: {\r\n            margin: 4,\r\n            padding: 4,\r\n            borderColor: `#FFFF00`,\r\n            borderStyle: `solid`,\r\n            borderWidth: 1,\r\n            borderRadius: 4,\r\n        },\r\n        buttonText: {\r\n            fontFamily: `\"Lucida Console\", Monaco, monospace`,\r\n            fontSize: 16,\r\n            color: `#FFFF00`,\r\n        },\r\n    } as const;\r\n\r\n    const LeaderboardNameInput = (props: { onSubmit: (value: string) => void }) => {\r\n        const [name, setName] = useState(``);\r\n        return (\r\n            <View style={leaderboardInputStyles.container}>\r\n                <TextInput style={leaderboardInputStyles.textInput} value={name} onChange={setName} placeholder='Name' keyboardType='default' autoCompleteType='off' />\r\n                <TouchableOpacity onPress={() => !!name && props.onSubmit(name)} style={!name ? { opacity: 0.5 } : {}}>\r\n                    <View style={leaderboardInputStyles.buttonView}>\r\n                        <Text style={leaderboardInputStyles.buttonText}>Save Score</Text>\r\n                    </View>\r\n                </TouchableOpacity>\r\n            </View >\r\n        );\r\n    };\r\n\r\n    const leaderboardStyles = {\r\n        container: {\r\n            marginTop: 16,\r\n            borderColor: `#FFFFFF`,\r\n            borderStyle: `solid`,\r\n            borderWidth: 1,\r\n            borderRadius: 0,\r\n        },\r\n        scoreView: {\r\n            flexDirection: `row`,\r\n            justifyContent: `space-around`,\r\n            padding: 4,\r\n            borderColor: `#FFFFFF`,\r\n            borderStyle: `solid`,\r\n            borderWidth: 1,\r\n            borderRadius: 0,\r\n        },\r\n        nameText: {\r\n            flex: 2,\r\n            fontFamily: `\"Lucida Console\", Monaco, monospace`,\r\n            fontSize: 12,\r\n            color: `#FFFFFF`,\r\n            overflow: `hidden`,\r\n        },\r\n        scoreText: {\r\n            flex: 1,\r\n            textAlign: `right`,\r\n            fontFamily: `\"Lucida Console\", Monaco, monospace`,\r\n            fontSize: 12,\r\n            color: `#FFFF00`,\r\n        },\r\n    } as const;\r\n\r\n    const LeaderboardViewInner = (props: { scores: LeaderboardScore[] }) => {\r\n\r\n        return (\r\n            <View style={leaderboardStyles.container}>\r\n                <View style={leaderboardStyles.scoreView}>\r\n                    <Text style={leaderboardStyles.nameText}>Leaderboard</Text>\r\n                    {args.scoreColumns.map(x => (\r\n                        <Text key={x.name} style={leaderboardStyles.scoreText} />\r\n                    ))}\r\n                </View>\r\n                <View style={leaderboardStyles.scoreView}>\r\n                    <Text style={leaderboardStyles.nameText}>Name</Text>\r\n                    {args.scoreColumns.map(x => (\r\n                        <Text key={x.name} style={leaderboardStyles.scoreText} >{x.name}</Text>\r\n                    ))}\r\n                </View>\r\n                {props.scores.map(x => (\r\n                    <View style={leaderboardStyles.scoreView}>\r\n                        <Text style={leaderboardStyles.nameText}>{x.name}</Text>\r\n                        {args.scoreColumns.map(c => (\r\n                            <Text key={x.name} style={leaderboardStyles.scoreText} >{c.getValue(x.score)}</Text>\r\n                        ))}\r\n                    </View>\r\n                ))}\r\n            </View>\r\n        );\r\n    };\r\n\r\n    const useLeaderboard = ({\r\n        getScore,\r\n    }: {\r\n        getScore: () => TScoreState;\r\n    }) => {\r\n\r\n        const [leaderboardScores, setLeaderboardScores] = useState({ scores: leaderboard.loadScore() } as { scores: LeaderboardScore[] });\r\n\r\n        const LeaderboardArea = (props: { gameOver: boolean, onScoreSaved: () => void }) => {\r\n\r\n            const onSaveScore = (name: string) => {\r\n                leaderboard.saveScore(name, getScore());\r\n                setLeaderboardScores({ scores: leaderboard.loadScore() });\r\n                props.onScoreSaved();\r\n            };\r\n\r\n            return (\r\n                <>\r\n                    {!!props.gameOver && (<LeaderboardNameInput onSubmit={onSaveScore} />)}\r\n                    <LeaderboardViewInner scores={leaderboardScores.scores} />\r\n                </>\r\n            );\r\n        };\r\n\r\n        return {\r\n            LeaderboardArea,\r\n        };\r\n    };\r\n\r\n\r\n    return {\r\n        useLeaderboard,\r\n    };\r\n};\r\n","export const userProfileChracters = `\r\n                       \r\n`.split(` `).map(x => x.trim()).filter(x => x);\r\n","import React, { useRef, useState, useEffect } from 'react';\r\nimport { View, Text, TouchableOpacity } from 'react-native-lite';\r\nimport { useAutoLoadingError } from 'utils-react/hooks';\r\nimport { C } from 'controls-react';\r\nimport { Icon } from 'controls-react/icon';\r\nimport { IconKind } from 'controls-react/icon-kind';\r\nimport { UserDataService, UserProfileInfo } from './user-data-service';\r\nimport { userProfileChracters } from './user-profile-emojis';\r\n\r\n\r\nexport const UserProfileManagerView = (props: { onClose?: () => void }) => {\r\n\r\n    const { loading, error, doWork } = useAutoLoadingError();\r\n    const [userProfiles, setUserProfiles] = useState(null as null | UserProfileInfo[]);\r\n\r\n    const reload = () => doWork(async (stopIfObsolete) => {\r\n        await UserDataService.get().setup();\r\n        stopIfObsolete();\r\n\r\n        const profiles = await UserDataService.get().getUserProfiles();\r\n        setUserProfiles(profiles);\r\n    });\r\n\r\n    useEffect(() => {\r\n        reload();\r\n    }, []);\r\n\r\n    return (\r\n        <C.View_Panel>\r\n            <C.Text_FormTitle >Users</C.Text_FormTitle>\r\n            <C.LoadingInline loading={loading} />\r\n            <C.ErrorBox error={error} />\r\n            {userProfiles?.map(x => (\r\n                <UserProfileView key={x.key} userProfile={x} onActiveUserChange={reload} onUserProfileChange={reload} />\r\n            ))}\r\n            <C.Text_FormTitle >Add User</C.Text_FormTitle>\r\n            <AddUserProfileView onUserAdded={reload} />\r\n            {!!props.onClose && (\r\n                <C.View_FormActionRow>\r\n                    <C.Button_FormAction onPress={() => props.onClose?.()}>Done</C.Button_FormAction>\r\n                </C.View_FormActionRow>\r\n            )}\r\n        </C.View_Panel>\r\n    );\r\n};\r\n\r\nconst AddUserProfileView = (props: { onUserAdded: () => void }) => {\r\n    const { loading, error, doWork } = useAutoLoadingError();\r\n    const [shareCode, setShareCode] = useState(null as null | string);\r\n    const addShareCode = () => {\r\n        if (!shareCode) { return; }\r\n\r\n        doWork(async (stopIfObsolete) => {\r\n            await UserDataService.get().addUserFromShareCode(shareCode);\r\n            stopIfObsolete();\r\n            props.onUserAdded();\r\n            setShareCode(null);\r\n        });\r\n    };\r\n\r\n    return (\r\n        <>\r\n            <C.View_Form>\r\n                <C.View_FieldRow>\r\n                    <C.LoadingInline loading={loading} />\r\n                    <C.Input_Text value={shareCode ?? ``} onChange={setShareCode} placeholder='Enter Share Code' />\r\n                    <C.Button_FieldInline onPress={addShareCode}>Add User</C.Button_FieldInline>\r\n                </C.View_FieldRow>\r\n                <C.ErrorBox error={error} />\r\n            </C.View_Form>\r\n        </>\r\n    );\r\n};\r\n\r\n\r\nconst UserProfileView = ({ userProfile, onActiveUserChange, onUserProfileChange }: { userProfile: UserProfileInfo, onActiveUserChange: () => void, onUserProfileChange: () => void }) => {\r\n    const { loading, error, doWork } = useAutoLoadingError();\r\n    const [shareCode, setShareCode] = useState(null as null | string);\r\n    const [characters, setCharacters] = useState(null as null | string[]);\r\n\r\n    const createShareCode = () => doWork(async (stopIfObsolete) => {\r\n        const result = await UserDataService.get().createShareCode(userProfile.key);\r\n        stopIfObsolete();\r\n        setShareCode(result.shareCode);\r\n    });\r\n    const makeActive = () => doWork(async (stopIfObsolete) => {\r\n        await UserDataService.get().setActiveUser(userProfile.key);\r\n        stopIfObsolete();\r\n        onActiveUserChange();\r\n    });\r\n\r\n    const showCharacterSelection = () => {\r\n        setCharacters(userProfileChracters);\r\n    };\r\n    const selectCharacter = (character: string) => doWork(async (stopIfObsolete) => {\r\n        await UserDataService.get().setUserProfileInfo(userProfile.key, { emoji: character });\r\n\r\n        setCharacters(null);\r\n        onUserProfileChange();\r\n    });\r\n\r\n    if (characters) {\r\n        return (\r\n            <>\r\n                <C.View_Form>\r\n                    <View style={{ flexDirection: `row`, flexWrap: `wrap` }}>\r\n                        {characters.map(x => (\r\n                            <TouchableOpacity key={x} onPress={() => selectCharacter(x)} >\r\n                                <View>\r\n                                    <Text style={{ fontSize: 32 }} >{x}</Text>\r\n                                </View>\r\n                            </TouchableOpacity>\r\n                        ))}\r\n                    </View>\r\n                </C.View_Form>\r\n            </>\r\n        );\r\n    }\r\n\r\n    return (\r\n        <>\r\n            <C.View_Form>\r\n                <C.View_FieldRow>\r\n                    <C.LoadingInline loading={loading} />\r\n                    <TouchableOpacity onPress={makeActive}>\r\n                        <Icon style={{ size: 32 }} kind={userProfile.isActive ? IconKind.checkChecked : IconKind.checkUnchecked} />\r\n                    </TouchableOpacity>\r\n                    <TouchableOpacity onPress={showCharacterSelection} >\r\n                        <View>\r\n                            <Text style={{ fontSize: 32 }} >{userProfile.emoji}</Text>\r\n                        </View>\r\n                    </TouchableOpacity>\r\n                    <UserProfileName userProfile={userProfile} onNameChange={onUserProfileChange} />\r\n                    {!!shareCode && (\r\n                        <C.Text_FieldLabel>{shareCode}</C.Text_FieldLabel>\r\n                    )}\r\n                    {!shareCode && (\r\n                        <C.Button_FieldInline onPress={createShareCode}>Create Share Code</C.Button_FieldInline>\r\n                    )}\r\n                </C.View_FieldRow>\r\n                <C.ErrorBox error={error} />\r\n            </C.View_Form>\r\n        </>\r\n    );\r\n};\r\n\r\n\r\nexport const UserProfileName = ({ userProfile, onNameChange }: { userProfile: UserProfileInfo, onNameChange: () => void }) => {\r\n    const { loading, error, doWork } = useAutoLoadingError();\r\n    const [name, setName] = useState(userProfile.name);\r\n    const [isEditingName, setIsEditingName] = useState(false);\r\n\r\n    const changeName = () => doWork(async (stopIfObsolete) => {\r\n        console.log(`UserProfileName changeName`, { name });\r\n\r\n        await UserDataService.get().setUserProfileInfo(userProfile.key, { name });\r\n\r\n        setIsEditingName(false);\r\n        onNameChange();\r\n    });\r\n\r\n    return (\r\n        <>\r\n            {!isEditingName && (\r\n                <TouchableOpacity onPress={() => setIsEditingName(true)} >\r\n                    <C.Text_FieldLabel>{userProfile.name}</C.Text_FieldLabel>\r\n                </TouchableOpacity>\r\n            )}\r\n            {isEditingName && (\r\n                <>\r\n                    <C.Input_Text value={name} onChange={setName} onSubmit={changeName} />\r\n                    <C.Button_FieldInline onPress={changeName}>Change</C.Button_FieldInline>\r\n                </>\r\n            )}\r\n        </>\r\n    );\r\n};\r\n","export default function _getPrototypeOf(o) {\n  _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf : function _getPrototypeOf(o) {\n    return o.__proto__ || Object.getPrototypeOf(o);\n  };\n  return _getPrototypeOf(o);\n}","export default function _setPrototypeOf(o, p) {\n  _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) {\n    o.__proto__ = p;\n    return o;\n  };\n\n  return _setPrototypeOf(o, p);\n}","export default function _isNativeReflectConstruct() {\n  if (typeof Reflect === \"undefined\" || !Reflect.construct) return false;\n  if (Reflect.construct.sham) return false;\n  if (typeof Proxy === \"function\") return true;\n\n  try {\n    Date.prototype.toString.call(Reflect.construct(Date, [], function () {}));\n    return true;\n  } catch (e) {\n    return false;\n  }\n}","import setPrototypeOf from \"./setPrototypeOf\";\nimport isNativeReflectConstruct from \"./isNativeReflectConstruct\";\nexport default function _construct(Parent, args, Class) {\n  if (isNativeReflectConstruct()) {\n    _construct = Reflect.construct;\n  } else {\n    _construct = function _construct(Parent, args, Class) {\n      var a = [null];\n      a.push.apply(a, args);\n      var Constructor = Function.bind.apply(Parent, a);\n      var instance = new Constructor();\n      if (Class) setPrototypeOf(instance, Class.prototype);\n      return instance;\n    };\n  }\n\n  return _construct.apply(null, arguments);\n}","import getPrototypeOf from \"./getPrototypeOf\";\nimport setPrototypeOf from \"./setPrototypeOf\";\nimport isNativeFunction from \"./isNativeFunction\";\nimport construct from \"./construct\";\nexport default function _wrapNativeSuper(Class) {\n  var _cache = typeof Map === \"function\" ? new Map() : undefined;\n\n  _wrapNativeSuper = function _wrapNativeSuper(Class) {\n    if (Class === null || !isNativeFunction(Class)) return Class;\n\n    if (typeof Class !== \"function\") {\n      throw new TypeError(\"Super expression must either be null or a function\");\n    }\n\n    if (typeof _cache !== \"undefined\") {\n      if (_cache.has(Class)) return _cache.get(Class);\n\n      _cache.set(Class, Wrapper);\n    }\n\n    function Wrapper() {\n      return construct(Class, arguments, getPrototypeOf(this).constructor);\n    }\n\n    Wrapper.prototype = Object.create(Class.prototype, {\n      constructor: {\n        value: Wrapper,\n        enumerable: false,\n        writable: true,\n        configurable: true\n      }\n    });\n    return setPrototypeOf(Wrapper, Class);\n  };\n\n  return _wrapNativeSuper(Class);\n}","export default function _isNativeFunction(fn) {\n  return Function.toString.call(fn).indexOf(\"[native code]\") !== -1;\n}","import { ApiError } from './error';\r\n\r\nexport function fetchWithTimeout(url: string, options: RequestInit, timeout = 10000): Promise<Response> {\r\n    return Promise.race([\r\n        fetch(url, options),\r\n        new Promise((resolve, reject) =>\r\n            setTimeout(() => reject(new ApiError(`Fetch Timeout`)), timeout),\r\n        ) as Promise<Response>,\r\n    ]);\r\n}\r\n\r\nexport async function webRequest(url: string, data: unknown, options?: { method: 'POST' | 'PUT' }) {\r\n\r\n    const body = JSON.stringify(data);\r\n    const reqData: RequestInit = {\r\n        method: options?.method ?? `POST`,\r\n        headers: {\r\n            'Accept': `application/json`,\r\n            'Content-Type': `application/json`,\r\n            'Content-Length': `${body.length}`,\r\n        },\r\n        body,\r\n    };\r\n    const result = await fetchWithTimeout(url, reqData).catch((error) => { throw new ApiError(`Request Failure`, { url, data, error }); });\r\n    if (!result.ok) {\r\n        throw new ApiError(`Api Error`, { data: (await result.json().catch(error => {/* Ignore Parse Error */ })) ?? {}, responseStatus: result.status, request: { url, data } });\r\n    }\r\n    const resultObj = await result.json().catch((error) => { throw new ApiError(`Request Parse Failure`, { url, data, error }); });\r\n    return resultObj;\r\n}\r\n","!function (r, t) {\n  \"object\" == typeof exports && \"undefined\" != typeof module ? module.exports = t() : \"function\" == typeof define && define.amd ? define(t) : r.dayjs_plugin_relativeTime = t();\n}(this, function () {\n  \"use strict\";\n\n  return function (r, t, e) {\n    r = r || {};\n    var n = t.prototype,\n        o = {\n      future: \"in %s\",\n      past: \"%s ago\",\n      s: \"a few seconds\",\n      m: \"a minute\",\n      mm: \"%d minutes\",\n      h: \"an hour\",\n      hh: \"%d hours\",\n      d: \"a day\",\n      dd: \"%d days\",\n      M: \"a month\",\n      MM: \"%d months\",\n      y: \"a year\",\n      yy: \"%d years\"\n    };\n    e.en.relativeTime = o;\n\n    var d = function d(t, n, _d, i) {\n      for (var u, a, s, f = _d.$locale().relativeTime || o, l = r.thresholds || [{\n        l: \"s\",\n        r: 44,\n        d: \"second\"\n      }, {\n        l: \"m\",\n        r: 89\n      }, {\n        l: \"mm\",\n        r: 44,\n        d: \"minute\"\n      }, {\n        l: \"h\",\n        r: 89\n      }, {\n        l: \"hh\",\n        r: 21,\n        d: \"hour\"\n      }, {\n        l: \"d\",\n        r: 35\n      }, {\n        l: \"dd\",\n        r: 25,\n        d: \"day\"\n      }, {\n        l: \"M\",\n        r: 45\n      }, {\n        l: \"MM\",\n        r: 10,\n        d: \"month\"\n      }, {\n        l: \"y\",\n        r: 17\n      }, {\n        l: \"yy\",\n        d: \"year\"\n      }], h = l.length, m = 0; m < h; m += 1) {\n        var c = l[m];\n        c.d && (u = i ? e(t).diff(_d, c.d, !0) : _d.diff(t, c.d, !0));\n        var y = (r.rounding || Math.round)(Math.abs(u));\n\n        if (s = u > 0, y <= c.r || !c.r) {\n          y <= 1 && m > 0 && (c = l[m - 1]);\n          var p = f[c.l];\n          a = \"string\" == typeof p ? p.replace(\"%d\", y) : p(y, n, c.l, s);\n          break;\n        }\n      }\n\n      return n ? a : (s ? f.future : f.past).replace(\"%s\", a);\n    };\n\n    n.to = function (r, t) {\n      return d(r, t, this, !0);\n    }, n.from = function (r, t) {\n      return d(r, t, this);\n    };\n\n    var i = function i(r) {\n      return r.$u ? e.utc() : e();\n    };\n\n    n.toNow = function (r) {\n      return this.to(i(this), r);\n    }, n.fromNow = function (r) {\n      return this.from(i(this), r);\n    };\n  };\n});","export const websocketsApiConfig = {\r\n    websocketsApiUrl: `wss://p4w1a7ysk8.execute-api.us-east-1.amazonaws.com/prod`,\r\n};\r\n","'use strict';\nvar $ = require('../internals/export');\nvar flattenIntoArray = require('../internals/flatten-into-array');\nvar toObject = require('../internals/to-object');\nvar toLength = require('../internals/to-length');\nvar aFunction = require('../internals/a-function');\nvar arraySpeciesCreate = require('../internals/array-species-create');\n\n// `Array.prototype.flatMap` method\n// https://github.com/tc39/proposal-flatMap\n$({ target: 'Array', proto: true }, {\n  flatMap: function flatMap(callbackfn /* , thisArg */) {\n    var O = toObject(this);\n    var sourceLen = toLength(O.length);\n    var A;\n    aFunction(callbackfn);\n    A = arraySpeciesCreate(O, 0);\n    A.length = flattenIntoArray(A, O, O, sourceLen, 0, 1, callbackfn, arguments.length > 1 ? arguments[1] : undefined);\n    return A;\n  }\n});\n","import React, { useState } from 'react';\r\nimport { View, Text, TouchableOpacity, Platform } from 'react-native-lite';\r\nimport { ProblemService } from '../problems/problems-service';\r\n\r\n\r\nconst subjectStyles = {\r\n    container: {\r\n        margin: 16,\r\n    },\r\n    header: {\r\n        view: {\r\n            margin: 4,\r\n        },\r\n        text: {\r\n            fontSize: 16,\r\n        },\r\n    },\r\n    section: {\r\n        view: {\r\n            margin: 4,\r\n            flexDirection: `row`,\r\n        },\r\n        text: {\r\n            fontSize: 16,\r\n        },\r\n    },\r\n} as const;\r\n\r\nexport type SubjectProblemService = {\r\n    getSections: () => { key: string, name: string, isComplete: boolean }[];\r\n    gotoSection: (section: { key: string }) => void;\r\n};\r\nexport const SubjectNavigator = (props: { problemService: SubjectProblemService, onOpen: () => void, onClose: () => void, onSubjectNavigation: () => void }) => {\r\n\r\n    const [isExpanded, setIsExpanded] = useState(false);\r\n    const toggle = () => {\r\n        if (!isExpanded) {\r\n            props.onOpen();\r\n        }\r\n        if (isExpanded) {\r\n            props.onClose();\r\n        }\r\n        setIsExpanded(s => !s);\r\n    };\r\n\r\n    return (\r\n        <View style={subjectStyles.container}>\r\n            <TouchableOpacity onPress={toggle}>\r\n                <View style={subjectStyles.header.view}>\r\n                    <Text style={subjectStyles.header.text}>Sections</Text>\r\n                </View>\r\n            </TouchableOpacity>\r\n            {isExpanded && (\r\n                <View>\r\n                    {props.problemService.getSections().map(s => (\r\n                        <TouchableOpacity key={s.key} onPress={() => {\r\n                            console.log(`SubjectNavigator onSection`, { s });\r\n                            props.problemService.gotoSection(s);\r\n                            props.onSubjectNavigation();\r\n                            props.onClose();\r\n                            setIsExpanded(false);\r\n                            if (Platform.OS === `web`) {\r\n                                window.scrollTo(0, 0);\r\n                            }\r\n                        }}>\r\n                            <View style={subjectStyles.section.view}>\r\n                                <Text style={subjectStyles.section.text}>{s.isComplete ? `` : ``}</Text>\r\n                                <Text style={subjectStyles.section.text}>{s.name}</Text>\r\n                            </View>\r\n                        </TouchableOpacity>\r\n                    ))}\r\n                </View>\r\n            )}\r\n\r\n        </View>\r\n    );\r\n};\r\n","import { ProblemStateStorage, ProblemService } from './problems-service';\r\n\r\nexport const createProblemStateStorage = (storageKey: string): ProblemStateStorage => {\r\n    const storage: ProblemStateStorage = {\r\n        load: async <T>() => {\r\n            try {\r\n                return JSON.parse(localStorage.getItem(storageKey) ?? `error - NOT FOUND`) as T;\r\n            }\r\n            catch{\r\n                return null;\r\n            }\r\n        },\r\n        save: async (value) => {\r\n            localStorage.setItem(storageKey, JSON.stringify(value));\r\n        },\r\n    };\r\n    return storage;\r\n};\r\n\r\nexport const createAutoSavedProblemService = (problemSource: ProblemService, storageKey: string): ProblemService => {\r\n    const storage = createProblemStateStorage(storageKey);\r\n\r\n    // Load \r\n    (async () => await problemSource.load(storage))();\r\n\r\n    return {\r\n        ...problemSource,\r\n        recordAnswer: (problem, answer) => {\r\n            problemSource.recordAnswer(problem, answer);\r\n\r\n            if (problem.isLastOfSection) {\r\n                (async () => await problemSource.save(storage))();\r\n            }\r\n        },\r\n    };\r\n};\r\n","import { createUploadApiWebClient } from 'upload-api/client/web-client';\r\nimport { uploadApiConfig } from 'upload-api/client/config';\r\nimport { UploadUrl } from 'upload-api/client/types';\r\nimport { createUploader, downloadData } from 'upload-api/client/uploader';\r\nimport { AppError } from 'utils/error';\r\nimport { delay } from 'utils/delay';\r\nimport { error } from 'console';\r\n\r\nconst USER_DATA_SERVICE_STATE_KEY = `_USER_DATA_SERVICE_STATE`;\r\nexport type UserProfileInfo = {\r\n    key: string;\r\n    name: string;\r\n    emoji: string;\r\n    isActive: boolean;\r\n};\r\ntype UserProfileMetadata = {\r\n    name?: string;\r\n    emoji?: string;\r\n};\r\ntype UserProfileData = {\r\n    key: string;\r\n    name: string;\r\n    emoji?: string;\r\n    uploadUrl: UploadUrl;\r\n    lastUploadTimestamp?: number;\r\n};\r\ntype UserServiceState = {\r\n    userProfiles: UserProfileData[];\r\n    activeUserProfileKey: string;\r\n    changeTimestamp: number;\r\n};\r\ntype UserData = {\r\n    data: { [key: string]: null | string };\r\n    metadata?: UserProfileMetadata;\r\n    timestamp: number;\r\n};\r\n\r\nconst createUserDataService = () => {\r\n    const uploadApi = createUploadApiWebClient(uploadApiConfig);\r\n\r\n    const storage = {\r\n        getUserDataServiceState: (): null | UserServiceState => {\r\n            try {\r\n                return JSON.parse(localStorage.getItem(USER_DATA_SERVICE_STATE_KEY) ?? `NULL !{}`);\r\n            } catch{\r\n                return null;\r\n            }\r\n        },\r\n        setUserDataServiceState: (state: UserServiceState) => {\r\n            localStorage.setItem(USER_DATA_SERVICE_STATE_KEY, JSON.stringify(state));\r\n        },\r\n        getUserData: (): UserData => {\r\n            const state = storage.getUserDataServiceState();\r\n            const userState = state && state.userProfiles.find(x => x.key === state.activeUserProfileKey);\r\n            const data = {\r\n                data: {},\r\n                metadata: { name: userState?.name, emoji: userState?.emoji },\r\n                timestamp: Date.now(),\r\n            } as UserData;\r\n            const keys = Object.keys(localStorage).filter(x => !x.startsWith(`_`));\r\n            for (const k of keys) {\r\n                data.data[k] = localStorage.getItem(k);\r\n            }\r\n            return data;\r\n        },\r\n        clearUserData: () => {\r\n            // Remove all old data\r\n            const keys = Object.keys(localStorage).filter(x => !x.startsWith(`_`));\r\n            for (const k of keys) {\r\n                localStorage.removeItem(k);\r\n            }\r\n\r\n            // Load metadata\r\n            const state = storage.getUserDataServiceState();\r\n            if (!state) { return; }\r\n            state.userProfiles.forEach(x => { x.lastUploadTimestamp = undefined; });\r\n            storage.setUserDataServiceState(state);\r\n        },\r\n        setUserData: (userData: UserData) => {\r\n            storage.clearUserData();\r\n\r\n            // Set New data\r\n            for (const k of Object.keys(userData.data)) {\r\n                const val = userData.data[k];\r\n                if (!val) {\r\n                    localStorage.removeItem(k);\r\n                    return;\r\n                }\r\n                localStorage.setItem(k, val);\r\n            }\r\n\r\n            // Load metadata\r\n            const state = storage.getUserDataServiceState();\r\n            const userState = state && state.userProfiles.find(x => x.key === state.activeUserProfileKey);\r\n            if (!state || !userState) { return; }\r\n            userState.emoji = userData.metadata?.emoji ?? userState.emoji;\r\n            userState.name = userData.metadata?.name ?? userState.name;\r\n            userState.lastUploadTimestamp = userData.timestamp;\r\n            storage.setUserDataServiceState(state);\r\n        },\r\n    };\r\n\r\n    const getUserProfile = (userProfileKey: string) => {\r\n        const state = storage.getUserDataServiceState();\r\n        if (!state) { return null; }\r\n        return state.userProfiles.find(x => x.key === userProfileKey);\r\n    };\r\n    const getActiveUserProfile = () => {\r\n        const state = storage.getUserDataServiceState();\r\n        if (!state?.activeUserProfileKey) { return null; }\r\n        return state.userProfiles.find(x => x.key === state.activeUserProfileKey);\r\n    };\r\n\r\n    const uploadBackup = async (userState: UserProfileData, userData: UserData) => {\r\n        const uploadUrl = await uploadApi.createUploadUrl({ prefix: `backup/users/${userState.name}/${userState.uploadUrl.relativePath}/${Date.now()}` });\r\n        const uploader = createUploader(uploadUrl.uploadUrl);\r\n        await uploader.uploadData(userData);\r\n    };\r\n\r\n    const uploadWithAutoRenew = async (userProfileKey: string, userData: UserData) => {\r\n        const state = storage.getUserDataServiceState();\r\n        const userState = state && state.userProfiles.find(x => x.key === userProfileKey);\r\n        if (!state || !userState) { return; }\r\n\r\n        // Upload backup\r\n        await uploadBackup(userState, userData);\r\n\r\n        const upload = async () => {\r\n            const uploader = createUploader(userState.uploadUrl);\r\n            await uploader.uploadData(userData);\r\n        };\r\n\r\n        try {\r\n            // Try to upload\r\n            console.log(`uploadWithAutoRenew - Attempt 1`);\r\n            await upload();\r\n            console.log(`uploadWithAutoRenew - UPLOADED`);\r\n        } catch{\r\n            // Rewew and try again\r\n            console.log(`uploadWithAutoRenew - Attempt 2`);\r\n\r\n            const newUploarUrl = await uploadApi.renewUploadUrl({ uploadUrl: userState.uploadUrl });\r\n            userState.uploadUrl = newUploarUrl.uploadUrl;\r\n            storage.setUserDataServiceState(state);\r\n\r\n            await upload();\r\n\r\n            console.log(`uploadWithAutoRenew - UPLOADED AFTER RENEW`);\r\n        }\r\n    };\r\n\r\n    const updateUserProfileFromServer = async (userProfileKey: string) => {\r\n        console.log(`updateUserProfile`, { userProfileKey });\r\n        const state = storage.getUserDataServiceState();\r\n        const userState = state && state.userProfiles.find(x => x.key === userProfileKey);\r\n        if (!state || !userState) {\r\n            console.log(`updateUserProfile - NO USER STATE`, { userProfileKey });\r\n            return;\r\n        }\r\n\r\n        const userData = await downloadData(userState.uploadUrl.getUrl) as UserData;\r\n        if (!userData.timestamp || userData.timestamp <= (userState.lastUploadTimestamp ?? 0)) {\r\n            // Skip if not new\r\n            console.log(`updateUserProfile - NOT NEW`, { name: userState.name });\r\n            return;\r\n        }\r\n\r\n        console.log(`updateUserProfile - UPDATED USER PROFILE`, { name: userState.name });\r\n        userState.emoji = userData.metadata?.emoji ?? userState.emoji;\r\n        userState.name = userData.metadata?.name ?? userState.name;\r\n        userState.lastUploadTimestamp = userData.timestamp;\r\n        storage.setUserDataServiceState(state);\r\n\r\n        if (userState.key === state.activeUserProfileKey) {\r\n            console.log(`updateUserProfile - UPDATED ACTIVE USER DATA`, { name: userState.name });\r\n            storage.setUserData(userData);\r\n        }\r\n    };\r\n    const updateAllProfilesFromServer = async () => {\r\n        const state = storage.getUserDataServiceState();\r\n        if (!state) { return; }\r\n\r\n        for (const userState of state.userProfiles) {\r\n            try {\r\n                // eslint-disable-next-line no-await-in-loop\r\n                await updateUserProfileFromServer(userState.key);\r\n            } catch (error_) {\r\n                console.log(`updateAllProfiles - ERROR Updating user profile`, { error: error_ });\r\n            }\r\n        }\r\n    };\r\n\r\n    let isSetupStarted = false;\r\n    let isSetupDone = false;\r\n\r\n    const service = {\r\n        setup: async () => {\r\n            if (isSetupStarted) {\r\n                while (!isSetupDone) {\r\n                    // eslint-disable-next-line no-await-in-loop\r\n                    await delay(10);\r\n                }\r\n                return;\r\n            }\r\n            isSetupStarted = true;\r\n            const doSetup = async () => {\r\n                console.log(`UserDataService:setup`);\r\n\r\n                const a = getActiveUserProfile();\r\n                if (a) {\r\n                    await updateAllProfilesFromServer();\r\n                    return;\r\n                }\r\n\r\n                const state = storage.getUserDataServiceState();\r\n                if (state && state.userProfiles.length > 0) {\r\n                    state.activeUserProfileKey = state.userProfiles[0].key;\r\n                    storage.setUserDataServiceState(state);\r\n                    await updateAllProfilesFromServer();\r\n                    return;\r\n                }\r\n\r\n                const newUploadUrlResult = await uploadApi.createUploadUrl({ prefix: `users` });\r\n                const newState: UserServiceState = state ?? {\r\n                    userProfiles: [{\r\n                        key: newUploadUrlResult.uploadUrl.relativePath,\r\n                        name: `${`Player 1`}`,\r\n                        uploadUrl: newUploadUrlResult.uploadUrl,\r\n                    }],\r\n                    activeUserProfileKey: newUploadUrlResult.uploadUrl.relativePath,\r\n                    changeTimestamp: 0,\r\n                };\r\n                storage.setUserDataServiceState(newState);\r\n\r\n                // Upload initial data\r\n                await service.uploadUserData();\r\n            };\r\n\r\n            try {\r\n                await doSetup();\r\n                isSetupDone = true;\r\n            } catch (error_) {\r\n                // Setup Failed\r\n                isSetupDone = true;\r\n                throw error_;\r\n            }\r\n        },\r\n        getActiveUser: (): null | UserProfileInfo => {\r\n            const user = getActiveUserProfile();\r\n            if (!user) { return null; }\r\n            return {\r\n                key: user.key,\r\n                name: user.name,\r\n                emoji: user.emoji ?? ``,\r\n                isActive: true,\r\n            };\r\n        },\r\n        setActiveUser: async (userProfileKey: string) => {\r\n            console.log(`setActiveUser`, { userProfileKey });\r\n            const state = storage.getUserDataServiceState();\r\n            if (!state) { return; }\r\n\r\n            if (!state.userProfiles.find(x => x.key === userProfileKey)) {\r\n                console.log(`setActiveUser - User Profile Not Found`, { userProfileKey });\r\n                throw new AppError(`User Profile not found`);\r\n            }\r\n\r\n            // Don't upload old user data - the chance of this being out of date is high\r\n            // // Upload old user data\r\n            // await service.uploadUserData();\r\n\r\n            if (state.activeUserProfileKey !== userProfileKey) {\r\n                console.log(`setActiveUser - user changed - clearing state`);\r\n\r\n                state.activeUserProfileKey = userProfileKey;\r\n                state.changeTimestamp = 0;\r\n                storage.setUserDataServiceState(state);\r\n                storage.clearUserData();\r\n            }\r\n\r\n            console.log(`setActiveUser - before download`, { stateJson: JSON.stringify(storage.getUserDataServiceState()) });\r\n\r\n            // Download new user data\r\n            await service.downloadUserDataIfNewer();\r\n        },\r\n        getUserProfiles: async (): Promise<UserProfileInfo[]> => {\r\n            const state = storage.getUserDataServiceState();\r\n            if (!state?.activeUserProfileKey) { return []; }\r\n            return state.userProfiles.map(x => ({\r\n                key: x.key,\r\n                name: x.name,\r\n                emoji: x.emoji ?? ``,\r\n                isActive: state.activeUserProfileKey === x.key,\r\n            }));\r\n        },\r\n        setUserProfileInfo: async (userProfileKey: string, info: { emoji?: string, name?: string }) => {\r\n            const state = storage.getUserDataServiceState();\r\n            if (!state) {\r\n                console.log(`uploadUserData - NO STATE`);\r\n                return;\r\n            }\r\n\r\n            const userState = state.userProfiles.find(x => x.key === userProfileKey);\r\n            if (!userState) {\r\n                console.log(`uploadUserData - NO USER STATE`);\r\n                return;\r\n            }\r\n\r\n            userState.emoji = info.emoji ?? userState.emoji;\r\n            userState.name = info.name ?? userState.name;\r\n            storage.setUserDataServiceState(state);\r\n\r\n            // Save to remote data\r\n            const uploader = createUploader(userState.uploadUrl);\r\n            const uData = await uploader.downloadData() as UserData;\r\n            if (!uData) { return; }\r\n            uData.metadata = {\r\n                name: userState.name,\r\n                emoji: userState.emoji,\r\n            };\r\n            uData.timestamp = Date.now();\r\n            await uploadWithAutoRenew(userProfileKey, uData);\r\n        },\r\n        uploadUserData: async () => {\r\n            console.log(`uploadUserData`);\r\n\r\n            const state = storage.getUserDataServiceState();\r\n            if (!state) {\r\n                console.log(`uploadUserData - NO STATE`);\r\n                return;\r\n            }\r\n\r\n            const userState = state.userProfiles.find(x => x.key === state.activeUserProfileKey);\r\n            if (!userState) {\r\n                console.log(`uploadUserData - NO user State`, { state });\r\n                return;\r\n            }\r\n\r\n            userState.lastUploadTimestamp = Date.now();\r\n            storage.setUserDataServiceState(state);\r\n\r\n            const userData = storage.getUserData();\r\n            await uploadWithAutoRenew(userState.key, userData);\r\n\r\n            console.log(`uploadUserData - UPLOADED`, { userData });\r\n        },\r\n        downloadUserDataIfNewer: async () => {\r\n            const state = storage.getUserDataServiceState();\r\n            if (!state) { return; }\r\n\r\n            const userState = state.userProfiles.find(x => x.key === state.activeUserProfileKey);\r\n            if (!userState) { return; }\r\n\r\n            console.log(`downloadUserDataIfNewer`);\r\n\r\n            const uploader = createUploader(userState.uploadUrl);\r\n            const userData = await uploader.downloadData() as UserData;\r\n\r\n            // Don't update if not newer\r\n            if (!userData.timestamp || userData.timestamp <= (userState.lastUploadTimestamp ?? 0)) {\r\n                console.log(`downloadUserDataIfNewer - Local data is up to date`, { state, userData });\r\n                return;\r\n            }\r\n\r\n            console.log(`downloadUserDataIfNewer - UPDATING`, { state, userData });\r\n            storage.clearUserData();\r\n            storage.setUserData(userData);\r\n        },\r\n        createShareCode: async (userProfileKey: string) => {\r\n            await service.setup();\r\n            const user = getUserProfile(userProfileKey);\r\n            if (!user) {\r\n                throw new AppError(`user should not be null`);\r\n            }\r\n\r\n            const shareUrlResult = await uploadApi.createUploadUrl({ shareablePath: true });\r\n\r\n            // Save user uploadUrl to shared path\r\n            const uploader = createUploader(shareUrlResult.uploadUrl);\r\n            await uploader.uploadData(user.uploadUrl);\r\n\r\n            return {\r\n                shareCode: shareUrlResult.uploadUrl.relativePath,\r\n            };\r\n        },\r\n        addUserFromShareCode: async (shareCode: string) => {\r\n            console.log(`addUserFromShareCode`, { shareCode });\r\n\r\n            // Don't have a clean way to get the path, but can generate a new path from the server and use it as a template\r\n            const shareUrlResult = await uploadApi.createUploadUrl({ shareablePath: true });\r\n            const shareGetUrl = shareUrlResult.uploadUrl.getUrl.replace(shareUrlResult.uploadUrl.relativePath, shareCode.toUpperCase());\r\n            const sharedUploadUrl = await downloadData(shareGetUrl) as UploadUrl;\r\n            if (!sharedUploadUrl.putUrl) {\r\n                console.log(`addUserFromShareCode - FAILED TO GET PROFILE`);\r\n                throw new AppError(`Failed to get user profile`);\r\n            }\r\n\r\n            const state = storage.getUserDataServiceState();\r\n            if (!state) {\r\n                console.log(`addUserFromShareCode - NO STATE`);\r\n                throw new AppError(`UserDataService is not setup`);\r\n            }\r\n\r\n            // Already has that user profile\r\n            if (state.userProfiles.find(x => x.key === sharedUploadUrl.relativePath)) {\r\n                console.log(`addUserFromShareCode - ALREADY HAS USER`, { userKey: sharedUploadUrl.relativePath });\r\n                return;\r\n            }\r\n\r\n            state.userProfiles.push({\r\n                key: sharedUploadUrl.relativePath,\r\n                name: `Player ${state.userProfiles.length + 1}`,\r\n                uploadUrl: sharedUploadUrl,\r\n            });\r\n            storage.setUserDataServiceState(state);\r\n\r\n            console.log(`addUserFromShareCode - ADDED`, { userKey: sharedUploadUrl.relativePath });\r\n\r\n            // Reload profile\r\n            await updateUserProfileFromServer(sharedUploadUrl.relativePath);\r\n        },\r\n    };\r\n    return service;\r\n};\r\n\r\nexport type UserDataService = ReturnType<typeof createUserDataService>;\r\nconst serviceState = {\r\n    instance: null as null | UserDataService,\r\n};\r\nexport const UserDataService = {\r\n    get: (): UserDataService => {\r\n        if (!serviceState.instance) {\r\n            serviceState.instance = createUserDataService();\r\n        };\r\n        return serviceState.instance;\r\n    },\r\n};\r\n","export { delay } from 'utils/delay';\r\nexport { randomIndex, randomItem } from 'utils/random';\r\nexport { getValuesAsItems } from 'utils/objects';\r\nexport { moveItem } from 'utils/arrays';\r\nexport const randomBinary = (length: number) => String.fromCharCode(...[...new Array(length)].map(x => Math.random() * (126 - 32) + 32));\r\n"],"sourceRoot":""}