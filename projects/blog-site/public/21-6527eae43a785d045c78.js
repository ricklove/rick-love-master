(window.__LOADABLE_LOADED_CHUNKS__=window.__LOADABLE_LOADED_CHUNKS__||[]).push([[21],{"9GY0":function(e,t,n){"use strict";n.r(t),n.d(t,"EducationalGame_Doodle_Spelling",(function(){return B}));var r=n("a1TR"),a=n.n(r),o=(n("3yYM"),n("Ab9Y")),c=n("ERkP"),i=n.n(c),u=n("DTYs"),l=n("t8gp"),s=n("4cHy"),d=n("hsFx"),p=n("1U25"),f=n("X2o9"),m=n("+tC1"),w=n("Vgox"),g=n("MWkW"),b="doodle/summary",v="doodle/drawings",y="doodle/votes",h=function(){try{var e;return JSON.parse(null!==(e=localStorage.getItem("doodleStorage.v2"))&&void 0!==e?e:"NULL!{}")}catch(t){return null}},k=function(e){localStorage.setItem("doodleStorage.v2",JSON.stringify(e))},x=function(){var e=Object(o.a)(a.a.mark((function e(){var t,n,r,c,i,u,x,O,j,E,S;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=Object(f.a)({getUploadUrl:function(){var e=Object(o.a)(a.a.mark((function e(){var t,n;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",null!==(t=null===(n=h())||void 0===n?void 0:n.doodleUploadUrl)&&void 0!==t?t:null);case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),setUploadUrl:function(){var e=Object(o.a)(a.a.mark((function e(t){var n;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",k(Object.assign({},null!==(n=h())&&void 0!==n?n:{},{doodleUploadUrl:t})));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),uploadApiUrl:p.a.uploadApiUrl,uploadUrlPrefix:v}),u=Object(f.a)({getUploadUrl:function(){var e=Object(o.a)(a.a.mark((function e(){var t,n;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",null!==(t=null===(n=h())||void 0===n?void 0:n.scoresUploadUrl)&&void 0!==t?t:null);case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),setUploadUrl:function(){var e=Object(o.a)(a.a.mark((function e(t){var n;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",k(Object.assign({},null!==(n=h())&&void 0!==n?n:{},{scoresUploadUrl:t})));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),uploadApiUrl:p.a.uploadApiUrl,uploadUrlPrefix:y}),x=function(){var e=Object(o.a)(a.a.mark((function e(){var t,n,r,o,c,i,u,l;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,r=null===(t=h())||void 0===t?void 0:t.doodleUploadUrl){e.next=7;break}return o=Object(w.a)(p.a),e.next=6,o.createUploadUrl({});case 6:r=e.sent.uploadUrl;case 7:return c=null===(n=r)||void 0===n?void 0:n.getUrl.replace(r.relativePath,""),i=""+c+b,console.log("getSummaryData",{uploadUrl:r,serverUrl:c,summaryUrl:i}),e.next=12,Object(f.c)(i);case 12:return u=e.sent,l={doodles:u.doodles.map((function(e){return{key:e.k,prompt:e.p,timestamp:e.t,drawing:Object(g.a)(e.d),score:e.s}}))},e.abrupt("return",l);case 17:return e.prev=17,e.t0=e.catch(0),e.abrupt("return",{doodles:[]});case 20:case"end":return e.stop()}}),e,null,[[0,17]])})));return function(){return e.apply(this,arguments)}}(),e.next=5,x();case 5:return O=e.sent,j={doodles:[],doodleScores:[],doodleVotes:[]},e.next=9,i.load();case 9:if(e.t2=n=e.sent,e.t1=null===e.t2,e.t1){e.next=13;break}e.t1=void 0===n;case 13:if(!e.t1){e.next=17;break}e.t3=void 0,e.next=18;break;case 17:e.t3=n.doodles.map((function(e){return{key:e.k,prompt:e.p,timestamp:e.t,drawing:e.d?Object(g.a)(e.d):e.drawing}}));case 18:if(e.t4=t=e.t3,e.t0=null!==e.t4,!e.t0){e.next=22;break}e.t0=void 0!==t;case 22:if(!e.t0){e.next=26;break}e.t5=t,e.next=27;break;case 26:e.t5=[];case 27:return j.doodles=e.t5,e.next=30,u.load();case 30:if(e.t8=c=e.sent,e.t7=null===e.t8,e.t7){e.next=34;break}e.t7=void 0===c;case 34:if(!e.t7){e.next=38;break}e.t9=void 0,e.next=39;break;case 38:e.t9=c.doodleVotes;case 39:if(e.t10=r=e.t9,e.t6=null!==e.t10,!e.t6){e.next=43;break}e.t6=void 0!==r;case 43:if(!e.t6){e.next=47;break}e.t11=r,e.next=48;break;case 47:e.t11=[];case 48:return j.doodleVotes=e.t11,E={},O.doodles.forEach((function(e){var t;E[e.key]=(null!==(t=E[e.key])&&void 0!==t?t:0)+e.score})),j.doodleScores=Object(m.b)(E).map((function(e){return{doodleKey:e.key,score:e.value}})),S={saveDrawing:function(){var e=Object(o.a)(a.a.mark((function e(t,n){var r;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r={key:t.substr(0,8)+":"+Date.now()+":"+Math.floor(999999*Math.random()),drawing:n,prompt:t,timestamp:Date.now()},j.doodles.push(r),setTimeout(Object(o.a)(a.a.mark((function e(){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i.save({doodles:j.doodles.map((function(e){return{k:e.key,p:e.prompt,t:e.timestamp,d:Object(g.d)(e.drawing)}}))});case 2:case"end":return e.stop()}}),e)}))));case 3:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),saveBestDrawingSelection:function(){var e=Object(o.a)(a.a.mark((function e(t){var n,r;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:j.doodleVotes.push({k:t.key,t:Date.now()}),(r=j.doodleScores.find((function(e){return e.doodleKey===t.key})))||(r={doodleKey:t.key,score:0},j.doodleScores.push(r)),r.score=(null!==(n=r.score)&&void 0!==n?n:0)+1,setTimeout(Object(o.a)(a.a.mark((function e(){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,u.save({doodleVotes:j.doodleVotes});case 2:case"end":return e.stop()}}),e)}))));case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),getDrawings:function(){var e=Object(o.a)(a.a.mark((function e(t,n){var r,o,c,i,u,p,f,m,w,g;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=(r=null!=n?n:{}).includeOtherPrompts,c=void 0!==o&&o,i=r.maxCount,u=void 0===i?4:i,p=Object(d.b)([].concat(Object(l.a)(O.doodles),Object(l.a)(j.doodles.map((function(e){var t,n;return Object.assign({},e,{score:null!==(t=null===(n=j.doodleScores.find((function(t){return t.doodleKey===e.key})))||void 0===n?void 0:n.score)&&void 0!==t?t:0})})))),(function(e){return e.key})),f=p.filter((function(e){return e.prompt===t})).sort((function(e,t){return-(e.score-t.score)})),console.log("getDrawings",{samePromptDrawings:f}),m=c?p.filter((function(e){return e.prompt!==t})):[],w=c?[Object(s.b)(f)].concat(Object(l.a)(Object(d.e)(m).slice(0,u-1))):f,g=Object(d.e)(w).slice(0,u),e.abrupt("return",{doodles:g});case 8:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()},e.abrupt("return",S);case 54:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),O=n("njmQ"),j=n("pAyS"),E=n("yxiS"),S=(n("xrQq"),n("kNg/"),{rows:[{keys:"qwertyuiop".split("")},{keys:" asdfghjkl".split("")},{keys:"  zxcvbnm ".split("")}]}),F={container:{},rowView:{flex:1,flexDirection:"row"},keyView:{margin:2,padding:2,width:20,height:20,backgroundColor:"#111111",justifyContent:"center",alignItems:"center"},keyView_disabled:{opacity:.5},keyText:{fontSize:16},keyText_wrong:{fontSize:16,color:"#FF0000"}},D=function(e){var t=e.expectedCharacter,n=e.showHints,r=e.onExpectedKeyPress,a=S,o=Object(c.useState)(null),s=o[0],p=o[1],f=Object(c.useState)([]),m=f[0],w=f[1];Object(c.useEffect)((function(){n||p(null);var e=[t].concat(Object(l.a)(Object(d.e)(a.rows.flatMap((function(e){return e.keys})).map((function(e){return e.trim()})).filter((function(e){return e}))).slice(0,3)));p(e),w([])}),[t,n]);return i.a.createElement(i.a.Fragment,null,i.a.createElement(u.h,{style:F.container},a.rows.map((function(e,a){return i.a.createElement(u.h,{style:F.rowView,key:""+a},e.keys.map((function(e,a){return i.a.createElement(u.g,{key:""+e+a,style:{outline:"none"},onPress:function(){var a;(a=e)!==t?n&&(p((function(e){return(null!=e?e:[]).filter((function(e){return e!==a}))})),w((function(e){return[].concat(Object(l.a)(e),[a])}))):r()}},i.a.createElement(u.h,{style:!s||s.includes(e)?{}:F.keyView_disabled},i.a.createElement(u.h,{style:F.keyView},i.a.createElement(u.e,{style:m.includes(e)?F.keyText_wrong:F.keyText},e))))})))}))))},U={container:{alignItems:"center"},drawing:{width:312,height:312,color:"#FFFFFF",backgroundColor:"#000000"},drawingChoicesView:{maxWidth:332,flexDirection:"row",flexWrap:"wrap"},drawingChoiceWrapper:{padding:4},drawingChoice:{width:78,height:78,color:"#FFFFFF",backgroundColor:"#000000"},titleView:{justifyContent:"center",alignItems:"center"},titleText:{fontSize:20,color:"#FFFFFF"},promptView:{justifyContent:"center",alignItems:"center"},promptText:{fontSize:20,color:"#FFFF00"},hintText:{fontSize:14,color:"#FFFF00"},buttonRowView:{flexDirection:"row"},buttonView:{margin:4,padding:8,backgroundColor:"#111111"},buttonText:{fontSize:20,color:"#FFFF00"}},C=function(e){var t=Object(c.useState)(0),n=t[0],r=t[1];return i.a.createElement(i.a.Fragment,null,i.a.createElement(V,Object.assign({},e,{problemSourceKey:n})),i.a.createElement(E.a,{problemService:e.problemService,onOpen:function(){},onClose:function(){},onSubjectNavigation:function(){r((function(e){return e+1}))}}))},V=function(e){var t,n,r=Object(c.useState)(null),u=r[0],l=r[1],s=Object(c.useState)("type"),d=s[0],p=s[1],f=Object(c.useState)(null),m=f[0],w=f[1],g=Object(c.useRef)(null!==(t=null==u?void 0:u.prompt)&&void 0!==t?t:"");g.current=null!==(n=null==u?void 0:u.prompt)&&void 0!==n?n:"";var b=function(){var t,n=e.problemService.getNextProblem();n&&(l(n),setTimeout(h),null===(t=n.speakPrompt)||void 0===t||t.call(n))};Object(c.useEffect)((function(){b()}),[e.problemSourceKey]);var v=Object(O.a)(),y=(v.loading,v.error,v.doWork),h=function(){y(function(){var t=Object(o.a)(a.a.mark((function t(n){var r;return a.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.drawingStorage.getDrawings(g.current,{maxCount:1,includeOtherPrompts:!1});case 2:r=t.sent,w(r.doodles),p("type");case 5:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())},k=function(){p("drawPrompt")},x=function(){y(function(){var t=Object(o.a)(a.a.mark((function t(n){var r;return a.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.drawingStorage.getDrawings(g.current);case 2:if(r=t.sent,n(),!(r.doodles.length<=1)){t.next=7;break}return b(),t.abrupt("return");case 7:w(r.doodles),p("chooseBest");case 9:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())};return u?"type"===d?i.a.createElement(i.a.Fragment,null,i.a.createElement(A,{prompt:g.current,drawings:null!=m?m:[],onDone:function(){y(function(){var e=Object(o.a)(a.a.mark((function e(t){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:setTimeout(k);case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())}})):"chooseBest"===d&&m?i.a.createElement(i.a.Fragment,null,i.a.createElement(P,{prompt:g.current,drawings:m,onChooseBest:function(t){y(function(){var n=Object(o.a)(a.a.mark((function n(r){return a.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,e.drawingStorage.saveBestDrawingSelection(t);case 2:r(),b();case 4:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}())}})):i.a.createElement(i.a.Fragment,null,i.a.createElement(T,{prompt:g.current,hint:u.hint,onDone:function(t){y(function(){var n=Object(o.a)(a.a.mark((function n(r){return a.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(!(t.segments.length>0)){n.next=3;break}return n.next=3,e.drawingStorage.saveDrawing(g.current,t);case 3:r(),setTimeout(x);case 5:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}())},onSkip:function(){setTimeout(x)}})):i.a.createElement(i.a.Fragment,null)},T=function(e){var t=Object(c.useState)(Object(g.b)()),n=t[0],r=t[1];return Object(c.useEffect)((function(){r(Object(g.b)())}),[e.prompt]),i.a.createElement(u.h,{style:U.container},i.a.createElement(u.h,{style:U.titleView},i.a.createElement(u.e,{style:U.titleText},"Draw")),i.a.createElement(j.DoodleDrawerView,{style:U.drawing,drawing:n,onChange:function(e){r(e)}}),i.a.createElement(u.h,{style:U.promptView},i.a.createElement(u.e,{style:U.promptText},e.prompt),!!e.hint&&i.a.createElement(u.e,{style:U.hintText},e.hint)),i.a.createElement(u.h,{style:U.buttonRowView},i.a.createElement(u.g,{onPress:function(){e.onSkip()}},i.a.createElement(u.h,{style:U.buttonView},i.a.createElement(u.e,{style:U.buttonText},"Skip"))),i.a.createElement(u.g,{onPress:function(){e.onDone(n)}},i.a.createElement(u.h,{style:U.buttonView},i.a.createElement(u.e,{style:U.buttonText},"Done")))))},P=function(e){return i.a.createElement(u.h,{style:U.container},i.a.createElement(u.h,{style:U.titleView},i.a.createElement(u.e,{style:U.titleText},"Choose Best")),i.a.createElement(u.h,{style:U.promptView},i.a.createElement(u.e,{style:U.promptText},e.prompt)),i.a.createElement(u.h,{style:U.drawingChoicesView},e.drawings.map((function(t){return i.a.createElement(u.g,{key:t.key,onPress:function(){return e.onChooseBest(t)}},i.a.createElement(u.h,{style:U.drawingChoiceWrapper},i.a.createElement(j.DoodleDisplayView,{style:U.drawingChoice,drawing:t.drawing})))}))))},_={completedText:{fontSize:16,color:"#FFFF00"}},A=function(e){var t,n=Object(c.useState)({completed:"",remaining:e.prompt}),r=n[0],a=n[1];Object(c.useEffect)((function(){a({completed:"",remaining:e.prompt})}),[e.prompt,e.drawings]);return i.a.createElement(u.h,{style:U.container},i.a.createElement(u.h,{style:U.titleView},i.a.createElement(u.e,{style:U.titleText},"Type Word")),i.a.createElement(u.h,{style:U.drawingChoicesView},e.drawings.map((function(e){return i.a.createElement(u.h,{key:e.key,style:U.drawingChoiceWrapper},i.a.createElement(j.DoodleDisplayView,{style:U.drawingChoice,drawing:e.drawing}))}))),i.a.createElement(u.h,null,i.a.createElement(u.e,{style:_.completedText},r.completed+(r.remaining.length>0?"_":""))),i.a.createElement(D,{expectedCharacter:null!==(t=r.remaining[0])&&void 0!==t?t:" ",showHints:!0,onExpectedKeyPress:function(){a((function(t){t.remaining.length<=1&&e.onDone();var n=t.remaining[0];return{completed:t.completed+n,remaining:t.remaining.substr(1)}}))}}))},z=n("aLR2"),K=n("oo7O"),N=n("DZ/V"),W=n("yyXn"),B=function(e){var t=Object(c.useRef)(Object(z.a)()),n=Object(c.useState)("web"!==u.c.OS),r=n[0],l=n[1],s=Object(O.a)(),d=s.loading,p=(s.error,s.doWork),f=Object(c.useRef)(null),m=Object(c.useRef)(null);if(Object(c.useEffect)((function(){p(function(){var e=Object(o.a)(a.a.mark((function e(n){var r,o;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,x();case 2:f.current=e.sent,n(),r=Object(W.a)(Object(K.a)({speechService:t.current,sectionSize:8}),"ProblemsSpellingDoodle"),o=null,m.current={getSections:r.getSections,gotoSection:r.gotoSection,getNextProblem:function(){var e,t;o&&r.recordAnswer(o,o.answers.find((function(e){return e.isCorrect})));var n=r.getNextProblem();return n.question?(o=n,{prompt:null!==(e=null===(t=n.answers.find((function(e){return e.isCorrect})))||void 0===t?void 0:t.value)&&void 0!==e?e:"",speakPrompt:n.onQuestion}):null}};case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())}),[]),!r){return i.a.createElement(u.h,null,i.a.createElement(N.a,{languange:"en",speechService:t.current}),i.a.createElement("div",{onClick:function(){return t.current.speak("Start"),void l(!0)}},i.a.createElement(u.h,{style:{height:300,alignSelf:"center",alignItems:"center",justifyContent:"center"}},i.a.createElement(u.e,{style:{fontSize:36}},"Start"))))}return!d&&f.current&&m.current?i.a.createElement(C,{problemService:m.current,drawingStorage:f.current}):i.a.createElement(i.a.Fragment,null,i.a.createElement(u.a,{size:"large",color:"#FFFF00"}))}}}]);
//# sourceMappingURL=21-6527eae43a785d045c78.js.map