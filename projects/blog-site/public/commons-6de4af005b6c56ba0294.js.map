{"version":3,"sources":["webpack:///D:/Projects/rick-love-master/code/utils/objects.ts","webpack:///D:/Projects/rick-love-master/node_modules/core-js/modules/es6.reflect.construct.js","webpack:///D:/Projects/rick-love-master/node_modules/core-js/modules/_string-pad.js","webpack:///D:/Projects/rick-love-master/code/upload-api/client/config.ts","webpack:///D:/Projects/rick-love-master/node_modules/core-js/modules/es7.string.pad-start.js","webpack:///D:/Projects/rick-love-master/code/utils/random.ts","webpack:///D:/Projects/rick-love-master/node_modules/core-js/modules/_parse-int.js","webpack:///D:/Projects/rick-love-master/code/controls-react/icon-kind.ts","webpack:///D:/Projects/rick-love-master/node_modules/core-js/modules/_parse-float.js","webpack:///D:/Projects/rick-love-master/node_modules/core-js/modules/es6.number.parse-int.js","webpack:///D:/Projects/rick-love-master/code/user-data-service/user-profile-selection-view.tsx","webpack:///D:/Projects/rick-love-master/code/games/educational-games/progress-games/emoji-idle-game/emoji-skills/emoji-skill-tree.ts","webpack:///D:/Projects/rick-love-master/code/games/educational-games/progress-games/emoji-idle-game/emoji-idle-service.ts","webpack:///D:/Projects/rick-love-master/code/games/educational-games/progress-games/emoji-idle-game/emoji-idle-view.tsx","webpack:///D:/Projects/rick-love-master/code/games/educational-games/progress-games/progress-game.tsx","webpack:///D:/Projects/rick-love-master/code/utils/email-address.ts","webpack:///D:/Projects/rick-love-master/code/utils/error.ts","webpack:///D:/Projects/rick-love-master/node_modules/core-js/modules/es6.string.starts-with.js","webpack:///D:/Projects/rick-love-master/node_modules/core-js/modules/_flatten-into-array.js","webpack:///D:/Projects/rick-love-master/code/games/educational-games/problems/problems-reviewer.ts","webpack:///D:/Projects/rick-love-master/code/react-native-lite/index.tsx","webpack:///D:/Projects/rick-love-master/code/games/educational-games/utils/voice-chooser.tsx","webpack:///D:/Projects/rick-love-master/node_modules/core-js/modules/es6.array.find-index.js","webpack:///D:/Projects/rick-love-master/code/utils/subscribable.ts","webpack:///D:/Projects/rick-love-master/node_modules/core-js/modules/es6.number.parse-float.js","webpack:///D:/Projects/rick-love-master/code/doodle/doodle.ts","webpack:///D:/Projects/rick-love-master/node_modules/@stripe/react-stripe-js/dist/react-stripe.umd.js","webpack:///D:/Projects/rick-love-master/code/utils/phone-number.ts","webpack:///D:/Projects/rick-love-master/node_modules/@stripe/stripe-js/dist/stripe.esm.js","webpack:///D:/Projects/rick-love-master/code/payments/common/types.ts","webpack:///D:/Projects/rick-love-master/code/payments/common/process-steps.ts","webpack:///D:/Projects/rick-love-master/code/payments/providers/stripe/common/stripe-process-steps.ts","webpack:///D:/Projects/rick-love-master/code/payments/providers/stripe/client/stripe-payment-react.tsx","webpack:///D:/Projects/rick-love-master/code/payments/providers/stripe/client/stripe-client-tokens.ts","webpack:///D:/Projects/rick-love-master/code/user-data-service/user-data-service.ts","webpack:///D:/Projects/rick-love-master/node_modules/core-js/modules/es6.string.from-code-point.js","webpack:///D:/Projects/rick-love-master/code/upload-api/client/web-client.ts","webpack:///D:/Projects/rick-love-master/node_modules/core-js/modules/_math-sign.js","webpack:///D:/Projects/rick-love-master/code/upload-api/client/uploader.ts","webpack:///D:/Projects/rick-love-master/node_modules/react-icons/lib/esm/iconsManifest.js","webpack:///D:/Projects/rick-love-master/node_modules/react-icons/lib/esm/iconContext.js","webpack:///D:/Projects/rick-love-master/node_modules/react-icons/lib/esm/iconBase.js","webpack:///D:/Projects/rick-love-master/node_modules/core-js/modules/es7.array.flat-map.js","webpack:///D:/Projects/rick-love-master/code/games/educational-games/utils/speech.ts","webpack:///D:/Projects/rick-love-master/code/utils/json.ts","webpack:///D:/Projects/rick-love-master/code/controls-react/error-box.tsx","webpack:///D:/Projects/rick-love-master/code/controls-react/button.tsx","webpack:///D:/Projects/rick-love-master/code/controls-react/index.tsx","webpack:///D:/Projects/rick-love-master/code/controls-react/loading.tsx","webpack:///D:/Projects/rick-love-master/code/controls-react/inputs.tsx","webpack:///D:/Projects/rick-love-master/node_modules/core-js/modules/es6.math.sign.js","webpack:///D:/Projects/rick-love-master/code/utils/delay.ts","webpack:///D:/Projects/rick-love-master/code/controls-react/icon.tsx","webpack:///D:/Projects/rick-love-master/code/themes/theme.ts","webpack:///D:/Projects/rick-love-master/code/utils/arrays.ts","webpack:///D:/Projects/rick-love-master/code/user-data-service/user-profile-emojis.tsx","webpack:///D:/Projects/rick-love-master/code/user-data-service/user-profile-manager-view.tsx","webpack:///D:/Projects/rick-love-master/code/utils-react/hooks.tsx","webpack:///D:/Projects/rick-love-master/code/games/educational-games/problems/spelling/spelling-problem-service.ts","webpack:///D:/Projects/rick-love-master/code/doodle/doodle-view.tsx","webpack:///D:/Projects/rick-love-master/code/games/educational-games/problems/multiples.ts","webpack:///D:/Projects/rick-love-master/code/games/educational-games/components/game-pad-analog.tsx","webpack:///D:/Projects/rick-love-master/code/games/educational-games/utils/vectors.ts","webpack:///D:/Projects/rick-love-master/code/games/educational-games/star-blast-sideways.tsx","webpack:///D:/Projects/rick-love-master/code/games/educational-games/components/leaderboard.tsx","webpack:///D:/Projects/rick-love-master/code/utils/web-request.ts","webpack:///D:/Projects/rick-love-master/node_modules/core-js/modules/_string-repeat.js","webpack:///D:/Projects/rick-love-master/code/games/educational-games/utils/subject-navigator.tsx","webpack:///D:/Projects/rick-love-master/code/games/educational-games/problems/problem-state-storage.ts","webpack:///D:/Projects/rick-love-master/code/games/console-simulator/utils.ts"],"names":["getValuesAsItems","obj","Object","keys","map","k","filter","x","toKeyValueObject","items","v","forEach","key","value","toMap","Map","toKeyValueArray","$export","create","aFunction","anObject","isObject","fails","bind","rConstruct","Reflect","construct","NEW_TARGET_BUG","F","ARGS_BUG","S","Target","args","newTarget","arguments","length","$args","push","apply","proto","prototype","instance","result","Function","call","toLength","repeat","defined","module","exports","that","maxLength","fillString","left","String","stringLength","fillStr","undefined","intMaxLength","fillLen","stringFiller","Math","ceil","slice","uploadApiConfig","uploadApiUrl","$pad","userAgent","WEBKIT_BUG","test","P","padStart","this","randomIndex","floor","random","randomItem","$parseInt","parseInt","$trim","trim","ws","hex","str","radix","string","IconKind","$parseFloat","parseFloat","Infinity","charAt","Number","styles","container","flexDirection","flexWrap","justifyContent","profileContainer","alignItems","profileCharacterView","width","height","borderWidth","borderStyle","borderColor","profileCharacterText","fontSize","textAlign","profileNameView","profileNameText","UserProfileSelectionView","props","useAutoLoadingError","doWork","loading","error","useState","userProfiles","setUserProfiles","isManagerVisible","setIsManagerVisible","reload","stopIfObsolete","a","UserDataService","get","setup","getUserProfiles","profiles","useEffect","onClose","style","onPress","setActiveUser","onUserSelected","emoji","name","buildEmojiSkillTree","maleSkillDoc","child_male","student_male","skillDoc","femaleSkillDoc","child_female","student_female","getFemaleVariant","maleNodes","parseSkillDoc","femaleNodes","babyNode","babyEmoji","gender","pay","requirementEmojis","startEmoji","parent","children","allNodes","root","child","find","allRequirements","parseRequirementsDoc","requirementsDoc","node","allCosts","r","cost","summary","join","totalCost","reduce","out","debug_totalRequirementsCost","doc","split","line","parts","parseSkillLine","skillLine","payText","p1","end","replace","RegExp","genderCharCodes","male","female","man","woman","fromCodePoint","storage","localStorage","setItem","JSON","stringify","getItem","parse","createService","skillTree","reqMap","defaultState","characterEmoji","emotion","lastEmotionTimestamp","Date","now","money","multiplier","lastMultiplierChangeTimestamp","lastPurchaseTimestamp","townState","characters","s","sub","createSubscribable","changeState","partialState","onStateChange","rewardInner","min","setInterval","targetEmoji","targetOptions","skillNode","t","remainingSkills","c","targetSkillNode","reqs","reqs_remaining","requirementsPurchased","includes","sort","b","reqs_available","requirementsAvailable","requirementsNeeded","requirementsRemaining","subscribePetStateChange","subscribe","reward","reward_major","reward_extreme","punish","max","selectOption","finishedTimestamp","serviceState","EmojiIdleService","fixed","position","top","right","zIndex","inner","emotionEmoji","fontFamily","characterEmoji_small","costText","color","costText_small","targetCharacterEmoji","objectEmoji","marginLeft","money_small","foodText","EmojiIdleView","gameState","setGameState","isExpanded","setIsExpanded","unsubscribe","purchased","townStyles","background","payText_disabled","moneyText","townMoneyText","TownView","townPersons","character","skill","n","years","missingSkills","townMoney","flex","padding","toLocaleString","toFixed","opacity","CommandsView","offset","setOffset","targetOptionsLength","i","canBuy","borderRadius","paddingLeft","paddingRight","ScoreView","moneySizeOffset","setMoneySizeOffset","multiplierSizeOffset","setMultiplierSizeOffset","lastMultiplier","useRef","multiplierDelta","setMultiplierDelta","update","clearInterval","id","current","transform","EmojiCharacterView","PurchasedView","EmotionView","text","isEmotion","display","setDisplay","showEmotion","variant","getEmoji","shuffle","ProgressGameService","onCorrect","onCompleteSection","onCompleteSubject","onWrong","createProgressGameProblemService","problemSource","options","recordAnswer","problem","answer","isCorrect","isReview","isLastOfSubject","setTimeout","uploadUserData","isLastOfSection","ProgressGameView","hasSelectedProfile","setHasSelectedProfile","userProfile","setUserProfile","getActiveUser","Platform","OS","window","location","toEmailAddress","email","AppError","message","data","Error","ApiError","context","$startsWith","startsWith","searchString","index","search","isArray","ctx","IS_CONCAT_SPREADABLE","flattenIntoArray","target","original","source","sourceLen","start","depth","mapper","thisArg","element","spreadable","targetIndex","sourceIndex","mapFn","TypeError","createReviewProblemService","maxNewReviewCount","reviewSequencePreviousLength","reviewQuestionPrefix","requiredCorrectInRow","state","problemSourceHistory","reviewProblems","lastReviewProblem","reviewSequence","repeatState","startReview","console","log","service","load","save","getSections","gotoSection","getNextProblem","reviewProblem","rSeq","iNext","iEnd","lastReviewProblemIndex","iStart","seq","p","question","answers","getReviewProblem","correctsInRow","newProblem","findIndex","problemAlreadyInReview","newReview","_debug_problemKey","mergeStyles","Array","item","viewStyleDefaults","textStyleDefaults","whiteSpace","finalizeTextStyle","userSelect","MozUserSelect","WebkitUserSelect","View","Text","numberOfLines","allStyles","overflow","wordWrap","textOverflow","TextInput","type","keyboardType","secureTextEntry","autoCompleteType","onKeyPress","onSubmitEditing","e","shiftKey","preventDefault","placeholder","disabled","editable","onChange","onBlur","TouchableOpacity","lastPressTime","hasTouchStarted","onClick","onTouchStart","onTouchMove","onTouchEnd","role","tabIndex","Pressable","onIgnore","stopPropagation","cancelBubble","returnValue","onPressIn","onPressOut","onMouseDown","onMouseUp","onTouchCancel","onMouseLeave","onTouchEndCapture","ActivityIndicator","size","sizePx","CircleSvg","thickness","dashLength","PI","maxWidth","viewBox","xmlns","fill","stroke","strokeWidth","cx","cy","className","strokeDasharray","transformOrigin","Clipboard","setString","navigator","clipboard","writeText","VoiceChooser","languange","speechService","setLoading","setRenderId","refresh","getVoicesForLanguange","voice","setVoiceForLanguange","speak","margin","isSelected","lang","localService","$find","KEY","forced","callbackfn","initialState","lastState","callbacks","callback","defaultDoodleDrawing","segments","encodeDoodleSegmentPoints","points","last","y","decodeDoodleSegmentPoints","pointsString","point","encodeDoodleDrawing","doodle","o","w","h","doodleText","decodeDoodleDrawing","doodleSegmentToSvgPath_line","segment","React","_typeof","Symbol","iterator","constructor","_objectWithoutProperties","excluded","sourceKeys","indexOf","_objectWithoutPropertiesLoose","getOwnPropertySymbols","sourceSymbolKeys","propertyIsEnumerable","_slicedToArray","arr","_arrayWithHoles","toString","_arr","_n","_d","_e","_s","_i","next","done","err","_iterableToArrayLimit","_nonIterableRest","emptyFunction","emptyFunctionWithReset","hasOwnProperty","resetWarningCache","propTypes","fn","createCommonjsModule","shim","propName","componentName","propFullName","secret","getShim","isRequired","ReactPropTypes","array","bool","func","number","object","symbol","any","arrayOf","elementType","instanceOf","objectOf","oneOf","oneOfType","shape","exact","checkPropTypes","PropTypes","factoryWithThrowingShims","isUnknownObject","raw","isEqual","leftArray","leftPlainObject","leftKeys","rightKeys","keySet","allKeys","l","every","usePrevious","ref","validateStripe","maybeStripe","elements","createToken","createPaymentMethod","confirmCardPayment","parseStripeProp","then","isPromise","tag","stripePromise","Promise","resolve","stripe","ElementsContext","createContext","displayName","useElementsContextWithUseCase","useCaseMessage","useCase","concat","parseElementsContext","useContext","ElementsConsumer","_ref2","useCallbackReference","cb","extractUpdateableOptions","paymentRequest","noop","createElementComponent","isServer","toUpperCase","Element","createElement","_ref","_ref$options","_ref$onBlur","_ref$onFocus","onFocus","_ref$onReady","onReady","_ref$onChange","_ref$onEscape","onEscape","_ref$onClick","elementRef","domNode","callOnReady","callOnBlur","callOnFocus","callOnClick","callOnChange","callOnEscape","useLayoutEffect","mount","on","prevOptions","warn","updateableOptions","destroy","__elementType","AuBankAccountElement","CardElement","CardNumberElement","CardExpiryElement","CardCvcElement","FpxBankElement","IbanElement","IdealBankElement","PaymentRequestButtonElement","Elements","rawStripeProp","_final","isMounted","parsed","useMemo","_React$useState2","setContext","prevStripe","anyStripe","_registerWrapper","version","Provider","useElements","useStripe","defineProperty","factory","formatPhoneNumber_UsaCanada","phoneNumberMask_UsaCanada","corrected","toStandardPhoneNumber","digitsNo1","digits","letters","iDigit","iLast","full","_toConsumableArray","arr2","_arrayWithoutHoles","iter","from","_iterableToArray","_nonIterableSpread","V3_URL","V3_URL_REGEX","EXISTING_SCRIPT_MESSAGE","loadScript","params","reject","Stripe","script","scripts","document","querySelectorAll","src","findScript","queryString","advancedFraudSignals","headOrBody","head","body","appendChild","injectScript","addEventListener","initStripe","registerWrapper","stripePromise$1","loadCalled","ProcessSteps_CreateSavedPaymentMethod","PaymentError","ProcessSteps_CreateSavedPaymentMethod_Stripe","_02_Server_SetupSavedPaymentMethod","_03_Client_CollectPaymentDetails","_04_Server_ObtainPaymentMethod","logProcessStep_CreateSavedPaymentMethod_Stripe","step","status","wrapProcessStep_CreateSavedPaymentMethod_Stripe","execute","createPaymentClientComponents_stripe","_len","_key","loadStripe","stripePublicKey","AppWrapperComponent","PaymentMethodEntryComponent","paymentMethodSetupToken","onPaymentMethodReady","stripeError","setStripeError","handleSubmit","event","_03A_Client_CollectPaymentDetails","setupInfo","stripeDecodeClientSetupToken","confirmCardSetup","clientSecret","payment_method","card","getElement","billing_details","customerBillingDetails","setupIntent","stripeEncodeClientToken","inputStyle","base","textColor","fontSmoothing","invalid","textColor_invalid","iconColor","inputContainerStyle","marginBottom","elementPadding","textPadding","backgroundColor","buttonStyle","fontWeight","buttonJustifyContent","buttonAlignment","errorContainerStyle","errorMessageStyle","onSubmit","buttonText","stripeEncodeClientSetupToken","uploadApi","getUserProfile","getActiveUserProfile","uploadBackup","uploadWithAutoRenew","updateUserProfileFromServer","updateAllProfilesFromServer","isSetupStarted","isSetupDone","createUploadApiWebClient","getUserDataServiceState","setUserDataServiceState","getUserData","userState","activeUserProfileKey","metadata","timestamp","clearUserData","removeItem","lastUploadTimestamp","setUserData","userData","val","userProfileKey","createUploadUrl","contentType","prefix","uploadUrl","relativePath","uploader","createUploader","uploadData","upload","renewUploadUrl","newUploarUrl","downloadData","getUrl","delay","doSetup","newUploadUrlResult","newState","changeTimestamp","user","isActive","stateJson","downloadUserDataIfNewer","setUserProfileInfo","info","uData","createShareCode","shareablePath","shareUrlResult","shareCode","addUserFromShareCode","shareGetUrl","sharedUploadUrl","putUrl","userKey","toAbsoluteIndex","fromCharCode","$fromCodePoint","code","res","aLen","RangeError","config","apiRequest","endpoint","url","requestData","webRequest","resultObj","sign","fetchWithTimeout","method","headers","json","ok","createSmartUploader","uploadApiWebClient","_uploadUrl","setupUploadUrl","getUploadUrl","setUploadUrl","backupUrl","backupUploader","DefaultContext","attr","IconContext","__assign","assign","__rest","GenIcon","IconBase","Tree2Element","tree","elem","conf","computedSize","title","svgProps","Consumer","toObject","arraySpeciesCreate","flatMap","A","O","createSpeechService","synth","speechSynthesis","selectedVoices","voiceLang","u","SpeechSynthesisUtterance","voices","getVoices","language","jsonStringify_safe","shouldFormat","visited","_","errorBoxStyle","view","theme","view_error","text_error","text_errorMessage","icon","icon_errorMessage","button","outlineColor","colors","outline","ErrorBox_Inner","expanded","setExpanded","errorAsString","errorMessage","errorDetails","errorObjText","canExpand","kind","collapsed","copy","retryCallback","retry","Button","styleAlt","button_formAction_alt","button_formAction","extractViewStyle","extractTextStyle","C","Loading","loader","LoadingInline","ErrorBox","ErrorMessage","View_Panel","view_panel","View_Form","view_form","View_FormFields","view_formFields","View_FieldRow","view_fieldRow","View_FormActionRow","view_formActionRow","Text_FormTitle","text_formTitle","Text_FieldLabel","text_fieldLabel","Button_FieldInline","button_fieldInline_alt","button_fieldInline","Button_FormAction","Input_Text","input_fieldEntry","Input_Username","Input_Password","showPassword","setShowPassword","marginRight","eye","eyeSlash","Input_Phone","valueActual","setValueActual","Input_Email","Input_Currency","timeout","Icon","menu","component","MdMenu","back","MdArrowBack","MdErrorOutline","FiChevronDown","FiChevronRight","MdContentCopy","FaRedo","dashboard","MdDashboard","add","FaPlus","remove","FaMinus","FaEye","FaEyeSlash","checkChecked","FaCheckSquare","checkUnchecked","FaSquare","MdCheckBoxOutlineBlank","getIcon","IconComponent","sizes","marginTop","paddingTop","paddingBottom","minWidth","lineHeight","basicThemeColors","text_header","text_button","border","border_minor","border_input","background_field","background_button","background_error","getBorderSizes","all","borderLeftWidth","borderRightWidth","borderTopWidth","borderBottomWidth","bottom","basicThemeSizes","borderWidth_minor","borderWidth_input","sectionGap","elementGap","rowGap","rowPadding","fontSize_input","fontSize_button","fontSize_header","minWidth_label","minWidth_input","minWidth_button","basicFont","fontWeight_normal","fontWeight_button","fontWeight_header","createTheme","font","borderProps","borderProps_minor","borderProps_input","sTextView","moveItem","to","splice","distinct","Set","distinct_key","getKey","set","sameArrayContents","userProfileChracters","UserProfileManagerView","onActiveUserChange","onUserProfileChange","onUserAdded","AddUserProfileView","setShareCode","UserProfileView","setCharacters","onNameChange","UserProfileName","setName","isEditingName","setIsEditingName","changeName","mounted","useMounted","loadingError","setLoadingError","doWorkInner","getContext","contextInit","doCall","createSpellingProblemService","maxAnswers","sectionSize","speech","spellingEntries","getSpellingEntries","sectionCount","nextIndex","completedSectionKeys","getSectionKey","sectionIndex","loaded","isComplete","correctValue","word","wrongAnswerCount","wrongValues","mispellings","onQuestion","sectionKey","drawing","DoodleTestView","setDoodle","DoodleDrawerView","DoodleDisplayView","scale","setSegment","segmentClientStart","divHost","nativeEvent","pos","div","rect","getBoundingClientRect","clientX","clientY","onClientMove","lastPos","abs","onMove","onIgnoreNative","passive","removeEventListener","preserveAspectRatio","d","onMouseMove","touches","GamepadAnalogStateful","moveDirection","buttons","isDown","onPressStateChange","onMovePressIn","dir","onMovePressOut","inputStyles","alignSelf","section","moveSectionWrapper","moveSectionRotation","row","cellTouch","cellView","pointerEvents","cellText","moveCellText","cellEmptyView","cellTextOcclusionView","GamepadAnalog","cellViewStyle","onKeyDown","onKeyUp","DirectionButton","direction","ActionButton","Fragment","getDistanceSq","EducationalGame_StarBlastSideways_Multiples","problemService","createAutoSavedProblemService","m","bVal","round","EducationalGame_StarBlastSideways","EducationalGame_StarBlastSideways_Inner","paused","pauseState","setPauseState","pressState","setPressState","problemSourceKey","setProblemSourceKey","gamepad","onOpen","onSubjectNavigation","viewscreen","gameStyles","directAnswerButtonContainer","directAnswerButton","directAnswerButton_hidden","viewscreenView","sprite","viewSize","fontSize_small","gameOver","GameView","getDefaultGameState","lastActualTimeMs","lastGameTime","gameSpeed","lives","score","getGameTime","actualTimePassed","gameTime","gameTimePassed","playerPositionState","rotation","projectilesState","lastShotActualTime","shots","debris","enemiesState","enemies","problemsState","restartGame","e2","gotoNextProblem","pSize","newProblemState","problemTime","isAnsweredWrong","newEnemyState","ans","enemy","vel","onHit","ignore","destroyed","gameLastTime","requestAnimationFrame","gameLoop","gameDeltaTime","getCommonState","playerPosition","onLoseLife","deadTime","gameOverTime","gameResult","updateGame","playerResult","updatePlayer","projectilesResult","updateProjectiles","enemiesResult","updateEnemies","timeSinceProblem","hasHitGround","explodeTime","weaponsLock","lockedEnemy","lockedAtPlayerPosition","playerTargetPosition","directAnswer","dirPress","targetPos","targetRotation","gw","gh","playerPos","didShoot","destoyed","pad","hPad","shift","newShots","radius","radiusSq","radiusSq_enemies","i2","swap","radiusSq_player","wPad","closestEnemyToPlayer","newEnemies","Sprite","offsetX","offsetY","getSpriteEmoji","stylePosition","styleRotation","TextPositioned","createLeaderboard","leaderboard","saveScore","loadScore","sortKey","storageKey","sortDescending","leaderboardInputStyles","textInput","buttonView","LeaderboardNameInput","leaderboardStyles","scoreView","nameText","scoreText","LeaderboardViewInner","scoreColumns","scores","getValue","useLeaderboard","getScore","leaderboardScores","setLeaderboardScores","LeaderboardArea","onScoreSaved","race","fetch","reqData","catch","responseStatus","request","toInteger","count","subjectStyles","header","SubjectNavigator","scrollTo","createProblemStateStorage","randomBinary"],"mappings":"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","file":"commons-6de4af005b6c56ba0294.js","sourcesContent":["export const getValuesAsItems = <T>(obj: T) => {\r\n    return Object.keys(obj).map(k => k as keyof typeof obj).map(k => obj[k]).filter(x => x);\r\n};\r\n\r\nexport const toKeyValueObject = <T>(items: { key: string, value: T }[]): { [key: string]: T } => {\r\n    const v = {} as { [key: string]: T };\r\n    items.forEach(x => { v[x.key] = x.value; });\r\n    return v;\r\n};\r\n\r\nexport const toMap = <T>(items: { key: string, value: T }[]): Map<string, T> => {\r\n    const v = new Map(items.map(x => [x.key, x.value]));\r\n    return v;\r\n};\r\n\r\nexport const toKeyValueArray = <T>(obj: { [key: string]: T }): { key: string, value: T }[] => {\r\n    return Object.keys(obj).map(k => k as keyof typeof obj).map(k => ({ key: k as string, value: obj[k] }));\r\n};\r\n","// 26.1.2 Reflect.construct(target, argumentsList [, newTarget])\nvar $export = require('./_export');\nvar create = require('./_object-create');\nvar aFunction = require('./_a-function');\nvar anObject = require('./_an-object');\nvar isObject = require('./_is-object');\nvar fails = require('./_fails');\nvar bind = require('./_bind');\nvar rConstruct = (require('./_global').Reflect || {}).construct;\n\n// MS Edge supports only 2 arguments and argumentsList argument is optional\n// FF Nightly sets third argument as `new.target`, but does not create `this` from it\nvar NEW_TARGET_BUG = fails(function () {\n  function F() { /* empty */ }\n  return !(rConstruct(function () { /* empty */ }, [], F) instanceof F);\n});\nvar ARGS_BUG = !fails(function () {\n  rConstruct(function () { /* empty */ });\n});\n\n$export($export.S + $export.F * (NEW_TARGET_BUG || ARGS_BUG), 'Reflect', {\n  construct: function construct(Target, args /* , newTarget */) {\n    aFunction(Target);\n    anObject(args);\n    var newTarget = arguments.length < 3 ? Target : aFunction(arguments[2]);\n    if (ARGS_BUG && !NEW_TARGET_BUG) return rConstruct(Target, args, newTarget);\n    if (Target == newTarget) {\n      // w/o altered newTarget, optimization for 0-4 arguments\n      switch (args.length) {\n        case 0: return new Target();\n        case 1: return new Target(args[0]);\n        case 2: return new Target(args[0], args[1]);\n        case 3: return new Target(args[0], args[1], args[2]);\n        case 4: return new Target(args[0], args[1], args[2], args[3]);\n      }\n      // w/o altered newTarget, lot of arguments case\n      var $args = [null];\n      $args.push.apply($args, args);\n      return new (bind.apply(Target, $args))();\n    }\n    // with altered newTarget, not support built-in constructors\n    var proto = newTarget.prototype;\n    var instance = create(isObject(proto) ? proto : Object.prototype);\n    var result = Function.apply.call(Target, instance, args);\n    return isObject(result) ? result : instance;\n  }\n});\n","// https://github.com/tc39/proposal-string-pad-start-end\nvar toLength = require('./_to-length');\nvar repeat = require('./_string-repeat');\nvar defined = require('./_defined');\n\nmodule.exports = function (that, maxLength, fillString, left) {\n  var S = String(defined(that));\n  var stringLength = S.length;\n  var fillStr = fillString === undefined ? ' ' : String(fillString);\n  var intMaxLength = toLength(maxLength);\n  if (intMaxLength <= stringLength || fillStr == '') return S;\n  var fillLen = intMaxLength - stringLength;\n  var stringFiller = repeat.call(fillStr, Math.ceil(fillLen / fillStr.length));\n  if (stringFiller.length > fillLen) stringFiller = stringFiller.slice(0, fillLen);\n  return left ? stringFiller + S : S + stringFiller;\n};\n","export const uploadApiConfig = {\r\n    uploadApiUrl: `https://s7mrgkmtk5.execute-api.us-east-1.amazonaws.com/prod/upload-api`,\r\n};\r\n","'use strict';\n// https://github.com/tc39/proposal-string-pad-start-end\nvar $export = require('./_export');\nvar $pad = require('./_string-pad');\nvar userAgent = require('./_user-agent');\n\n// https://github.com/zloirock/core-js/issues/280\nvar WEBKIT_BUG = /Version\\/10\\.\\d+(\\.\\d+)?( Mobile\\/\\w+)? Safari\\//.test(userAgent);\n\n$export($export.P + $export.F * WEBKIT_BUG, 'String', {\n  padStart: function padStart(maxLength /* , fillString = ' ' */) {\n    return $pad(this, maxLength, arguments.length > 1 ? arguments[1] : undefined, true);\n  }\n});\n","export const randomIndex = (length: number) => {\r\n    const x = Math.floor(length * Math.random());\r\n    return x >= length ? length - 1 : x;\r\n};\r\nexport const randomItem = <T>(items: T[]) => items[randomIndex(items.length)];\r\n","var $parseInt = require('./_global').parseInt;\nvar $trim = require('./_string-trim').trim;\nvar ws = require('./_string-ws');\nvar hex = /^[-+]?0[xX]/;\n\nmodule.exports = $parseInt(ws + '08') !== 8 || $parseInt(ws + '0x16') !== 22 ? function parseInt(str, radix) {\n  var string = $trim(String(str), 3);\n  return $parseInt(string, (radix >>> 0) || (hex.test(string) ? 16 : 10));\n} : $parseInt;\n","\r\nexport enum IconKind {\r\n    // common icons\r\n    menu,\r\n    back,\r\n    error,\r\n    expanded,\r\n    collapsed,\r\n    copy,\r\n    retry,\r\n    dashboard,\r\n    add,\r\n    remove,\r\n    eye,\r\n    eyeSlash,\r\n\r\n    checkChecked,\r\n    checkUnchecked,\r\n\r\n    // navigation icons\r\n    account,\r\n    message,\r\n    subscription,\r\n    calendar,\r\n    contacts,\r\n    keys,\r\n    resources,\r\n    admin,\r\n}\r\n","var $parseFloat = require('./_global').parseFloat;\nvar $trim = require('./_string-trim').trim;\n\nmodule.exports = 1 / $parseFloat(require('./_string-ws') + '-0') !== -Infinity ? function parseFloat(str) {\n  var string = $trim(String(str), 3);\n  var result = $parseFloat(string);\n  return result === 0 && string.charAt(0) == '-' ? -0 : result;\n} : $parseFloat;\n","var $export = require('./_export');\nvar $parseInt = require('./_parse-int');\n// 20.1.2.13 Number.parseInt(string, radix)\n$export($export.S + $export.F * (Number.parseInt != $parseInt), 'Number', { parseInt: $parseInt });\n","import React, { useState, useEffect } from 'react';\r\nimport { View, Text, TouchableOpacity } from 'react-native-lite';\r\nimport { useAutoLoadingError } from 'utils-react/hooks';\r\nimport { UserDataService, UserProfileInfo } from './user-data-service';\r\nimport { UserProfileManagerView } from './user-profile-manager-view';\r\n\r\nconst styles = {\r\n    container: {\r\n        flexDirection: `row`,\r\n        flexWrap: `wrap`,\r\n        justifyContent: `space-around`,\r\n    },\r\n    profileContainer: {\r\n        flexDirection: `column`,\r\n        alignItems: `center`,\r\n    },\r\n    profileCharacterView: {\r\n        width: 80,\r\n        height: 80,\r\n        borderWidth: 1,\r\n        borderStyle: `solid`,\r\n        borderColor: `#888888`,\r\n    },\r\n    profileCharacterText: {\r\n        fontSize: 48,\r\n        textAlign: `center`,\r\n    },\r\n    profileNameView: {\r\n    },\r\n    profileNameText: {\r\n\r\n    },\r\n} as const;\r\n\r\nexport const UserProfileSelectionView = (props: { onUserSelected: () => void }) => {\r\n    const { loading, error, doWork } = useAutoLoadingError();\r\n    const [userProfiles, setUserProfiles] = useState(null as null | UserProfileInfo[]);\r\n    const [isManagerVisible, setIsManagerVisible] = useState(false);\r\n\r\n    const reload = () => doWork(async (stopIfObsolete) => {\r\n        await UserDataService.get().setup();\r\n        stopIfObsolete();\r\n\r\n        const profiles = await UserDataService.get().getUserProfiles();\r\n        setUserProfiles(profiles);\r\n    });\r\n\r\n    const selectUser = (key: string) => doWork(async (stopIfObsolete) => {\r\n        await UserDataService.get().setActiveUser(key);\r\n        props.onUserSelected();\r\n    });\r\n\r\n    const onEditProfiles = () => {\r\n        setIsManagerVisible(true);\r\n    };\r\n\r\n    useEffect(() => {\r\n        reload();\r\n    }, []);\r\n\r\n    if (!userProfiles) {\r\n        return (<></>);\r\n    }\r\n\r\n    if (isManagerVisible) {\r\n        return <UserProfileManagerView onClose={() => { setIsManagerVisible(false); reload(); }} />;\r\n    }\r\n\r\n    return (\r\n        <View style={styles.container}>\r\n            {userProfiles.map(x => (\r\n                <TouchableOpacity key={x.key} onPress={() => selectUser(x.key)}>\r\n                    <View style={styles.profileContainer}>\r\n                        <View style={styles.profileCharacterView}>\r\n                            <Text style={styles.profileCharacterText}>{x.emoji ?? ``}</Text>\r\n                        </View>\r\n                        <View style={styles.profileNameView}>\r\n                            <Text style={styles.profileNameText}>{x.name}</Text>\r\n                        </View>\r\n                    </View>\r\n                </TouchableOpacity>\r\n            ))}\r\n            <TouchableOpacity onPress={onEditProfiles}>\r\n                <View style={styles.profileContainer}>\r\n                    <View style={styles.profileCharacterView}>\r\n                        <Text style={styles.profileCharacterText}>{`  `}</Text>\r\n                    </View>\r\n                    <View style={styles.profileNameView}>\r\n                        <Text style={styles.profileNameText}>Edit</Text>\r\n                    </View>\r\n                </View>\r\n            </TouchableOpacity>\r\n        </View>\r\n    );\r\n};\r\n","export type EmojiSkillNode = {\r\n    emoji: string;\r\n    name: string;\r\n    gender: `baby` | `male` | `female`;\r\n    pay: number;\r\n    startEmoji: null | string;\r\n    requirementEmojis: string[];\r\n    debug_totalRequirementsCost?: string;\r\n\r\n    parent: null | EmojiSkillNode;\r\n    children: EmojiSkillNode[];\r\n};\r\nexport type EmojiSkillRequirement = {\r\n    emoji: string;\r\n    cost: number;\r\n};\r\nexport type EmojiSkillTree = {\r\n    allNodes: EmojiSkillNode[];\r\n    allRequirements: EmojiSkillRequirement[];\r\n    root: EmojiSkillNode;\r\n};\r\n\r\n\r\nexport const buildEmojiSkillTree = (): EmojiSkillTree => {\r\n    const maleSkillDoc = `${child_male}\\n${student_male}\\n${skillDoc}`;\r\n    const femaleSkillDoc = `${child_female}\\n${student_female}\\n\\n${getFemaleVariant(skillDoc)}`;\r\n    const maleNodes = parseSkillDoc(maleSkillDoc, `male`);\r\n    const femaleNodes = parseSkillDoc(femaleSkillDoc, `female`);\r\n    const babyNode: EmojiSkillNode = {\r\n        emoji: babyEmoji,\r\n        name: `baby`,\r\n        gender: `baby`,\r\n        pay: 0,\r\n        requirementEmojis: [],\r\n        startEmoji: null,\r\n        parent: null,\r\n        children: [],\r\n    };\r\n    const allNodes = [babyNode, ...maleNodes, ...femaleNodes];\r\n    const root = babyNode;\r\n\r\n    allNodes.forEach(child => {\r\n        const parent = allNodes.find(x => child.startEmoji === x.emoji);\r\n        if (!parent) { return; }\r\n\r\n        parent.children.push(child);\r\n        child.parent = parent;\r\n    });\r\n\r\n    const allRequirements = parseRequirementsDoc(requirementsDoc);\r\n\r\n    allNodes.forEach(node => {\r\n        const allCosts = node.requirementEmojis\r\n            .map(r => allRequirements.find(x => x.emoji === r) ?? { emoji: r, cost: 0 });\r\n\r\n        const summary = allCosts\r\n            .map(x => `${x.emoji} = ${x.cost}`)\r\n            .join(`\\n`);\r\n\r\n        // eslint-disable-next-line unicorn/no-reduce\r\n        const totalCost = allCosts.reduce((out, x) => { out += x.cost; return out; }, 0);\r\n        node.debug_totalRequirementsCost = `${totalCost} =\\n${summary}`;\r\n    });\r\n\r\n    const tree: EmojiSkillTree = {\r\n        allNodes,\r\n        root,\r\n        allRequirements,\r\n    };\r\n\r\n    // const allRequirements = distinct(allNodes.flatMap(x => x.requirementEmojis));\r\n    // const allRequirementsDoc = allRequirements.map(x => `${x} = 0`).join(`\\n`);\r\n\r\n    // console.log(`buildSkillTree`, { tree, maleSkillDoc, femaleSkillDoc });\r\n    return tree;\r\n};\r\n// setTimeout(buildEmojiSkillTree);\r\n\r\nconst parseRequirementsDoc = (doc: string) => {\r\n    const lines = doc.split(`\\n`).map(x => x.trim()).filter(x => x);\r\n    const nodes = lines.map(line => {\r\n        const parts = line.split(`=`).map(x => x.trim()).filter(x => x);\r\n        const r: EmojiSkillRequirement = {\r\n            emoji: parts[0],\r\n            cost: Number.parseInt(parts[1], 10),\r\n        };\r\n        return r;\r\n    });\r\n    return nodes;\r\n};\r\n\r\nconst parseSkillDoc = (doc: string, gender: 'male' | 'female') => {\r\n    const lines = doc.split(`\\n`).map(x => x.trim()).filter(x => x);\r\n    const nodes = lines.map(x => parseSkillLine(x, gender));\r\n    return nodes;\r\n};\r\n\r\nconst parseSkillLine = (skillLine: string, gender: 'male' | 'female'): EmojiSkillNode => {\r\n    const [name, payText, p1] = skillLine.split(`:`).map(x => x.trim());\r\n    const pay = Number.parseInt(payText, 10);\r\n    const [end, p2] = p1.split(`=`).map(x => x.trim());\r\n    const [start, requirementsStr] = p2.split(`+`).map(x => x.trim());\r\n    const requirements = requirementsStr.split(` `).map(x => x.trim()).filter(x => x);\r\n    return { name, pay, emoji: end, startEmoji: start, requirementEmojis: requirements, children: [], parent: null, gender };\r\n};\r\n\r\nconst getFemaleVariant = (emoji: string) => {\r\n    return emoji\r\n        .replace(new RegExp(genderCharCodes.male, `g`), genderCharCodes.female)\r\n        .replace(new RegExp(genderCharCodes.man, `g`), genderCharCodes.woman);\r\n};\r\n\r\nconst genderCharCodes = {\r\n    man: String.fromCodePoint(0x1F468),\r\n    woman: String.fromCodePoint(0x1F469),\r\n    male: String.fromCodePoint(0x1F469),\r\n    female: String.fromCodePoint(0x1F469),\r\n};\r\n\r\nconst babyEmoji = ``;\r\nconst child_male = `boy               : 0 :  =  +           `;\r\nconst child_female = `girl            : 0 :  =  +           `;\r\nconst student_male = `  student_boy   : 0 :  =  +          `;\r\nconst student_female = `student_girl  : 0 :  =  +          `;\r\n\r\nconst skillDoc = `\r\nfactory_worker      :   20000 :  =  +                    \r\nmechanic            :   30000 :  =  +               \r\nconstruction_worker :   75000 :  =  +                             \r\nartist              :   35000 :  =  +                     \r\nsinger              :   40000 :  =  +               \r\nfarmer              :   50000 :  =  +                   \r\ncook                :   40000 :  =  +                   \r\nfirefighter         :   55000 :  =  +          \r\npolice_officer      :   60000 :  =  +                    \r\ndetective           :   70000 :  =  +                 \r\nteacher             :   50000 :  =  +       \r\noffice_worker       :   60000 :  =  +                     \r\ntechnologist        :   80000 :  =  +                      \r\nscientist           :   90000 :  =  +                    \r\njudge               :  120000 :  =  +          \r\nhealth_worker       :  100000 :  =  +          \r\npilot               :  110000 :  =  +            \r\nastronaut           :  130000 :  =  +       \r\n`;\r\n\r\nconst requirementsDoc = `\r\n = 10\r\n = 10\r\n = 20\r\n = 20\r\n = 10\r\n = 20\r\n = 30\r\n = 50\r\n = 25\r\n = 150\r\n = 200\r\n\r\n = 20\r\n = 20\r\n = 10\r\n = 20\r\n = 30\r\n\r\n = 30\r\n = 10\r\n = 20\r\n = 500\r\n = 15\r\n = 350\r\n = 1250\r\n = 7000\r\n = 800\r\n = 10000\r\n\r\n = 20\r\n = 80\r\n = 110\r\n = 25\r\n = 15\r\n = 300\r\n = 700\r\n = 35000\r\n = 150\r\n = 75\r\n = 150\r\n = 3000\r\n = 16000\r\n = 32000\r\n = 100\r\n = 70\r\n = 50\r\n = 35\r\n = 15\r\n = 15\r\n = 80\r\n = 150\r\n = 400\r\n = 150\r\n = 120\r\n = 750\r\n = 320\r\n = 450\r\n = 320\r\n = 1450\r\n = 25\r\n = 10\r\n = 35\r\n = 25\r\n = 30\r\n = 350\r\n = 150\r\n = 120\r\n = 100\r\n = 15000\r\n = 25\r\n = 30\r\n = 20\r\n = 75\r\n = 100\r\n = 50\r\n = 120\r\n = 350\r\n = 120\r\n = 225\r\n = 150\r\n = 250\r\n = 50\r\n = 75\r\n = 135000\r\n = 15000\r\n = 750\r\n = 500\r\n = 1250\r\n = 150\r\n = 55000\r\n = 250\r\n = 55\r\n = 85\r\n = 125\r\n = 25\r\n = 75\r\n = 25\r\n = 60\r\n = 30\r\n = 16000\r\n = 250\r\n = 150\r\n = 50\r\n = 750\r\n = 75\r\n = 150\r\n = 50\r\n = 1500\r\n = 150\r\n = 25\r\n = 3500\r\n = 150\r\n = 300\r\n = 250\r\n = 150\r\n = 650\r\n = 150\r\n = 100\r\n = 120\r\n = 1200\r\n = 1500\r\n = 75000\r\n = 550\r\n = 50\r\n = 850\r\n = 1500000\r\n = 350\r\n = 150000000\r\n`;\r\n","import { createSubscribable } from 'utils/subscribable';\r\nimport { toMap } from 'utils/objects';\r\nimport { buildEmojiSkillTree } from './emoji-skills/emoji-skill-tree';\r\n\r\nexport type EmojiIdleEmotionKind = 'excited' | 'happy' | 'normal' | 'angry' | 'sick' | 'dead';\r\nexport type EmojiIdleState = {\r\n    characterEmoji: string;\r\n    targetEmoji?: string;\r\n    targetOptions?: { emoji: string }[];\r\n    requirementsPurchased?: string[];\r\n    requirementsAvailable?: { emoji: string, cost: number }[];\r\n    requirementsRemaining?: { emoji: string, cost: number }[];\r\n    requirementsNeeded?: { emoji: string, cost: number }[];\r\n    lastPurchaseTimestamp: number;\r\n\r\n    emotion: EmojiIdleEmotionKind;\r\n    lastEmotionTimestamp: number;\r\n\r\n    money: number;\r\n\r\n    multiplier: number;\r\n    lastMultiplierChangeTimestamp: number;\r\n\r\n    townState: {\r\n        characters: {\r\n            characterEmoji: string;\r\n            finishedTimestamp: number;\r\n            // requirementsPurchased: string[];\r\n        }[];\r\n    };\r\n};\r\n\r\nconst storageKey = `EmojiIdleState`;\r\nconst storage = {\r\n    save: (value: EmojiIdleState) => { localStorage.setItem(storageKey, JSON.stringify(value)); },\r\n    load: () => {\r\n        if (!localStorage.getItem(storageKey)) { return null; }\r\n        try {\r\n            return JSON.parse(localStorage.getItem(storageKey) ?? ``);\r\n        } catch{\r\n            return null;\r\n        }\r\n    },\r\n};\r\n\r\nconst createService = () => {\r\n    const skillTree = buildEmojiSkillTree();\r\n    const reqMap = toMap(skillTree.allRequirements.map(x => ({ key: x.emoji, value: x })));\r\n\r\n    const defaultState: EmojiIdleState = {\r\n        characterEmoji: skillTree.root.emoji,\r\n        emotion: `normal`,\r\n        lastEmotionTimestamp: Date.now(),\r\n        money: 0,\r\n        multiplier: 1,\r\n        lastMultiplierChangeTimestamp: Date.now(),\r\n        lastPurchaseTimestamp: Date.now(),\r\n        townState: {\r\n            characters: [],\r\n        },\r\n    };\r\n    let s: EmojiIdleState = storage.load() ?? defaultState;\r\n\r\n    // Load missing state fields\r\n    s = { ...defaultState, ...s };\r\n\r\n    // // Hard code Missing Town Characters for Kids Accounts\r\n    // s.townState = {\r\n    //     // characters: [...skillTree.allNodes.filter(x => x.children.length <= 0).slice(0, 5).map(x => ({\r\n    //     //     characterEmoji: x.emoji,\r\n    //     //     finishedTimestamp: Date.now() - Math.random() * 1000 * 60 * 60 * 24 * 7,\r\n    //     // }))],\r\n    //     characters: [...skillTree.allNodes\r\n    //         .filter(x => x.name === `artist` && x.gender === `female`)\r\n    //         .map(x => ({\r\n    //             characterEmoji: x.emoji,\r\n    //             finishedTimestamp: Math.floor(Date.now() - 0.25 * 1000 * 60 * 60 * 24),\r\n    //         }))],\r\n    // };\r\n\r\n    const sub = createSubscribable<EmojiIdleState>(s);\r\n\r\n    const changeState = (partialState: Partial<EmojiIdleState>) => {\r\n        // console.log(`changePetState`, { partialState, before: { ...s } });\r\n        s = { ...s, ...partialState };\r\n        sub.onStateChange(s);\r\n        storage.save(s);\r\n    };\r\n\r\n    const rewardInner = (value: number) => {\r\n        // max multiplier - keeps things more linear?\r\n        const maxMultiplier = 100;\r\n        changeState({\r\n            money: s.money + s.multiplier,\r\n            multiplier: Math.min(maxMultiplier, s.multiplier + value),\r\n            lastMultiplierChangeTimestamp: Date.now(),\r\n        });\r\n    };\r\n\r\n    const punish = () => {\r\n        // This is the only way to lose multiplier\r\n        changeState({\r\n            multiplier: Math.max(1, s.multiplier - 5),\r\n            lastMultiplierChangeTimestamp: Date.now(),\r\n        });\r\n    };\r\n\r\n    const selectOption = (emoji: string) => {\r\n        // console.log(`selectOption`, { emoji });\r\n\r\n        // Choose character\r\n        if (s.targetOptions?.find(x => x.emoji === emoji)) {\r\n            if (emoji === skillTree.root.emoji) {\r\n                // Add finished character to town\r\n                s.townState.characters.push({\r\n                    characterEmoji: s.characterEmoji,\r\n                    finishedTimestamp: Date.now(),\r\n                });\r\n            }\r\n\r\n            changeState({\r\n                targetEmoji: emoji,\r\n                targetOptions: undefined,\r\n                emotion: `excited`,\r\n                lastEmotionTimestamp: Date.now(),\r\n                lastPurchaseTimestamp: Date.now(),\r\n\r\n                money: 0,\r\n                // money: emoji === skillTree.root.emoji ? 0 : s.money,\r\n            });\r\n        }\r\n\r\n        // Purchases\r\n        const r = s.requirementsAvailable?.find(x => x.emoji === emoji);\r\n        if (r && r.cost <= s.money) {\r\n            // Purchase \r\n            changeState({\r\n                requirementsPurchased: [...s.requirementsPurchased ?? [], r.emoji],\r\n                requirementsRemaining: undefined,\r\n                money: s.money - r.cost,\r\n                requirementsAvailable: undefined,\r\n                emotion: `excited`,\r\n                lastEmotionTimestamp: Date.now(),\r\n                lastPurchaseTimestamp: Date.now(),\r\n            });\r\n        }\r\n\r\n        // Ignore\r\n    };\r\n\r\n    // Update state\r\n    setInterval(() => {\r\n        const second = 1000;\r\n        const minute = 60 * second;\r\n        const hour = 60 * minute;\r\n\r\n        // console.log(`emoji - idle - service update`, {});\r\n\r\n        // This is too powerful against slow players\r\n        // // Decrease Multiplier over time\r\n        // const decTime = 3 * second;\r\n        // if (s.multiplier > 1 && Date.now() > s.lastMultiplierChangeTimestamp + decTime) {\r\n        //     const timeDelta = Date.now() - s.lastMultiplierChangeTimestamp;\r\n        //     const multChange = Math.floor(timeDelta / decTime);\r\n\r\n        //     // console.log(`emoji - idle - service`, { timeDelta, multChange });\r\n        //     changeState({\r\n        //         multiplier: Math.max(1, s.multiplier - multChange),\r\n        //         lastMultiplierChangeTimestamp: Date.now(),\r\n        //     });\r\n        // }\r\n\r\n        // Choose target\r\n        if (!s.targetEmoji && !s.targetOptions) {\r\n            const skillNode = skillTree.allNodes.find(x => x.emoji === s.characterEmoji);\r\n            if (skillNode) {\r\n                let t = skillNode.children.map(x => ({ emoji: x.emoji }));\r\n                const remainingSkills = t.filter(x => !s.townState.characters.find(c => c.characterEmoji));\r\n\r\n                if (remainingSkills.length > 0) {\r\n                    t = remainingSkills;\r\n                }\r\n\r\n                if (t.length === 0) {\r\n                    // Top of skill tree\r\n                    changeState({\r\n                        targetOptions: [{ emoji: skillTree.root.emoji }],\r\n                    });\r\n                }\r\n                // else if (t.length === 1) {\r\n                //     // Auto select\r\n                //     changeState({\r\n                //         targetEmoji: t[0].emoji,\r\n                //     });\r\n                // } \r\n                else {\r\n                    changeState({\r\n                        targetOptions: t,\r\n                    });\r\n                }\r\n            }\r\n        }\r\n\r\n        // Populate Available Requirements\r\n        if (s.targetEmoji) {\r\n            const targetSkillNode = skillTree.allNodes.find(x => x.emoji === s.targetEmoji);\r\n            if (targetSkillNode) {\r\n                // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\r\n                const reqs = targetSkillNode.requirementEmojis.map(x => reqMap.get(x)).filter(x => x).map(x => x!);\r\n                const reqs_remaining = reqs.filter(x => !s.requirementsPurchased?.includes(x.emoji));\r\n                reqs_remaining.sort((a, b) => a.cost - b.cost);\r\n                const reqs_available = reqs_remaining.filter(x => x.cost <= s.money);\r\n\r\n                if (reqs_available.length !== s.requirementsAvailable?.length) {\r\n                    changeState({\r\n                        requirementsNeeded: reqs,\r\n                        requirementsAvailable: reqs_available,\r\n                    });\r\n                }\r\n\r\n                if (reqs_remaining.length !== s.requirementsRemaining?.length) {\r\n                    changeState({\r\n                        requirementsRemaining: reqs_remaining,\r\n                    });\r\n                }\r\n\r\n                // Target completed\r\n                if (reqs_remaining.length <= 0) {\r\n                    changeState({\r\n                        characterEmoji: s.targetEmoji,\r\n                        targetEmoji: undefined,\r\n                        targetOptions: undefined,\r\n                        requirementsAvailable: undefined,\r\n                        requirementsNeeded: undefined,\r\n                        requirementsPurchased: undefined,\r\n                    });\r\n                }\r\n            }\r\n\r\n            // Emotion\r\n            if (Date.now() > (s.lastEmotionTimestamp ?? 0) + 15 * second) {\r\n                // TODO: Sickness\r\n                const emotion = Date.now() > (s.lastPurchaseTimestamp ?? 0) + 5 * minute ? `angry`\r\n                    : `normal`;\r\n\r\n                if (s.emotion !== emotion) {\r\n                    changeState({ emotion, lastEmotionTimestamp: Date.now() });\r\n                }\r\n            }\r\n        }\r\n\r\n    }, 1000);\r\n\r\n    return {\r\n        subscribePetStateChange: sub.subscribe,\r\n        reward: () => rewardInner(1),\r\n        reward_major: () => rewardInner(10),\r\n        reward_extreme: () => rewardInner(100),\r\n        punish,\r\n\r\n        selectOption,\r\n    };\r\n};\r\n\r\nexport type EmojiIdleService = ReturnType<typeof createService>;\r\n\r\nconst serviceState = {\r\n    instance: null as null | EmojiIdleService,\r\n};\r\nexport const EmojiIdleService = {\r\n    get: () => {\r\n        // eslint-disable-next-line no-return-assign\r\n        return serviceState.instance ?? (serviceState.instance = createService());\r\n    },\r\n    reset: () => {\r\n        serviceState.instance = createService();\r\n    },\r\n};\r\n","import React, { useState, useEffect, useRef } from 'react';\r\nimport { View, Text, TouchableOpacity } from 'react-native-lite';\r\nimport { shuffle } from 'utils/arrays';\r\nimport { EmojiIdleService, EmojiIdleState, EmojiIdleEmotionKind } from './emoji-idle-service';\r\nimport { buildEmojiSkillTree } from './emoji-skills/emoji-skill-tree';\r\n\r\nexport const styles = {\r\n    container: {\r\n        height: 40,\r\n    },\r\n    fixed: {\r\n        position: `fixed`,\r\n        top: 0, right: 0, left: 0,\r\n        zIndex: 1000,\r\n    },\r\n    inner: {\r\n        position: `relative`,\r\n        height: 40,\r\n    },\r\n    emotionEmoji: {\r\n        fontFamily: `\"Lucida Console\", Monaco, monospace`,\r\n        fontSize: 24,\r\n    },\r\n    characterEmoji: {\r\n        fontFamily: `\"Lucida Console\", Monaco, monospace`,\r\n        fontSize: 24,\r\n    },\r\n    characterEmoji_small: {\r\n        fontFamily: `\"Lucida Console\", Monaco, monospace`,\r\n        fontSize: 16,\r\n    },\r\n    costText: {\r\n        fontFamily: `\"Lucida Console\", Monaco, monospace`,\r\n        fontSize: 16,\r\n        color: `#00FF00`,\r\n    },\r\n    costText_small: {\r\n        fontFamily: `\"Lucida Console\", Monaco, monospace`,\r\n        fontSize: 10,\r\n        color: `#00FF00`,\r\n    },\r\n    targetCharacterEmoji: {\r\n        fontFamily: `\"Lucida Console\", Monaco, monospace`,\r\n        fontSize: 16,\r\n    },\r\n    objectEmoji: {\r\n        fontFamily: `\"Lucida Console\", Monaco, monospace`,\r\n        fontSize: 12,\r\n    },\r\n\r\n    money: {\r\n        fontFamily: `\"Lucida Console\", Monaco, monospace`,\r\n        fontSize: 20,\r\n        color: `#FFFF00`,\r\n        marginLeft: 8,\r\n    },\r\n    money_small: {\r\n        fontFamily: `\"Lucida Console\", Monaco, monospace`,\r\n        fontSize: 16,\r\n        color: `#FFFF00`,\r\n    },\r\n    multiplier: {\r\n        fontFamily: `\"Lucida Console\", Monaco, monospace`,\r\n        fontSize: 14,\r\n        color: `#FF00FF`,\r\n        marginLeft: 8,\r\n    },\r\n    foodText: {\r\n        fontFamily: `\"Lucida Console\", Monaco, monospace`,\r\n        fontSize: 12,\r\n        color: `#333300`,\r\n    },\r\n} as const;\r\n\r\nexport const EmojiIdleView = (props: {}) => {\r\n    const [gameState, setGameState] = useState(null as null | EmojiIdleState);\r\n    const [isExpanded, setIsExpanded] = useState(false);\r\n    useEffect(() => {\r\n        const service = EmojiIdleService.get();\r\n        const sub = service.subscribePetStateChange(setGameState);\r\n        return () => sub.unsubscribe();\r\n    });\r\n\r\n    if (isExpanded && gameState) {\r\n        return (\r\n            <TownView gameState={gameState} onClose={() => setIsExpanded(false)} />\r\n        );\r\n    }\r\n\r\n    return (\r\n        <View style={styles.container}>\r\n            <View style={styles.fixed}>\r\n                <View style={styles.inner}>\r\n                    <EmojiCharacterView\r\n                        emoji={gameState?.characterEmoji ?? ``}\r\n                        targetEmoji={gameState?.targetEmoji ?? ``}\r\n                        emotion={gameState?.emotion ?? null}\r\n                        purchased={gameState?.requirementsPurchased ?? []}\r\n                        onPress={() => setIsExpanded(s => !s)}\r\n                    />\r\n                    {gameState && <CommandsView gameState={gameState} />}\r\n                    {/* {gameState && gameState.food > 0 && [...new Array(gameState.food)].map((x, i) => (\r\n                        // eslint-disable-next-line react/no-array-index-key\r\n                        <View key={`${i}`} style={{ position: `absolute`, transform: `translate(${100 + i * 87 % 100}px,${4 + i * 43 % 12}px)` }} >\r\n                            <Text style={styles.foodText}>{getFoodVariant(i)}</Text>\r\n                        </View>\r\n                    ))} */}\r\n                </View>\r\n            </View>\r\n        </View>\r\n    );\r\n};\r\n\r\nexport const townStyles = {\r\n    container: {\r\n        background: `#555555`,\r\n    },\r\n    payText: {\r\n        fontFamily: `\"Lucida Console\", Monaco, monospace`,\r\n        fontSize: 14,\r\n        color: `#FFFFFF`,\r\n    },\r\n    payText_disabled: {\r\n        fontFamily: `\"Lucida Console\", Monaco, monospace`,\r\n        fontSize: 14,\r\n        color: `#CCCCCC`,\r\n    },\r\n    moneyText: {\r\n        fontFamily: `\"Lucida Console\", Monaco, monospace`,\r\n        fontSize: 16,\r\n        color: `#FFFF00`,\r\n    },\r\n    townMoneyText: {\r\n        fontFamily: `\"Lucida Console\", Monaco, monospace`,\r\n        fontSize: 16,\r\n        color: `#00FF00`,\r\n    },\r\n} as const;\r\n\r\nconst skillTree = buildEmojiSkillTree();\r\nconst TownView = ({ gameState, onClose }: { gameState: EmojiIdleState, onClose: () => void }) => {\r\n    // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\r\n    const townPersons = gameState.townState.characters.map(x => ({\r\n        character: x,\r\n        skill: skillTree.allNodes.find(n => n.emoji === x.characterEmoji) ?? skillTree.root,\r\n    }))\r\n        .filter(x => x.skill.pay)\r\n        .map(x => ({\r\n            ...x,\r\n            years: (Date.now() - x.character.finishedTimestamp) / (24 * 60 * 60 * 1000),\r\n            money: Math.floor((Date.now() - x.character.finishedTimestamp) / (24 * 60 * 60 * 1000) * x.skill.pay),\r\n        }));\r\n    const missingSkills = skillTree.allNodes.filter(x => x.children.length <= 0 && !gameState.townState.characters.find(t => t.characterEmoji === x.emoji));\r\n    // eslint-disable-next-line unicorn/no-reduce\r\n    const townMoney = townPersons.reduce((out, x) => { out += x.money ?? 0; return out; }, 0);\r\n    return (\r\n        <View style={townStyles.container}>\r\n            <View>\r\n                <View style={{ background: `#333333`, flexDirection: `row`, alignItems: `center` }}>\r\n                    <View style={{ position: `relative`, width: 100, height: 40 }}>\r\n                        <View style={{ position: `absolute`, left: 0, top: 0, flexDirection: `column`, alignItems: `flex-end` }} >\r\n                            <TouchableOpacity onPress={() => onClose()}>\r\n                                <Text style={styles.characterEmoji}>{`  `}</Text>\r\n                            </TouchableOpacity>\r\n                        </View>\r\n                    </View>\r\n                    <View style={{ flex: 1 }} />\r\n                    <View style={{ padding: 4 }}>\r\n                        <Text style={townStyles.townMoneyText}>{`$${(townMoney).toLocaleString()}`}</Text>\r\n                    </View>\r\n                </View>\r\n            </View>\r\n            <View style={{ background: `#333333`, flexDirection: `row`, alignItems: `center` }}>\r\n                <View style={{ position: `relative`, width: 100, height: 40 }}>\r\n                    <EmojiCharacterView\r\n                        emoji={gameState?.characterEmoji ?? ``}\r\n                        targetEmoji={gameState?.targetEmoji ?? ``}\r\n                        emotion={gameState?.emotion ?? null}\r\n                        purchased={gameState?.requirementsPurchased ?? []}\r\n                        onPress={() => onClose()}\r\n                    />\r\n                </View>\r\n            </View>\r\n            {/* Finished Characters */}\r\n            {townPersons.map(x => (\r\n                <View style={{ background: `#333333`, flexDirection: `row`, alignItems: `center` }}>\r\n                    <View style={{ position: `relative`, width: 100, height: 40 }}>\r\n                        <EmojiCharacterView\r\n                            emoji={x.character.characterEmoji}\r\n                            targetEmoji=''\r\n                            emotion='happy'\r\n                            purchased={x.skill?.requirementEmojis ?? []}\r\n                        />\r\n                    </View>\r\n                    <View style={{ padding: 4 }}>\r\n                        <Text style={townStyles.payText}>{`$${(x.skill?.pay ?? 0).toLocaleString()}`}</Text>\r\n                    </View>\r\n                    <View style={{ padding: 4 }}>\r\n                        <Text style={townStyles.payText}>{`x${(x.years).toFixed(1)}`}</Text>\r\n                    </View>\r\n                    <View style={{ flex: 1 }} />\r\n                    <View style={{ padding: 4 }}>\r\n                        <Text style={townStyles.moneyText}>{`$${(x.money).toLocaleString()}`}</Text>\r\n                    </View>\r\n                </View>\r\n            ))}\r\n            {/* Missing Characters */}\r\n            {missingSkills.map(x => (\r\n                <View style={{ background: `#555555`, flexDirection: `row`, alignItems: `center` }}>\r\n                    <View style={{ position: `relative`, width: 100, height: 40, opacity: 0.5 }}>\r\n                        <EmojiCharacterView\r\n                            emoji={x.emoji}\r\n                            targetEmoji=''\r\n                            emotion={null}\r\n                            purchased={[]}\r\n                        />\r\n                    </View>\r\n                    <View style={{ padding: 4 }}>\r\n                        <Text style={townStyles.payText_disabled}>{`$${(x.pay).toLocaleString()}`}</Text>\r\n                    </View>\r\n                </View>\r\n            ))}\r\n        </View>\r\n    );\r\n};\r\n\r\nconst CommandsView = ({ gameState }: { gameState: EmojiIdleState }) => {\r\n\r\n    const [offset, setOffset] = useState(0);\r\n    useEffect(() => {\r\n        setOffset(0);\r\n    }, [gameState.targetOptions, gameState.requirementsAvailable]);\r\n\r\n    if (gameState.targetOptions && gameState.targetOptions.length > 0) {\r\n        const listSize = 4;\r\n        const targetOptionsLength = gameState.targetOptions.length;\r\n        return (\r\n            <View style={{ position: `absolute`, top: 0, left: 0, right: 0 }} >\r\n                <View style={{ flexDirection: `row`, justifyContent: `center` }}>\r\n                    {gameState.targetOptions.slice(offset, offset + listSize).map(x => (\r\n                        <TouchableOpacity key={x.emoji} onPress={() => EmojiIdleService.get().selectOption(x.emoji)}>\r\n                            <View>\r\n                                <Text style={styles.characterEmoji}>{x.emoji}</Text>\r\n                            </View>\r\n                        </TouchableOpacity>\r\n                    ))}\r\n                    {targetOptionsLength > listSize && (\r\n                        <TouchableOpacity onPress={() => setOffset(s => { const i = s + 5; return i >= targetOptionsLength ? 0 : i; })}>\r\n                            <View>\r\n                                <Text style={styles.characterEmoji}>{offset + listSize < targetOptionsLength ? `` : ``}</Text>\r\n                            </View>\r\n                        </TouchableOpacity>\r\n                    )}\r\n                </View>\r\n            </View>\r\n        );\r\n    }\r\n\r\n    // if (gameState.requirementsAvailable && gameState.requirementsAvailable.length > 0) {\r\n    //     return (\r\n    //         <View style={{ position: `absolute`, top: 0, left: 0, right: 0 }} >\r\n    //             <View style={{ alignSelf: `center`, alignItems: `center`, background: `#222222`, borderRadius: 4, padding: 4 }}>\r\n    //                 <View style={{ flexDirection: `row`, justifyContent: `center` }}>\r\n    //                     {gameState.requirementsAvailable.slice(0, 5).map(x => (\r\n    //                         <TouchableOpacity key={x.emoji} onPress={() => EmojiIdleService.get().selectOption(x.emoji)}>\r\n    //                             <View style={{ flexDirection: `column`, margin: 4, alignItems: `center`, background: `#333333`, borderRadius: 4 }}>\r\n    //                                 <Text style={styles.characterEmoji}>{x.emoji}</Text>\r\n    //                                 <Text style={styles.costText}>{`$${x.cost.toLocaleString()}`}</Text>\r\n    //                             </View>\r\n    //                         </TouchableOpacity>\r\n    //                     ))}\r\n    //                 </View>\r\n    //                 <Text style={styles.money_small}>{`$${(gameState.money ?? 0).toLocaleString()}`}</Text>\r\n    //             </View>\r\n    //         </View>\r\n    //     );\r\n    // }\r\n\r\n    const reqs = gameState.requirementsRemaining ?? [];\r\n    const reqShowLength = 3;\r\n    return (\r\n        <View>\r\n            <ScoreView {...gameState ?? { money: 0, multiplier: 1 }} />\r\n            <View style={{ position: `absolute`, left: 90, top: 0, flexDirection: `row`, zIndex: 10 }} >\r\n                {reqs.slice(0, reqShowLength).map(x => {\r\n                    const canBuy = x.cost <= gameState.money;\r\n                    return (\r\n                        <TouchableOpacity key={x.emoji} onPress={() => EmojiIdleService.get().selectOption(x.emoji)}>\r\n                            <View style={{ flexDirection: `column`, alignItems: `center`, background: canBuy ? `#003300` : `#553300`, borderRadius: 4, paddingLeft: 2, paddingRight: 2 }}>\r\n                                <Text style={styles.characterEmoji_small}>{x.emoji}</Text>\r\n                                <Text style={{ ...styles.costText_small, ...(canBuy ? {} : { color: `#FF0000` }) }}>{`$${x.cost.toLocaleString()}`}</Text>\r\n                            </View>\r\n                        </TouchableOpacity>\r\n                    );\r\n                })}\r\n            </View>\r\n        </View>\r\n    );\r\n};\r\n\r\n\r\nconst ScoreView = ({ money, multiplier }: { money: number, multiplier: number }) => {\r\n\r\n    const [moneySizeOffset, setMoneySizeOffset] = useState(0);\r\n    const [multiplierSizeOffset, setMultiplierSizeOffset] = useState(0);\r\n    const lastMultiplier = useRef(multiplier);\r\n    const [multiplierDelta, setMultiplierDelta] = useState(0);\r\n\r\n\r\n    useEffect(() => {\r\n        setMoneySizeOffset(5);\r\n\r\n        const update = () => {\r\n            setMoneySizeOffset(s => {\r\n                if (s > 0) {\r\n                    return s - 1;\r\n                }\r\n                clearInterval(id);\r\n                return 0;\r\n            });\r\n        };\r\n        update();\r\n\r\n        const id = setInterval(update, 25);\r\n        return () => clearInterval(id);\r\n    }, [money]);\r\n\r\n    useEffect(() => {\r\n        setMultiplierSizeOffset(10);\r\n        setMultiplierDelta(multiplier - lastMultiplier.current);\r\n        lastMultiplier.current = multiplier;\r\n\r\n        const update = () => {\r\n            setMultiplierSizeOffset(s => {\r\n                if (s > 0) {\r\n                    return s - 1;\r\n                }\r\n                clearInterval(id);\r\n                return 0;\r\n            });\r\n        };\r\n        update();\r\n\r\n        const id = setInterval(update, 25);\r\n        return () => clearInterval(id);\r\n    }, [multiplier]);\r\n\r\n\r\n    return (\r\n        <View style={{ position: `absolute`, top: 0, right: 4 }} >\r\n            <View style={{ flexDirection: `row`, justifyContent: `flex-end` }}>\r\n                <View style={{ transform: `translate(-${moneySizeOffset}px,${2 * moneySizeOffset}px) scale(${moneySizeOffset * 0.1 + 1})` }}>\r\n                    <Text style={styles.money}>{`$${(money ?? 0).toLocaleString()}`}</Text>\r\n                </View>\r\n                <View style={{ transform: `translate(-${multiplierSizeOffset}px,${2 * multiplierSizeOffset}px) scale(${multiplierSizeOffset * 0.1 + 1})` }}>\r\n                    <Text style={{ ...styles.multiplier, ...(multiplierDelta < -5 ? { color: `#FF0000` } : multiplierDelta < 0 ? { color: `#FFFF00` } : { color: `#00FF00` }) }}>{`x${(multiplier ?? 1).toLocaleString()}`.padStart(4, ` `)}</Text>\r\n                </View>\r\n            </View>\r\n        </View>\r\n    );\r\n};\r\n\r\nconst EmojiCharacterView = ({ emoji, targetEmoji, emotion, purchased, onPress }: { emoji: string, targetEmoji: string, emotion: null | EmojiIdleEmotionKind, purchased: string[], onPress?: () => void }) => {\r\n    return (\r\n        <>\r\n            <PurchasedView purchased={purchased} />\r\n            <View style={{ position: `absolute`, left: 20, top: 0, flexDirection: `column`, alignItems: `flex-end` }} >\r\n                <TouchableOpacity onPress={() => onPress?.()}>\r\n                    <EmotionView emotion={emotion ?? null} emoji={emoji} />\r\n                </TouchableOpacity>\r\n            </View>\r\n            <View style={{ position: `absolute`, left: 66, top: 0, flexDirection: `column`, alignItems: `flex-end` }} >\r\n                <Text style={styles.targetCharacterEmoji}>{`${targetEmoji}`}</Text>\r\n            </View>\r\n        </>\r\n    );\r\n};\r\n\r\nconst PurchasedView = ({ purchased }: { purchased: string[] }) => {\r\n    const [offset, setOffset] = useState(0);\r\n    useEffect(() => {\r\n        const update = () => {\r\n            setOffset(s => s + 1);\r\n        };\r\n        update();\r\n\r\n        const id = setInterval(update, 200);\r\n        return () => clearInterval(id);\r\n    }, [purchased.length]);\r\n\r\n    return (\r\n        <>\r\n            {purchased.map((x, i) => (\r\n                <View key={x} style={{ position: `absolute`, left: 0, top: 0, flexDirection: `column`, alignItems: `flex-end` }} >\r\n                    <View style={{ transform: `translate(${((i * 17) + offset) % 60}px,${((i * 5) + offset) % 24}px)` }}>\r\n                        <Text style={styles.objectEmoji}>{`${x}`}</Text>\r\n                    </View>\r\n                </View>\r\n            ))}\r\n        </>\r\n    );\r\n};\r\n\r\nconst EmotionView = ({ emotion, emoji }: { emotion: null | EmojiIdleEmotionKind, emoji: string }) => {\r\n    const [display, setDisplay] = useState({ text: emoji, isEmotion: false });\r\n    useEffect(() => {\r\n        if (!emotion) {\r\n            return () => { };\r\n        }\r\n        let showEmotion = false;\r\n        let variant = 0;\r\n        const update = () => {\r\n            showEmotion = !showEmotion;\r\n            if (!showEmotion) {\r\n                setDisplay({ text: emoji, isEmotion: false });\r\n                return;\r\n            }\r\n            setDisplay({ text: getEmoji(emotion, variant++), isEmotion: true });\r\n        };\r\n        update();\r\n\r\n        const id = setInterval(update, 3000);\r\n        return () => clearInterval(id);\r\n    }, [emotion, emoji]);\r\n\r\n    return (\r\n        <Text style={display.isEmotion ? styles.emotionEmoji : styles.characterEmoji}>{display.text}</Text>\r\n    );\r\n};\r\n\r\n// \r\n// \r\n// \r\n// \r\n// \r\nconst getEmoji = (emotion: null | EmojiIdleEmotionKind, variant: number) => {\r\n    // console.log(`getEmoji`, { emotion, variant });\r\n\r\n    // Setup State\r\n    if (!emotion) { return ``; }\r\n\r\n    if (emotion === `excited`) {\r\n        const items = shuffle([``, ``, ``, ``, ``, ``, ``]);\r\n        return items[variant % items.length];\r\n    }\r\n    if (emotion === `happy`) {\r\n        const items = [``, ``, ``, ``, ``];\r\n        return items[variant % items.length];\r\n    }\r\n    if (emotion === `normal`) {\r\n        // const items = [``, ``, ``, ``, ``, ``, ``];\r\n        const items = [``, ``, ``, ``];\r\n        return items[variant % items.length];\r\n    }\r\n    if (emotion === `angry`) {\r\n        const items = [``, ``, ``, ``, ``, ``, ``];\r\n        return items[variant % items.length];\r\n    }\r\n    if (emotion === `sick`) {\r\n        const items = [``, ``, ``, ``, ``, ``, ``];\r\n        return items[variant % items.length];\r\n    }\r\n    if (emotion === `dead`) {\r\n        const items = [``, ``, ``];\r\n        return items[variant % items.length];\r\n    }\r\n\r\n    // Unknown\r\n    return ``;\r\n};\r\n\r\nconst foodItems = shuffle(` \r\n                             \r\n                            \r\n                       `\r\n    .replace(`\\n`, ` `).split(` `).map(x => x.trim()).filter(x => x));\r\n\r\nconst getFoodVariant = (variant: number) => {\r\n    return foodItems[variant % foodItems.length];\r\n};\r\n","import React, { useEffect, useState } from 'react';\r\nimport { UserDataService, UserProfileInfo } from 'user-data-service/user-data-service';\r\nimport { useAutoLoadingError } from 'utils-react/hooks';\r\nimport { UserProfileManagerView } from 'user-data-service/user-profile-manager-view';\r\nimport { UserProfileSelectionView } from 'user-data-service/user-profile-selection-view';\r\nimport { View, Text, TouchableOpacity, Platform } from 'react-native-lite';\r\nimport { ProblemService } from '../problems/problems-service';\r\nimport { EmojiIdleView } from './emoji-idle-game/emoji-idle-view';\r\nimport { EmojiIdleService } from './emoji-idle-game/emoji-idle-service';\r\n\r\nexport const ProgressGameService = {\r\n    onCorrect: () => {\r\n        EmojiIdleService.get().reward();\r\n    },\r\n    onCompleteSection: () => {\r\n        EmojiIdleService.get().reward_major();\r\n    },\r\n    onCompleteSubject: () => {\r\n        EmojiIdleService.get().reward_extreme();\r\n    },\r\n    onWrong: () => {\r\n        EmojiIdleService.get().punish();\r\n    },\r\n};\r\n\r\nexport const createProgressGameProblemService = (problemSource: ProblemService, options?: {}): ProblemService => {\r\n    const service: ProblemService = {\r\n        ...problemSource,\r\n        recordAnswer: (problem, answer) => {\r\n            // (async () => UserDataService.get().markUserDataChanged())();\r\n\r\n            if (answer.isCorrect) {\r\n                ProgressGameService.onCorrect();\r\n\r\n                if (!problem.isReview && problem.isLastOfSubject) {\r\n                    ProgressGameService.onCompleteSubject();\r\n\r\n                    // Save User Data (delayed to let other state update)\r\n                    setTimeout(async () => {\r\n                        await UserDataService.get().uploadUserData();\r\n                    }, 1000);\r\n                } else if (!problem.isReview && problem.isLastOfSection) {\r\n                    ProgressGameService.onCompleteSection();\r\n\r\n                    // Save User Data (delayed to let other state update)\r\n                    setTimeout(async () => {\r\n                        await UserDataService.get().uploadUserData();\r\n                    }, 1000);\r\n                }\r\n\r\n            } else {\r\n                ProgressGameService.onWrong();\r\n            }\r\n\r\n            return problemSource.recordAnswer(problem, answer);\r\n        },\r\n    };\r\n    return service;\r\n};\r\n\r\nexport const ProgressGameView = () => {\r\n    const { loading, error, doWork } = useAutoLoadingError();\r\n    const [hasSelectedProfile, setHasSelectedProfile] = useState(false);\r\n    const [userProfile, setUserProfile] = useState(null as null | UserProfileInfo);\r\n\r\n    useEffect(() => {\r\n        setUserProfile(UserDataService.get().getActiveUser() ?? null);\r\n        EmojiIdleService.reset();\r\n    }, [hasSelectedProfile]);\r\n\r\n    useEffect(() => {\r\n        // Load User Data\r\n        doWork(async () => {\r\n            await UserDataService.get().setup();\r\n            EmojiIdleService.reset();\r\n        });\r\n    }, []);\r\n\r\n    const onChangeProfile = () => {\r\n        // setHasSelectedProfile(false);\r\n        // Force Reload Page\r\n        if (Platform.OS === `web`) {\r\n            window.location.reload();\r\n        }\r\n    };\r\n\r\n    if (loading) {\r\n        return <></>;\r\n    }\r\n\r\n    if (!hasSelectedProfile) {\r\n        return <UserProfileSelectionView onUserSelected={() => setHasSelectedProfile(true)} />;\r\n    }\r\n\r\n    return (\r\n        <>\r\n            <EmojiIdleView />\r\n            <View>\r\n                <TouchableOpacity onPress={onChangeProfile}>\r\n                    <View style={{ flexDirection: `row`, alignItems: `center`, justifyContent: `flex-start`, padding: 4 }}>\r\n                        <Text style={{ fontSize: 32 }}>{userProfile?.emoji ?? ``}</Text>\r\n                        <Text style={{ fontSize: 14 }}>{userProfile?.name ?? ``}</Text>\r\n                    </View>\r\n                </TouchableOpacity>\r\n            </View>\r\n        </>\r\n    );\r\n};\r\n","\r\nexport type EmailAddress = string & { __type: 'email' };\r\nexport const toEmailAddress = (email: string): EmailAddress => {\r\n    return email.trim() as EmailAddress;\r\n};\r\n","/* eslint-disable max-classes-per-file */\r\nexport type ErrorState = { message: string, data?: unknown, error?: unknown, retryCallback?: () => void };\r\n\r\nexport class AppError extends Error implements ErrorState {\r\n    constructor(public message: string, public data?: unknown) {\r\n        super();\r\n    }\r\n}\r\n\r\nexport class ApiError extends Error implements ErrorState {\r\n    constructor(public message: string, public data?: unknown) {\r\n        super();\r\n    }\r\n}\r\n\r\nexport class MockError extends Error implements ErrorState {\r\n    constructor(public message: string, public data?: unknown) {\r\n        super();\r\n    }\r\n}\r\n\r\nexport class NotImplementedError extends Error implements ErrorState {\r\n    constructor(public message: string = `Not Implemented`, public data?: unknown) {\r\n        super();\r\n    }\r\n}\r\n","// 21.1.3.18 String.prototype.startsWith(searchString [, position ])\n'use strict';\nvar $export = require('./_export');\nvar toLength = require('./_to-length');\nvar context = require('./_string-context');\nvar STARTS_WITH = 'startsWith';\nvar $startsWith = ''[STARTS_WITH];\n\n$export($export.P + $export.F * require('./_fails-is-regexp')(STARTS_WITH), 'String', {\n  startsWith: function startsWith(searchString /* , position = 0 */) {\n    var that = context(this, searchString, STARTS_WITH);\n    var index = toLength(Math.min(arguments.length > 1 ? arguments[1] : undefined, that.length));\n    var search = String(searchString);\n    return $startsWith\n      ? $startsWith.call(that, search, index)\n      : that.slice(index, index + search.length) === search;\n  }\n});\n","'use strict';\n// https://tc39.github.io/proposal-flatMap/#sec-FlattenIntoArray\nvar isArray = require('./_is-array');\nvar isObject = require('./_is-object');\nvar toLength = require('./_to-length');\nvar ctx = require('./_ctx');\nvar IS_CONCAT_SPREADABLE = require('./_wks')('isConcatSpreadable');\n\nfunction flattenIntoArray(target, original, source, sourceLen, start, depth, mapper, thisArg) {\n  var targetIndex = start;\n  var sourceIndex = 0;\n  var mapFn = mapper ? ctx(mapper, thisArg, 3) : false;\n  var element, spreadable;\n\n  while (sourceIndex < sourceLen) {\n    if (sourceIndex in source) {\n      element = mapFn ? mapFn(source[sourceIndex], sourceIndex, original) : source[sourceIndex];\n\n      spreadable = false;\n      if (isObject(element)) {\n        spreadable = element[IS_CONCAT_SPREADABLE];\n        spreadable = spreadable !== undefined ? !!spreadable : isArray(element);\n      }\n\n      if (spreadable && depth > 0) {\n        targetIndex = flattenIntoArray(target, original, element, toLength(element.length), targetIndex, depth - 1) - 1;\n      } else {\n        if (targetIndex >= 0x1fffffffffffff) throw TypeError();\n        target[targetIndex] = element;\n      }\n\n      targetIndex++;\n    }\n    sourceIndex++;\n  }\n  return targetIndex;\n}\n\nmodule.exports = flattenIntoArray;\n","import { shuffle } from 'utils/arrays';\r\nimport { ProblemService, Problem, ProblemResult } from './problems-service';\r\n\r\nexport const createReviewProblemService = (problemSource: ProblemService, {\r\n    maxNewReviewCount = 3,\r\n    reviewSequencePreviousLength = 1,\r\n    reviewQuestionPrefix = ` `,\r\n    requiredCorrectInRow = 3,\r\n}: {\r\n    maxNewReviewCount?: number;\r\n    reviewSequencePreviousLength?: number;\r\n    reviewQuestionPrefix?: string;\r\n    requiredCorrectInRow?: number;\r\n}): ProblemService => {\r\n    const state = {\r\n        problemSourceHistory: [] as Problem[],\r\n        reviewProblems: [] as { index: number, correctsInRow: number }[],\r\n        lastReviewProblem: null as null | { index: number, correctsInRow: number },\r\n        reviewSequence: null as null | { iNext: number, iStart: number, iEnd: number },\r\n        repeatState: `new` as 'new' | 'review',\r\n    };\r\n\r\n    const startReview = () => {\r\n        console.log(`createReviewProblemService startReview`, state);\r\n        state.repeatState = `review`;\r\n    };\r\n\r\n    const getReviewProblem = (): null | Problem => {\r\n        console.log(`createReviewProblemService getReviewProblem`, state);\r\n\r\n        const rSeq = state.reviewSequence;\r\n        if (rSeq && rSeq.iNext > rSeq.iEnd) {\r\n            console.log(`createReviewProblemService getReviewProblem - End of Sequence`, { rSeq, state });\r\n            state.reviewSequence = null;\r\n        }\r\n\r\n        if (!state.reviewSequence) {\r\n            // If reached end of review problems, exit review mode\r\n            const reviewProblem = state.reviewProblems.find(x => x.index > (state.lastReviewProblem?.index ?? -1));\r\n            if (!reviewProblem) {\r\n                console.log(`createReviewProblemService getReviewProblem - No Review Problem (with greater order than last)`, { reviewProblems: state.reviewProblems, lastReviewProblem: state.lastReviewProblem, state });\r\n                state.lastReviewProblem = null;\r\n                return null;\r\n            }\r\n\r\n            const lastReviewProblemIndex = state.lastReviewProblem?.index ?? -1;\r\n            state.lastReviewProblem = reviewProblem;\r\n\r\n            console.log(`createReviewProblemService getReviewProblem - Start Review Sequence`, state);\r\n            const iStart = Math.max(0, reviewProblem.index - reviewSequencePreviousLength, lastReviewProblemIndex + 1);\r\n\r\n            state.reviewSequence = {\r\n                iNext: iStart,\r\n                iStart,\r\n                iEnd: reviewProblem.index,\r\n            };\r\n        }\r\n\r\n        // Next in sequence\r\n        const seq = state.reviewSequence;\r\n        const p = state.problemSourceHistory[seq.iNext];\r\n        seq.iNext++;\r\n\r\n        return {\r\n            ...p,\r\n            question: reviewQuestionPrefix + p.question,\r\n            answers: shuffle(p.answers),\r\n        };\r\n    };\r\n\r\n    const service: ProblemService = {\r\n        load: problemSource.load,\r\n        save: problemSource.save,\r\n\r\n        getSections: problemSource.getSections,\r\n        gotoSection: problemSource.gotoSection,\r\n\r\n        getNextProblem: (): ProblemResult => {\r\n            console.log(`createReviewProblemService getNextProblem`, state);\r\n\r\n            if (state.repeatState === `review`) {\r\n                const reviewProblem = getReviewProblem();\r\n                if (reviewProblem) {\r\n                    return { ...reviewProblem, isReview: true };\r\n                }\r\n\r\n                console.log(`createReviewProblemService getNextProblem - No Review Problem - Change Mode to NEW`, state);\r\n                state.repeatState = `new`;\r\n            }\r\n\r\n            if (state.reviewProblems.filter(x => x.correctsInRow <= 1).length >= maxNewReviewCount) {\r\n                startReview();\r\n                return service.getNextProblem();\r\n            }\r\n\r\n            const newProblem = problemSource.getNextProblem();\r\n            if (newProblem.question) {\r\n                state.problemSourceHistory.push(newProblem);\r\n            } else {\r\n                // Done - Finish Review\r\n                startReview();\r\n                return service.getNextProblem();\r\n            }\r\n            return newProblem;\r\n        },\r\n        recordAnswer: (problem, answer) => {\r\n            console.log(`createReviewProblemService recordAnswer`, state);\r\n\r\n            // if (answer.isCorrect) {\r\n\r\n            //     problemSource.recordAnswer(problem, answer);\r\n            //     return;\r\n            // }\r\n\r\n            const i = state.problemSourceHistory.findIndex(x => x.key === problem.key);\r\n            if (i < 0) {\r\n                problemSource.recordAnswer(problem, answer);\r\n                return;\r\n            }\r\n\r\n            const problemAlreadyInReview = state.reviewProblems.find(x => x.index === i);\r\n            if (answer.isCorrect) {\r\n                // Correct\r\n                if (problemAlreadyInReview) {\r\n                    problemAlreadyInReview.correctsInRow++;\r\n\r\n                    // Remove if enough corrects in a row \r\n                    state.reviewProblems = state.reviewProblems.filter(x => x.correctsInRow <= requiredCorrectInRow);\r\n                }\r\n            } else {\r\n                // Wrong \r\n                // eslint-disable-next-line no-lonely-if\r\n                if (problemAlreadyInReview) {\r\n                    problemAlreadyInReview.correctsInRow = 0;\r\n                } else {\r\n                    // Insert Review Problem in Index order\r\n                    const newReview = { index: i, correctsInRow: 0, _debug_problemKey: problem.key };\r\n                    state.reviewProblems.push(newReview);\r\n                    state.reviewProblems.sort((a, b) => a.index - b.index);\r\n                    // state.problemsToReview = distinct_key(state.problemsToReview, x => `${x.index}`);\r\n                }\r\n            }\r\n\r\n\r\n            problemSource.recordAnswer(problem, answer);\r\n        },\r\n    };\r\n\r\n    return service;\r\n};\r\n","import './index.css';\r\nimport React, { ReactNode, useRef } from 'react';\r\nimport { ThemeTextStyle, ThemeViewStyle } from 'themes/theme';\r\n\r\nfunction mergeStyles<T>(items: (T | undefined | null) | (T | T[] | undefined | null)[]): T {\r\n    if (Array.isArray(items)) {\r\n        if (items.length === 1) { return mergeStyles(items[0]) ?? {} as T; }\r\n        let item = { ...mergeStyles(items[0]) };\r\n        items.forEach(x => { item = { ...item, ...mergeStyles(x ?? {}) }; });\r\n        return (item ?? {}) as T;\r\n    }\r\n    return items as T;\r\n};\r\n\r\nconst viewStyleDefaults = {\r\n    display: `flex`,\r\n    flexDirection: `column`,\r\n} as const;\r\n\r\nconst textStyleDefaults = {\r\n    whiteSpace: `pre`,\r\n} as const;\r\n\r\nconst finalizeTextStyle = <T extends unknown>(style: T) => {\r\n    const s = style as {\r\n        userSelect?: 'none';\r\n        MozUserSelect?: 'none';\r\n        WebkitUserSelect?: 'none';\r\n    };\r\n    if (s.userSelect === `none`) {\r\n        s.MozUserSelect = `none`;\r\n        s.WebkitUserSelect = `none`;\r\n    }\r\n\r\n    return style;\r\n};\r\n\r\nexport const View = (props: { style?: ThemeViewStyle | ThemeViewStyle[], children?: ReactNode }) => { return (<div style={mergeStyles([viewStyleDefaults, props.style])}>{props.children}</div>); };\r\nexport const Text = (props: { style?: ThemeTextStyle | ThemeTextStyle[], children?: string, numberOfLines?: undefined | 1 }) => {\r\n    if (props.numberOfLines === 1) {\r\n        const singleLineStyle = {\r\n            overflow: `hidden`,\r\n            whiteSpace: `nowrap`,\r\n            wordWrap: `break-word`,\r\n            textOverflow: `ellipsis`,\r\n        } as const;\r\n        const allStyles = mergeStyles([textStyleDefaults, props.style, singleLineStyle]);\r\n        return (<span style={finalizeTextStyle(allStyles)}>{props.children}</span>);\r\n    }\r\n    const allStyles = mergeStyles([textStyleDefaults, props.style]);\r\n    return (<span style={finalizeTextStyle(allStyles)}>{props.children}</span>);\r\n};\r\nexport const TextInput = (props: {\r\n    style?: ThemeTextStyle | ThemeTextStyle[];\r\n    keyboardType: 'default' | 'numeric' | 'phone-pad' | 'email-address';\r\n    autoCompleteType: 'off' | 'username' | 'password' | 'email' | 'name' | 'tel' | 'street-address' | 'postal-code';\r\n    secureTextEntry?: boolean;\r\n    placeholder?: string;\r\n    editable?: boolean;\r\n    value: string;\r\n    onChange: (value: string) => void;\r\n    onSubmitEditing?: () => void;\r\n    onBlur?: () => void;\r\n}) => {\r\n    const type = props.keyboardType === `numeric` ? `number`\r\n        : (props.secureTextEntry ? `password`\r\n            : `text`);\r\n\r\n    const name = props.autoCompleteType === `username` ? `username`\r\n        : (props.autoCompleteType === `password` ? `password`\r\n            : undefined);\r\n\r\n    const onKeyPress = props.onSubmitEditing && ((e: React.KeyboardEvent<HTMLInputElement>) => {\r\n        if (e.key === `Enter` && !e.shiftKey) {\r\n            e.preventDefault();\r\n            props.onSubmitEditing?.();\r\n        }\r\n    }) || undefined;\r\n\r\n    return (<input type={type}\r\n        name={name} id={name}\r\n        style={mergeStyles([textStyleDefaults, props.style])}\r\n        placeholder={props.placeholder}\r\n        disabled={!(props.editable ?? true)}\r\n        value={props.value}\r\n        onChange={(e) => props.onChange(e.target.value)}\r\n        onKeyPress={onKeyPress}\r\n        onBlur={props.onBlur}\r\n    />);\r\n\r\n};\r\nexport const TouchableOpacity = (props: { style?: ThemeViewStyle | ThemeViewStyle[], children?: ReactNode, onPress: () => void }) => {\r\n\r\n    // Prevent Initial Press (already pressing when created)\r\n    const lastPressTime = useRef(Date.now());\r\n    const onPress = () => {\r\n        // Prevent duplicate triggers\r\n        if (Date.now() < lastPressTime.current + 250) { return; }\r\n        lastPressTime.current = Date.now();\r\n\r\n        props.onPress();\r\n    };\r\n\r\n    const hasTouchStarted = useRef(true);\r\n\r\n    return (\r\n        <div style={mergeStyles([viewStyleDefaults, props.style])}\r\n            onClick={onPress}\r\n            onKeyPress={onPress}\r\n            onTouchStart={() => { hasTouchStarted.current = true; }}\r\n            onTouchMove={() => { hasTouchStarted.current = false; }}\r\n            onTouchEnd={() => { if (hasTouchStarted.current) { onPress(); } }}\r\n            role='button'\r\n            tabIndex={0}>\r\n            {props.children}\r\n        </div>\r\n    );\r\n};\r\n\r\nexport const Pressable = (props: { style?: ThemeViewStyle | ThemeViewStyle[], children?: ReactNode, onPressIn: () => void, onPressOut: () => void }) => {\r\n\r\n    const onIgnore = (e: React.MouseEvent | React.TouchEvent) => {\r\n        e.preventDefault();\r\n        e.stopPropagation?.();\r\n        (e as unknown as { [key: string]: boolean }).cancelBubble = true;\r\n        (e as unknown as { [key: string]: boolean }).returnValue = false;\r\n        return false;\r\n    };\r\n\r\n    const onPressIn = (e: React.MouseEvent | React.TouchEvent) => {\r\n        props.onPressIn();\r\n        return onIgnore(e);\r\n    };\r\n    const onPressOut = (e: React.MouseEvent | React.TouchEvent) => {\r\n        props.onPressOut();\r\n        return onIgnore(e);\r\n    };\r\n\r\n    return (\r\n        <div style={mergeStyles([viewStyleDefaults, props.style])}\r\n            onMouseDown={onPressIn}\r\n            onMouseUp={onPressOut}\r\n            onTouchStart={onPressIn}\r\n            onTouchEnd={onPressOut}\r\n            onTouchCancel={onPressOut}\r\n            onTouchMove={onIgnore}\r\n            onMouseLeave={onPressOut}\r\n            onTouchEndCapture={onPressOut}\r\n            role='button'\r\n            tabIndex={0}>\r\n            {props.children}\r\n        </div>\r\n    );\r\n};\r\n\r\nexport const ActivityIndicator = ({ size, color }: { size: 'large' | 'small', color: string }) => {\r\n    const sizePx = size === `small` ? 16 : 32;\r\n    return (\r\n        <CircleSvg size={sizePx} thickness={sizePx / 8} color={color} />\r\n    );\r\n};\r\n\r\n// Based on: https://glennmccomb.com/articles/building-a-pure-css-animated-svg-spinner/\r\nconst CircleSvg = ({ size, thickness, color }: { size: number, thickness: number, color: string }) => {\r\n    const circumference = 2 * Math.PI * (size - thickness) * 0.5;\r\n    const dashLength = circumference * 0.6;\r\n    return (\r\n        <svg style={{ maxWidth: size }} viewBox={`0 0 ${size} ${size}`} xmlns='http://www.w3.org/2000/svg'>\r\n            <circle style={{\r\n                fill: `transparent`,\r\n                stroke: color,\r\n                strokeWidth: thickness,\r\n                opacity: 0.5,\r\n            }} cx={size * 0.5} cy={size * 0.5} r={size * 0.5 - thickness} />\r\n            <circle className='activity-spinner' style={{\r\n                strokeDasharray: dashLength,\r\n                fill: `transparent`,\r\n                stroke: color,\r\n                strokeWidth: thickness,\r\n                transformOrigin: `${size * 0.5}px ${size * 0.5}px`,\r\n            }} cx={size * 0.5} cy={size * 0.5} r={size * 0.5 - thickness} />\r\n        </svg>\r\n    );\r\n};\r\n\r\n\r\nexport const Platform = {\r\n    OS: `web` as 'web' | 'ios' | 'android',\r\n};\r\n\r\nexport const Clipboard = {\r\n    setString: async (value: string) => { await navigator.clipboard.writeText(value); },\r\n};\r\n","import React, { useState, useEffect } from 'react';\r\nimport { Text, View, ActivityIndicator, TouchableOpacity } from 'react-native-lite';\r\nimport { SpeechService } from './speech';\r\n\r\nexport const VoiceChooser = ({ languange, speechService }: { languange: string, speechService: SpeechService }) => {\r\n    const [loading, setLoading] = useState(true);\r\n    // eslint-disable-next-line @typescript-eslint/no-unused-vars\r\n    const [renderId, setRenderId] = useState(0);\r\n\r\n    const refresh = () => {\r\n        setLoading(true);\r\n        setTimeout(() => {\r\n            setLoading(false);\r\n        }, 1000);\r\n    };\r\n\r\n    useEffect(() => {\r\n        refresh();\r\n    }, []);\r\n\r\n    const selectVoice = (voice: SpeechSynthesisVoice) => {\r\n        speechService.setVoiceForLanguange(languange, voice);\r\n        setRenderId(s => s + 1);\r\n        speechService.speak(voice.name, languange);\r\n    };\r\n\r\n    return (\r\n        <View>\r\n            <TouchableOpacity onPress={refresh}>\r\n                <Text style={{ fontSize: 24 }}>{`Voice for ${languange}`}</Text>\r\n            </TouchableOpacity>\r\n            {loading && <ActivityIndicator size='small' color='red' />}\r\n            {!loading && (\r\n                <>\r\n                    {speechService.getVoicesForLanguange(languange).map(x => (\r\n                        <TouchableOpacity onPress={() => { selectVoice(x.voice); }}>\r\n                            <View>\r\n                                <Text style={{ margin: 4, fontSize: 14, whiteSpace: `normal` }} >{`${x.isSelected ? `` : ``} ${x.voice.lang} - ${x.voice.name} - ${x.voice.localService ? `local` : `web`}`}</Text>\r\n                            </View>\r\n                        </TouchableOpacity>\r\n                    ))}\r\n                </>\r\n            )}\r\n        </View>\r\n    );\r\n};\r\n","'use strict';\n// 22.1.3.9 Array.prototype.findIndex(predicate, thisArg = undefined)\nvar $export = require('./_export');\nvar $find = require('./_array-methods')(6);\nvar KEY = 'findIndex';\nvar forced = true;\n// Shouldn't skip holes\nif (KEY in []) Array(1)[KEY](function () { forced = false; });\n$export($export.P + $export.F * forced, 'Array', {\n  findIndex: function findIndex(callbackfn /* , that = undefined */) {\n    return $find(this, callbackfn, arguments.length > 1 ? arguments[1] : undefined);\n  }\n});\nrequire('./_add-to-unscopables')(KEY);\n","\r\nexport type Subscription<T> = (state: T) => void;\r\n\r\nexport const createSubscribable = <T>(initialState?: T) => {\r\n    let lastState = initialState;\r\n    const callbacks = [] as (null | Subscription<T>)[];\r\n    const subscribe = (callback: Subscription<T>) => {\r\n        const i = callbacks.length;\r\n        callbacks.push(callback);\r\n\r\n        // Send Initial State if it exists\r\n        setTimeout(() => {\r\n            if (!lastState) { return; }\r\n            callback(lastState);\r\n        });\r\n\r\n        return {\r\n            unsubscribe: () => {\r\n                callbacks[i] = null;\r\n            },\r\n        };\r\n    };\r\n    const onStateChange = (state: T) => {\r\n        lastState = state;\r\n        callbacks.forEach(x => x?.(state));\r\n    };\r\n    return {\r\n        subscribe,\r\n        onStateChange,\r\n    };\r\n};\r\n","var $export = require('./_export');\nvar $parseFloat = require('./_parse-float');\n// 20.1.2.12 Number.parseFloat(string)\n$export($export.S + $export.F * (Number.parseFloat != $parseFloat), 'Number', { parseFloat: $parseFloat });\n","export type DoodleDrawingStorageService = {\r\n    saveDrawing: (prompt: string, drawing: DoodleDrawing) => Promise<void>;\r\n    getDrawings: (prompt: string, options?: { includeOtherPrompts?: boolean, maxCount?: number }) => Promise<{ doodles: DoodleData[] }>;\r\n    saveBestDrawingSelection: (doodle: DoodleData) => Promise<void>;\r\n};\r\n\r\n\r\nexport type DoodleSummaryDataJson = {\r\n    doodles: DoodleData_EncodedWithScore[];\r\n};\r\nexport type DoodleData_EncodedWithScore = DoodleData_Encoded & {\r\n    s: number;\r\n};\r\n\r\nexport type DoodleUserDrawingDataJson = {\r\n    doodles: DoodleData_Encoded[];\r\n};\r\n\r\nexport type DoodleUserVotesDataJson = {\r\n    doodleVotes: DoodleScoreVote[];\r\n};\r\n\r\nexport type DoodleScoreVote = {\r\n    // Doodle Key\r\n    k: string;\r\n    // Doodle Timestamp\r\n    t: number;\r\n};\r\n\r\nexport type DoodleScore = {\r\n    doodleKey: string;\r\n    score: number;\r\n};\r\n\r\nexport type DoodleData = {\r\n    key: string;\r\n    drawing: DoodleDrawing;\r\n    prompt: string;\r\n    timestamp: number;\r\n};\r\nexport type DoodleData_Encoded = {\r\n    // Doodle Key\r\n    k: string;\r\n    // Doodle Drawing\r\n    d: DoodleDrawingEncoded;\r\n    // Prompt\r\n    p: string;\r\n    // Doodle Timestamp\r\n    t: number;\r\n};\r\n\r\nexport type DoodleDrawing = {\r\n    width: number;\r\n    height: number;\r\n    segments: DoodleSegment[];\r\n};\r\nexport type DoodleSegment = {\r\n    points: { x: number, y: number }[];\r\n};\r\n\r\n// const sampleDrawing: DoodleDrawing = {\r\n//     width: 128,\r\n//     height: 128,\r\n//     segments: [{\r\n//         points: [\r\n//             { x: 10, y: 10 },\r\n//             { x: 50, y: 10 },\r\n//             { x: 50, y: 50 },\r\n//             { x: 10, y: 50 },\r\n//             { x: 10, y: 10 },\r\n//         ],\r\n//     }],\r\n// };\r\n\r\nexport const defaultDoodleDrawing = (): DoodleDrawing => ({\r\n    width: 104,\r\n    height: 104,\r\n    segments: [],\r\n});\r\n\r\nexport type DoodleDrawingEncoded = {\r\n    doodleText: string;\r\n};\r\ntype DoodleDrawingEncodedObj = {\r\n    w: number;\r\n    h: number;\r\n    s: {\r\n        x: number;\r\n        y: number;\r\n        p: string;\r\n    }[];\r\n};\r\nconst encodeDoodleSegmentPoints = (points: { x: number, y: number }[]): string => {\r\n    if (points.length <= 0) { return ``; }\r\n    let last = points[0];\r\n    let t = ``;\r\n\r\n    points.slice(1).forEach(p => {\r\n        t += `${p.x - last.x},${p.y - last.y};`;\r\n        last = p;\r\n    });\r\n\r\n    return t;\r\n};\r\nconst decodeDoodleSegmentPoints = (x: number, y: number, pointsString: string): { x: number, y: number }[] => {\r\n    if (!pointsString) { return [{ x, y }]; }\r\n    let last = { x, y };\r\n    const pointRelPos = pointsString.split(`;`).filter(p => p);\r\n    const points = pointRelPos.map(p => {\r\n        const parts = p.split(`,`);\r\n        const point = {\r\n            x: last.x + Number.parseInt(parts[0], 10),\r\n            y: last.y + Number.parseInt(parts[1], 10),\r\n        };\r\n        last = point;\r\n        return point;\r\n    });\r\n\r\n    return [...points];\r\n};\r\n\r\nexport const encodeDoodleDrawing = (doodle: DoodleDrawing): DoodleDrawingEncoded => {\r\n    const o: DoodleDrawingEncodedObj = {\r\n        w: doodle.width,\r\n        h: doodle.height,\r\n        s: doodle.segments.map(x => ({\r\n            x: x.points[0].x,\r\n            y: x.points[0].y,\r\n            p: encodeDoodleSegmentPoints(x.points),\r\n        })),\r\n    };\r\n    return { doodleText: JSON.stringify(o) };\r\n};\r\nexport const decodeDoodleDrawing = (doodle: DoodleDrawingEncoded): DoodleDrawing => {\r\n    const o: DoodleDrawingEncodedObj = JSON.parse(doodle.doodleText) as DoodleDrawingEncodedObj;\r\n    return {\r\n        width: o.w,\r\n        height: o.h,\r\n        segments: o.s.map(p => {\r\n            return {\r\n                points: [{ x: p.x, y: p.y }, ...decodeDoodleSegmentPoints(p.x, p.y, p.p)],\r\n            };\r\n        }),\r\n    };\r\n};\r\n\r\n\r\n// const doodleSegmentToSvgPath_bezier = (segment: DoodleSegment) => {\r\n//     const delta1 = {\r\n//         x: segment.points[2].x - segment.points[1].x,\r\n//         y: segment.points[2].y - segment.points[1].y,\r\n//     };\r\n//     const controlPoint = {\r\n//         x: segment.points[1].x - delta1.x * 0.5,\r\n//         y: segment.points[1].y - delta1.y * 0.5,\r\n//     };\r\n//     return `M${segment.points[0].x} ${segment.points[0].y} Q${controlPoint.x} ${controlPoint.y} ${segment.points[1].x} ${segment.points[1].y}T${segment.points.slice(2, -1).map(p => `${p.x} ${p.y}`).join(` `)}`;\r\n// };\r\n\r\n\r\nexport const doodleSegmentToSvgPath_line = (segment: DoodleSegment) => {\r\n    if (segment.points.length <= 0) { return ``; }\r\n    if (segment.points.length === 1) { return `M${segment.points[0].x} ${segment.points[0].y} L${segment.points[0].x} ${segment.points[0].y}`; }\r\n\r\n    let last = segment.points[0];\r\n    return `M${segment.points[0].x} ${segment.points[0].y} l${segment.points.slice(1).map(p => {\r\n        const t = `${p.x - last.x} ${p.y - last.y}`;\r\n        last = p;\r\n        return t;\r\n    }).join(` `)}`;\r\n};\r\n\r\nexport const doodleToSvg = (drawing: DoodleDrawing) => {\r\n    // preserveAspectRatio='none' stroke='#000000' fill='transparent' xmlns='http://www.w3.org/2000/svg'\r\n    return `\r\n<svg viewBox='0 0 ${drawing.width} ${drawing.height}' stroke='#000000' fill='transparent'>\r\n    ${drawing.segments.map((x, i) => (\r\n        `<path d='${doodleSegmentToSvgPath_line(x)}' />`\r\n    )).join(``)}\r\n</svg>\r\n    `.trim();\r\n};\r\n","require(\"core-js/modules/es6.object.define-property\");\n\nrequire(\"core-js/modules/es6.promise\");\n\nrequire(\"core-js/modules/es6.function.name\");\n\nrequire(\"core-js/modules/es6.regexp.to-string\");\n\nrequire(\"core-js/modules/es6.date.to-string\");\n\nrequire(\"core-js/modules/es6.array.is-array\");\n\nrequire(\"core-js/modules/es6.array.index-of\");\n\nrequire(\"core-js/modules/web.dom.iterable\");\n\nrequire(\"core-js/modules/es6.array.iterator\");\n\nrequire(\"core-js/modules/es6.object.to-string\");\n\nrequire(\"core-js/modules/es6.object.keys\");\n\nrequire(\"core-js/modules/es7.symbol.async-iterator\");\n\nrequire(\"core-js/modules/es6.symbol\");\n\n(function (global, factory) {\n  typeof exports === 'object' && typeof module !== 'undefined' ? factory(exports, require('react')) : typeof define === 'function' && define.amd ? define(['exports', 'react'], factory) : (global = global || self, factory(global.ReactStripe = {}, global.React));\n})(this, function (exports, React) {\n  'use strict';\n\n  React = React && React.hasOwnProperty('default') ? React['default'] : React;\n\n  function _typeof(obj) {\n    \"@babel/helpers - typeof\";\n\n    if (typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\") {\n      _typeof = function _typeof(obj) {\n        return typeof obj;\n      };\n    } else {\n      _typeof = function _typeof(obj) {\n        return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj;\n      };\n    }\n\n    return _typeof(obj);\n  }\n\n  function _objectWithoutPropertiesLoose(source, excluded) {\n    if (source == null) return {};\n    var target = {};\n    var sourceKeys = Object.keys(source);\n    var key, i;\n\n    for (i = 0; i < sourceKeys.length; i++) {\n      key = sourceKeys[i];\n      if (excluded.indexOf(key) >= 0) continue;\n      target[key] = source[key];\n    }\n\n    return target;\n  }\n\n  function _objectWithoutProperties(source, excluded) {\n    if (source == null) return {};\n\n    var target = _objectWithoutPropertiesLoose(source, excluded);\n\n    var key, i;\n\n    if (Object.getOwnPropertySymbols) {\n      var sourceSymbolKeys = Object.getOwnPropertySymbols(source);\n\n      for (i = 0; i < sourceSymbolKeys.length; i++) {\n        key = sourceSymbolKeys[i];\n        if (excluded.indexOf(key) >= 0) continue;\n        if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue;\n        target[key] = source[key];\n      }\n    }\n\n    return target;\n  }\n\n  function _slicedToArray(arr, i) {\n    return _arrayWithHoles(arr) || _iterableToArrayLimit(arr, i) || _nonIterableRest();\n  }\n\n  function _arrayWithHoles(arr) {\n    if (Array.isArray(arr)) return arr;\n  }\n\n  function _iterableToArrayLimit(arr, i) {\n    if (!(Symbol.iterator in Object(arr) || Object.prototype.toString.call(arr) === \"[object Arguments]\")) {\n      return;\n    }\n\n    var _arr = [];\n    var _n = true;\n    var _d = false;\n    var _e = undefined;\n\n    try {\n      for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) {\n        _arr.push(_s.value);\n\n        if (i && _arr.length === i) break;\n      }\n    } catch (err) {\n      _d = true;\n      _e = err;\n    } finally {\n      try {\n        if (!_n && _i[\"return\"] != null) _i[\"return\"]();\n      } finally {\n        if (_d) throw _e;\n      }\n    }\n\n    return _arr;\n  }\n\n  function _nonIterableRest() {\n    throw new TypeError(\"Invalid attempt to destructure non-iterable instance\");\n  }\n\n  function createCommonjsModule(fn, module) {\n    return module = {\n      exports: {}\n    }, fn(module, module.exports), module.exports;\n  }\n  /**\n   * Copyright (c) 2013-present, Facebook, Inc.\n   *\n   * This source code is licensed under the MIT license found in the\n   * LICENSE file in the root directory of this source tree.\n   */\n\n\n  var ReactPropTypesSecret = 'SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED';\n  var ReactPropTypesSecret_1 = ReactPropTypesSecret;\n\n  function emptyFunction() {}\n\n  function emptyFunctionWithReset() {}\n\n  emptyFunctionWithReset.resetWarningCache = emptyFunction;\n\n  var factoryWithThrowingShims = function factoryWithThrowingShims() {\n    function shim(props, propName, componentName, location, propFullName, secret) {\n      if (secret === ReactPropTypesSecret_1) {\n        // It is still safe when called from React.\n        return;\n      }\n\n      var err = new Error('Calling PropTypes validators directly is not supported by the `prop-types` package. ' + 'Use PropTypes.checkPropTypes() to call them. ' + 'Read more at http://fb.me/use-check-prop-types');\n      err.name = 'Invariant Violation';\n      throw err;\n    }\n\n    shim.isRequired = shim;\n\n    function getShim() {\n      return shim;\n    } // Keep this list in sync with production version in `./factoryWithTypeCheckers.js`.\n\n\n    var ReactPropTypes = {\n      array: shim,\n      bool: shim,\n      func: shim,\n      number: shim,\n      object: shim,\n      string: shim,\n      symbol: shim,\n      any: shim,\n      arrayOf: getShim,\n      element: shim,\n      elementType: shim,\n      instanceOf: getShim,\n      node: shim,\n      objectOf: getShim,\n      oneOf: getShim,\n      oneOfType: getShim,\n      shape: getShim,\n      exact: getShim,\n      checkPropTypes: emptyFunctionWithReset,\n      resetWarningCache: emptyFunction\n    };\n    ReactPropTypes.PropTypes = ReactPropTypes;\n    return ReactPropTypes;\n  };\n\n  var propTypes = createCommonjsModule(function (module) {\n    /**\n     * Copyright (c) 2013-present, Facebook, Inc.\n     *\n     * This source code is licensed under the MIT license found in the\n     * LICENSE file in the root directory of this source tree.\n     */\n    {\n      // By explicitly using `prop-types` you are opting into new production behavior.\n      // http://fb.me/prop-types-in-prod\n      module.exports = factoryWithThrowingShims();\n    }\n  });\n\n  var isUnknownObject = function isUnknownObject(raw) {\n    return raw !== null && _typeof(raw) === 'object';\n  };\n\n  var isPromise = function isPromise(raw) {\n    return isUnknownObject(raw) && typeof raw.then === 'function';\n  }; // We are using types to enforce the `stripe` prop in this lib,\n  // but in an untyped integration `stripe` could be anything, so we need\n  // to do some sanity validation to prevent type errors.\n\n\n  var isStripe = function isStripe(raw) {\n    return isUnknownObject(raw) && typeof raw.elements === 'function' && typeof raw.createToken === 'function' && typeof raw.createPaymentMethod === 'function' && typeof raw.confirmCardPayment === 'function';\n  };\n\n  var PLAIN_OBJECT_STR = '[object Object]';\n\n  var isEqual = function isEqual(left, right) {\n    if (!isUnknownObject(left) || !isUnknownObject(right)) {\n      return left === right;\n    }\n\n    var leftArray = Array.isArray(left);\n    var rightArray = Array.isArray(right);\n    if (leftArray !== rightArray) return false;\n    var leftPlainObject = Object.prototype.toString.call(left) === PLAIN_OBJECT_STR;\n    var rightPlainObject = Object.prototype.toString.call(right) === PLAIN_OBJECT_STR;\n    if (leftPlainObject !== rightPlainObject) return false;\n    if (!leftPlainObject && !leftArray) return false;\n    var leftKeys = Object.keys(left);\n    var rightKeys = Object.keys(right);\n    if (leftKeys.length !== rightKeys.length) return false;\n    var keySet = {};\n\n    for (var i = 0; i < leftKeys.length; i += 1) {\n      keySet[leftKeys[i]] = true;\n    }\n\n    for (var _i = 0; _i < rightKeys.length; _i += 1) {\n      keySet[rightKeys[_i]] = true;\n    }\n\n    var allKeys = Object.keys(keySet);\n\n    if (allKeys.length !== leftKeys.length) {\n      return false;\n    }\n\n    var l = left;\n    var r = right;\n\n    var pred = function pred(key) {\n      return isEqual(l[key], r[key]);\n    };\n\n    return allKeys.every(pred);\n  };\n\n  var usePrevious = function usePrevious(value) {\n    var ref = React.useRef(value);\n    React.useEffect(function () {\n      ref.current = value;\n    }, [value]);\n    return ref.current;\n  };\n\n  var INVALID_STRIPE_ERROR = 'Invalid prop `stripe` supplied to `Elements`. We recommend using the `loadStripe` utility from `@stripe/stripe-js`. See https://stripe.com/docs/stripe-js/react#elements-props-stripe for details.'; // We are using types to enforce the `stripe` prop in this lib, but in a real\n  // integration `stripe` could be anything, so we need to do some sanity\n  // validation to prevent type errors.\n\n  var validateStripe = function validateStripe(maybeStripe) {\n    if (maybeStripe === null || isStripe(maybeStripe)) {\n      return maybeStripe;\n    }\n\n    throw new Error(INVALID_STRIPE_ERROR);\n  };\n\n  var parseStripeProp = function parseStripeProp(raw) {\n    if (isPromise(raw)) {\n      return {\n        tag: 'async',\n        stripePromise: Promise.resolve(raw).then(validateStripe)\n      };\n    }\n\n    var stripe = validateStripe(raw);\n\n    if (stripe === null) {\n      return {\n        tag: 'empty'\n      };\n    }\n\n    return {\n      tag: 'sync',\n      stripe: stripe\n    };\n  };\n\n  var ElementsContext = React.createContext(null);\n  ElementsContext.displayName = 'ElementsContext';\n\n  var parseElementsContext = function parseElementsContext(ctx, useCase) {\n    if (!ctx) {\n      throw new Error(\"Could not find Elements context; You need to wrap the part of your app that \".concat(useCase, \" in an <Elements> provider.\"));\n    }\n\n    return ctx;\n  };\n  /**\n   * The `Elements` provider allows you to use [Element components](https://stripe.com/docs/stripe-js/react#element-components) and access the [Stripe object](https://stripe.com/docs/js/initializing) in any nested component.\n   * Render an `Elements` provider at the root of your React app so that it is available everywhere you need it.\n   *\n   * To use the `Elements` provider, call `loadStripe` from `@stripe/stripe-js` with your publishable key.\n   * The `loadStripe` function will asynchronously load the Stripe.js script and initialize a `Stripe` object.\n   * Pass the returned `Promise` to `Elements`.\n   *\n   * @docs https://stripe.com/docs/stripe-js/react#elements-provider\n   */\n\n\n  var Elements = function Elements(_ref) {\n    var rawStripeProp = _ref.stripe,\n        options = _ref.options,\n        children = _ref.children;\n\n    var _final = React.useRef(false);\n\n    var isMounted = React.useRef(true);\n    var parsed = React.useMemo(function () {\n      return parseStripeProp(rawStripeProp);\n    }, [rawStripeProp]);\n\n    var _React$useState = React.useState(function () {\n      return {\n        stripe: null,\n        elements: null\n      };\n    }),\n        _React$useState2 = _slicedToArray(_React$useState, 2),\n        ctx = _React$useState2[0],\n        setContext = _React$useState2[1];\n\n    var prevStripe = usePrevious(rawStripeProp);\n    var prevOptions = usePrevious(options);\n\n    if (prevStripe !== null) {\n      if (prevStripe !== rawStripeProp) {\n        console.warn('Unsupported prop change on Elements: You cannot change the `stripe` prop after setting it.');\n      }\n\n      if (!isEqual(options, prevOptions)) {\n        console.warn('Unsupported prop change on Elements: You cannot change the `options` prop after setting the `stripe` prop.');\n      }\n    }\n\n    if (!_final.current) {\n      if (parsed.tag === 'sync') {\n        _final.current = true;\n        setContext({\n          stripe: parsed.stripe,\n          elements: parsed.stripe.elements(options)\n        });\n      }\n\n      if (parsed.tag === 'async') {\n        _final.current = true;\n        parsed.stripePromise.then(function (stripe) {\n          if (stripe && isMounted.current) {\n            // Only update Elements context if the component is still mounted\n            // and stripe is not null. We allow stripe to be null to make\n            // handling SSR easier.\n            setContext({\n              stripe: stripe,\n              elements: stripe.elements(options)\n            });\n          }\n        });\n      }\n    }\n\n    React.useEffect(function () {\n      return function () {\n        isMounted.current = false;\n      };\n    }, []);\n    React.useEffect(function () {\n      var anyStripe = ctx.stripe;\n\n      if (!anyStripe || !anyStripe._registerWrapper) {\n        return;\n      }\n\n      anyStripe._registerWrapper({\n        name: 'react-stripe-js',\n        version: \"1.1.2\"\n      });\n    }, [ctx.stripe]);\n    return React.createElement(ElementsContext.Provider, {\n      value: ctx\n    }, children);\n  };\n\n  var useElementsContextWithUseCase = function useElementsContextWithUseCase(useCaseMessage) {\n    var ctx = React.useContext(ElementsContext);\n    return parseElementsContext(ctx, useCaseMessage);\n  };\n  /**\n   * @docs https://stripe.com/docs/stripe-js/react#useelements-hook\n   */\n\n\n  var useElements = function useElements() {\n    var _useElementsContextWi = useElementsContextWithUseCase('calls useElements()'),\n        elements = _useElementsContextWi.elements;\n\n    return elements;\n  };\n  /**\n   * @docs https://stripe.com/docs/stripe-js/react#usestripe-hook\n   */\n\n\n  var useStripe = function useStripe() {\n    var _useElementsContextWi2 = useElementsContextWithUseCase('calls useStripe()'),\n        stripe = _useElementsContextWi2.stripe;\n\n    return stripe;\n  };\n  /**\n   * @docs https://stripe.com/docs/stripe-js/react#elements-consumer\n   */\n\n\n  var ElementsConsumer = function ElementsConsumer(_ref2) {\n    var children = _ref2.children;\n    var ctx = useElementsContextWithUseCase('mounts <ElementsConsumer>'); // Assert to satisfy the busted React.FC return type (it should be ReactNode)\n\n    return children(ctx);\n  };\n\n  ElementsConsumer.propTypes = {\n    children: propTypes.func.isRequired\n  };\n\n  var useCallbackReference = function useCallbackReference(cb) {\n    var ref = React.useRef(cb);\n    React.useEffect(function () {\n      ref.current = cb;\n    }, [cb]);\n    return function () {\n      if (ref.current) {\n        ref.current.apply(ref, arguments);\n      }\n    };\n  };\n\n  var extractUpdateableOptions = function extractUpdateableOptions(options) {\n    if (!isUnknownObject(options)) {\n      return {};\n    }\n\n    var _ = options.paymentRequest,\n        rest = _objectWithoutProperties(options, [\"paymentRequest\"]);\n\n    return rest;\n  };\n\n  var noop = function noop() {};\n\n  var capitalized = function capitalized(str) {\n    return str.charAt(0).toUpperCase() + str.slice(1);\n  };\n\n  var createElementComponent = function createElementComponent(type, isServer) {\n    var displayName = \"\".concat(capitalized(type), \"Element\");\n\n    var ClientElement = function ClientElement(_ref) {\n      var id = _ref.id,\n          className = _ref.className,\n          _ref$options = _ref.options,\n          options = _ref$options === void 0 ? {} : _ref$options,\n          _ref$onBlur = _ref.onBlur,\n          onBlur = _ref$onBlur === void 0 ? noop : _ref$onBlur,\n          _ref$onFocus = _ref.onFocus,\n          onFocus = _ref$onFocus === void 0 ? noop : _ref$onFocus,\n          _ref$onReady = _ref.onReady,\n          onReady = _ref$onReady === void 0 ? noop : _ref$onReady,\n          _ref$onChange = _ref.onChange,\n          onChange = _ref$onChange === void 0 ? noop : _ref$onChange,\n          _ref$onEscape = _ref.onEscape,\n          onEscape = _ref$onEscape === void 0 ? noop : _ref$onEscape,\n          _ref$onClick = _ref.onClick,\n          onClick = _ref$onClick === void 0 ? noop : _ref$onClick;\n\n      var _useElementsContextWi = useElementsContextWithUseCase(\"mounts <\".concat(displayName, \">\")),\n          elements = _useElementsContextWi.elements;\n\n      var elementRef = React.useRef(null);\n      var domNode = React.useRef(null);\n      var callOnReady = useCallbackReference(onReady);\n      var callOnBlur = useCallbackReference(onBlur);\n      var callOnFocus = useCallbackReference(onFocus);\n      var callOnClick = useCallbackReference(onClick);\n      var callOnChange = useCallbackReference(onChange);\n      var callOnEscape = useCallbackReference(onEscape);\n      React.useLayoutEffect(function () {\n        if (elementRef.current == null && elements && domNode.current != null) {\n          var element = elements.create(type, options);\n          elementRef.current = element;\n          element.mount(domNode.current);\n          element.on('ready', function () {\n            return callOnReady(element);\n          });\n          element.on('change', callOnChange);\n          element.on('blur', callOnBlur);\n          element.on('focus', callOnFocus);\n          element.on('escape', callOnEscape); // Users can pass an an onClick prop on any Element component\n          // just as they could listen for the `click` event on any Element,\n          // but only the PaymentRequestButton will actually trigger the event.\n\n          element.on('click', callOnClick);\n        }\n      });\n      var prevOptions = React.useRef(options);\n      React.useEffect(function () {\n        if (prevOptions.current && prevOptions.current.paymentRequest !== options.paymentRequest) {\n          console.warn('Unsupported prop change: options.paymentRequest is not a customizable property.');\n        }\n\n        var updateableOptions = extractUpdateableOptions(options);\n\n        if (Object.keys(updateableOptions).length !== 0 && !isEqual(updateableOptions, extractUpdateableOptions(prevOptions.current))) {\n          if (elementRef.current) {\n            elementRef.current.update(updateableOptions);\n            prevOptions.current = options;\n          }\n        }\n      }, [options]);\n      React.useEffect(function () {\n        return function () {\n          if (elementRef.current) {\n            elementRef.current.destroy();\n          }\n        };\n      }, []);\n      return React.createElement(\"div\", {\n        id: id,\n        className: className,\n        ref: domNode\n      });\n    }; // Only render the Element wrapper in a server environment.\n\n\n    var ServerElement = function ServerElement(props) {\n      // Validate that we are in the right context by calling useElementsContextWithUseCase.\n      useElementsContextWithUseCase(\"mounts <\".concat(displayName, \">\"));\n      var id = props.id,\n          className = props.className;\n      return React.createElement(\"div\", {\n        id: id,\n        className: className\n      });\n    };\n\n    var Element = isServer ? ServerElement : ClientElement;\n    Element.propTypes = {\n      id: propTypes.string,\n      className: propTypes.string,\n      onChange: propTypes.func,\n      onBlur: propTypes.func,\n      onFocus: propTypes.func,\n      onReady: propTypes.func,\n      onClick: propTypes.func,\n      options: propTypes.object\n    };\n    Element.displayName = displayName;\n    Element.__elementType = type;\n    return Element;\n  };\n\n  var isServer = typeof window === 'undefined';\n  /**\n   * Requires beta access:\n   * Contact [Stripe support](https://support.stripe.com/) for more information.\n   *\n   * @docs https://stripe.com/docs/stripe-js/react#element-components\n   */\n\n  var AuBankAccountElement = createElementComponent('auBankAccount', isServer);\n  /**\n   * @docs https://stripe.com/docs/stripe-js/react#element-components\n   */\n\n  var CardElement = createElementComponent('card', isServer);\n  /**\n   * @docs https://stripe.com/docs/stripe-js/react#element-components\n   */\n\n  var CardNumberElement = createElementComponent('cardNumber', isServer);\n  /**\n   * @docs https://stripe.com/docs/stripe-js/react#element-components\n   */\n\n  var CardExpiryElement = createElementComponent('cardExpiry', isServer);\n  /**\n   * @docs https://stripe.com/docs/stripe-js/react#element-components\n   */\n\n  var CardCvcElement = createElementComponent('cardCvc', isServer);\n  /**\n   * @docs https://stripe.com/docs/stripe-js/react#element-components\n   */\n\n  var FpxBankElement = createElementComponent('fpxBank', isServer);\n  /**\n   * @docs https://stripe.com/docs/stripe-js/react#element-components\n   */\n\n  var IbanElement = createElementComponent('iban', isServer);\n  /**\n   * @docs https://stripe.com/docs/stripe-js/react#element-components\n   */\n\n  var IdealBankElement = createElementComponent('idealBank', isServer);\n  /**\n   * @docs https://stripe.com/docs/stripe-js/react#element-components\n   */\n\n  var PaymentRequestButtonElement = createElementComponent('paymentRequestButton', isServer);\n  exports.AuBankAccountElement = AuBankAccountElement;\n  exports.CardCvcElement = CardCvcElement;\n  exports.CardElement = CardElement;\n  exports.CardExpiryElement = CardExpiryElement;\n  exports.CardNumberElement = CardNumberElement;\n  exports.Elements = Elements;\n  exports.ElementsConsumer = ElementsConsumer;\n  exports.FpxBankElement = FpxBankElement;\n  exports.IbanElement = IbanElement;\n  exports.IdealBankElement = IdealBankElement;\n  exports.PaymentRequestButtonElement = PaymentRequestButtonElement;\n  exports.useElements = useElements;\n  exports.useStripe = useStripe;\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n});","export type PhoneNumber = string & { __type: 'PhoneNumber', format: '+19785551234' };\r\nexport type PhoneNumberFormatted = string & { __type: 'PhoneNumber', format: '(###) ###-####' };\r\n\r\nexport function formatPhoneNumber_UsaCanada(text: string): PhoneNumberFormatted {\r\n    return phoneNumberMask_UsaCanada(text).corrected as PhoneNumberFormatted;\r\n}\r\n\r\nexport function toStandardPhoneNumber(text: string): PhoneNumber {\r\n    return `+1${phoneNumberMask_UsaCanada(text).digitsNo1}` as PhoneNumber;\r\n}\r\n\r\nexport function toStandardPhoneNumber_optional(text: string | null | undefined): PhoneNumber | undefined {\r\n    if (!text) { return undefined; }\r\n    return `+1${phoneNumberMask_UsaCanada(text).digitsNo1}` as PhoneNumber;\r\n}\r\n\r\nexport function phoneNumberMask_UsaCanada(x: string | null | undefined) {\r\n    const numberMask = `(###) ###-####`;\r\n    const digits = x\r\n        ?.replace(/^(\\+1|1)/, ``)\r\n        .replace(/\\D/g, ``)\r\n        .split(``) ?? [];\r\n    const letters = numberMask.split(``);\r\n    let iDigit = 0;\r\n    let iLast = -1;\r\n    for (let i = 0; i < letters.length; i++) {\r\n        if (letters[i] === `#` && iDigit < digits.length) {\r\n            letters[i] = digits[iDigit];\r\n            iDigit++;\r\n            iLast = i;\r\n        }\r\n    }\r\n    const full = letters.join(``);\r\n    const corrected = letters.slice(0, iLast + 1).join(``);\r\n    return { corrected, full, digitsNo1: digits.join(``) };\r\n}\r\n","import \"core-js/modules/es6.promise\";\nimport \"core-js/modules/es6.string.iterator\";\nimport \"core-js/modules/es6.array.from\";\nimport \"core-js/modules/es6.regexp.to-string\";\nimport \"core-js/modules/es6.date.to-string\";\nimport \"core-js/modules/es6.object.to-string\";\nimport \"core-js/modules/es7.symbol.async-iterator\";\nimport \"core-js/modules/es6.symbol\";\nimport \"core-js/modules/web.dom.iterable\";\nimport \"core-js/modules/es6.array.is-array\";\n\nfunction _toConsumableArray(arr) {\n  return _arrayWithoutHoles(arr) || _iterableToArray(arr) || _nonIterableSpread();\n}\n\nfunction _arrayWithoutHoles(arr) {\n  if (Array.isArray(arr)) {\n    for (var i = 0, arr2 = new Array(arr.length); i < arr.length; i++) {\n      arr2[i] = arr[i];\n    }\n\n    return arr2;\n  }\n}\n\nfunction _iterableToArray(iter) {\n  if (Symbol.iterator in Object(iter) || Object.prototype.toString.call(iter) === \"[object Arguments]\") return Array.from(iter);\n}\n\nfunction _nonIterableSpread() {\n  throw new TypeError(\"Invalid attempt to spread non-iterable instance\");\n}\n\nvar V3_URL = 'https://js.stripe.com/v3';\nvar V3_URL_REGEX = /^https:\\/\\/js\\.stripe\\.com\\/v3\\/?(\\?.*)?$/;\nvar EXISTING_SCRIPT_MESSAGE = 'loadStripe.setLoadParameters was called but an existing Stripe.js script already exists in the document; existing script parameters will be used';\n\nvar findScript = function findScript() {\n  var scripts = document.querySelectorAll(\"script[src^=\\\"\".concat(V3_URL, \"\\\"]\"));\n\n  for (var i = 0; i < scripts.length; i++) {\n    var script = scripts[i];\n\n    if (!V3_URL_REGEX.test(script.src)) {\n      continue;\n    }\n\n    return script;\n  }\n\n  return null;\n};\n\nvar injectScript = function injectScript(params) {\n  var queryString = params && !params.advancedFraudSignals ? '?advancedFraudSignals=false' : '';\n  var script = document.createElement('script');\n  script.src = \"\".concat(V3_URL).concat(queryString);\n  var headOrBody = document.head || document.body;\n\n  if (!headOrBody) {\n    throw new Error('Expected document.body not to be null. Stripe.js requires a <body> element.');\n  }\n\n  headOrBody.appendChild(script);\n  return script;\n};\n\nvar registerWrapper = function registerWrapper(stripe) {\n  if (!stripe || !stripe._registerWrapper) {\n    return;\n  }\n\n  stripe._registerWrapper({\n    name: 'stripe-js',\n    version: \"1.5.0\"\n  });\n};\n\nvar stripePromise = null;\n\nvar loadScript = function loadScript(params) {\n  // Ensure that we only attempt to load Stripe.js at most once\n  if (stripePromise !== null) {\n    return stripePromise;\n  }\n\n  stripePromise = new Promise(function (resolve, reject) {\n    if (typeof window === 'undefined') {\n      // Resolve to null when imported server side. This makes the module\n      // safe to import in an isomorphic code base.\n      resolve(null);\n      return;\n    }\n\n    if (window.Stripe && params) {\n      console.warn(EXISTING_SCRIPT_MESSAGE);\n    }\n\n    if (window.Stripe) {\n      resolve(window.Stripe);\n      return;\n    }\n\n    try {\n      var script = findScript();\n\n      if (script && params) {\n        console.warn(EXISTING_SCRIPT_MESSAGE);\n      } else if (!script) {\n        script = injectScript(params);\n      }\n\n      script.addEventListener('load', function () {\n        if (window.Stripe) {\n          resolve(window.Stripe);\n        } else {\n          reject(new Error('Stripe.js not available'));\n        }\n      });\n      script.addEventListener('error', function () {\n        reject(new Error('Failed to load Stripe.js'));\n      });\n    } catch (error) {\n      reject(error);\n      return;\n    }\n  });\n  return stripePromise;\n};\n\nvar initStripe = function initStripe(maybeStripe, args) {\n  if (maybeStripe === null) {\n    return null;\n  }\n\n  var stripe = maybeStripe.apply(void 0, _toConsumableArray(args));\n  registerWrapper(stripe);\n  return stripe;\n}; // own script injection.\n\n\nvar stripePromise$1 = Promise.resolve().then(function () {\n  return loadScript(null);\n});\nvar loadCalled = false;\nstripePromise$1[\"catch\"](function (err) {\n  if (!loadCalled) {\n    console.warn(err);\n  }\n});\n\nvar loadStripe = function loadStripe() {\n  for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n    args[_key] = arguments[_key];\n  }\n\n  loadCalled = true;\n  return stripePromise$1.then(function (maybeStripe) {\n    return initStripe(maybeStripe, args);\n  });\n};\n\nexport { loadStripe };","/** This token is used to identify a specific app user with the user's id in the provider's context (i.e. customer id) */\r\nexport type PaymentProviderUserToken = unknown & { __type: 'PaymentProviderUserToken' };\r\n/** This token is used to identify the client as it negotiates directly with the provider to enter payment method data */\r\nexport type PaymentProviderSavedPaymentMethodClientSetupToken = unknown & { __type: 'PaymentProviderSavedPaymentMethodClientSetupToken' };\r\n/** This token is used to identify the payment method obtained on the client from the provider */\r\nexport type PaymentProviderSavedPaymentMethodClientToken = unknown & { __type: 'PaymentProviderSavedPaymentMethodClientToken' };\r\n/** This token is used to identify the payment method long term after being verified by the provider on the server */\r\nexport type PaymentProviderSavedPaymentMethodStorageToken = unknown & { __type: 'PaymentProviderSavedPaymentMethodStorageToken' };\r\n\r\n/** PaymentProviderName identifies the payment provider and it's implementation (i.e. stripe, paypal, etc.) */\r\nexport type PaymentProviderName = string & { __type: 'PaymentProviderName' };\r\n\r\n/** PaymentMethodStorageKey is the auto generated storage key to uniquely identify a stored payment method */\r\nexport type PaymentMethodStorageKey = string & { __type: 'PaymentMethodStorageKey' };\r\n\r\nexport type PaymentMethodExpiration = {\r\n    year: number;\r\n    month: number;\r\n};\r\nexport type PaymentMethodClientInfo = {\r\n    key: PaymentMethodStorageKey;\r\n    providerName: PaymentProviderName;\r\n    title: string;\r\n    expiration: PaymentMethodExpiration;\r\n};\r\n\r\nexport type PaymentAmount = { currency: 'usd', usdCents: number };\r\n\r\nexport type PaymentTransaction = {\r\n    providerName: PaymentProviderName;\r\n    created: Date;\r\n    amount: PaymentAmount;\r\n    status: 'success' | 'incomplete' | 'terminated';\r\n}\r\n\r\n/** Payment Client to Server Calls\r\n * \r\n * These are the calls made on the client to the server, it supports multiple payment provider types\r\n * \r\n * Note: this is scoped to the user associated with the client\r\n */\r\nexport type PaymentClientApi = {\r\n    // Normal Flow\r\n    setupSavedPaymentMethod: (params: { providerName: PaymentProviderName }) => Promise<PaymentProviderSavedPaymentMethodClientSetupToken>;\r\n    saveSavedPaymentMethod: (params: { providerName: PaymentProviderName, paymentMethodClientToken: PaymentProviderSavedPaymentMethodClientToken }) => Promise<void>;\r\n\r\n    // Management of Payment Methods\r\n    getSavedPaymentMethods: () => Promise<PaymentMethodClientInfo[]>;\r\n    deleteSavedPaymentMethod: (params: { key: PaymentMethodStorageKey }) => Promise<void>;\r\n\r\n    // Management of Payments\r\n    debug_triggerPayment: (params: { amount: PaymentAmount }) => Promise<void>;\r\n    getPayments: () => Promise<PaymentTransaction[]>;\r\n    // getPaymentsRequiringUserAction: () => Promise<PaymentTransaction[]>;\r\n}\r\n\r\n\r\n/** Payment Server to Server Calls\r\n * \r\n * These are the calls intended to be used server-side to process payments\r\n * \r\n */\r\nexport type PaymentServerApi = {\r\n    /** This will use the payment methods in order until one succeeds */\r\n    chargeUsingSavedPaymentMethods: (params: { amount: PaymentAmount }) => Promise<void>;\r\n}\r\n\r\n/** Payment Server to Payment Provider Api Calls\r\n * \r\n * This wraps the provider-specific server code\r\n */\r\nexport type PaymentProviderApi = {\r\n    providerName: PaymentProviderName;\r\n    setupSavedPaymentMethod: (userToken: PaymentProviderUserToken | null) => Promise<{\r\n        newUserToken?: PaymentProviderUserToken;\r\n        setupToken: PaymentProviderSavedPaymentMethodClientSetupToken;\r\n    }>;\r\n    obtainSavedPaymentMethod: (userToken: PaymentProviderUserToken, clientToken: PaymentProviderSavedPaymentMethodClientToken) => Promise<{\r\n        token: PaymentProviderSavedPaymentMethodStorageToken;\r\n        title: string;\r\n        expiration: PaymentMethodExpiration;\r\n    }>;\r\n    chargeSavedPaymentMethod: (userToken: PaymentProviderUserToken, token: PaymentProviderSavedPaymentMethodStorageToken, amount: PaymentAmount) => Promise<void>;\r\n\r\n    getPayments: (userToken: PaymentProviderUserToken) => Promise<PaymentTransaction[]>;\r\n}\r\n\r\n/** Payment Server Dependencies */\r\nexport type PaymentMethodStorageData = {\r\n    /** Key should be auto-generated by storage provider */\r\n    key: PaymentMethodStorageKey;\r\n    title: string;\r\n    expiration: PaymentMethodExpiration;\r\n    providerName: PaymentProviderName;\r\n    paymentMethodStorageToken: PaymentProviderSavedPaymentMethodStorageToken;\r\n};\r\n\r\nexport type PaymentUserTokenData = {\r\n    providerName: PaymentProviderName;\r\n    userToken: PaymentProviderUserToken;\r\n};\r\n\r\nexport type PaymentStorageProviderApi = {\r\n    getUserToken: (params: { providerName: PaymentProviderName }) => Promise<PaymentUserTokenData | null>;\r\n    setUserToken: (params: PaymentUserTokenData) => Promise<void>;\r\n\r\n    savePaymentMethod: (params: Omit<PaymentMethodStorageData, 'key'>) => Promise<void>;\r\n    /** Return all saved payment methods - In the order that they were created */\r\n    getSavedPaymentMethods: () => Promise<PaymentMethodStorageData[]>;\r\n    deleteSavedPaymentMethod: (params: { key: PaymentMethodStorageKey }) => Promise<void>;\r\n}\r\n\r\nexport class PaymentError extends Error {\r\n    constructor(public message: string, public data?: unknown) { super(); }\r\n}\r\n","\r\nexport enum ProcessSteps_CreateSavedPaymentMethod {\r\n    _01_Client_BeginCreateSavedPaymentMethod = 100,\r\n    _02_Server_SetupSavedPaymentMethod = 200,\r\n    _03_Client_CollectPaymentDetails = 300,\r\n    _04_Server_ObtainPaymentMethod = 400,\r\n    _05_Server_SavePaymentMethod = 500,\r\n};\r\n\r\nexport const logProcessStep_CreateSavedPaymentMethod = (step: ProcessSteps_CreateSavedPaymentMethod, status?: 'BEGIN' | 'END' | 'FAIL', data?: unknown) => {\r\n    // TODO: Implement Universal Logger\r\n\r\n    // eslint-disable-next-line no-console\r\n    console.log(`CreateSavedPaymentMethod: ${ProcessSteps_CreateSavedPaymentMethod[step]} ${status}`, data);\r\n};\r\n\r\nexport const wrapProcessStep_CreateSavedPaymentMethod = async <TResult>(step: ProcessSteps_CreateSavedPaymentMethod, execute: () => Promise<TResult>): Promise<TResult> => {\r\n    try {\r\n        logProcessStep_CreateSavedPaymentMethod(step, `BEGIN`);\r\n\r\n        const result = await execute();\r\n        logProcessStep_CreateSavedPaymentMethod(step, `END`);\r\n        return result;\r\n    } catch (error) {\r\n        logProcessStep_CreateSavedPaymentMethod(step, `FAIL`, { error });\r\n        throw error;\r\n    }\r\n};\r\n","/* eslint-disable @typescript-eslint/quotes */\r\n/* eslint-disable prefer-template */\r\nimport { ProcessSteps_CreateSavedPaymentMethod } from '../../../common/process-steps';\r\n\r\n// Saved Payments: https://stripe.com/docs/payments/save-and-reuse\r\nexport enum ProcessSteps_CreateSavedPaymentMethod_Stripe {\r\n    _02A_Server_GetOrCreateCustomer = ProcessSteps_CreateSavedPaymentMethod._02_Server_SetupSavedPaymentMethod + 1,\r\n    _02B_Server_CreateSetupIntent = ProcessSteps_CreateSavedPaymentMethod._02_Server_SetupSavedPaymentMethod + 2,\r\n    _03A_Client_CollectPaymentDetails = ProcessSteps_CreateSavedPaymentMethod._03_Client_CollectPaymentDetails + 1,\r\n    _04A_Server_ObtainPaymentMethod = ProcessSteps_CreateSavedPaymentMethod._04_Server_ObtainPaymentMethod + 1,\r\n    _04B_Server_ObtainPaymentMethodDetails = ProcessSteps_CreateSavedPaymentMethod._04_Server_ObtainPaymentMethod + 2,\r\n};\r\n\r\nexport const logProcessStep_CreateSavedPaymentMethod_Stripe = (step: ProcessSteps_CreateSavedPaymentMethod_Stripe, status?: 'BEGIN' | 'END' | 'FAIL', data?: unknown) => {\r\n    // TODO: Implement Universal Logger\r\n\r\n    // eslint-disable-next-line no-console\r\n    console.log(`CreateSavedPaymentMethod_Stripe: ${ProcessSteps_CreateSavedPaymentMethod_Stripe[step]} ${status}`, data);\r\n};\r\n\r\nexport const wrapProcessStep_CreateSavedPaymentMethod_Stripe = async <TResult>(step: ProcessSteps_CreateSavedPaymentMethod_Stripe, execute: () => Promise<TResult>): Promise<TResult> => {\r\n    try {\r\n        logProcessStep_CreateSavedPaymentMethod_Stripe(step, `BEGIN`);\r\n\r\n        const result = await execute();\r\n        logProcessStep_CreateSavedPaymentMethod_Stripe(step, `END`);\r\n        return result;\r\n    } catch (error) {\r\n        logProcessStep_CreateSavedPaymentMethod_Stripe(step, `FAIL`, { error });\r\n        throw error;\r\n    }\r\n};\r\n","import React, { useState } from 'react';\r\nimport { Elements, CardElement, useStripe, useElements } from '@stripe/react-stripe-js';\r\nimport { loadStripe, PaymentMethod, PaymentMethodCreateParams } from '@stripe/stripe-js';\r\nimport { PaymentClientComponents } from '../../../common/types-react';\r\nimport { PaymentError } from '../../../common/types';\r\nimport { stripeDecodeClientSetupToken, stripeEncodeClientToken } from './stripe-client-tokens';\r\nimport { wrapProcessStep_CreateSavedPaymentMethod_Stripe, ProcessSteps_CreateSavedPaymentMethod_Stripe } from '../common/stripe-process-steps';\r\n\r\nexport const createPaymentClientComponents_stripe = (params: { stripePublicKey: string }): PaymentClientComponents => {\r\n\r\n    const stripePromise = loadStripe(params.stripePublicKey);\r\n\r\n    const components: PaymentClientComponents = {\r\n        AppWrapperComponent: ({ children }) => (<Elements stripe={stripePromise}>{children}</Elements>),\r\n        PaymentMethodEntryComponent: ({ style, paymentMethodSetupToken, onPaymentMethodReady }) => {\r\n            const stripe = useStripe();\r\n            const elements = useElements();\r\n\r\n            const [stripeError, setStripeError] = useState(null as null | { message: string, error: unknown });\r\n\r\n            const handleSubmit = async (event: React.FormEvent<HTMLFormElement>) => {\r\n                event.preventDefault();\r\n                if (!stripe || !elements) { return; }\r\n\r\n                try {\r\n                    // Completed SetupIntent -> Used to get PaymentMethod\r\n                    const setupIntent = await wrapProcessStep_CreateSavedPaymentMethod_Stripe(\r\n                        ProcessSteps_CreateSavedPaymentMethod_Stripe._03A_Client_CollectPaymentDetails,\r\n                        async () => {\r\n\r\n                            const setupInfo = stripeDecodeClientSetupToken(paymentMethodSetupToken);\r\n\r\n                            const result = await stripe.confirmCardSetup(setupInfo.clientSecret, {\r\n                                payment_method: {\r\n                                    // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\r\n                                    card: elements.getElement(CardElement)!,\r\n                                    billing_details: setupInfo.customerBillingDetails,\r\n                                },\r\n                            });\r\n\r\n                            if (result.error || !result.setupIntent) {\r\n                                throw new PaymentError(`Stripe Payment Error`, result.error);\r\n                            }\r\n\r\n                            return result.setupIntent;\r\n                        });\r\n                    if (!setupIntent) { return; }\r\n\r\n                    onPaymentMethodReady(stripeEncodeClientToken({ setupIntent }));\r\n                } catch (error) {\r\n                    setStripeError({ message: `Stripe Payment Error`, error });\r\n                }\r\n            };\r\n\r\n            const s = style;\r\n            const inputStyle = {\r\n                base: {\r\n                    color: s.textColor,\r\n                    fontSize: s.fontSize ? `${s.fontSize}px` : ``,\r\n                    fontFamily: s.fontFamily,\r\n                    fontSmoothing: `antialiased`,\r\n                    \"::placeholder\": {\r\n                        color: s.textColor,\r\n                        opacity: 0.8,\r\n                    },\r\n                },\r\n                invalid: {\r\n                    color: s.textColor_invalid,\r\n                    iconColor: s.textColor_invalid,\r\n                },\r\n            };\r\n            const inputContainerStyle = {\r\n                marginBottom: s.elementPadding,\r\n                padding: s.textPadding,\r\n                backgroundColor: s.backgroundColor,\r\n                borderWidth: 1, borderStyle: `solid`, borderColor: s.borderColor, borderRadius: s.borderRadius,\r\n            };\r\n            const buttonStyle = {\r\n                color: s.textColor,\r\n                backgroundColor: s.backgroundColor,\r\n                borderWidth: 1, borderStyle: `solid`, borderColor: s.borderColor, borderRadius: s.borderRadius,\r\n\r\n                fontSize: s.fontSize ? `${s.fontSize}px` : ``,\r\n                fontFamily: s.fontFamily,\r\n                fontSmoothing: `antialiased`,\r\n                fontWeight: `bold`,\r\n                padding: s.textPadding,\r\n                marginBottom: s.elementPadding,\r\n            } as const;\r\n            const buttonJustifyContent = s.buttonAlignment === `left` ? `flex-start`\r\n                : (s.buttonAlignment === `right` ? `flex-end`\r\n                    : `center`);\r\n\r\n            const errorContainerStyle = {\r\n                marginBottom: s.elementPadding,\r\n                padding: s.textPadding,\r\n                backgroundColor: s.backgroundColor,\r\n                borderWidth: 1, borderStyle: `solid`, borderColor: s.borderColor, borderRadius: s.borderRadius,\r\n            };\r\n            const errorMessageStyle = {\r\n                color: s.textColor_invalid,\r\n\r\n                fontSize: s.fontSize ? `${s.fontSize}px` : ``,\r\n                fontFamily: s.fontFamily,\r\n                fontSmoothing: `antialiased`,\r\n                fontWeight: `bold`,\r\n                padding: s.textPadding,\r\n                marginBottom: s.elementPadding,\r\n            } as const;\r\n\r\n            return (\r\n                <form onSubmit={handleSubmit}>\r\n                    <div style={inputContainerStyle}>\r\n                        <CardElement options={{ style: inputStyle }} />\r\n                    </div>\r\n                    {stripeError && (\r\n                        <>\r\n                            <div style={errorContainerStyle}>\r\n                                <span style={errorMessageStyle}>{stripeError.message}</span>\r\n                            </div>\r\n                        </>\r\n                    )}\r\n\r\n                    {!stripeError && (\r\n                        <div style={{ display: `flex`, flexDirection: `row`, justifyContent: buttonJustifyContent }}>\r\n                            <button type='submit' disabled={!stripe || !elements} style={buttonStyle}>{s.buttonText ?? `Subscribe`}</button>\r\n                        </div>\r\n                    )}\r\n                </form>\r\n            );\r\n        },\r\n    };\r\n\r\n    return components;\r\n};\r\n","import { PaymentMethodCreateParams, SetupIntent } from '@stripe/stripe-js';\r\nimport { PaymentProviderSavedPaymentMethodClientSetupToken, PaymentProviderSavedPaymentMethodClientToken } from '../../../common/types';\r\n\r\nexport type StripeCustomerBillingDetails = PaymentMethodCreateParams.BillingDetails;\r\n\r\nexport type StripePaymentClientSetupToken = {\r\n    clientSecret: string;\r\n    customerBillingDetails: StripeCustomerBillingDetails;\r\n};\r\n\r\nexport const stripeEncodeClientSetupToken = (params: StripePaymentClientSetupToken): PaymentProviderSavedPaymentMethodClientSetupToken => {\r\n    return params as unknown as PaymentProviderSavedPaymentMethodClientSetupToken;\r\n};\r\nexport const stripeDecodeClientSetupToken = (params: PaymentProviderSavedPaymentMethodClientSetupToken): StripePaymentClientSetupToken => {\r\n    return params as unknown as StripePaymentClientSetupToken;\r\n};\r\n\r\nexport type StripePaymentClientToken = {\r\n    setupIntent: SetupIntent;\r\n};\r\n\r\nexport const stripeEncodeClientToken = (params: StripePaymentClientToken): PaymentProviderSavedPaymentMethodClientToken => {\r\n    return params as unknown as PaymentProviderSavedPaymentMethodClientToken;\r\n};\r\nexport const stripeDecodeClientToken = (params: PaymentProviderSavedPaymentMethodClientToken): StripePaymentClientToken => {\r\n    return params as unknown as StripePaymentClientToken;\r\n};\r\n","import { createUploadApiWebClient } from 'upload-api/client/web-client';\r\nimport { uploadApiConfig } from 'upload-api/client/config';\r\nimport { UploadUrl } from 'upload-api/client/types';\r\nimport { createUploader, downloadData } from 'upload-api/client/uploader';\r\nimport { AppError } from 'utils/error';\r\nimport { delay } from 'utils/delay';\r\nimport { error } from 'console';\r\n\r\nconst USER_DATA_SERVICE_STATE_KEY = `_USER_DATA_SERVICE_STATE`;\r\nexport type UserProfileInfo = {\r\n    key: string;\r\n    name: string;\r\n    emoji: string;\r\n    isActive: boolean;\r\n};\r\ntype UserProfileMetadata = {\r\n    name?: string;\r\n    emoji?: string;\r\n};\r\ntype UserProfileData = {\r\n    key: string;\r\n    name: string;\r\n    emoji?: string;\r\n    uploadUrl: UploadUrl;\r\n    lastUploadTimestamp?: number;\r\n};\r\ntype UserServiceState = {\r\n    userProfiles: UserProfileData[];\r\n    activeUserProfileKey: string;\r\n    changeTimestamp: number;\r\n};\r\ntype UserData = {\r\n    data: { [key: string]: null | string };\r\n    metadata?: UserProfileMetadata;\r\n    timestamp: number;\r\n};\r\n\r\nconst createUserDataService = () => {\r\n    const uploadApi = createUploadApiWebClient(uploadApiConfig);\r\n\r\n    const storage = {\r\n        getUserDataServiceState: (): null | UserServiceState => {\r\n            try {\r\n                return JSON.parse(localStorage.getItem(USER_DATA_SERVICE_STATE_KEY) ?? `NULL !{}`);\r\n            } catch{\r\n                return null;\r\n            }\r\n        },\r\n        setUserDataServiceState: (state: UserServiceState) => {\r\n            localStorage.setItem(USER_DATA_SERVICE_STATE_KEY, JSON.stringify(state));\r\n        },\r\n        getUserData: (): UserData => {\r\n            const state = storage.getUserDataServiceState();\r\n            const userState = state && state.userProfiles.find(x => x.key === state.activeUserProfileKey);\r\n            const data = {\r\n                data: {},\r\n                metadata: { name: userState?.name, emoji: userState?.emoji },\r\n                timestamp: Date.now(),\r\n            } as UserData;\r\n            const keys = Object.keys(localStorage).filter(x => !x.startsWith(`_`));\r\n            for (const k of keys) {\r\n                data.data[k] = localStorage.getItem(k);\r\n            }\r\n            return data;\r\n        },\r\n        clearUserData: () => {\r\n            // Remove all old data\r\n            const keys = Object.keys(localStorage).filter(x => !x.startsWith(`_`));\r\n            for (const k of keys) {\r\n                localStorage.removeItem(k);\r\n            }\r\n\r\n            // Load metadata\r\n            const state = storage.getUserDataServiceState();\r\n            if (!state) { return; }\r\n            state.userProfiles.forEach(x => { x.lastUploadTimestamp = undefined; });\r\n            storage.setUserDataServiceState(state);\r\n        },\r\n        setUserData: (userData: UserData) => {\r\n            storage.clearUserData();\r\n\r\n            // Set New data\r\n            for (const k of Object.keys(userData.data)) {\r\n                const val = userData.data[k];\r\n                if (!val) {\r\n                    localStorage.removeItem(k);\r\n                    return;\r\n                }\r\n                localStorage.setItem(k, val);\r\n            }\r\n\r\n            // Load metadata\r\n            const state = storage.getUserDataServiceState();\r\n            const userState = state && state.userProfiles.find(x => x.key === state.activeUserProfileKey);\r\n            if (!state || !userState) { return; }\r\n            userState.emoji = userData.metadata?.emoji ?? userState.emoji;\r\n            userState.name = userData.metadata?.name ?? userState.name;\r\n            userState.lastUploadTimestamp = userData.timestamp;\r\n            storage.setUserDataServiceState(state);\r\n        },\r\n    };\r\n\r\n    const getUserProfile = (userProfileKey: string) => {\r\n        const state = storage.getUserDataServiceState();\r\n        if (!state) { return null; }\r\n        return state.userProfiles.find(x => x.key === userProfileKey);\r\n    };\r\n    const getActiveUserProfile = () => {\r\n        const state = storage.getUserDataServiceState();\r\n        if (!state?.activeUserProfileKey) { return null; }\r\n        return state.userProfiles.find(x => x.key === state.activeUserProfileKey);\r\n    };\r\n\r\n    const uploadBackup = async (userState: UserProfileData, userData: UserData) => {\r\n        const uploadUrl = await uploadApi.createUploadUrl({ contentType: `application/json`, prefix: `${userState.name}/${userState.uploadUrl.relativePath}/${Date.now()}` });\r\n        const uploader = createUploader(uploadUrl.uploadUrl);\r\n        await uploader.uploadData(userData);\r\n    };\r\n\r\n    const uploadWithAutoRenew = async (userProfileKey: string, userData: UserData) => {\r\n        const state = storage.getUserDataServiceState();\r\n        const userState = state && state.userProfiles.find(x => x.key === userProfileKey);\r\n        if (!state || !userState) { return; }\r\n\r\n        // Upload backup\r\n        await uploadBackup(userState, userData);\r\n\r\n        const upload = async () => {\r\n            const uploader = createUploader(userState.uploadUrl);\r\n            await uploader.uploadData(userData);\r\n        };\r\n\r\n        try {\r\n            // Try to upload\r\n            console.log(`uploadWithAutoRenew - Attempt 1`);\r\n            await upload();\r\n            console.log(`uploadWithAutoRenew - UPLOADED`);\r\n        } catch{\r\n            // Rewew and try again\r\n            console.log(`uploadWithAutoRenew - Attempt 2`);\r\n\r\n            const newUploarUrl = await uploadApi.renewUploadUrl({ uploadUrl: userState.uploadUrl });\r\n            userState.uploadUrl = newUploarUrl.uploadUrl;\r\n            storage.setUserDataServiceState(state);\r\n\r\n            await upload();\r\n\r\n            console.log(`uploadWithAutoRenew - UPLOADED AFTER RENEW`);\r\n        }\r\n    };\r\n\r\n    const updateUserProfileFromServer = async (userProfileKey: string) => {\r\n        console.log(`updateUserProfile`, { userProfileKey });\r\n        const state = storage.getUserDataServiceState();\r\n        const userState = state && state.userProfiles.find(x => x.key === userProfileKey);\r\n        if (!state || !userState) {\r\n            console.log(`updateUserProfile - NO USER STATE`, { userProfileKey });\r\n            return;\r\n        }\r\n\r\n        const userData = await downloadData(userState.uploadUrl.getUrl) as UserData;\r\n        if (!userData.timestamp || userData.timestamp <= (userState.lastUploadTimestamp ?? 0)) {\r\n            // Skip if not new\r\n            console.log(`updateUserProfile - NOT NEW`, { name: userState.name });\r\n            return;\r\n        }\r\n\r\n        console.log(`updateUserProfile - UPDATED USER PROFILE`, { name: userState.name });\r\n        userState.emoji = userData.metadata?.emoji ?? userState.emoji;\r\n        userState.name = userData.metadata?.name ?? userState.name;\r\n        userState.lastUploadTimestamp = userData.timestamp;\r\n        storage.setUserDataServiceState(state);\r\n\r\n        if (userState.key === state.activeUserProfileKey) {\r\n            console.log(`updateUserProfile - UPDATED ACTIVE USER DATA`, { name: userState.name });\r\n            storage.setUserData(userData);\r\n        }\r\n    };\r\n    const updateAllProfilesFromServer = async () => {\r\n        const state = storage.getUserDataServiceState();\r\n        if (!state) { return; }\r\n\r\n        for (const userState of state.userProfiles) {\r\n            try {\r\n                // eslint-disable-next-line no-await-in-loop\r\n                await updateUserProfileFromServer(userState.key);\r\n            } catch (error_) {\r\n                console.log(`updateAllProfiles - ERROR Updating user profile`, { error: error_ });\r\n            }\r\n        }\r\n    };\r\n\r\n    let isSetupStarted = false;\r\n    let isSetupDone = false;\r\n\r\n    const service = {\r\n        setup: async () => {\r\n            if (isSetupStarted) {\r\n                while (!isSetupDone) {\r\n                    // eslint-disable-next-line no-await-in-loop\r\n                    await delay(10);\r\n                }\r\n                return;\r\n            }\r\n            isSetupStarted = true;\r\n            const doSetup = async () => {\r\n                console.log(`UserDataService:setup`);\r\n\r\n                const a = getActiveUserProfile();\r\n                if (a) {\r\n                    await updateAllProfilesFromServer();\r\n                    return;\r\n                }\r\n\r\n                const state = storage.getUserDataServiceState();\r\n                if (state && state.userProfiles.length > 0) {\r\n                    state.activeUserProfileKey = state.userProfiles[0].key;\r\n                    storage.setUserDataServiceState(state);\r\n                    await updateAllProfilesFromServer();\r\n                    return;\r\n                }\r\n\r\n                const newUploadUrlResult = await uploadApi.createUploadUrl({ contentType: `application/json` });\r\n                const newState: UserServiceState = state ?? {\r\n                    userProfiles: [{\r\n                        key: newUploadUrlResult.uploadUrl.relativePath,\r\n                        name: `${`Player 1`}`,\r\n                        uploadUrl: newUploadUrlResult.uploadUrl,\r\n                    }],\r\n                    activeUserProfileKey: newUploadUrlResult.uploadUrl.relativePath,\r\n                    changeTimestamp: 0,\r\n                };\r\n                storage.setUserDataServiceState(newState);\r\n\r\n                // Upload initial data\r\n                await service.uploadUserData();\r\n            };\r\n\r\n            try {\r\n                await doSetup();\r\n                isSetupDone = true;\r\n            } catch (error_) {\r\n                // Setup Failed\r\n                isSetupDone = true;\r\n                throw error_;\r\n            }\r\n        },\r\n        getActiveUser: (): null | UserProfileInfo => {\r\n            const user = getActiveUserProfile();\r\n            if (!user) { return null; }\r\n            return {\r\n                key: user.key,\r\n                name: user.name,\r\n                emoji: user.emoji ?? ``,\r\n                isActive: true,\r\n            };\r\n        },\r\n        setActiveUser: async (userProfileKey: string) => {\r\n            console.log(`setActiveUser`, { userProfileKey });\r\n            const state = storage.getUserDataServiceState();\r\n            if (!state) { return; }\r\n\r\n            if (!state.userProfiles.find(x => x.key === userProfileKey)) {\r\n                console.log(`setActiveUser - User Profile Not Found`, { userProfileKey });\r\n                throw new AppError(`User Profile not found`);\r\n            }\r\n\r\n            // Don't upload old user data - the chance of this being out of date is high\r\n            // // Upload old user data\r\n            // await service.uploadUserData();\r\n\r\n            state.activeUserProfileKey = userProfileKey;\r\n            state.changeTimestamp = 0;\r\n            storage.setUserDataServiceState(state);\r\n\r\n            console.log(`setActiveUser - before download`, { stateJson: JSON.stringify(storage.getUserDataServiceState()) });\r\n\r\n            // Clear Current State\r\n            storage.clearUserData();\r\n            console.log(`setActiveUser - cleared user data`, {});\r\n\r\n            // Download new user data\r\n            await service.downloadUserDataIfNewer();\r\n        },\r\n        getUserProfiles: async (): Promise<UserProfileInfo[]> => {\r\n            const state = storage.getUserDataServiceState();\r\n            if (!state?.activeUserProfileKey) { return []; }\r\n            return state.userProfiles.map(x => ({\r\n                key: x.key,\r\n                name: x.name,\r\n                emoji: x.emoji ?? ``,\r\n                isActive: state.activeUserProfileKey === x.key,\r\n            }));\r\n        },\r\n        setUserProfileInfo: async (userProfileKey: string, info: { emoji?: string, name?: string }) => {\r\n            const state = storage.getUserDataServiceState();\r\n            if (!state) {\r\n                console.log(`uploadUserData - NO STATE`);\r\n                return;\r\n            }\r\n\r\n            const userState = state.userProfiles.find(x => x.key === userProfileKey);\r\n            if (!userState) {\r\n                console.log(`uploadUserData - NO USER STATE`);\r\n                return;\r\n            }\r\n\r\n            userState.emoji = info.emoji ?? userState.emoji;\r\n            userState.name = info.name ?? userState.name;\r\n            storage.setUserDataServiceState(state);\r\n\r\n            // Save to remote data\r\n            const uploader = createUploader(userState.uploadUrl);\r\n            const uData = await uploader.downloadData() as UserData;\r\n            if (!uData) { return; }\r\n            uData.metadata = {\r\n                name: userState.name,\r\n                emoji: userState.emoji,\r\n            };\r\n            uData.timestamp = Date.now();\r\n            await uploadWithAutoRenew(userProfileKey, uData);\r\n        },\r\n        uploadUserData: async () => {\r\n            console.log(`uploadUserData`);\r\n\r\n            const state = storage.getUserDataServiceState();\r\n            if (!state) {\r\n                console.log(`uploadUserData - NO STATE`);\r\n                return;\r\n            }\r\n\r\n            const userState = state.userProfiles.find(x => x.key === state.activeUserProfileKey);\r\n            if (!userState) {\r\n                console.log(`uploadUserData - NO user State`, { state });\r\n                return;\r\n            }\r\n\r\n            userState.lastUploadTimestamp = Date.now();\r\n            storage.setUserDataServiceState(state);\r\n\r\n            const userData = storage.getUserData();\r\n            await uploadWithAutoRenew(userState.key, userData);\r\n\r\n            console.log(`uploadUserData - UPLOADED`, { userData });\r\n        },\r\n        downloadUserDataIfNewer: async () => {\r\n            const state = storage.getUserDataServiceState();\r\n            if (!state) { return; }\r\n\r\n            const userState = state.userProfiles.find(x => x.key === state.activeUserProfileKey);\r\n            if (!userState) { return; }\r\n\r\n            console.log(`downloadUserDataIfNewer`);\r\n\r\n            const uploader = createUploader(userState.uploadUrl);\r\n            const userData = await uploader.downloadData() as UserData;\r\n\r\n            // Don't update if not newer\r\n            if (!userData.timestamp || userData.timestamp <= (userState.lastUploadTimestamp ?? 0)) {\r\n                console.log(`downloadUserDataIfNewer - Local data is up to date`, { state, userData });\r\n                return;\r\n            }\r\n\r\n            console.log(`downloadUserDataIfNewer - UPDATING`, { state, userData });\r\n            storage.setUserData(userData);\r\n        },\r\n        createShareCode: async (userProfileKey: string) => {\r\n            await service.setup();\r\n            const user = getUserProfile(userProfileKey);\r\n            if (!user) {\r\n                throw new AppError(`user should not be null`);\r\n            }\r\n\r\n            const shareUrlResult = await uploadApi.createUploadUrl({ contentType: `application/json`, shareablePath: true });\r\n\r\n            // Save user uploadUrl to shared path\r\n            const uploader = createUploader(shareUrlResult.uploadUrl);\r\n            await uploader.uploadData(user.uploadUrl);\r\n\r\n            return {\r\n                shareCode: shareUrlResult.uploadUrl.relativePath,\r\n            };\r\n        },\r\n        addUserFromShareCode: async (shareCode: string) => {\r\n            console.log(`addUserFromShareCode`, { shareCode });\r\n\r\n            // Don't have a clean way to get the path, but can generate a new path from the server and use it as a template\r\n            const shareUrlResult = await uploadApi.createUploadUrl({ contentType: `application/json`, shareablePath: true });\r\n            const shareGetUrl = shareUrlResult.uploadUrl.getUrl.replace(shareUrlResult.uploadUrl.relativePath, shareCode.toUpperCase());\r\n            const sharedUploadUrl = await downloadData(shareGetUrl) as UploadUrl;\r\n            if (!sharedUploadUrl.putUrl) {\r\n                console.log(`addUserFromShareCode - FAILED TO GET PROFILE`);\r\n                throw new AppError(`Failed to get user profile`);\r\n            }\r\n\r\n            const state = storage.getUserDataServiceState();\r\n            if (!state) {\r\n                console.log(`addUserFromShareCode - NO STATE`);\r\n                throw new AppError(`UserDataService is not setup`);\r\n            }\r\n\r\n            // Already has that user profile\r\n            if (state.userProfiles.find(x => x.key === sharedUploadUrl.relativePath)) {\r\n                console.log(`addUserFromShareCode - ALREADY HAS USER`, { userKey: sharedUploadUrl.relativePath });\r\n                return;\r\n            }\r\n\r\n            state.userProfiles.push({\r\n                key: sharedUploadUrl.relativePath,\r\n                name: `Player ${state.userProfiles.length + 1}`,\r\n                uploadUrl: sharedUploadUrl,\r\n            });\r\n            storage.setUserDataServiceState(state);\r\n\r\n            console.log(`addUserFromShareCode - ADDED`, { userKey: sharedUploadUrl.relativePath });\r\n\r\n            // Reload profile\r\n            await updateUserProfileFromServer(sharedUploadUrl.relativePath);\r\n        },\r\n    };\r\n    return service;\r\n};\r\n\r\nexport type UserDataService = ReturnType<typeof createUserDataService>;\r\nconst serviceState = {\r\n    instance: null as null | UserDataService,\r\n};\r\nexport const UserDataService = {\r\n    get: (): UserDataService => {\r\n        if (!serviceState.instance) {\r\n            serviceState.instance = createUserDataService();\r\n        };\r\n        return serviceState.instance;\r\n    },\r\n};\r\n","var $export = require('./_export');\nvar toAbsoluteIndex = require('./_to-absolute-index');\nvar fromCharCode = String.fromCharCode;\nvar $fromCodePoint = String.fromCodePoint;\n\n// length should be 1, old FF problem\n$export($export.S + $export.F * (!!$fromCodePoint && $fromCodePoint.length != 1), 'String', {\n  // 21.1.2.2 String.fromCodePoint(...codePoints)\n  fromCodePoint: function fromCodePoint(x) { // eslint-disable-line no-unused-vars\n    var res = [];\n    var aLen = arguments.length;\n    var i = 0;\n    var code;\n    while (aLen > i) {\n      code = +arguments[i++];\n      if (toAbsoluteIndex(code, 0x10ffff) !== code) throw RangeError(code + ' is not a valid code point');\n      res.push(code < 0x10000\n        ? fromCharCode(code)\n        : fromCharCode(((code -= 0x10000) >> 10) + 0xd800, code % 0x400 + 0xdc00)\n      );\n    } return res.join('');\n  }\n});\n","import { webRequest } from 'utils/web-request';\r\nimport { UploadApi, UploadApiEndpointName, UploadApiRequestData } from './types';\r\n\r\nexport const createUploadApiWebClient = (config: { uploadApiUrl: string }): UploadApi => {\r\n\r\n    async function apiRequest<T>(endpoint: UploadApiEndpointName, data: unknown): Promise<T> {\r\n        const url = `${config.uploadApiUrl}/${endpoint}`;\r\n\r\n        const requestData: UploadApiRequestData = {\r\n            endpoint,\r\n            data,\r\n        };\r\n\r\n        const resultObj = (await webRequest(url, requestData)) as { data: T };\r\n\r\n        return resultObj.data;\r\n    };\r\n\r\n    const api: UploadApi = {\r\n        createUploadUrl: (data) => apiRequest(`createUploadUrl`, data),\r\n        renewUploadUrl: (data) => apiRequest(`renewUploadUrl`, data),\r\n    };\r\n\r\n    return api;\r\n};\r\n","// 20.2.2.28 Math.sign(x)\nmodule.exports = Math.sign || function sign(x) {\n  // eslint-disable-next-line no-self-compare\n  return (x = +x) == 0 || x != x ? x : x < 0 ? -1 : 1;\n};\n","import { fetchWithTimeout } from 'utils/web-request';\r\nimport { AppError } from 'utils/error';\r\nimport { UploadUrl } from './types';\r\nimport { createUploadApiWebClient } from './web-client';\r\n\r\nexport const downloadData = async (getUrl: string) => {\r\n    const result = await fetchWithTimeout(getUrl, {\r\n        method: `GET`,\r\n        headers: {\r\n            'Accept': `application/json`,\r\n        },\r\n    });\r\n    const json = await result.json() as { data: unknown };\r\n    return json.data;\r\n};\r\n\r\n\r\nexport const createUploader = (uploadUrl: UploadUrl) => {\r\n    return {\r\n        uploadData: async (data: unknown) => {\r\n            const body = JSON.stringify({ data });\r\n            const result = await fetchWithTimeout(uploadUrl.putUrl, {\r\n                method: `PUT`,\r\n                headers: {\r\n                    'Accept': `application/json`,\r\n                    'Content-Type': `application/json`,\r\n                    'Content-Length': `${body.length}`,\r\n                },\r\n                body,\r\n            });\r\n\r\n            if (!result.ok) {\r\n                throw new AppError(`Upload Failed`);\r\n            }\r\n        },\r\n        downloadData: async (): Promise<unknown> => {\r\n            return await downloadData(uploadUrl.getUrl);\r\n        },\r\n    };\r\n};\r\n\r\nexport const createSmartUploader = <T extends {}>(args: { getUploadUrl: () => Promise<null | UploadUrl>, setUploadUrl: (uploadUrl: UploadUrl) => Promise<void>, uploadUrlPrefix: string, uploadApiUrl: string }) => {\r\n    const uploadApiWebClient = createUploadApiWebClient(args);\r\n\r\n    let _uploadUrl = null as null | UploadUrl;\r\n\r\n    const setupUploadUrl = async () => {\r\n        if (_uploadUrl) { return _uploadUrl; }\r\n\r\n        _uploadUrl = await args.getUploadUrl();\r\n        if (_uploadUrl) { return _uploadUrl; }\r\n\r\n        _uploadUrl = (await uploadApiWebClient.createUploadUrl({ prefix: `doodle` })).uploadUrl;\r\n        await args.setUploadUrl(_uploadUrl);\r\n        return _uploadUrl;\r\n    };\r\n\r\n    return {\r\n        load: async (): Promise<null | T> => {\r\n            const uploadUrl = await setupUploadUrl();\r\n\r\n            try {\r\n                const data = await downloadData(uploadUrl.getUrl);\r\n                return data as T;\r\n            } catch{\r\n                return null;\r\n            }\r\n        },\r\n        save: async (data: T) => {\r\n            let uploadUrl = await setupUploadUrl();\r\n\r\n            try {\r\n                const uploader = createUploader(uploadUrl);\r\n                await uploader.uploadData(data);\r\n            } catch{\r\n                // Try again after renew upload token\r\n                uploadUrl = (await uploadApiWebClient.renewUploadUrl({ uploadUrl })).uploadUrl;\r\n                await args.setUploadUrl(uploadUrl);\r\n                _uploadUrl = uploadUrl;\r\n\r\n                const uploader = createUploader(uploadUrl);\r\n                await uploader.uploadData(data);\r\n            }\r\n\r\n            // Upload backup (temp)\r\n            const backupUrl = (await uploadApiWebClient.createUploadUrl({ prefix: `${uploadUrl.relativePath}/backup` })).uploadUrl;\r\n            const backupUploader = createUploader(backupUrl);\r\n            await backupUploader.uploadData(data);\r\n        },\r\n    };\r\n};\r\n","export var IconsManifest = [{\n  \"id\": \"fa\",\n  \"name\": \"Font Awesome\",\n  \"projectUrl\": \"https://fontawesome.com/\",\n  \"license\": \"CC BY 4.0 License\",\n  \"licenseUrl\": \"https://creativecommons.org/licenses/by/4.0/\"\n}, {\n  \"id\": \"io\",\n  \"name\": \"Ionicons\",\n  \"projectUrl\": \"https://ionicons.com/\",\n  \"license\": \"MIT\",\n  \"licenseUrl\": \"https://github.com/ionic-team/ionicons/blob/master/LICENSE\"\n}, {\n  \"id\": \"md\",\n  \"name\": \"Material Design icons\",\n  \"projectUrl\": \"http://google.github.io/material-design-icons/\",\n  \"license\": \"Apache License Version 2.0\",\n  \"licenseUrl\": \"https://github.com/google/material-design-icons/blob/master/LICENSE\"\n}, {\n  \"id\": \"ti\",\n  \"name\": \"Typicons\",\n  \"projectUrl\": \"http://s-ings.com/typicons/\",\n  \"license\": \"CC BY-SA 3.0\",\n  \"licenseUrl\": \"https://creativecommons.org/licenses/by-sa/3.0/\"\n}, {\n  \"id\": \"go\",\n  \"name\": \"Github Octicons icons\",\n  \"projectUrl\": \"https://octicons.github.com/\",\n  \"license\": \"MIT\",\n  \"licenseUrl\": \"https://github.com/primer/octicons/blob/master/LICENSE\"\n}, {\n  \"id\": \"fi\",\n  \"name\": \"Feather\",\n  \"projectUrl\": \"https://feathericons.com/\",\n  \"license\": \"MIT\",\n  \"licenseUrl\": \"https://github.com/feathericons/feather/blob/master/LICENSE\"\n}, {\n  \"id\": \"gi\",\n  \"name\": \"Game Icons\",\n  \"projectUrl\": \"https://game-icons.net/\",\n  \"license\": \"CC BY 3.0\",\n  \"licenseUrl\": \"https://creativecommons.org/licenses/by/3.0/\"\n}, {\n  \"id\": \"wi\",\n  \"name\": \"Weather Icons\",\n  \"projectUrl\": \"https://erikflowers.github.io/weather-icons/\",\n  \"license\": \"SIL OFL 1.1\",\n  \"licenseUrl\": \"http://scripts.sil.org/OFL\"\n}, {\n  \"id\": \"di\",\n  \"name\": \"Devicons\",\n  \"projectUrl\": \"https://vorillaz.github.io/devicons/\",\n  \"license\": \"MIT\",\n  \"licenseUrl\": \"https://opensource.org/licenses/MIT\"\n}, {\n  \"id\": \"ai\",\n  \"name\": \"Ant Design Icons\",\n  \"projectUrl\": \"https://github.com/ant-design/ant-design-icons\",\n  \"license\": \"MIT\",\n  \"licenseUrl\": \"https://opensource.org/licenses/MIT\"\n}, {\n  \"id\": \"bs\",\n  \"name\": \"Bootstrap Icons\",\n  \"projectUrl\": \"https://github.com/twbs/icons\",\n  \"license\": \"MIT\",\n  \"licenseUrl\": \"https://opensource.org/licenses/MIT\"\n}, {\n  \"id\": \"ri\",\n  \"name\": \"Remix Icon\",\n  \"projectUrl\": \"https://github.com/Remix-Design/RemixIcon\",\n  \"license\": \"Apache License Version 2.0\",\n  \"licenseUrl\": \"http://www.apache.org/licenses/\"\n}, {\n  \"id\": \"fc\",\n  \"name\": \"Flat Color Icons\",\n  \"projectUrl\": \"https://github.com/icons8/flat-color-icons\",\n  \"license\": \"MIT\",\n  \"licenseUrl\": \"https://opensource.org/licenses/MIT\"\n}, {\n  \"id\": \"gr\",\n  \"name\": \"Grommet-Icons\",\n  \"projectUrl\": \"https://github.com/grommet/grommet-icons\",\n  \"license\": \"Apache License Version 2.0\",\n  \"licenseUrl\": \"http://www.apache.org/licenses/\"\n}];","import * as React from 'react';\nexport var DefaultContext = {\n  color: undefined,\n  size: undefined,\n  className: undefined,\n  style: undefined,\n  attr: undefined\n};\nexport var IconContext = React.createContext && React.createContext(DefaultContext);","import \"core-js/modules/es6.array.map\";\nimport \"core-js/modules/es6.symbol\";\nimport \"core-js/modules/es6.array.index-of\";\nimport \"core-js/modules/es6.object.assign\";\n\nvar __assign = this && this.__assign || function () {\n  __assign = Object.assign || function (t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n      s = arguments[i];\n\n      for (var p in s) {\n        if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n      }\n    }\n\n    return t;\n  };\n\n  return __assign.apply(this, arguments);\n};\n\nvar __rest = this && this.__rest || function (s, e) {\n  var t = {};\n\n  for (var p in s) {\n    if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0) t[p] = s[p];\n  }\n\n  if (s != null && typeof Object.getOwnPropertySymbols === \"function\") for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\n    if (e.indexOf(p[i]) < 0) t[p[i]] = s[p[i]];\n  }\n  return t;\n};\n\nimport * as React from 'react';\nimport { IconContext, DefaultContext } from './iconContext';\n\nfunction Tree2Element(tree) {\n  return tree && tree.map(function (node, i) {\n    return React.createElement(node.tag, __assign({\n      key: i\n    }, node.attr), Tree2Element(node.child));\n  });\n}\n\nexport function GenIcon(data) {\n  return function (props) {\n    return React.createElement(IconBase, __assign({\n      attr: __assign({}, data.attr)\n    }, props), Tree2Element(data.child));\n  };\n}\nexport function IconBase(props) {\n  var elem = function elem(conf) {\n    var computedSize = props.size || conf.size || \"1em\";\n    var className;\n    if (conf.className) className = conf.className;\n    if (props.className) className = (className ? className + ' ' : '') + props.className;\n\n    var attr = props.attr,\n        title = props.title,\n        svgProps = __rest(props, [\"attr\", \"title\"]);\n\n    return React.createElement(\"svg\", __assign({\n      stroke: \"currentColor\",\n      fill: \"currentColor\",\n      strokeWidth: \"0\"\n    }, conf.attr, attr, svgProps, {\n      className: className,\n      style: __assign({\n        color: props.color || conf.color\n      }, conf.style, props.style),\n      height: computedSize,\n      width: computedSize,\n      xmlns: \"http://www.w3.org/2000/svg\"\n    }), title && React.createElement(\"title\", null, title), props.children);\n  };\n\n  return IconContext !== undefined ? React.createElement(IconContext.Consumer, null, function (conf) {\n    return elem(conf);\n  }) : elem(DefaultContext);\n}","'use strict';\n// https://tc39.github.io/proposal-flatMap/#sec-Array.prototype.flatMap\nvar $export = require('./_export');\nvar flattenIntoArray = require('./_flatten-into-array');\nvar toObject = require('./_to-object');\nvar toLength = require('./_to-length');\nvar aFunction = require('./_a-function');\nvar arraySpeciesCreate = require('./_array-species-create');\n\n$export($export.P, 'Array', {\n  flatMap: function flatMap(callbackfn /* , thisArg */) {\n    var O = toObject(this);\n    var sourceLen, A;\n    aFunction(callbackfn);\n    sourceLen = toLength(O.length);\n    A = arraySpeciesCreate(O, 0);\n    flattenIntoArray(A, O, O, sourceLen, 0, 1, callbackfn, arguments[1]);\n    return A;\n  }\n});\n\nrequire('./_add-to-unscopables')('flatMap');\n","import { Platform } from 'react-native-lite';\r\n\r\nexport const createSpeechService = (): {\r\n    speak: (text: string, languange?: string) => void;\r\n    getVoicesForLanguange: (languange: string) => { voice: SpeechSynthesisVoice, isSelected: boolean }[];\r\n    setVoiceForLanguange: (languange: string, voice: SpeechSynthesisVoice) => void;\r\n} => {\r\n    if (Platform.OS !== `web`) {\r\n        return {\r\n            speak: () => { },\r\n            getVoicesForLanguange: () => [],\r\n            setVoiceForLanguange: () => { },\r\n        };\r\n    }\r\n\r\n    const synth = window.speechSynthesis;\r\n\r\n    const selectedVoices = {} as { [languange: string]: SpeechSynthesisVoice };\r\n\r\n    const speak = (text: string, languange?: string) => {\r\n        const voiceLang = selectedVoices[languange ?? `en`] ?? null;\r\n\r\n        try {\r\n            const u = new SpeechSynthesisUtterance(text);\r\n            u.voice = voiceLang;\r\n            synth.speak(u);\r\n        } catch {\r\n            // Ignore\r\n        }\r\n    };\r\n\r\n    return {\r\n        speak,\r\n        getVoicesForLanguange: (languange) => {\r\n            const voices = synth.getVoices();\r\n            console.log(`voices`, { voices });\r\n            const v = voices.filter(x => x.lang.startsWith(languange)).map(x => ({\r\n                voice: x,\r\n                isSelected: selectedVoices[languange] === x,\r\n            }));\r\n            return v;\r\n        },\r\n        setVoiceForLanguange: (language, voice) => {\r\n            selectedVoices[language] = voice;\r\n        },\r\n    };\r\n};\r\n\r\nexport type SpeechService = ReturnType<typeof createSpeechService>;\r\n","export type JsonTyped<T> = string & { __json: T };\r\n\r\nexport const jsonParse = <T>(json: JsonTyped<T>): T => {\r\n    return JSON.parse(json) as T;\r\n};\r\nexport const jsonParse_smart = <T>(json: T | JsonTyped<T>): T => {\r\n    if (typeof json === `string`) {\r\n        return JSON.parse(json) as T;\r\n    }\r\n    return json as T;\r\n};\r\nexport const jsonStringify = <T>(obj: T) => JSON.stringify(obj) as JsonTyped<T>;\r\n\r\nexport const jsonStringify_safe = (obj: unknown, shouldFormat?: boolean): string => {\r\n    const visited = [] as unknown[];\r\n\r\n    return JSON.stringify(obj, (_, val: unknown) => {\r\n        if (val != null && typeof val == `object`) {\r\n            if (visited.includes(val)) {\r\n                return `[OBJ-DUPLICATED]`;\r\n            }\r\n            visited.push(val);\r\n        }\r\n        return val;\r\n    }, shouldFormat ? 2 : 0);\r\n};\r\n","import React, { useState } from 'react';\r\nimport { View, Text, TouchableOpacity, Clipboard } from 'react-native-lite';\r\nimport { theme } from 'themes/theme';\r\nimport { ErrorState } from 'utils/error';\r\nimport { jsonStringify_safe } from 'utils/json';\r\nimport { Icon } from './icon';\r\nimport { IconKind } from './icon-kind';\r\n\r\nconst DEBUG = true;\r\n\r\nconst errorBoxStyle = {\r\n    view: theme.view_error,\r\n    text: theme.text_error,\r\n    text_errorMessage: theme.text_errorMessage,\r\n    icon: theme.icon,\r\n    icon_errorMessage: theme.icon_errorMessage,\r\n    button: { outlineColor: theme.colors.outline },\r\n};\r\n\r\nexport const ErrorBox = ({ error }: { error: ErrorState | null | undefined }) => {\r\n    if (!error) { return (<></>); }\r\n    return (<ErrorBox_Inner error={error} />);\r\n};\r\n\r\nconst ErrorBox_Inner = (props: { error: ErrorState }) => {\r\n    const [expanded, setExpanded] = useState(false);\r\n\r\n    // console.log(`ErrorBox`, { error: props.error, expanded });\r\n\r\n    const errorAsString = typeof props.error === `string` ? `${props.error}` : null;\r\n    const errorMessage = props.error.message ?? errorAsString ?? `Unknown Error`;\r\n    const errorDetails = props.error.data && jsonStringify_safe(props.error.data, true) || undefined;\r\n    const errorObjText = DEBUG && props.error && jsonStringify_safe(props.error, true) || undefined;\r\n    const canExpand = !!errorDetails || !!errorObjText;\r\n\r\n    return (\r\n        <View style={errorBoxStyle.view}>\r\n            <View style={{ flexDirection: `row` }}>\r\n                <TouchableOpacity style={{ flex: 1, flexDirection: `row`, alignItems: `center`, ...errorBoxStyle.button }} onPress={() => setExpanded(!expanded)}>\r\n                    {canExpand && (expanded ? <Icon style={errorBoxStyle.icon} kind={IconKind.expanded} /> : <Icon style={errorBoxStyle.icon} kind={IconKind.collapsed} />)}\r\n                    <View style={{ paddingRight: 8 }}>\r\n                        <Icon style={errorBoxStyle.icon} kind={IconKind.error} />\r\n                    </View>\r\n                    <View style={{ flex: 1, overflow: `hidden` }}>\r\n                        <Text style={errorBoxStyle.text} numberOfLines={!expanded ? 1 : undefined}>{errorMessage}</Text>\r\n                    </View>\r\n                </TouchableOpacity>\r\n                {DEBUG && (\r\n                    <TouchableOpacity style={{ flexDirection: `row`, alignItems: `center`, paddingLeft: 8, ...errorBoxStyle.button }} onPress={() => Clipboard.setString(jsonStringify_safe({ errorMessage, errorDetails, errorObjText }, true))}>\r\n                        <Icon style={errorBoxStyle.icon} kind={IconKind.copy} />\r\n                    </TouchableOpacity>\r\n                )}\r\n                {props.error.retryCallback && (\r\n                    <TouchableOpacity style={{ flexDirection: `row`, alignItems: `center`, paddingLeft: 8, ...errorBoxStyle.button }} onPress={props.error.retryCallback}>\r\n                        <Icon style={errorBoxStyle.icon} kind={IconKind.retry} />\r\n                    </TouchableOpacity>\r\n                )}\r\n            </View>\r\n            {canExpand && expanded && !!errorDetails && (<Text style={{ ...errorBoxStyle.text }}>{errorDetails}</Text>)}\r\n            {canExpand && expanded && !!errorObjText && (<Text style={{ ...errorBoxStyle.text }}>{errorObjText}</Text>)}\r\n        </View>\r\n    );\r\n};\r\n\r\n\r\nexport const ErrorMessage = (props: { children: string }) => {\r\n    return (\r\n        <View style={{ flexDirection: `row`, alignItems: `center` }}>\r\n            <View style={{ paddingLeft: 8, paddingRight: 8 }}>\r\n                <Icon style={errorBoxStyle.icon_errorMessage} kind={IconKind.error} />\r\n            </View>\r\n            <View style={{ overflow: `hidden` }}>\r\n                <Text style={errorBoxStyle.text_errorMessage} numberOfLines={1}>{props.children}</Text>\r\n            </View>\r\n        </View>\r\n    );\r\n};\r\n","import React, { } from 'react';\r\nimport { Text, TouchableOpacity } from 'react-native-lite';\r\nimport { theme, ThemeTextStyle, ThemeViewStyle, extractViewStyle, extractTextStyle } from 'themes/theme';\r\n\r\nexport const Button = (props: { style?: ThemeTextStyle & ThemeViewStyle, styleAlt?: boolean, children: string, onPress: () => void }) => {\r\n    const s = props.style ?? (props.styleAlt ? theme.button_formAction_alt : theme.button_formAction);\r\n    return (\r\n        <TouchableOpacity style={extractViewStyle(s)} onPress={props.onPress}>\r\n            <Text style={extractTextStyle(s)}>{props.children}</Text>\r\n        </TouchableOpacity>\r\n    );\r\n};\r\n","import React, { } from 'react';\r\nimport { View, Text } from 'react-native-lite';\r\nimport { theme } from 'themes/theme';\r\nimport { Loading, LoadingInline } from './loading';\r\nimport { ErrorBox, ErrorMessage } from './error-box';\r\nimport { Input_Text, Input_Username, Input_Password, Input_Phone, Input_Email, Input_Currency } from './inputs';\r\nimport { Button } from './button';\r\n\r\ntype PropsOf<T> = T extends (props: infer P) => JSX.Element ? P : never;\r\n\r\nexport const C = {\r\n    Loading,\r\n    LoadingInline,\r\n    ErrorBox,\r\n    ErrorMessage,\r\n    View_Panel: (props: PropsOf<typeof View>) => (<View style={theme.view_panel} {...props} />),\r\n    View_Form: (props: PropsOf<typeof View>) => (<View style={theme.view_form} {...props} />),\r\n    View_FormFields: (props: PropsOf<typeof View>) => (<View style={theme.view_formFields} {...props} />),\r\n    View_FieldRow: (props: PropsOf<typeof View>) => (<View style={theme.view_fieldRow} {...props} />),\r\n    View_FormActionRow: (props: PropsOf<typeof View>) => (<View style={theme.view_formActionRow} {...props} />),\r\n    Text_FormTitle: (props: PropsOf<typeof Text>) => (<Text style={theme.text_formTitle} {...props} />),\r\n    Text_FieldLabel: (props: PropsOf<typeof Text>) => (<Text style={theme.text_fieldLabel} numberOfLines={1} {...props} />),\r\n    Button_FieldInline: (props: PropsOf<typeof Button>) => (<Button style={props.styleAlt ? theme.button_fieldInline_alt : theme.button_fieldInline} {...props} />),\r\n    Button_FormAction: (props: PropsOf<typeof Button>) => (<Button style={props.styleAlt ? theme.button_formAction_alt : theme.button_formAction} {...props} />),\r\n    Input_Text,\r\n    Input_Username,\r\n    Input_Password,\r\n    Input_Phone,\r\n    Input_Email,\r\n    Input_Currency,\r\n};\r\n","import React, { useState, useEffect } from 'react';\r\nimport { ActivityIndicator, View } from 'react-native-lite';\r\nimport { theme } from 'themes/theme';\r\n\r\nexport const Loading = ({ loading }: { loading?: boolean }) => {\r\n\r\n    const visible = loading;\r\n\r\n    // // Show loading for a min time\r\n    // const [visible, setVisible] = useState(loading);\r\n    // const MIN_TIME_MS = 500;\r\n    // useEffect(() => {\r\n    //     if (loading) { setVisible(true); return () => { }; }\r\n    //     const timeoutId = setTimeout(() => {\r\n    //         setVisible(false);\r\n    //     }, MIN_TIME_MS);\r\n    //     return () => {\r\n    //         clearTimeout(timeoutId);\r\n    //     };\r\n    // }, [loading]);\r\n\r\n    if (!visible) { return <></>; }\r\n\r\n    return (\r\n        <View>\r\n            <ActivityIndicator size='large' color={theme.colors.loader} />\r\n        </View>\r\n    );\r\n};\r\n\r\nexport const LoadingInline = ({ loading }: { loading?: boolean }) => {\r\n\r\n    const visible = loading;\r\n\r\n    // // Show loading for a min time\r\n    // const [visible, setVisible] = useState(loading);\r\n    // const MIN_TIME_MS = 500;\r\n    // useEffect(() => {\r\n    //     if (loading) { setVisible(true); return () => { }; }\r\n    //     const timeoutId = setTimeout(() => {\r\n    //         setVisible(false);\r\n    //     }, MIN_TIME_MS);\r\n    //     return () => {\r\n    //         clearTimeout(timeoutId);\r\n    //     };\r\n    // }, [loading]);\r\n\r\n    if (!visible) { return <></>; }\r\n\r\n    return (\r\n        <>\r\n            <ActivityIndicator size='small' color={theme.colors.loader} />\r\n        </>\r\n    );\r\n};\r\n","import React, { useState } from 'react';\r\nimport { TextInput, View, TouchableOpacity } from 'react-native-lite';\r\nimport { theme, ThemeTextStyle } from 'themes/theme';\r\nimport { PhoneNumber, toStandardPhoneNumber, formatPhoneNumber_UsaCanada } from 'utils/phone-number';\r\nimport { EmailAddress, toEmailAddress } from 'utils/email-address';\r\nimport { Icon } from './icon';\r\nimport { IconKind } from './icon-kind';\r\n\r\nexport const Input_Text = (props: { style?: ThemeTextStyle, value: string, onChange: (value: string) => void, onSubmit?: () => void, placeholder?: string, editable?: boolean }) => {\r\n    return (\r\n        <TextInput style={props.style ?? theme.input_fieldEntry}\r\n            keyboardType='default'\r\n            autoCompleteType='off'\r\n            placeholder={props.placeholder}\r\n            editable={props.editable}\r\n            value={`${props.value}`}\r\n            onChange={(x) => props.onChange(x)}\r\n            onSubmitEditing={props.onSubmit}\r\n        />\r\n    );\r\n};\r\n\r\nexport const Input_Username = (props: { style?: ThemeTextStyle, value: string, onChange: (value: string) => void, onSubmit?: () => void, placeholder?: string, editable?: boolean }) => {\r\n    return (\r\n        <TextInput style={props.style ?? theme.input_fieldEntry}\r\n            keyboardType='default'\r\n            autoCompleteType='username'\r\n            placeholder={props.placeholder}\r\n            editable={props.editable}\r\n            value={`${props.value}`}\r\n            onChange={(x) => props.onChange(x)}\r\n            onSubmitEditing={props.onSubmit}\r\n        />\r\n    );\r\n};\r\n\r\nexport const Input_Password = (props: { style?: ThemeTextStyle, value: string, onChange: (value: string) => void, onSubmit?: () => void, onBlur?: () => void, placeholder?: string, editable?: boolean }) => {\r\n\r\n    const [showPassword, setShowPassword] = useState(false);\r\n\r\n    const inputStyle = props.style ?? theme.input_fieldEntry;\r\n    const { marginRight } = inputStyle;\r\n    return (\r\n        <View style={{ flexDirection: `row`, alignItems: `center` }}>\r\n            <TextInput style={{ ...inputStyle, marginRight: 0 }}\r\n                keyboardType='default'\r\n                autoCompleteType='password'\r\n                secureTextEntry={!showPassword}\r\n                placeholder={props.placeholder}\r\n                editable={props.editable}\r\n                value={`${props.value}`}\r\n                onChange={(x) => props.onChange(x)}\r\n                onSubmitEditing={props.onSubmit}\r\n                onBlur={props.onBlur}\r\n            />\r\n            <TouchableOpacity onPress={() => setShowPassword(s => !s)} style={{ outlineColor: theme.icon.outlineColor }}>\r\n                <View style={{ paddingLeft: 4, paddingRight: 4, marginRight }}>\r\n                    <Icon style={theme.icon} kind={showPassword ? IconKind.eye : IconKind.eyeSlash} />\r\n                </View>\r\n            </TouchableOpacity>\r\n        </View>\r\n    );\r\n};\r\n\r\nexport type Currency = number;// & { __type: 'currency' };\r\nexport const Input_Currency = (props: { style?: ThemeTextStyle, value: Currency, onChange: (value: Currency) => void, onSubmit?: () => void, placeholder?: string, editable?: boolean }) => {\r\n    return (\r\n        <TextInput style={props.style ?? theme.input_fieldEntry}\r\n            keyboardType='numeric'\r\n            autoCompleteType='off'\r\n            placeholder={props.placeholder}\r\n            editable={props.editable}\r\n            value={`${props.value}`}\r\n            onChange={(x) => props.onChange(Number.parseFloat(x) || 0)}\r\n            onSubmitEditing={props.onSubmit}\r\n        />\r\n    );\r\n};\r\n\r\nexport const Input_Phone = (props: { style?: ThemeTextStyle, value: PhoneNumber, onChange: (value: PhoneNumber) => void, onSubmit?: () => void, placeholder?: string, editable?: boolean }) => {\r\n\r\n    const [valueActual, setValueActual] = useState(formatPhoneNumber_UsaCanada(props.value));\r\n    const changeValueActual = (v: string) => {\r\n        setValueActual(formatPhoneNumber_UsaCanada(v));\r\n        props.onChange(toStandardPhoneNumber(v));\r\n    };\r\n    return (\r\n        <TextInput style={props.style ?? theme.input_fieldEntry}\r\n            keyboardType='phone-pad'\r\n            autoCompleteType='tel'\r\n            placeholder={props.placeholder}\r\n            editable={props.editable}\r\n            value={valueActual}\r\n            onChange={changeValueActual}\r\n            onSubmitEditing={props.onSubmit}\r\n        />\r\n    );\r\n};\r\n\r\n\r\nexport const Input_Email = (props: { style?: ThemeTextStyle, value: EmailAddress, onChange: (value: EmailAddress) => void, onSubmit?: () => void, placeholder?: string, editable?: boolean }) => {\r\n\r\n    const [valueActual, setValueActual] = useState(toEmailAddress(props.value));\r\n    const changeValueActual = (v: string) => {\r\n        setValueActual(toEmailAddress(v));\r\n        props.onChange(toEmailAddress(v));\r\n    };\r\n    return (\r\n        <TextInput style={props.style ?? theme.input_fieldEntry}\r\n            keyboardType='email-address'\r\n            autoCompleteType='email'\r\n            placeholder={props.placeholder}\r\n            editable={props.editable}\r\n            value={valueActual}\r\n            onChange={changeValueActual}\r\n            onSubmitEditing={props.onSubmit}\r\n        />\r\n    );\r\n};\r\n","// 20.2.2.28 Math.sign(x)\nvar $export = require('./_export');\n\n$export($export.S, 'Math', { sign: require('./_math-sign') });\n","export async function delay(timeout: number): Promise<void> {\r\n    return await new Promise((resolve) => {\r\n        setTimeout(resolve, timeout);\r\n    });\r\n}\r\n","import React from 'react';\r\nimport { ThemeIconStyle, theme } from 'themes/theme';\r\nimport { MdMenu, MdArrowBack, MdCheckBoxOutlineBlank, MdErrorOutline, MdContentCopy, MdDashboard } from 'react-icons/md';\r\nimport { FiChevronRight, FiChevronDown } from 'react-icons/fi';\r\nimport { FaRedo, FaPlus, FaMinus, FaEye, FaEyeSlash, FaCheck, FaCheckSquare, FaSquare } from 'react-icons/fa';\r\nimport { View } from 'react-native-lite';\r\nimport { IconKind } from './icon-kind';\r\n\r\nfunction getIcon(kind: IconKind) {\r\n    switch (kind) {\r\n        case IconKind.menu: return { name: `menu`, component: MdMenu };\r\n        case IconKind.back: return { name: `arrow-back`, component: MdArrowBack };\r\n        case IconKind.error: return { name: `error-outline`, component: MdErrorOutline };\r\n        case IconKind.expanded: return { name: `chevron-down`, component: FiChevronDown };\r\n        case IconKind.collapsed: return { name: `chevron-right`, component: FiChevronRight };\r\n        case IconKind.copy: return { name: `content-copy`, component: MdContentCopy };\r\n        case IconKind.retry: return { name: `reload`, component: FaRedo };\r\n        case IconKind.dashboard: return { name: `dashboard`, component: MdDashboard };\r\n        case IconKind.add: return { name: `plus`, component: FaPlus };\r\n        case IconKind.remove: return { name: `minus`, component: FaMinus };\r\n        case IconKind.eye: return { name: `eye`, component: FaEye };\r\n        case IconKind.eyeSlash: return { name: `eye-slash`, component: FaEyeSlash };\r\n        case IconKind.checkChecked: return { name: `checked`, component: FaCheckSquare };\r\n        case IconKind.checkUnchecked: return { name: `unchecked`, component: FaSquare };\r\n\r\n        // case IconKind.Account: return { name: `account-circle`, component: MaterialIcons };\r\n        // case IconKind.Message: return { name: `message`, component: MaterialIcons };\r\n        // case IconKind.Subscription: return { name: `ticket-account`, component: MaterialCommunityIcons };\r\n        // case IconKind.Campaigns: return { name: `calendar-multiselect`, component: MaterialCommunityIcons };\r\n        // case IconKind.Contacts: return { name: `contacts`, component: MaterialIcons };\r\n        // case IconKind.Keywords: return { name: `key-variant`, component: MaterialCommunityIcons };\r\n        // case IconKind.Resources: return { name: `collections-bookmark`, component: MaterialIcons };\r\n        // case IconKind.Admin: return { name: `settings`, component: MaterialIcons };\r\n        // case IconKind.Solutions: return { name: '', component: FontAwesome };\r\n        // case IconKind.Texting: return { name: '', component: FontAwesome };\r\n        // case IconKind.Pricing: return { name: '', component: FontAwesome };\r\n        // case IconKind.Download: return { name: '', component: FontAwesome };\r\n\r\n        default:\r\n            return { name: `unknown`, component: MdCheckBoxOutlineBlank };\r\n    }\r\n}\r\n\r\nexport const Icon = (props: { kind: IconKind, style?: ThemeIconStyle }) => {\r\n    const icon = getIcon(props.kind);\r\n    const IconComponent = icon.component;\r\n    const size = props.style?.size ?? theme.icon.size ?? theme.sizes.fontSize;\r\n    return (\r\n        <View style={{ width: size, height: size }}>\r\n            <IconComponent name={icon.name} size={size} color={props.style?.color ?? theme.icon.color} />\r\n        </View>\r\n    );\r\n};\r\n","/* eslint-disable @typescript-eslint/no-unused-vars */\r\nexport type ThemeViewStyle = {\r\n    display?: 'flex';\r\n    flexDirection?: 'row' | 'column' | 'row-reverse' | 'column-reverse';\r\n    flexWrap?: 'wrap' | 'nowrap';\r\n    flex?: number;\r\n    justifyContent?: 'flex-start' | 'center' | 'flex-end' | 'space-around' | 'space-between';\r\n    alignItems?: 'flex-start' | 'center' | 'flex-end';\r\n    alignSelf?: 'center' | 'stretch' | 'flex-start' | 'flex-end';\r\n    overflow?: 'visible' | 'hidden';\r\n\r\n    background?: string;\r\n\r\n    margin?: number;\r\n    marginLeft?: number;\r\n    marginRight?: number;\r\n    marginTop?: number;\r\n    marginBottom?: number;\r\n    padding?: number;\r\n    paddingRight?: number;\r\n    paddingLeft?: number;\r\n    paddingTop?: number;\r\n    paddingBottom?: number;\r\n\r\n    width?: number;\r\n    minWidth?: number;\r\n    maxWidth?: number;\r\n    height?: number;\r\n\r\n    borderWidth?: number;\r\n    borderLeftWidth?: number;\r\n    borderRightWidth?: number;\r\n    borderTopWidth?: number;\r\n    borderBottomWidth?: number;\r\n\r\n    borderColor?: string;\r\n    borderLeftColor?: string;\r\n    borderRightColor?: string;\r\n    borderTopColor?: string;\r\n    borderBottomColor?: string;\r\n\r\n\r\n    borderRadius?: number;\r\n    borderStyle?: 'solid';\r\n    outlineColor?: string;\r\n    outline?: `none`;\r\n\r\n    transform?: string;\r\n\r\n    opacity?: number;\r\n\r\n    position?: 'absolute' | 'relative' | 'fixed';\r\n    top?: number;\r\n    bottom?: number;\r\n    left?: number;\r\n    right?: number;\r\n    zIndex?: number;\r\n};\r\nexport type ThemeTextStyle = {\r\n    margin?: number;\r\n    marginLeft?: number;\r\n    marginRight?: number;\r\n    marginTop?: number;\r\n    marginBottom?: number;\r\n    padding?: number;\r\n    paddingRight?: number;\r\n    paddingLeft?: number;\r\n    paddingTop?: number;\r\n    paddingBottom?: number;\r\n\r\n    color?: string;\r\n\r\n    fontFamily?: string;\r\n    fontSize?: number;\r\n    fontWeight?: 'normal' | 'bold' | 'lighter';\r\n    lineHeight?: string;\r\n    whiteSpace?: 'normal' | 'nowrap' | 'pre' | 'pre-wrap';\r\n    minWidth?: number;\r\n\r\n    outlineColor?: string;\r\n    userSelect?: `none`;\r\n};\r\nexport type ThemeIconStyle = {\r\n    color?: string;\r\n    size?: number;\r\n    outlineColor?: string;\r\n};\r\n\r\nexport const extractViewStyle = (style: ThemeViewStyle & ThemeTextStyle): ThemeViewStyle => {\r\n    return {\r\n        display: style.display,\r\n        flexDirection: style.flexDirection,\r\n        flex: style.flex,\r\n        justifyContent: style.justifyContent,\r\n        alignItems: style.alignItems,\r\n        overflow: style.overflow,\r\n\r\n        background: style.background,\r\n\r\n        margin: style.margin,\r\n        marginLeft: style.margin ?? style.marginLeft,\r\n        marginRight: style.margin ?? style.marginRight,\r\n        marginTop: style.margin ?? style.marginTop,\r\n        marginBottom: style.margin ?? style.marginBottom,\r\n        padding: style.padding,\r\n        paddingRight: style.padding ?? style.paddingRight,\r\n        paddingLeft: style.padding ?? style.paddingLeft,\r\n        paddingTop: style.padding ?? style.paddingTop,\r\n        paddingBottom: style.padding ?? style.paddingBottom,\r\n\r\n        width: style.width,\r\n        minWidth: style.minWidth,\r\n        maxWidth: style.maxWidth,\r\n        height: style.height,\r\n\r\n        borderWidth: style.borderWidth,\r\n        borderRadius: style.borderRadius,\r\n        borderColor: style.borderColor,\r\n        borderStyle: style.borderStyle,\r\n\r\n        outlineColor: style.outlineColor,\r\n    };\r\n};\r\nexport const extractTextStyle = (style: ThemeViewStyle & ThemeTextStyle): ThemeTextStyle => {\r\n    return {\r\n        // padding: style.padding,\r\n        color: style.color,\r\n\r\n        fontFamily: style.fontFamily,\r\n        fontSize: style.fontSize,\r\n        fontWeight: style.fontWeight,\r\n        lineHeight: style.lineHeight,\r\n        // whiteSpace: style.whiteSpace,\r\n\r\n        outlineColor: style.outlineColor,\r\n    };\r\n};\r\n\r\nexport const basicThemeColors = {\r\n    text: `#333333`,\r\n    text_header: `#333333`,\r\n    text_button: `#333333`,\r\n    text_error: `#333333`,\r\n    text_errorMessage: `#ff3333`,\r\n    border: `#cccccc`,\r\n    border_minor: `#cccccc`,\r\n    border_input: `#cccccc`,\r\n    outline: `#888888`,\r\n    background: `#ffffff`,\r\n    background_field: `#dddddd`,\r\n    background_button: `#eeeeee`,\r\n    background_error: `#ffcccc`,\r\n    loader: `#3333ff`,\r\n    icon: `#3333ff`,\r\n};\r\nexport type RectSize = { all?: number, left?: number, right?: number, top?: number, bottom?: number };\r\nconst getBorderSizes = (size: RectSize) => {\r\n    return {\r\n        borderWidth: size.all,\r\n        borderLeftWidth: size.left ?? size.all,\r\n        borderRightWidth: size.right ?? size.all,\r\n        borderTopWidth: size.top ?? size.all,\r\n        borderBottomWidth: size.bottom ?? size.all,\r\n    };\r\n};\r\n\r\nexport const basicThemeSizes = {\r\n    textPadding: 4,\r\n    borderWidth: { all: 1 } as RectSize,\r\n    borderWidth_minor: { all: 1 } as RectSize,\r\n    borderWidth_input: { all: 1 } as RectSize,\r\n    borderRadius: 4,\r\n    sectionGap: 16,\r\n    elementGap: 8,\r\n    rowGap: 4,\r\n    rowPadding: 4,\r\n\r\n    fontSize: 14,\r\n    fontSize_input: 16,\r\n    fontSize_button: 14,\r\n    fontSize_header: 16,\r\n\r\n    lineHeight: `18px`,\r\n\r\n    minWidth_label: 120,\r\n    minWidth_input: 120,\r\n    minWidth_button: 120,\r\n\r\n    icon: 14,\r\n};\r\n\r\nexport const basicFont = {\r\n    fontFamily: `\"Trebuchet MS\", Helvetica, Roboto, sans-serif`,\r\n    fontWeight_normal: `normal` as 'normal' | 'bold',\r\n    fontWeight_button: `bold` as 'normal' | 'bold',\r\n    fontWeight_header: `bold` as 'normal' | 'bold',\r\n};\r\n\r\nexport type ThemeColors = typeof basicThemeColors;\r\nexport type ThemeSizes = typeof basicThemeSizes;\r\nexport type ThemeFont = typeof basicFont;\r\n\r\nconst createTheme = (colors: ThemeColors, sizes: ThemeSizes, font: ThemeFont) => {\r\n\r\n    const borderProps = {\r\n        ...getBorderSizes(sizes.borderWidth),\r\n\r\n        borderRadius: sizes.borderRadius,\r\n        borderColor: colors.border,\r\n        borderStyle: `solid`,\r\n        outlineColor: colors.outline,\r\n    } as const;\r\n\r\n    const borderProps_minor = {\r\n        ...getBorderSizes(sizes.borderWidth_minor),\r\n\r\n        borderRadius: sizes.borderRadius,\r\n        borderColor: colors.border_minor,\r\n        borderStyle: `solid`,\r\n        outlineColor: colors.outline,\r\n    } as const;\r\n\r\n    const borderProps_input = {\r\n        ...getBorderSizes(sizes.borderWidth_input),\r\n\r\n        borderRadius: sizes.borderRadius,\r\n        borderColor: colors.border_input,\r\n        borderStyle: `solid`,\r\n        outlineColor: colors.outline,\r\n    } as const;\r\n\r\n    let sView: ThemeViewStyle = {};\r\n    let sText: ThemeTextStyle = {};\r\n    let sIcon: ThemeIconStyle = {};\r\n    let sTextView: ThemeTextStyle & ThemeViewStyle = {};\r\n\r\n    const theme = {\r\n        colors,\r\n        sizes,\r\n        font,\r\n\r\n        view_panel: sView = {\r\n            background: colors.background,\r\n            padding: sizes.elementGap,\r\n        },\r\n        view_form: sView = {\r\n            ...borderProps,\r\n            marginBottom: sizes.sectionGap,\r\n            padding: sizes.elementGap,\r\n            // background: colors.background_field,\r\n        },\r\n        text_formTitle: sText = {\r\n            padding: sizes.textPadding,\r\n            color: colors.text_header,\r\n            fontSize: sizes.fontSize_header,\r\n            fontFamily: font.fontFamily,\r\n            fontWeight: font.fontWeight_header,\r\n        },\r\n        view_formFields: sView = {\r\n            // ...borderProps,\r\n            ...borderProps_minor,\r\n            // padding: sizes.elementGap,\r\n            marginBottom: sizes.rowGap,\r\n            background: colors.background_field,\r\n            // alignItems: `center`,\r\n        },\r\n        view_fieldRow: sView = {\r\n            // ...borderProps,\r\n            // ...borderProps_minor,\r\n            // marginBottom: sizes.rowGap,\r\n            // padding: sizes.rowPadding,\r\n            marginLeft: sizes.rowPadding,\r\n            // background: colors.background_field,\r\n            display: `flex`,\r\n            flexDirection: `row`,\r\n\r\n            alignItems: `center`,\r\n            flexWrap: `wrap`,\r\n        },\r\n        text_fieldLabel: sText = {\r\n            padding: sizes.textPadding,\r\n            color: colors.text,\r\n            fontSize: sizes.fontSize,\r\n            fontWeight: font.fontWeight_normal,\r\n            minWidth: sizes.minWidth_label,\r\n            //  whiteSpace: `nowrap`,\r\n        },\r\n        input_fieldEntry: sText = {\r\n            ...borderProps_input,\r\n            marginBottom: sizes.rowGap,\r\n            marginRight: sizes.rowGap,\r\n            padding: sizes.textPadding,\r\n            color: colors.text,\r\n            fontSize: sizes.fontSize_input,\r\n            fontWeight: font.fontWeight_normal,\r\n            lineHeight: sizes.lineHeight,\r\n            minWidth: sizes.minWidth_input,\r\n        },\r\n        button_fieldInline: sTextView = {\r\n            ...borderProps,\r\n            // marginLeft: sizes.elementGap,\r\n            marginBottom: sizes.rowGap,\r\n            marginRight: sizes.rowGap,\r\n            padding: sizes.textPadding,\r\n            background: colors.background_button,\r\n            color: colors.text_button,\r\n            fontSize: sizes.fontSize_button,\r\n            fontWeight: font.fontWeight_button,\r\n            lineHeight: sizes.lineHeight,\r\n            display: `flex`,\r\n            minWidth: sizes.minWidth_button,\r\n        },\r\n        button_fieldInline_alt: sTextView = {\r\n            ...sTextView,\r\n            background: colors.text_button,\r\n            color: colors.background_button,\r\n            borderColor: colors.background_button,\r\n        },\r\n        view_formActionRow: sView = {\r\n            display: `flex`,\r\n            flexDirection: `row`,\r\n            justifyContent: `flex-end`,\r\n            marginBottom: sizes.elementGap,\r\n        },\r\n        button_formAction: sTextView = {\r\n            ...borderProps,\r\n            marginLeft: sizes.elementGap,\r\n            padding: sizes.textPadding,\r\n            background: colors.background_button,\r\n            color: colors.text_button,\r\n            fontSize: sizes.fontSize_button,\r\n            fontWeight: font.fontWeight_button,\r\n            lineHeight: sizes.lineHeight,\r\n            minWidth: sizes.minWidth_button,\r\n        },\r\n        button_formAction_alt: sTextView = {\r\n            ...sTextView,\r\n            background: colors.text_button,\r\n            color: colors.background_button,\r\n            borderColor: colors.background_button,\r\n        },\r\n\r\n        view_error: sView = {\r\n            ...borderProps,\r\n            marginBottom: sizes.sectionGap,\r\n            padding: sizes.rowPadding,\r\n            background: colors.background_error,\r\n        },\r\n        text_error: sText = {\r\n            padding: sizes.textPadding,\r\n            color: colors.text_error,\r\n            fontSize: sizes.fontSize,\r\n            fontFamily: font.fontFamily,\r\n            fontWeight: font.fontWeight_button,\r\n        },\r\n        text_errorMessage: sText = {\r\n            padding: sizes.textPadding,\r\n            color: colors.text_errorMessage,\r\n            fontSize: sizes.fontSize,\r\n            fontFamily: font.fontFamily,\r\n            fontWeight: font.fontWeight_button,\r\n        },\r\n\r\n        icon: sIcon = {\r\n            size: sizes.icon,\r\n            color: colors.icon,\r\n            outlineColor: colors.outline,\r\n        },\r\n        icon_errorMessage: sIcon = {\r\n            size: sizes.icon,\r\n            color: colors.text_errorMessage,\r\n            outlineColor: colors.outline,\r\n        },\r\n    } as const;\r\n\r\n    return theme;\r\n};\r\n\r\nexport const purpleColors = {\r\n    purple: `#863d8f`,\r\n    purpleLite: `#a75da7`,\r\n    purpleBackgroundLite: `#ddbfdd`,\r\n    blue: `#3baccf`,\r\n    gray: `#656364`,\r\n    lightGray: `#f8f6f7`,\r\n    lightBackgroundGray: `#e8e6e7`,\r\n    borderGray: `#d7c7d7`,\r\n    headerWhite: `#ffffff`,\r\n    headerGray: `#cecece`,\r\n    menuWhite: `#ffffff`,\r\n    bodyWhite: `#ffffff`,\r\n    buttonGray: `#a0a1a5`,\r\n    buttonWhite: `#e2e3e9`,\r\n    headingGray: `#f8f6f7`,\r\n    cardLightGray: `#f8f8f8`,\r\n    textWhite: `#ffffff`,\r\n    textBlack: `#2b2b2b`,\r\n    textGray: `#696768`,\r\n\r\n    // New Colors\r\n    warnRed: `#C56364`,\r\n    errorRed: `#C56364`,\r\n    deleteRed: `#C56364`,\r\n    changedYellow: `#F5F5C5`,\r\n};\r\n\r\nexport const purpleThemeColors: typeof basicThemeColors = {\r\n    ...basicThemeColors,\r\n    text: `#2b2b2b`,\r\n    text_header: `#863d8f`,\r\n    text_button: `#ffffff`,\r\n    // text_error: `#ffffff`,\r\n    border: `#863d8f`,\r\n    border_minor: `#863d8f`,\r\n    // border_minor: `#aaaaaa`,\r\n    border_input: `#aaaaaa`,\r\n    background: `#ffffff`,\r\n    background_field: `#dddddd`,\r\n    background_button: `#863d8f`,\r\n    // background_error: `#C56364`,\r\n    loader: `#863d8f`,\r\n    icon: `#863d8f`,\r\n};\r\n\r\nexport const purpleSizes: typeof basicThemeSizes = {\r\n    ...basicThemeSizes,\r\n    borderWidth: { all: 1, bottom: 4 },\r\n    borderWidth_minor: { all: 0, bottom: 1 },\r\n};\r\n\r\nexport const vscodeThemeColors = {\r\n    colors: {\r\n        text: `#569CD6`,\r\n        border: `#6796E6`,\r\n        background: `#1e1e1e`,\r\n        background_field: `#2e2e2e`,\r\n    },\r\n};\r\n\r\n// eslint-disable-next-line import/no-mutable-exports\r\nexport let theme = createTheme(basicThemeColors, basicThemeSizes, basicFont);\r\n// eslint-disable-next-line import/no-mutable-exports\r\n// export let theme = createTheme(purpleThemeColors, purpleSizes, basicFont);\r\n\r\nexport const setTheme = (colors: ThemeColors, sizes: ThemeSizes, font: ThemeFont) => {\r\n    theme = createTheme(purpleThemeColors, basicThemeSizes, basicFont);\r\n};\r\n","import { getValuesAsItems } from './objects';\r\n\r\nexport const moveItem = <T>(obj: T, from: T[], to: T[]) => {\r\n    const i = from.indexOf(obj);\r\n    if (i < 0) { throw new Error(`moveItem Failed to find an item in the from array: ${JSON.stringify({ obj, from, to })}`); }\r\n    from.splice(i, 1);\r\n    to.push(obj);\r\n};\r\n\r\nexport const distinct = <T>(items: T[]): T[] => {\r\n    const set = new Set(items);\r\n    return [...set];\r\n};\r\n\r\nexport const shuffle = <T>(items: T[]): T[] => {\r\n    return items.map(x => ({ x, value: Math.random() })).sort((a, b) => a.value - b.value).map(x => x.x);\r\n};\r\n\r\nexport const distinct_key = <T>(items: T[], getKey: (item: T) => string): T[] => {\r\n    const set = {} as { [key: string]: T };\r\n    items.forEach(x => { set[getKey(x)] = x; });\r\n    return getValuesAsItems(set);\r\n};\r\n\r\nexport const groupItems = <T>(items: T[], getKey: (item: T) => string): { [key: string]: T[] } => {\r\n    const groups = {} as { [key: string]: T[] };\r\n    for (const x of items) {\r\n        const g = groups[getKey(x)] ?? (groups[getKey(x)] = []);\r\n        g.push(x);\r\n    }\r\n    return groups;\r\n};\r\n\r\nexport const mergeItems = <T>(items: T[], getKey: (item: T) => string, getMerged: (item: T[], key: string) => T): T[] => {\r\n    const groups = groupItems(items, getKey);\r\n    const merged = getValuesAsItems(groups).map(g => getMerged(g, getKey(g[0])));\r\n    return merged;\r\n};\r\n\r\nexport function sameArrayContents<T>(a: undefined | null | T[], b?: undefined | null | T[]) {\r\n    if (a === b) { return true; }\r\n    if (a == null && b == null) { return true; }\r\n    if (a == null || b == null) { return false; }\r\n    if (a.length !== b.length) { return false; }\r\n    for (const i in a) {\r\n        if (a[i] !== b[i]) { return false; }\r\n    }\r\n    return true;\r\n}\r\n","export const userProfileChracters = `\r\n                       \r\n`.split(` `).map(x => x.trim()).filter(x => x);\r\n","import React, { useRef, useState, useEffect } from 'react';\r\nimport { View, Text, TouchableOpacity } from 'react-native-lite';\r\nimport { useAutoLoadingError } from 'utils-react/hooks';\r\nimport { C } from 'controls-react';\r\nimport { Icon } from 'controls-react/icon';\r\nimport { IconKind } from 'controls-react/icon-kind';\r\nimport { UserDataService, UserProfileInfo } from './user-data-service';\r\nimport { userProfileChracters } from './user-profile-emojis';\r\n\r\n\r\nexport const UserProfileManagerView = (props: { onClose?: () => void }) => {\r\n\r\n    const { loading, error, doWork } = useAutoLoadingError();\r\n    const [userProfiles, setUserProfiles] = useState(null as null | UserProfileInfo[]);\r\n\r\n    const reload = () => doWork(async (stopIfObsolete) => {\r\n        await UserDataService.get().setup();\r\n        stopIfObsolete();\r\n\r\n        const profiles = await UserDataService.get().getUserProfiles();\r\n        setUserProfiles(profiles);\r\n    });\r\n\r\n    useEffect(() => {\r\n        reload();\r\n    }, []);\r\n\r\n    return (\r\n        <C.View_Panel>\r\n            <C.Text_FormTitle >Users</C.Text_FormTitle>\r\n            <C.LoadingInline loading={loading} />\r\n            <C.ErrorBox error={error} />\r\n            {userProfiles?.map(x => (\r\n                <UserProfileView key={x.key} userProfile={x} onActiveUserChange={reload} onUserProfileChange={reload} />\r\n            ))}\r\n            <C.Text_FormTitle >Add User</C.Text_FormTitle>\r\n            <AddUserProfileView onUserAdded={reload} />\r\n            {!!props.onClose && (\r\n                <C.View_FormActionRow>\r\n                    <C.Button_FormAction onPress={() => props.onClose?.()}>Done</C.Button_FormAction>\r\n                </C.View_FormActionRow>\r\n            )}\r\n        </C.View_Panel>\r\n    );\r\n};\r\n\r\nconst AddUserProfileView = (props: { onUserAdded: () => void }) => {\r\n    const { loading, error, doWork } = useAutoLoadingError();\r\n    const [shareCode, setShareCode] = useState(null as null | string);\r\n    const addShareCode = () => {\r\n        if (!shareCode) { return; }\r\n\r\n        doWork(async (stopIfObsolete) => {\r\n            await UserDataService.get().addUserFromShareCode(shareCode);\r\n            stopIfObsolete();\r\n            props.onUserAdded();\r\n            setShareCode(null);\r\n        });\r\n    };\r\n\r\n    return (\r\n        <>\r\n            <C.View_Form>\r\n                <C.View_FieldRow>\r\n                    <C.LoadingInline loading={loading} />\r\n                    <C.Input_Text value={shareCode ?? ``} onChange={setShareCode} placeholder='Enter Share Code' />\r\n                    <C.Button_FieldInline onPress={addShareCode}>Add User</C.Button_FieldInline>\r\n                </C.View_FieldRow>\r\n                <C.ErrorBox error={error} />\r\n            </C.View_Form>\r\n        </>\r\n    );\r\n};\r\n\r\n\r\nconst UserProfileView = ({ userProfile, onActiveUserChange, onUserProfileChange }: { userProfile: UserProfileInfo, onActiveUserChange: () => void, onUserProfileChange: () => void }) => {\r\n    const { loading, error, doWork } = useAutoLoadingError();\r\n    const [shareCode, setShareCode] = useState(null as null | string);\r\n    const [characters, setCharacters] = useState(null as null | string[]);\r\n\r\n    const createShareCode = () => doWork(async (stopIfObsolete) => {\r\n        const result = await UserDataService.get().createShareCode(userProfile.key);\r\n        stopIfObsolete();\r\n        setShareCode(result.shareCode);\r\n    });\r\n    const makeActive = () => doWork(async (stopIfObsolete) => {\r\n        await UserDataService.get().setActiveUser(userProfile.key);\r\n        stopIfObsolete();\r\n        onActiveUserChange();\r\n    });\r\n\r\n    const showCharacterSelection = () => {\r\n        setCharacters(userProfileChracters);\r\n    };\r\n    const selectCharacter = (character: string) => doWork(async (stopIfObsolete) => {\r\n        await UserDataService.get().setUserProfileInfo(userProfile.key, { emoji: character });\r\n\r\n        setCharacters(null);\r\n        onUserProfileChange();\r\n    });\r\n\r\n    if (characters) {\r\n        return (\r\n            <>\r\n                <C.View_Form>\r\n                    <View style={{ flexDirection: `row`, flexWrap: `wrap` }}>\r\n                        {characters.map(x => (\r\n                            <TouchableOpacity key={x} onPress={() => selectCharacter(x)} >\r\n                                <View>\r\n                                    <Text style={{ fontSize: 32 }} >{x}</Text>\r\n                                </View>\r\n                            </TouchableOpacity>\r\n                        ))}\r\n                    </View>\r\n                </C.View_Form>\r\n            </>\r\n        );\r\n    }\r\n\r\n    return (\r\n        <>\r\n            <C.View_Form>\r\n                <C.View_FieldRow>\r\n                    <C.LoadingInline loading={loading} />\r\n                    <TouchableOpacity onPress={makeActive}>\r\n                        <Icon style={{ size: 32 }} kind={userProfile.isActive ? IconKind.checkChecked : IconKind.checkUnchecked} />\r\n                    </TouchableOpacity>\r\n                    <TouchableOpacity onPress={showCharacterSelection} >\r\n                        <View>\r\n                            <Text style={{ fontSize: 32 }} >{userProfile.emoji}</Text>\r\n                        </View>\r\n                    </TouchableOpacity>\r\n                    <UserProfileName userProfile={userProfile} onNameChange={onUserProfileChange} />\r\n                    {!!shareCode && (\r\n                        <C.Text_FieldLabel>{shareCode}</C.Text_FieldLabel>\r\n                    )}\r\n                    {!shareCode && (\r\n                        <C.Button_FieldInline onPress={createShareCode}>Create Share Code</C.Button_FieldInline>\r\n                    )}\r\n                </C.View_FieldRow>\r\n                <C.ErrorBox error={error} />\r\n            </C.View_Form>\r\n        </>\r\n    );\r\n};\r\n\r\n\r\nexport const UserProfileName = ({ userProfile, onNameChange }: { userProfile: UserProfileInfo, onNameChange: () => void }) => {\r\n    const { loading, error, doWork } = useAutoLoadingError();\r\n    const [name, setName] = useState(userProfile.name);\r\n    const [isEditingName, setIsEditingName] = useState(false);\r\n\r\n    const changeName = () => doWork(async (stopIfObsolete) => {\r\n        console.log(`UserProfileName changeName`, { name });\r\n\r\n        await UserDataService.get().setUserProfileInfo(userProfile.key, { name });\r\n\r\n        setIsEditingName(false);\r\n        onNameChange();\r\n    });\r\n\r\n    return (\r\n        <>\r\n            {!isEditingName && (\r\n                <TouchableOpacity onPress={() => setIsEditingName(true)} >\r\n                    <C.Text_FieldLabel>{userProfile.name}</C.Text_FieldLabel>\r\n                </TouchableOpacity>\r\n            )}\r\n            {isEditingName && (\r\n                <>\r\n                    <C.Input_Text value={name} onChange={setName} onSubmit={changeName} />\r\n                    <C.Button_FieldInline onPress={changeName}>Change</C.Button_FieldInline>\r\n                </>\r\n            )}\r\n        </>\r\n    );\r\n};\r\n","import { useEffect, useState, useRef } from 'react';\r\nimport { sameArrayContents } from 'utils/arrays';\r\nimport { ErrorState } from 'utils/error';\r\n\r\ntype TDoWork = (\r\n    doWorkInner: (stopIfObsolete: (() => void)) => Promise<void>,\r\n    getContext?: () => unknown[]) => void;\r\n\r\n\r\nexport function useMounted() {\r\n    const mounted = useRef(true);\r\n    useEffect(() => {\r\n        // Unmount on unsub\r\n        return () => {\r\n            mounted.current = false;\r\n        };\r\n    }, [/* Init Only */]);\r\n    return { mounted };\r\n}\r\n\r\n/** Automatically handle loading and error objects with asyncronous calls\r\n * @return The { loading, error, doWork } values\r\n * @example\r\n *\r\n *      const { loading, error, doWork } = ChatHooks.useAutoLoadingError();\r\n *      ...\r\n *          doWork(async (stopIfObsolete) => {\r\n *              ...\r\n *              const result = async DoAsyncWork());\r\n *              stopIfObsolete(); // Stop work if component has been unmounted, or if contextValues have changed since beginning of doWork\r\n *              ...\r\n *              setResult(result);\r\n *          }, () => [ contextValueA, contextValueB ]); // Optional context values to stop work if changed\r\n *    \r\n */\r\nexport function useAutoLoadingError() {\r\n    const { mounted } = useMounted();\r\n    const [loadingError, setLoadingError] = useState({ loading: false, error: null as null | ErrorState });\r\n\r\n    const UNMOUNTED = `unmounted`;\r\n    const CHANGED_CONTEXT = `changedContext`;\r\n\r\n    const doWork: TDoWork = (\r\n        doWorkInner: (stopIfObsolete: (() => void)) => Promise<void>,\r\n        getContext?: () => unknown[]) => {\r\n\r\n        let contextInit = undefined as undefined | unknown[];\r\n\r\n        const stopIfObsolete = () => {\r\n            if (!mounted.current) {\r\n                // eslint-disable-next-line @typescript-eslint/no-throw-literal\r\n                throw UNMOUNTED;\r\n            }\r\n            const c = getContext?.();\r\n\r\n            if (!sameArrayContents(contextInit, c)) {\r\n                // eslint-disable-next-line @typescript-eslint/no-throw-literal\r\n                throw CHANGED_CONTEXT;\r\n            }\r\n        };\r\n\r\n        const doCall = async () => {\r\n            contextInit = getContext?.();\r\n            setLoadingError({ loading: true, error: null });\r\n\r\n            // eslint-disable-next-line @typescript-eslint/no-unused-vars\r\n            let hadError = false;\r\n\r\n            try {\r\n                try {\r\n                    await doWorkInner(stopIfObsolete);\r\n                    stopIfObsolete();\r\n                    setLoadingError({ loading: false, error: null });\r\n                }\r\n                catch (error) {\r\n                    // Ignore unmounted or changed context\r\n                    if (error !== UNMOUNTED && error !== CHANGED_CONTEXT) {\r\n                        throw error;\r\n                    }\r\n                }\r\n            } catch (error) {\r\n                // console.log(`doWork catch`, { err: error });\r\n                hadError = true;\r\n\r\n                if (!mounted.current) {\r\n                    // console.warn(`doWork Error when not Mounted`, { err: error });\r\n                    return;\r\n                }\r\n\r\n                setLoadingError({ loading: false, error: { message: error.message ?? `Unknown Error in doWork`, error, retryCallback: doCall } });\r\n            }\r\n        };\r\n\r\n        // Start Async\r\n        (async () => await doCall())();\r\n    };\r\n\r\n    return { loading: loadingError.loading, error: loadingError.error, doWork };\r\n}\r\n\r\nexport function useLoadData<T>(doWork: TDoWork, getData: () => Promise<T>, getDataDeps?: () => unknown[]) {\r\n    const [data, setData] = useState(null as null | T);\r\n    useEffect(() => {\r\n        // console.log(`useLoadData.useEffect`);\r\n        doWork(async (stopIfObsolete) => {\r\n            // console.log(`useLoadData.useEffect.doWork`);\r\n            const d = await getData();\r\n            stopIfObsolete();\r\n            setData(d);\r\n        }, getDataDeps);\r\n    }, getDataDeps?.() ?? []);\r\n    return { data };\r\n}\r\n","import { distinct, shuffle } from 'utils/arrays';\r\nimport { randomItem } from 'utils/random';\r\nimport { SpeechService } from '../../utils/speech';\r\nimport { ProblemService, ProblemAnswer } from '../problems-service';\r\nimport { getSpellingEntries } from './spelling-entries';\r\n\r\nexport const createSpellingProblemService = ({ speechService, maxAnswers = 4, sectionSize = 25 }: { speechService: SpeechService, maxAnswers?: number, sectionSize?: number }): ProblemService => {\r\n    const speech = speechService;\r\n    const spellingEntries = getSpellingEntries();\r\n    const sectionCount = Math.ceil(spellingEntries.length / sectionSize);\r\n\r\n    let state = {\r\n        nextIndex: 0,\r\n        completedSectionKeys: [] as string[],\r\n    };\r\n\r\n    const getSectionKey = (sectionIndex: number) => {\r\n        return `${sectionIndex}`;\r\n    };\r\n    const getSectionName = (sectionIndex: number) => {\r\n        return `Spelling ${sectionIndex + 1}`;\r\n    };\r\n\r\n    const service: ProblemService = {\r\n        load: async (storage) => {\r\n            const loaded = await storage.load<typeof state>();\r\n            if (loaded) {\r\n                state = loaded;\r\n            }\r\n        },\r\n        save: async (storage) => {\r\n            await storage.save(state);\r\n        },\r\n        getSections: () => [...new Array(sectionCount)].map((x, i) => ({\r\n            key: getSectionKey(i),\r\n            name: getSectionName(i),\r\n            isComplete: state.completedSectionKeys.includes(getSectionKey(i)),\r\n        })),\r\n        gotoSection: ({ key }) => {\r\n            const a = Number.parseInt(key, 10);\r\n            state.nextIndex = (a - 1) * sectionSize;\r\n        },\r\n        getNextProblem: () => {\r\n            if (state.nextIndex >= spellingEntries.length) {\r\n                state.nextIndex = 0;\r\n            }\r\n\r\n            const i = state.nextIndex;\r\n            state.nextIndex++;\r\n\r\n            const p = spellingEntries[i];\r\n            const correctValue = p.word;\r\n            const wrongAnswerCount = maxAnswers - 1;\r\n            const wrongValues =\r\n                shuffle(distinct(p.mispellings)).slice(0, wrongAnswerCount);\r\n\r\n            const answers: ProblemAnswer[] = shuffle([...wrongValues.map(x => ({ value: `${x}`, isCorrect: false })), { value: `${correctValue}`, isCorrect: true }]).map(x => ({ ...x, key: x.value }));\r\n\r\n            const isLastOfSection = (i + 1) % sectionSize === 0;\r\n            const isLastOfSubject = i === spellingEntries.length - 1;\r\n            return {\r\n                key: `${i + 1}`,\r\n                question: `Word ${i + 1}`,\r\n                onQuestion: () => { speech.speak(correctValue); },\r\n                answers,\r\n                sectionKey: getSectionKey(Math.floor(i / sectionSize)),\r\n                isLastOfSection,\r\n                isLastOfSubject,\r\n            };\r\n        },\r\n        recordAnswer: (problem, answer) => {\r\n            if (answer.isCorrect && problem.isLastOfSection) {\r\n                state.completedSectionKeys.push(problem.sectionKey);\r\n            }\r\n\r\n            // Responses\r\n            if (!answer.isCorrect) {\r\n                // Demotivation!\r\n                const phrases = [\r\n                    `I've got a dog that spells better`,\r\n                    `That was horrible`,\r\n                    `What are you trying to do?`,\r\n                    `That is not a word`,\r\n                    `No, select the correct answer`,\r\n                    `Absolutely Incorrect`,\r\n                    `Completely Wrong`,\r\n                    `This is supposed to be English`,\r\n                    `What does the fox say?`,\r\n                ];\r\n                speech.speak(randomItem(phrases));\r\n                speech.speak(problem.answers.find(x => x.isCorrect)?.value ?? ``);\r\n            } else {\r\n\r\n                console.log(`recordAnswer correct`);\r\n                if (Math.random() > 0.1) { return; }\r\n                const phrases = [\r\n                    `Good job! Thank you for the alien skulls.`,\r\n                    `Great! That's a nice pile of bones.`,\r\n                    // `Amazing! Keep getting better`,\r\n                ];\r\n                speech.speak(randomItem(phrases));\r\n            }\r\n        },\r\n    };\r\n\r\n    return service;\r\n};\r\n","/* eslint-disable react/no-array-index-key */\r\n/* eslint-disable jsx-a11y/no-static-element-interactions */\r\nimport React, { useState, useRef, useEffect } from 'react';\r\nimport { defaultDoodleDrawing, DoodleSegment, DoodleDrawing, encodeDoodleDrawing, decodeDoodleDrawing, doodleSegmentToSvgPath_line, doodleToSvg } from './doodle';\r\n\r\nexport const styles = {\r\n    drawing: {\r\n        width: 312,\r\n        height: 312,\r\n        color: `#FFFFFF`,\r\n        backgroundColor: `#000000`,\r\n    },\r\n};\r\n\r\nexport const DoodleTestView = (props: {}) => {\r\n    const [doodle, setDoodle] = useState(defaultDoodleDrawing());\r\n\r\n    return (\r\n        <>\r\n            <DoodleDrawerView style={styles.drawing} drawing={doodle} onChange={setDoodle} />\r\n            <DoodleDisplayView style={styles.drawing} drawing={doodle} />\r\n        </>\r\n    );\r\n};\r\n\r\n// export const DoodleDrawingView = (props: { drawing?: DoodleDrawing, onDrawingChanged: (drawing: DoodleDrawing) => void }) => {\r\n\r\n//     const [doodle, setDoodle] = useState(props.drawing ?? defaultDoodleDrawing());\r\n//     const changeDoodle = (value: DoodleDrawing) => {\r\n//         setDoodle(value);\r\n//         props.onDrawingChanged(value);\r\n//     };\r\n\r\n//     return (\r\n//         <>\r\n//             <DoodleDrawer style={styles.drawing} drawing={doodle} onChange={changeDoodle} />\r\n//             {/* <div>\r\n//                 {JSON.stringify(doodle)}\r\n//             </div> */}\r\n//             {/* <div>\r\n//                 {JSON.stringify(decodeDoodleDrawing(encodeDoodleDrawing(doodle)))}\r\n//             </div> */}\r\n\r\n//             {/* <div>\r\n//                 {encodeDoodleDrawing(doodle).doodleText}\r\n//             </div> */}\r\n//             {/* <div>\r\n//                 {encodeDoodleDrawing(decodeDoodleDrawing(encodeDoodleDrawing(doodle))).doodleText}\r\n//             </div>  */}\r\n//         </>\r\n//     );\r\n// };\r\n\r\n\r\nexport const DoodleDrawerView = (props: { style: { width: number, height: number, color: string, backgroundColor: string }, drawing: DoodleDrawing, onChange: (drawing: DoodleDrawing) => void }) => {\r\n    const { style, drawing, onChange } = props;\r\n    const scale = style.width / drawing.width;\r\n\r\n    const [segment, setSegment] = useState(null as null | DoodleSegment);\r\n    const segmentClientStart = useRef(null as null | { clientX: number, clientY: number, x: number, y: number });\r\n    const divHost = useRef(null as null | HTMLDivElement);\r\n\r\n    type Ev = React.SyntheticEvent;\r\n\r\n    const onIgnore = (e: Ev) => {\r\n        e.preventDefault();\r\n        e.stopPropagation();\r\n        e.nativeEvent.cancelBubble = true;\r\n        e.nativeEvent.returnValue = false;\r\n        return false;\r\n    };\r\n\r\n    const onPressIn = (event: (Ev) & { clientX?: number, clientY?: number }, pos?: { clientX: number, clientY: number }) => {\r\n        // console.log(`onPressIn`, { event, pos });\r\n        const div = divHost.current;\r\n        if (!div) { return onIgnore(event); }\r\n\r\n        const rect = div.getBoundingClientRect();\r\n\r\n\r\n        const p = {\r\n            clientX: pos?.clientX ?? event.clientX ?? 0,\r\n            clientY: pos?.clientY ?? event.clientY ?? 0,\r\n        };\r\n\r\n        segmentClientStart.current = {\r\n            clientX: p.clientX,\r\n            clientY: p.clientY,\r\n            x: Math.floor((p.clientX - rect.x) / scale),\r\n            y: Math.floor((p.clientY - rect.y) / scale),\r\n        };\r\n\r\n        setSegment({\r\n            points: [{\r\n                x: segmentClientStart.current.x,\r\n                y: segmentClientStart.current.y,\r\n            }],\r\n        });\r\n\r\n        return onIgnore(event);\r\n    };\r\n    const onPressOut = (event: Ev) => {\r\n        // console.log(`onPressOut`, { event });\r\n        const s = segment;\r\n        if (!s) { return onIgnore(event); }\r\n\r\n        onChange({\r\n            ...drawing,\r\n            segments: [...drawing.segments, s],\r\n        });\r\n        setSegment(null);\r\n        segmentClientStart.current = null;\r\n\r\n        return onIgnore(event);\r\n    };\r\n    const onMove = (pos: { x: number, y: number }) => {\r\n        setSegment(s => {\r\n            if (!s) { return null; }\r\n            const lastPos = s.points[s.points.length - 1];\r\n            if (Math.abs(lastPos.x - pos.x) + Math.abs(lastPos.y - pos.y) <= 2) {\r\n                return s;\r\n            }\r\n            return { points: [...s.points, pos] };\r\n        });\r\n    };\r\n    const onClientMove = (event: (Ev) & { clientX?: number, clientY?: number }, pos?: { clientX: number, clientY: number }) => {\r\n        if (!segmentClientStart.current) {\r\n            return onIgnore(event);\r\n        }\r\n\r\n        // console.log(`onClientMove`, { event, pos });\r\n        const p = {\r\n            clientX: pos?.clientX ?? event.clientX ?? 0,\r\n            clientY: pos?.clientY ?? event.clientY ?? 0,\r\n        };\r\n        const dPos = {\r\n            x: Math.floor((p.clientX - segmentClientStart.current.clientX) / scale) + segmentClientStart.current.x,\r\n            y: Math.floor((p.clientY - segmentClientStart.current.clientY) / scale) + segmentClientStart.current.y,\r\n        };\r\n\r\n        onMove(dPos);\r\n        return onIgnore(event);\r\n    };\r\n\r\n    // useEffect(() => {\r\n    //     console.log(`divHost`, { divHost });\r\n    //     const div = divHost.current;\r\n    //     if (!div) { return () => { }; }\r\n\r\n    //     const onTouchStart = (x: Event) => onPressIn(x, (x as TouchEvent).touches[0]);\r\n    //     const onTouchMove = (x: Event) => onClientMove(x, (x as TouchEvent).touches[0]);\r\n\r\n    //     div.addEventListener(`mouseDown`, onPressIn, { passive: false });\r\n    //     div.addEventListener(`onTouchStart`, onTouchStart, { passive: false });\r\n    //     div.addEventListener(`onMouseUp`, onPressOut, { passive: false });\r\n    //     div.addEventListener(`onTouchEnd`, onPressOut, { passive: false });\r\n    //     div.addEventListener(`onMouseLeave`, onPressOut, { passive: false });\r\n    //     div.addEventListener(`onTouchEndCapture`, onPressOut, { passive: false });\r\n    //     div.addEventListener(`onMouseMove`, onClientMove, { passive: false });\r\n    //     div.addEventListener(`onTouchMove`, onTouchMove, { passive: false });\r\n\r\n    //     return () => {\r\n    //         div.removeEventListener(`mouseDown`, onPressIn);\r\n    //         div.removeEventListener(`onTouchStart`, onTouchStart);\r\n    //         div.removeEventListener(`onMouseUp`, onPressOut);\r\n    //         div.removeEventListener(`onTouchEnd`, onPressOut);\r\n    //         div.removeEventListener(`onMouseLeave`, onPressOut);\r\n    //         div.removeEventListener(`onTouchEndCapture`, onPressOut);\r\n    //         div.removeEventListener(`onMouseMove`, onClientMove);\r\n    //         div.removeEventListener(`onTouchMove`, onTouchMove);\r\n    //     };\r\n    // }, [divHost.current]);\r\n\r\n    useEffect(() => {\r\n        // console.log(`Disable scroll on touch`);\r\n        // Disable document scroll\r\n        const onIgnoreNative = (e: Event) => {\r\n            // If not drawing, don't ignore\r\n            if (!segmentClientStart.current) { return true; }\r\n\r\n            // console.log(`Prevent scroll on touch`);\r\n            e.preventDefault();\r\n            e.stopPropagation();\r\n            e.cancelBubble = true;\r\n            e.returnValue = false;\r\n            return false;\r\n        };\r\n        document.addEventListener(`touchmove`, onIgnoreNative, { passive: false });\r\n        return () => {\r\n            document.removeEventListener(`touchmove`, onIgnoreNative);\r\n        };\r\n    }, []);\r\n\r\n    return (\r\n        <>\r\n            <div style={{ position: `relative`, width: style.width, height: style.height, backgroundColor: style.backgroundColor }}>\r\n                <svg style={{ width: style.width, height: style.height }} viewBox={`0 0 ${drawing.width} ${drawing.height}`} preserveAspectRatio='none' xmlns='http://www.w3.org/2000/svg'>\r\n                    {drawing.segments.map((x, i) => (\r\n                        <path key={i} d={doodleSegmentToSvgPath_line(x)} stroke={style.color} fill='transparent' />\r\n                    ))}\r\n                    {segment && (\r\n                        <path d={doodleSegmentToSvgPath_line(segment)} stroke={style.color} fill='transparent' />\r\n                    )}\r\n                </svg>\r\n                <div ref={divHost} style={{ position: `absolute`, left: 0, right: 0, top: 0, bottom: 0, zIndex: 10 }}\r\n                    onMouseDown={onPressIn}\r\n                    onMouseUp={onPressOut}\r\n                    onMouseMove={onClientMove}\r\n                    onMouseLeave={onPressOut}\r\n                    onTouchStart={x => onPressIn(x, x.touches[0])}\r\n                    onTouchEnd={onPressOut}\r\n                    onTouchCancel={onPressOut}\r\n                    onTouchMove={x => onClientMove(x, x.touches[0])}\r\n                    onTouchEndCapture={onPressOut}\r\n                />\r\n            </div>\r\n            {/* <div>{doodleToSvg(drawing)}</div>\r\n            <div>{encodeDoodleDrawing(drawing).doodleText}</div> */}\r\n        </>\r\n    );\r\n};\r\n\r\nexport const DoodleDisplayView = ({ style, drawing }: { style: { width: number, height: number, color: string, backgroundColor: string }, drawing: DoodleDrawing }) => {\r\n    return (\r\n        <div style={{ width: style.width, height: style.height, backgroundColor: style.backgroundColor }}>\r\n            <svg style={{ width: style.width, height: style.height }} viewBox={`0 0 ${drawing.width} ${drawing.height}`} preserveAspectRatio='none' xmlns='http://www.w3.org/2000/svg'>\r\n                {drawing.segments.map((x, i) => (\r\n                    <path key={i} d={doodleSegmentToSvgPath_line(x)} stroke={style.color} fill='transparent' />\r\n                ))}\r\n            </svg>\r\n        </div>\r\n    );\r\n};\r\n","import { shuffle, distinct } from 'utils/arrays';\r\nimport { ProblemService, ProblemResult, ProblemAnswer } from './problems-service';\r\n\r\nexport const createMultiplesProblemService = ({\r\n    min = 1,\r\n    max = 12,\r\n    maxAnswers = 4,\r\n}: {\r\n    min?: number;\r\n    max?: number;\r\n    maxAnswers?: number;\r\n}): ProblemService => {\r\n\r\n    let state = {\r\n        n: min - 1,\r\n        m: min,\r\n        completedSectionKeys: [] as string[],\r\n    };\r\n    const getSectionKey = (m: number) => {\r\n        return `${m}`;\r\n    };\r\n    const getSectionName = (m: number) => {\r\n        return `Multiples of ${m}`;\r\n    };\r\n\r\n    const problemService: ProblemService = {\r\n        load: async (storage) => {\r\n            const loaded = await storage.load<typeof state>();\r\n            if (loaded) {\r\n                state = loaded;\r\n            }\r\n        },\r\n        save: async (storage) => {\r\n            await storage.save(state);\r\n        },\r\n        getSections: () => [...new Array(max - min + 1)].map((x, i) => ({\r\n            key: getSectionKey(i + min),\r\n            name: getSectionName(i + min),\r\n            isComplete: state.completedSectionKeys.includes(getSectionKey(i + min)),\r\n        })),\r\n        gotoSection: ({ key }) => {\r\n            const bVal = Number.parseInt(key, 10);\r\n            state.m = bVal;\r\n            state.n = min - 1;\r\n        },\r\n        getNextProblem: (): ProblemResult => {\r\n            state.n++;\r\n            if (state.n > max) {\r\n                state.n = min;\r\n                state.m++;\r\n                if (state.m > max) {\r\n                    // Loop\r\n                    state.n = min;\r\n                    state.m = min;\r\n                    // return { done: true, key: `done` };\r\n                }\r\n            }\r\n\r\n            const { n, m } = state;\r\n            const correctValue = n * m;\r\n            const wrongAnswerCount = maxAnswers - 1;\r\n            const wrongValues =\r\n                distinct(\r\n                    [...new Array(100)].map(() =>\r\n                        Math.round(n + 1 - 2 * Math.random())\r\n                        * Math.round(m + 1 - 2 * Math.random())\r\n                        + Math.round(2 - 4 * Math.random()))\r\n                        .filter(x => x !== correctValue)\r\n                        .filter(x => x > 0),\r\n                ).slice(0, wrongAnswerCount);\r\n\r\n            const answers: ProblemAnswer[] = shuffle([...wrongValues.map(x => ({ value: `${x}`, isCorrect: false })), { value: `${correctValue}`, isCorrect: true }]).map(x => ({ ...x, key: x.value }));\r\n\r\n            return {\r\n                key: `${m} x ${n}`,\r\n                question: `${m} x ${n}`,\r\n                answers,\r\n                sectionKey: getSectionKey(m),\r\n                isLastOfSection: n === max,\r\n                isLastOfSubject: n === max && m === max,\r\n            };\r\n        },\r\n        recordAnswer: (problem, answer) => {\r\n            if (answer.isCorrect && problem.isLastOfSection) {\r\n                state.completedSectionKeys.push(problem.sectionKey);\r\n            }\r\n        },\r\n    };\r\n\r\n    return problemService;\r\n};\r\n","import React, { useState, useRef, useEffect } from 'react';\r\nimport { View, Text, Pressable, Platform } from 'react-native-lite';\r\n\r\nexport type GamepadPressState = { moveDirection: { x: number, y: number }, buttons: { key: string, text: string, isDown: boolean }[] };\r\nexport const GamepadAnalogStateful = (props: {\r\n    style: { backgroundColor: string, borderColor: string };\r\n    onPressStateChange: (value: GamepadPressState) => void;\r\n    buttons: { text: string, key: string }[];\r\n}) => {\r\n\r\n    const state = useRef({\r\n        moveDirection: { x: 0, y: 0 },\r\n        buttons: props.buttons.map((x, i) => ({\r\n            isDown: false,\r\n            key: x.key,\r\n            text: x.text,\r\n            onPressIn: () => {\r\n                state.current.buttons[i].isDown = true;\r\n                props.onPressStateChange(state.current);\r\n            },\r\n            onPressOut: () => {\r\n                state.current.buttons[i].isDown = false;\r\n                props.onPressStateChange(state.current);\r\n            },\r\n        })),\r\n    });\r\n\r\n    const onMovePressIn = (dir: { x: number, y: number }) => {\r\n        const s = state.current;\r\n\r\n        state.current.moveDirection = {\r\n            x: dir.x ? dir.x : s.moveDirection.x,\r\n            y: dir.y ? dir.y : s.moveDirection.y,\r\n        };\r\n\r\n        console.log(`onMovePressIn`, { dir, s, moveDirection: state.current.moveDirection });\r\n\r\n        props.onPressStateChange(state.current);\r\n    };\r\n\r\n    const onMovePressOut = (dir: { x: number, y: number }) => {\r\n        const s = state.current;\r\n        state.current.moveDirection = {\r\n            x: dir.x ? 0 : s.moveDirection.x,\r\n            y: dir.y ? 0 : s.moveDirection.y,\r\n        };\r\n        props.onPressStateChange(state.current);\r\n    };\r\n\r\n    return (\r\n        <GamepadAnalog {...props} onMovePressIn={onMovePressIn} onMovePressOut={onMovePressOut} buttons={state.current.buttons} />\r\n    );\r\n};\r\n\r\nconst inputStyles = {\r\n    container: { flex: 1, alignSelf: `stretch`, flexDirection: `row`, justifyContent: `space-between`, alignItems: `center`, padding: 4 },\r\n    section: { justifyContent: `center`, alignItems: `center`, padding: 4 },\r\n    moveSectionWrapper: { overflow: `hidden` },\r\n    moveSectionRotation: { transform: `rotate(0.125turn)`, margin: 0 },\r\n    row: { flexDirection: `row` },\r\n    cellTouch: { outline: `none` },\r\n    cellView: { pointerEvents: `none`, position: `relative`, margin: 4, width: 56, height: 56, justifyContent: `center`, alignItems: `center`, borderWidth: 0, borderStyle: `solid`, outline: `none` },\r\n    cellText: { userSelect: `none`, pointerEvents: `none` },\r\n    moveCellText: { userSelect: `none`, pointerEvents: `none`, transform: `rotate(-0.125turn)` },\r\n    cellEmptyView: { margin: 2, width: 56, height: 56 },\r\n    cellTextOcclusionView: { position: `absolute`, top: 0, bottom: 0, left: 0, right: 0, backgroundColor: `red`, opacity: 0 },\r\n} as const;\r\n\r\nexport const GamepadAnalog = (props: {\r\n    style: { backgroundColor: string, borderColor: string };\r\n    onMovePressIn: (direction: { x: number, y: number }) => void;\r\n    onMovePressOut: (direction: { x: number, y: number }) => void;\r\n    buttons: { text: string, onPressIn: () => void, onPressOut: () => void }[];\r\n}) => {\r\n    const { onMovePressIn, onMovePressOut } = props;\r\n\r\n    const cellViewStyle = { ...inputStyles.cellView, ...props.style };\r\n\r\n    // Keyboard\r\n    useEffect(() => {\r\n        const onIgnore = (e: KeyboardEvent) => {\r\n            e.preventDefault();\r\n            e.stopPropagation?.();\r\n            return false;\r\n        };\r\n        if (Platform.OS === `web`) {\r\n            const onKeyDown = (e: KeyboardEvent) => {\r\n                if (e.key === `ArrowUp`) { onMovePressIn({ x: 0, y: +1 }); return onIgnore(e); }\r\n                if (e.key === `ArrowDown`) { onMovePressIn({ x: 0, y: -1 }); return onIgnore(e); }\r\n                if (e.key === `ArrowLeft`) { onMovePressIn({ x: -1, y: 0 }); return onIgnore(e); }\r\n                if (e.key === `ArrowRight`) { onMovePressIn({ x: +1, y: 0 }); return onIgnore(e); }\r\n                if (e.key === ` `) { props.buttons[0]?.onPressIn(); return onIgnore(e); }\r\n                // console.log(`onKeyDown`, { key: e.key });\r\n                return true;\r\n            };\r\n            const onKeyUp = (e: KeyboardEvent) => {\r\n                if (e.key === `ArrowUp`) { onMovePressOut({ x: 0, y: +1 }); return onIgnore(e); }\r\n                if (e.key === `ArrowDown`) { onMovePressOut({ x: 0, y: -1 }); return onIgnore(e); }\r\n                if (e.key === `ArrowLeft`) { onMovePressOut({ x: -1, y: 0 }); return onIgnore(e); }\r\n                if (e.key === `ArrowRight`) { onMovePressOut({ x: +1, y: 0 }); return onIgnore(e); }\r\n                if (e.key === ` `) { props.buttons[0]?.onPressOut(); return onIgnore(e); }\r\n                return true;\r\n            };\r\n            window.addEventListener(`keydown`, onKeyDown);\r\n            window.addEventListener(`keyup`, onKeyUp);\r\n            return () => {\r\n                window.removeEventListener(`keydown`, onKeyDown);\r\n                window.removeEventListener(`keyup`, onKeyUp);\r\n            };\r\n        }\r\n\r\n        return () => { };\r\n    });\r\n\r\n    const DirectionButton = ({ text, direction }: { text: string, direction: { x: number, y: number } }) => {\r\n        return (\r\n            <Pressable style={inputStyles.cellTouch} onPressIn={() => onMovePressIn(direction)} onPressOut={() => onMovePressOut(direction)}>\r\n                <View style={cellViewStyle}>\r\n                    <Text style={inputStyles.moveCellText}>{text}</Text>\r\n                    <View style={inputStyles.cellTextOcclusionView} />\r\n                </View>\r\n            </Pressable>\r\n        );\r\n    };\r\n\r\n    const ActionButton = ({ text, onPressIn, onPressOut }: { text: string, onPressIn: () => void, onPressOut: () => void }) => {\r\n        return (\r\n            <Pressable style={inputStyles.cellTouch} onPressIn={onPressIn} onPressOut={onPressOut}>\r\n                <View style={cellViewStyle}>\r\n                    <Text style={inputStyles.cellText}>{text}</Text>\r\n                    <View style={inputStyles.cellTextOcclusionView} />\r\n                </View>\r\n            </Pressable>\r\n        );\r\n    };\r\n\r\n    return (\r\n        <View style={inputStyles.container}>\r\n            <View style={inputStyles.moveSectionWrapper}>\r\n                <View style={inputStyles.moveSectionRotation}>\r\n                    <View style={inputStyles.section}>\r\n                        <View style={inputStyles.row} >\r\n                            <DirectionButton direction={{ x: 0, y: +1 }} text='' />\r\n                            <DirectionButton direction={{ x: +1, y: 0 }} text='' />\r\n                        </View>\r\n                        <View style={inputStyles.row} >\r\n                            <DirectionButton direction={{ x: -1, y: 0 }} text='' />\r\n                            <DirectionButton direction={{ x: 0, y: -1 }} text='' />\r\n                        </View>\r\n                    </View>\r\n                </View>\r\n            </View>\r\n            <View style={inputStyles.section} >\r\n                <View style={inputStyles.row} >\r\n                    {props.buttons.map(x => (\r\n                        <React.Fragment key={`${x.text}`}>\r\n                            <View style={inputStyles.cellEmptyView} />\r\n                            <ActionButton {...x} />\r\n                        </React.Fragment>\r\n                    ))}\r\n                </View>\r\n            </View>\r\n        </View>\r\n    );\r\n};\r\n","export type Vector2 = { x: number, y: number };\r\nexport const getDistanceSq = (a: Vector2, b: Vector2) => {\r\n    const x = a.x - b.x;\r\n    const y = a.y - b.y;\r\n    return x * x + y * y;\r\n};\r\n","/* eslint-disable react/no-array-index-key */\r\n/* eslint-disable jsx-a11y/accessible-emoji */\r\nimport React, { useState, useEffect, useRef } from 'react';\r\nimport { View, Text, Pressable, TouchableOpacity, Platform } from 'react-native-lite';\r\nimport { createMultiplesProblemService } from './problems/multiples';\r\nimport { ProblemService, Problem } from './problems/problems-service';\r\nimport { GamepadAnalogStateful, GamepadPressState } from './components/game-pad-analog';\r\nimport { getDistanceSq, Vector2 } from './utils/vectors';\r\nimport { createReviewProblemService } from './problems/problems-reviewer';\r\nimport { createProgressGameProblemService } from './progress-games/progress-game';\r\nimport { createAutoSavedProblemService } from './problems/problem-state-storage';\r\nimport { SubjectNavigator } from './utils/subject-navigator';\r\n\r\nexport const EducationalGame_StarBlastSideways_Multiples = (props: {}) => {\r\n    return <EducationalGame_StarBlastSideways problemService={createAutoSavedProblemService(createReviewProblemService(createMultiplesProblemService({ min: 1, max: 12 }), {}), `ProblemsMultiples`)} />;\r\n};\r\n\r\nexport const EducationalGame_StarBlastSideways = (props: { problemService: ProblemService }) => {\r\n    // Add Pet Feeder\r\n    return <EducationalGame_StarBlastSideways_Inner problemService={createProgressGameProblemService(props.problemService)} />;\r\n};\r\n\r\nconst EducationalGame_StarBlastSideways_Inner = (props: { problemService: ProblemService }) => {\r\n    const [pauseState, setPauseState] = useState({ paused: false } as { paused: boolean });\r\n    const [pressState, setPressState] = useState({ moveDirection: { x: 0, y: 0 }, buttons: [] } as GamepadPressState);\r\n    const onPressStateChange = (value: GamepadPressState) => {\r\n        // console.log(`onPressStateChange`, { ...x, dir: { ...x.moveDirection }, buttons: x.buttons.map(b => ({ ...b })) });\r\n        setPressState(value);\r\n    };\r\n\r\n    const [problemSourceKey, setProblemSourceKey] = useState(0);\r\n\r\n    return (\r\n        <>\r\n            <View>\r\n                <View style={{ alignItems: `center`, alignSelf: `stretch` }} >\r\n                    <View style={{ overflow: `hidden`, padding: 10, paddingTop: 4, paddingBottom: 64 }}>\r\n                        <View style={{ position: `relative` }}>\r\n                            <GameView pressState={pressState} pauseState={pauseState} problemService={props.problemService} problemSourceKey={`${problemSourceKey}`} />\r\n                            {/* <Pressable style={{ position: `absolute`, top: 0, bottom: 0, left: 0, right: 0, opacity: 0 }} onPressIn={() => { }} onPressOut={() => { }} /> */}\r\n                            <View style={{ zIndex: 10, flex: 1, alignSelf: `stretch` }}>\r\n                                <GamepadAnalogStateful style={colors.gamepad} onPressStateChange={onPressStateChange} buttons={[{ key: `A`, text: `` }]} />\r\n                            </View>\r\n                        </View>\r\n                    </View>\r\n                </View>\r\n                <SubjectNavigator problemService={props.problemService}\r\n                    onOpen={() => setPauseState({ paused: true })}\r\n                    onClose={() => setPauseState({ paused: false })}\r\n                    onSubjectNavigation={() => { setPauseState({ paused: false }); setProblemSourceKey(s => s + 1); }}\r\n                />\r\n            </View>\r\n        </>\r\n    );\r\n};\r\n\r\n\r\nconst colors = {\r\n    gamepad: {\r\n        backgroundColor: `#333333`,\r\n        borderColor: `#000033`,\r\n    },\r\n    viewscreen: {\r\n        borderColor: `#000033`,\r\n        backgroundColor: `#000000`,\r\n    },\r\n};\r\n\r\nconst gameStyles = {\r\n    directAnswerButtonContainer: { alignSelf: `flex-end`, justifyContent: `space-around`, height: 250, padding: 4 },\r\n    directAnswerButton: { width: 40, height: 40, backgroundColor: `#FFFFFF`, opacity: 0.1 },\r\n    directAnswerButton_hidden: { width: 40, height: 40 },\r\n    viewscreenView: {\r\n        height: 300,\r\n        width: 300,\r\n        backgroundColor: colors.viewscreen.backgroundColor,\r\n        borderColor: colors.viewscreen.borderColor,\r\n        borderWidth: 1,\r\n        borderStyle: `solid`,\r\n    },\r\n    sprite: {\r\n        viewSize: { width: 32, height: 32 },\r\n        text: {\r\n            fontFamily: `\"Lucida Console\", Monaco, monospace`,\r\n            fontSize: 32,\r\n            textAlign: `center`,\r\n        },\r\n    },\r\n    answer: {\r\n        text: {\r\n            fontFamily: `\"Lucida Console\", Monaco, monospace`,\r\n            fontSize: 24,\r\n            fontSize_small: 14,\r\n            textAlign: `center`,\r\n            whiteSpace: `pre-wrap`,\r\n        },\r\n    },\r\n    question: {\r\n        view: { flex: 1, justifyContent: `center`, padding: 4 },\r\n        text: {\r\n            fontFamily: `\"Lucida Console\", Monaco, monospace`,\r\n            fontSize: 24,\r\n            fontSize_small: 14,\r\n            whiteSpace: `pre-wrap`,\r\n        },\r\n    },\r\n    gameOver: {\r\n        view: { flex: 1, justifyContent: `center`, padding: 4 },\r\n        text: {\r\n            fontFamily: `\"Lucida Console\", Monaco, monospace`,\r\n            fontSize: 24,\r\n            textAlign: `center`,\r\n        },\r\n    },\r\n} as const;\r\n\r\ntype GamePosition = {\r\n    x: number;\r\n    y: number;\r\n    rotation: number;\r\n};\r\n\r\ntype GameState = {\r\n    lastActualTimeMs: number;\r\n    lastGameTime: number;\r\n    gameSpeed: number;\r\n\r\n    lives: number;\r\n    deadTime?: number;\r\n    gameOverTime?: number;\r\n    score: number;\r\n\r\n    weaponsLock?: {\r\n        lockedAtPlayerPosition: GamePosition;\r\n        lockedEnemy: { pos: GamePosition };\r\n    };\r\n    playerTargetPosition?: { x: number, y: number };\r\n};\r\n\r\n\r\ntype AnswerState = { key: string, value: string, isCorrect: boolean, isAnsweredWrong: boolean };\r\nconst GameView = (props: { pressState: GamepadPressState, pauseState: { paused: boolean }, problemService: ProblemService, problemSourceKey: string }) => {\r\n\r\n    const pressState = useRef(props.pressState);\r\n    pressState.current = props.pressState;\r\n\r\n    const pauseState = useRef(props.pauseState);\r\n    pauseState.current = props.pauseState;\r\n\r\n    const gameAcceleration = 0.1;\r\n    const gameDeceleration = 0.2;\r\n    const maxGameSpeed = 5;\r\n    const minGameSpeed = 0.5;\r\n\r\n    const getDefaultGameState = (): GameState => ({\r\n        lastActualTimeMs: Date.now(),\r\n        lastGameTime: 0,\r\n        gameSpeed: 1,\r\n        lives: 3,\r\n        score: 0,\r\n    });\r\n    const gameState = useRef(getDefaultGameState());\r\n    const getGameTime = () => {\r\n        const now = Date.now();\r\n        let actualTimePassed = (now - gameState.current.lastActualTimeMs) / 1000;\r\n        gameState.current.lastActualTimeMs = now;\r\n\r\n        if (actualTimePassed === 0) {\r\n            return { gameTime: gameState.current.lastGameTime };\r\n        }\r\n\r\n        // Left App, frozen, etc?\r\n        if (actualTimePassed > 0.1) {\r\n            actualTimePassed = 0.1;\r\n        }\r\n\r\n        const gameTimePassed = actualTimePassed * gameState.current.gameSpeed;\r\n        const gameTime = gameState.current.lastGameTime + gameTimePassed;\r\n        gameState.current.lastGameTime = gameTime;\r\n\r\n        return {\r\n            gameTime,\r\n        };\r\n    };\r\n\r\n    const playerPositionState = useRef({\r\n        y: gameStyles.viewscreenView.height * 0.5, x: gameStyles.viewscreenView.width * 0.15, rotation: 0,\r\n    } as GamePosition);\r\n    const projectilesState = useRef({ lastShotActualTime: 0, shots: [], debris: [] } as ProjectilesState);\r\n    const enemiesState = useRef({ enemies: [] } as EnemiesState);\r\n\r\n    const problemsState = useRef(null as null | { problemTime: number, question: string, answers: (Problem['answers'][0] & { key: string, pos: GamePosition, isAnsweredWrong: boolean })[] });\r\n    const [renderId, setRenderId] = useState(0);\r\n\r\n    const restartGame = () => {\r\n        // Move enemies back\r\n        enemiesState.current.enemies.forEach(e2 => { e2.pos.x += gameStyles.viewscreenView.width * 0.5; });\r\n\r\n        // Reset Player\r\n        playerPositionState.current.y = gameStyles.viewscreenView.height * 0.5;\r\n        playerPositionState.current.x = gameStyles.viewscreenView.width * 0.15;\r\n\r\n        gameState.current = { ...getDefaultGameState(), lastGameTime: gameState.current.lastGameTime };\r\n    };\r\n\r\n    const gameOver = () => {\r\n        gameState.current = {\r\n            ...gameState.current,\r\n            lives: 0,\r\n            gameOverTime: getGameTime().gameTime,\r\n        };\r\n    };\r\n\r\n    const gotoNextProblem = () => {\r\n        const p = props.problemService.getNextProblem();\r\n\r\n        console.log(`gotoNextProblem`, { p });\r\n\r\n        if (!p.question) {\r\n            // Game over - problems done\r\n            return;\r\n        }\r\n\r\n        const pSize = gameStyles.viewscreenView.width / (p.answers.length + 1);\r\n        const newProblemState = {\r\n            problemTime: getGameTime().gameTime,\r\n            question: p.question,\r\n            answers: p.answers.map((x, i) => ({ ...x, key: `${p.question} ${x.value}`, pos: { y: pSize * (0.5 + i), x: gameStyles.viewscreenView.width - gameStyles.sprite.viewSize.width * 0.5, rotation: 0 }, isAnsweredWrong: false })),\r\n        };\r\n        const newEnemyState = {\r\n            enemies: newProblemState.answers.map((ans, i) => {\r\n                const enemy = {\r\n                    key: `${p.question} ${ans.value}`,\r\n                    answer: ans,\r\n                    pos: { y: pSize * (0.5 + i), x: gameStyles.viewscreenView.width - gameStyles.sprite.viewSize.width * 1.5, rotation: 0 },\r\n                    vel: { x: -5, y: 0 },\r\n                    onHit: () => {\r\n                        setTimeout(() => {\r\n                            console.log(`onHit`, { ans });\r\n                            props.problemService.recordAnswer(p, ans);\r\n                            if (ans.isCorrect) {\r\n                                // TODO: Update score, etc.\r\n                                // Let bullets clear\r\n                                projectilesState.current.shots.forEach(x => { x.ignore = true; });\r\n                                gotoNextProblem();\r\n\r\n                                gameState.current = {\r\n                                    ...gameState.current,\r\n                                    score: gameState.current.score += Math.floor(enemy.pos.x) * 1000,\r\n                                    gameSpeed: Math.min(maxGameSpeed, gameState.current.gameSpeed * 1 + gameAcceleration),\r\n                                };\r\n                            } else {\r\n                                ans.isAnsweredWrong = true;\r\n\r\n                                gameState.current = {\r\n                                    ...gameState.current,\r\n                                    score: gameState.current.score -= Math.floor(enemy.pos.x) * 1500,\r\n                                    gameSpeed: Math.max(minGameSpeed, gameState.current.gameSpeed * 1 - gameDeceleration),\r\n                                };\r\n                            }\r\n                        });\r\n                    },\r\n                    destroyed: false,\r\n                };\r\n\r\n                return enemy;\r\n            }),\r\n        };\r\n\r\n        problemsState.current = newProblemState;\r\n        enemiesState.current = newEnemyState;\r\n        setRenderId(s => s + 1);\r\n\r\n        setTimeout(() => {\r\n            p.onQuestion?.();\r\n        }, 250);\r\n    };\r\n\r\n    useEffect(() => {\r\n        gotoNextProblem();\r\n    }, [props.problemSourceKey]);\r\n\r\n    useEffect(() => {\r\n        // Game Loop\r\n        let gameLastTime = getGameTime().gameTime;\r\n        const gameLoop = () => {\r\n            const { gameTime } = getGameTime();\r\n            const gameDeltaTime = gameTime - gameLastTime;\r\n            gameLastTime = gameTime;\r\n\r\n            if (pauseState.current.paused || gameDeltaTime <= 0) {\r\n                requestAnimationFrame(gameLoop);\r\n                return;\r\n            }\r\n\r\n            // if (!pressState.current.moveDirection.x\r\n            //     && !pressState.current.moveDirection.y) {\r\n            //     // No change\r\n            //     requestAnimationFrame(gameLoop);\r\n            //     return;\r\n            // }\r\n\r\n            // console.log(`gameLoop Update`);\r\n\r\n            // Update\r\n\r\n            const getCommonState = (): CommonGameState => {\r\n                return {\r\n                    gameTime,\r\n                    gameDeltaTime,\r\n                    gameState: gameState.current,\r\n                    pressState: pressState.current,\r\n                    playerPosition: playerPositionState.current,\r\n                    projectilesState: projectilesState.current,\r\n                    enemiesState: enemiesState.current,\r\n                    onLoseLife: () => {\r\n                        if (gameState.current.deadTime || gameState.current.gameOverTime) { return; }\r\n\r\n                        projectilesState.current.debris.push({ key: `player${gameTime}`, kind: `player-character`, pos: { ...playerPositionState.current }, vel: { x: 0, y: 0 } });\r\n\r\n\r\n                        if (gameState.current.lives <= 1) {\r\n                            // Game over\r\n                            gameOver();\r\n                            return;\r\n                        }\r\n\r\n                        // Move enemies back\r\n                        // enemiesState.current.enemies.forEach(e2 => { e2.pos.x += gameStyles.viewscreenView.width * 0.5; });\r\n\r\n                        gameState.current = {\r\n                            ...gameState.current,\r\n                            lives: gameState.current.lives - 1,\r\n                            deadTime: gameTime,\r\n                        };\r\n                    },\r\n                };\r\n            };\r\n\r\n\r\n            // Game\r\n            const gameResult = updateGame(getCommonState());\r\n            gameState.current = gameResult;\r\n\r\n            if (!gameState.current.gameOverTime) {\r\n                // Player\r\n                const playerResult = updatePlayer(getCommonState());\r\n                playerPositionState.current = playerResult.playerPosition;\r\n            } else if (getGameTime().gameTime > 1 + gameState.current.gameOverTime\r\n                && pressState.current.buttons[0]?.isDown) {\r\n                setTimeout(() => {\r\n                    restartGame();\r\n                }, 250);\r\n            }\r\n\r\n            // Projectiles\r\n            const projectilesResult = updateProjectiles(getCommonState());\r\n            projectilesState.current = projectilesResult;\r\n\r\n            // Enemies\r\n            const enemiesResult = updateEnemies(getCommonState());\r\n            enemiesState.current = enemiesResult;\r\n\r\n\r\n            // Game Loop\r\n            requestAnimationFrame(gameLoop);\r\n            setRenderId(s => s + 1);\r\n        };\r\n\r\n        requestAnimationFrame(gameLoop);\r\n    }, []);\r\n\r\n\r\n    // console.log(`GameView render`, { playerStylePosition });\r\n\r\n    const timeSinceProblem = getGameTime().gameTime - (problemsState.current?.problemTime ?? 0);\r\n\r\n    const directAnswer = (enemy: EnemiesState['enemies'][0]) => {\r\n        if (gameState.current.gameOverTime) { restartGame(); return; }\r\n        if (gameState.current.deadTime) { return; }\r\n        if (enemy.destroyed || enemy.explodeTime) { return; }\r\n        gameState.current.weaponsLock = { lockedEnemy: enemy, lockedAtPlayerPosition: playerPositionState.current };\r\n        const { shots } = projectilesState.current;\r\n        shots.push({ key: `${getGameTime()}${shots.length}`, pos: { ...playerPositionState.current }, lockedEnemy: enemy });\r\n        gameState.current.playerTargetPosition = { x: playerPositionState.current.x, y: enemy.pos.y };\r\n    };\r\n\r\n    return (\r\n        <>\r\n            <View style={gameStyles.viewscreenView} >\r\n                {/* <TextPositioned text={`${gameState.current.score.toLocaleString()}`} position={{ x: 0, y: -0.8 * gameStyles.sprite.viewSize.height, rotation: 0 }} /> */}\r\n                {[... new Array(gameState.current.lives)].map((x, i) => (\r\n                    <Sprite key={`life${i}`} kind='life' position={{ x: gameStyles.viewscreenView.width - (gameStyles.sprite.viewSize.width * (1 + i)), y: gameStyles.viewscreenView.height - 0.5 * gameStyles.sprite.viewSize.height, rotation: 0 }} />\r\n                ))}\r\n                {projectilesState.current.debris.map(x => (\r\n                    <Sprite key={x.key} kind={x.hasHitGround ? `${x.kind}-splat` as SpriteKind : x.kind} position={x.pos} />\r\n                ))}\r\n                {enemiesState.current?.enemies.filter(e => !e.destroyed).map(e => (\r\n                    <React.Fragment key={e.key}>\r\n                        {!e.answer.isAnsweredWrong && (<TextPositioned position={{ y: e.pos.y, x: e.pos.x + gameStyles.sprite.viewSize.width, rotation: 0 }} text={e.answer.value} />)}\r\n                        {e.answer.isAnsweredWrong && (<Sprite kind='answer-wrong' position={{ y: e.pos.y, x: e.pos.x + gameStyles.sprite.viewSize.width, rotation: 0 }} />)}\r\n                    </React.Fragment>\r\n                ))}\r\n                {enemiesState.current?.enemies.filter(x => !x.destroyed).map(x => (\r\n                    <React.Fragment key={x.key}>\r\n                        <Sprite kind={x.explodeTime ? `enemy-explode` : `enemy`} position={x.pos} />\r\n                        {x === gameState.current.weaponsLock?.lockedEnemy && (\r\n                            <Sprite kind='lock' position={x.pos} />\r\n                        )}\r\n                    </React.Fragment>\r\n                ))}\r\n                {!gameState.current.gameOverTime && !gameState.current.deadTime && (\r\n                    <Sprite kind='player' position={playerPositionState.current} />\r\n                )}\r\n                {projectilesState.current.shots.map(x => (\r\n                    <Sprite key={x.key} kind={x.explodeTime ? `shot-explode` : `shot`} position={x.pos} />\r\n                ))}\r\n                {gameState.current.gameOverTime && (\r\n                    <View>\r\n                        <View style={{ position: `absolute`, top: gameStyles.viewscreenView.height * 0.5, width: gameStyles.viewscreenView.width }}>\r\n                            <Text style={gameStyles.gameOver.text}>Game Over</Text>\r\n                            {getGameTime().gameTime > 1 + gameState.current.gameOverTime && (<Text style={gameStyles.gameOver.text}>Continue?</Text>)}\r\n                        </View>\r\n                    </View>\r\n                )}\r\n\r\n                <View style={gameStyles.directAnswerButtonContainer}>\r\n                    {enemiesState.current?.enemies.map(e => (\r\n                        <TouchableOpacity key={e.key} onPress={() => directAnswer(e)} >\r\n                            <View style={!e.destroyed && !e.explodeTime ? gameStyles.directAnswerButton : gameStyles.directAnswerButton_hidden} />\r\n                        </TouchableOpacity>\r\n                    ))}\r\n                </View>\r\n            </View>\r\n            <View style={{ position: `relative`, height: gameStyles.question.text.fontSize * 3, alignSelf: `stretch` }}>\r\n                <TextPositioned text={problemsState.current?.question ?? ``} position={{ x: gameStyles.viewscreenView.width * 0.25, y: gameStyles.question.text.fontSize * 1 - Math.max(0, gameStyles.viewscreenView.height * 0.5 - 125 * timeSinceProblem), rotation: 0 }} />\r\n            </View>\r\n            {/* <View>\r\n                <Text>{`${renderId}`}</Text>\r\n            </View> */}\r\n            {/* <View style={[gameStyles.question.view, { transform: `translate(0px,${-Math.max(0, gameStyles.viewscreenView.height * 0.5 - 125 * timeSinceProblem)}px)` }]}>\r\n                <Text style={{...gameStyles.question.text, text.length > 10 ? s.fontSize_small * 0.5 : s.fontSize}} >{problemsState.current?.question}</Text>\r\n            </View> */}\r\n\r\n        </>\r\n    );\r\n};\r\n\r\ntype CommonGameState = { gameTime: number, gameDeltaTime: number, gameState: GameState, pressState: GamepadPressState, playerPosition: GamePosition, projectilesState: ProjectilesState, enemiesState: EnemiesState, onLoseLife: () => void };\r\n\r\nconst updateGame = ({ gameTime, gameDeltaTime, pressState, playerPosition, gameState, enemiesState }: CommonGameState): GameState => {\r\n\r\n    // Respawn Player\r\n    if (gameState.deadTime && gameTime > 3 + gameState.deadTime) {\r\n        playerPosition.y = gameStyles.viewscreenView.height * 0.5;\r\n        playerPosition.x = gameStyles.viewscreenView.width * 0.15;\r\n\r\n        enemiesState.enemies.forEach(e2 => { e2.pos.x += gameStyles.viewscreenView.width * 0.5; });\r\n\r\n        return { ...gameState, deadTime: undefined };\r\n    }\r\n\r\n    return gameState;\r\n};\r\n\r\nconst updatePlayer = ({ gameTime, gameDeltaTime, pressState, playerPosition, gameState }: CommonGameState): { playerPosition: GamePosition } => {\r\n    if (gameState.deadTime) { return { playerPosition }; }\r\n\r\n    const dirPress = pressState.moveDirection;\r\n    const targetPos = gameState.playerTargetPosition;\r\n    const dir = dirPress.x || dirPress.y ? { x: dirPress.x, y: -dirPress.y }\r\n        : targetPos ? { x: targetPos.x - playerPosition.x, y: targetPos.y - playerPosition.y }\r\n            : { x: 0, y: 0 };\r\n    dir.x = dir.x === 0 ? 0 : Math.sign(dir.x);\r\n    dir.y = dir.y === 0 ? 0 : Math.sign(dir.y);\r\n\r\n    if (gameState.playerTargetPosition) {\r\n        console.log(`updatePlayer`, { dirPress, dir, targetPos, playerPosition });\r\n    }\r\n\r\n    if (dirPress.x || dirPress.y) {\r\n        gameState.playerTargetPosition = undefined;\r\n    }\r\n    if (gameState.playerTargetPosition && getDistanceSq(playerPosition, gameState.playerTargetPosition) < 5 * 5) {\r\n        gameState.playerTargetPosition = undefined;\r\n    }\r\n\r\n    const targetRotation = dir.y * 0.05;\r\n\r\n    const pos = {\r\n        x: playerPosition.x + dir.x * gameDeltaTime * 250,\r\n        y: playerPosition.y + dir.y * gameDeltaTime * 250,\r\n        rotation: playerPosition.rotation * 0.9 + targetRotation * 0.1,\r\n    };\r\n\r\n    const w = gameStyles.viewscreenView.width;\r\n    const gw = gameStyles.sprite.viewSize.width * 0.5;\r\n    const h = gameStyles.viewscreenView.height;\r\n    const gh = gameStyles.sprite.viewSize.height * 0.5;\r\n    pos.x = pos.x < gw ? gw : pos.x > w - gw ? w - gw : pos.x;\r\n    pos.y = pos.y < gh ? gh : pos.y > h - gh ? h - gh : pos.y;\r\n\r\n    return { playerPosition: pos };\r\n};\r\n\r\ntype ProjectilesState = {\r\n    lastShotActualTime: number;\r\n    shots: { key: string, pos: GamePosition, explodeTime?: number, ignore?: boolean, lockedEnemy?: { pos: GamePosition, explodeTime?: number, destoyed?: boolean } }[];\r\n    debris: { key: string, vel: Vector2, pos: GamePosition, kind: SpriteKind, hasHitGround?: boolean }[];\r\n};\r\nconst updateProjectiles = ({ gameTime, gameDeltaTime, pressState, playerPosition: playerPos, enemiesState, projectilesState, gameState, onLoseLife }: CommonGameState): ProjectilesState => {\r\n    const { shots, debris, lastShotActualTime } = projectilesState;\r\n\r\n    const canShoot = !gameState.deadTime && !gameState.gameOverTime && (Date.now() / 1000) > 0.25 + lastShotActualTime;\r\n\r\n    // console.log(`updateProjectiles`, { canShoot, gameTime, lastShotTime });\r\n\r\n    const didShoot = canShoot && pressState.buttons.find(x => x.key === `A`)?.isDown;\r\n    if (didShoot) {\r\n        const lockedEnemy = gameState.weaponsLock?.lockedEnemy;\r\n        shots.push({ key: `${gameTime}${shots.length}`, pos: { ...playerPos }, lockedEnemy });\r\n    }\r\n\r\n    // Move shots\r\n    shots.forEach(x => {\r\n        if (x.explodeTime) { return; }\r\n\r\n        if (x.lockedEnemy && !x.lockedEnemy.explodeTime && !x.lockedEnemy.destoyed) {\r\n            x.pos.y += (x.lockedEnemy.pos.y - x.pos.y) * 0.25;\r\n            x.pos.x += Math.min(250 * gameDeltaTime, (x.lockedEnemy.pos.x - x.pos.x) * 0.5);\r\n        } else {\r\n            x.pos.x += 250 * gameDeltaTime;\r\n        }\r\n    });\r\n\r\n    // Move debris\r\n    debris.forEach(d => {\r\n        if (d.hasHitGround) { return; }\r\n\r\n        // Gravity\r\n        d.vel.y += 100 * gameDeltaTime;\r\n\r\n        d.pos.y += d.vel.y * gameDeltaTime;\r\n        d.pos.x += d.vel.x * gameDeltaTime;\r\n\r\n        const pad = gameStyles.sprite.viewSize.width * 0.5;\r\n        const w = gameStyles.viewscreenView.width;\r\n        if (d.pos.x < pad) { d.pos.x = pad; d.vel.x = -d.vel.x; }\r\n        if (d.pos.x > w - pad) { d.pos.x = w - pad; d.vel.x = -d.vel.x; }\r\n\r\n        const hPad = gameStyles.sprite.viewSize.width * 0.8;\r\n        const h = gameStyles.viewscreenView.height;\r\n        if (d.pos.y > h - hPad + Math.random() * 10) {\r\n            d.hasHitGround = true;\r\n\r\n            if (d.kind === `kitten`) {\r\n                onLoseLife();\r\n            }\r\n        }\r\n\r\n    });\r\n\r\n    // Clean up too much debris\r\n    if (debris.length > 25) {\r\n        debris.shift();\r\n    }\r\n\r\n    const newShots = shots\r\n        // Remove shots offscreen\r\n        .filter(x => x.pos.x < gameStyles.viewscreenView.width)\r\n        // Remove exploded\r\n        .filter(x => !x.explodeTime || gameTime < 1 + x.explodeTime)\r\n        ;\r\n\r\n    return {\r\n        ...projectilesState,\r\n        lastShotActualTime: didShoot ? (Date.now() / 1000) : lastShotActualTime,\r\n        shots: newShots,\r\n    };\r\n};\r\n\r\ntype EnemiesState = {\r\n    enemies: {\r\n        key: string;\r\n        pos: GamePosition;\r\n        vel: Vector2;\r\n        explodeTime?: number;\r\n        answer: AnswerState;\r\n        onHit: () => void;\r\n        destroyed?: boolean;\r\n    }[];\r\n};\r\nconst updateEnemies = ({ gameTime, gameDeltaTime, projectilesState, enemiesState, gameState, playerPosition, onLoseLife }: CommonGameState): EnemiesState => {\r\n    const { enemies } = enemiesState;\r\n    const { shots } = projectilesState;\r\n\r\n    // Detect Collisions\r\n\r\n    // Enemies - Bullets\r\n    const radius = gameStyles.sprite.viewSize.width * 0.75;\r\n    const radiusSq = radius * radius;\r\n\r\n    enemies.forEach(e => shots.forEach(s => {\r\n        // console.log(`Checking!`, { e, s });\r\n\r\n        if (e.explodeTime) { return; }\r\n        if (s.explodeTime || s.ignore) { return; }\r\n\r\n        // Only shoot locked enemy\r\n        if (s.lockedEnemy && s.lockedEnemy !== e) { return; }\r\n\r\n        if (getDistanceSq(e.pos, s.pos) < radiusSq) {\r\n            console.log(`Exploded!`, { e, s });\r\n\r\n            e.explodeTime = gameTime;\r\n            s.explodeTime = gameTime;\r\n\r\n            e.onHit();\r\n\r\n            if (e.answer.isCorrect) {\r\n                projectilesState.debris.push({ key: `${e.key} ${gameTime}`, kind: `alien`, pos: { ...e.pos }, vel: { ...e.vel } });\r\n            } else {\r\n                projectilesState.debris.push({ key: `${e.key} ${gameTime}`, kind: `kitten`, pos: { ...e.pos }, vel: { ...e.vel } });\r\n            }\r\n        }\r\n    }));\r\n\r\n    // Enemies - Enemies (bounce)\r\n    const radiusSq_enemies = radius * radius * 1.5 * 1.5;\r\n    enemies.forEach((e, i) => enemies.forEach((e2, i2) => {\r\n\r\n        if (i >= i2) { return; }\r\n        if (e.explodeTime) { return; }\r\n        if (e2.explodeTime) { return; }\r\n\r\n        if (getDistanceSq(e.pos, e2.pos) < radiusSq_enemies) {\r\n\r\n            // Transfer momentum\r\n            const frictionRatio = 0.95;\r\n            const swap = e.vel.y;\r\n            e.vel.y = e2.vel.y * frictionRatio;\r\n            e2.vel.y = swap * frictionRatio;\r\n            // }\r\n\r\n            // if (getDistanceSq(e.pos, e2.pos) < radiusSq_enemies * 0.8 * 0.8) {\r\n            // Move apart\r\n            const a = e.pos.y < e2.pos.y ? e : e2;\r\n            const b = e.pos.y < e2.pos.y ? e2 : e;\r\n\r\n            a.pos.y -= 10 * gameDeltaTime;\r\n            b.pos.y += 10 * gameDeltaTime;\r\n            a.vel.y -= 10 * gameDeltaTime;\r\n            b.vel.y += 10 * gameDeltaTime;\r\n        }\r\n    }));\r\n\r\n    // Enemies - Player\r\n    const radiusSq_player = radius * radius * 0.8 * 0.8;\r\n    enemies.forEach((e, i) => {\r\n        if (e.explodeTime) { return; }\r\n        if (gameState.deadTime || gameState.gameOverTime) { return; }\r\n\r\n        if (getDistanceSq(e.pos, playerPosition) < radiusSq_player) {\r\n            onLoseLife();\r\n\r\n            // e.explodeTime = gameTime;\r\n            // e.onHit();\r\n\r\n            return;\r\n        }\r\n    });\r\n\r\n    // Enemies move\r\n    enemies.forEach(e => {\r\n        if (e.explodeTime) { return; }\r\n\r\n        e.vel.y += (-1 + 2 * Math.random()) * 250 * gameDeltaTime;\r\n        // e.vel.x += -3 * gameDeltaTime;\r\n\r\n        if (!gameState.deadTime && !gameState.gameOverTime) {\r\n            e.vel.x = -25;\r\n        } else {\r\n            e.vel.x = 0;\r\n        }\r\n\r\n        // Move away from ground\r\n        if (e.pos.y > gameStyles.viewscreenView.height * 0.7) {\r\n            // e.vel.y += -100 * gameDeltaTime;\r\n            e.vel.y = -5;\r\n        }\r\n\r\n        // Keep on screen\r\n        if (e.pos.x > gameStyles.viewscreenView.width - gameStyles.sprite.viewSize.width * 2) {\r\n            e.pos.x = gameStyles.viewscreenView.width - gameStyles.sprite.viewSize.width * 2;\r\n        }\r\n\r\n        e.pos.x += e.vel.x * gameDeltaTime;\r\n        e.pos.y += e.vel.y * gameDeltaTime;\r\n\r\n        const pad = gameStyles.sprite.viewSize.height * 0.5;\r\n        const h = gameStyles.viewscreenView.height;\r\n        if (e.pos.y < pad) { e.pos.y = pad; e.vel.y = 5; }\r\n        if (e.pos.y > h - pad) { e.pos.y = h - pad; e.vel.y = -e.vel.y; }\r\n\r\n        const wPad = gameStyles.sprite.viewSize.width * 0.5;\r\n        if (e.pos.x < wPad) {\r\n            e.pos.x = wPad;\r\n        }\r\n\r\n        // // Attack player\r\n        // if (e.pos.x < playerPosition.x) {\r\n        //     e.pos.y = playerPosition.y;\r\n        //     // e.vel.y = (playerPosition.y - e.pos.y) * 5;\r\n        // }\r\n    });\r\n\r\n    // Closest Enemy\r\n    const closestEnemyToPlayer = enemiesState.enemies.filter(x => !x.explodeTime && !x.destroyed)\r\n        .sort((a, b) => Math.abs(a.pos.y - playerPosition.y) < Math.abs(b.pos.y - playerPosition.y) ? -1 : 1)[0];\r\n\r\n    const updateWeaponsLock = (enemy: typeof enemiesState.enemies[0]) => {\r\n        // Only update on player movement\r\n        if (gameState.weaponsLock?.lockedAtPlayerPosition.y === playerPosition.y) {\r\n            return;\r\n        }\r\n\r\n        gameState.weaponsLock = {\r\n            lockedAtPlayerPosition: playerPosition,\r\n            lockedEnemy: enemy,\r\n        };\r\n    };\r\n\r\n    // Attack Player\r\n    if (closestEnemyToPlayer?.pos.x < playerPosition.x + gameStyles.sprite.viewSize.width * 0.5) {\r\n        closestEnemyToPlayer.pos.y = playerPosition.y;\r\n    } else {\r\n        // Lock on Enemy\r\n        updateWeaponsLock(closestEnemyToPlayer);\r\n    }\r\n\r\n    // Cleanup\r\n    const newEnemies = enemies;\r\n    newEnemies.filter(x => x.explodeTime && gameTime > 1 + x.explodeTime).forEach(x => {\r\n        x.destroyed = true;\r\n\r\n    });\r\n    // // Remove exploded\r\n    // .filter(x => !x.explodeTime || gameTime < 1 + x.explodeTime)\r\n    // ;\r\n\r\n    return {\r\n        enemies: newEnemies,\r\n    };\r\n};\r\n\r\ntype SpriteKind = 'text' | 'player' | 'player-character' | 'player-character-splat' | 'shot' | 'shot-explode' | 'lock' | 'enemy' | 'enemy-explode' | 'answer-wrong' | 'alien' | 'kitten' | 'alien-splat' | 'kitten-splat' | 'super-kitten' | 'life';\r\nconst getSpriteEmoji = (kind: SpriteKind) => {\r\n    // \r\n    // \r\n    // \r\n    // \r\n    // \r\n    switch (kind) {\r\n        case `player`: return { text: ``, rotation: +0.125, offsetX: 0, offsetY: -0.25 };\r\n        case `player-character`: return { text: `` };\r\n        case `player-character-splat`: return { text: ``, rotation: 0.15 };\r\n        case `shot`: return { text: ``, rotation: -0.25 };\r\n        case `shot-explode`: return { text: ``, rotation: 0, scale: 0.5 };\r\n        case `lock`: return { text: ``, offsetX: -0.25, offsetY: -0.125, scale: 1.5 };\r\n        case `enemy`: return { text: ``, offsetX: -0.125, offsetY: -0.125 };\r\n        case `enemy-explode`: return { text: ``, offsetX: -0.125, offsetY: -0.125 };\r\n        case `answer-wrong`: return { text: ``, offsetX: -0.125, offsetY: -0.125 };\r\n        case `alien`: return { text: ``, offsetX: 0, offsetY: 0 };\r\n        // case `kitten`: return { text: ``, offsetX: 0, offsetY: 0 };\r\n        case `kitten`: return { text: ``, offsetX: 0, offsetY: 0 };\r\n        case `alien-splat`: return { text: ``, offsetX: 0, offsetY: 0 };\r\n        case `kitten-splat`: return { text: ``, offsetX: 0, offsetY: 0 };\r\n        case `super-kitten`: return { text: ``, offsetX: 0, offsetY: 0 };\r\n        // case `kitten-splat`: return { text: ``, offsetX: 0, offsetY: 0 };\r\n        case `life`: return { text: ``, scale: 0.5 };\r\n        case `text`: return { text: ``, offsetX: 0, offsetY: -0.125 };\r\n        default: return { text: `` };\r\n    }\r\n};\r\n\r\nconst Sprite = ({ kind, position, text }: { kind: SpriteKind, position: { x: number, y: number, rotation: number }, text?: string }) => {\r\n    const s = getSpriteEmoji(kind);\r\n    const size = gameStyles.sprite.viewSize;\r\n    const { fontSize } = gameStyles.sprite.text;\r\n\r\n    const stylePosition = {\r\n        position: `absolute`,\r\n        ...size,\r\n        transform: `translate(${position.x}px, ${position.y}px) rotate(${position.rotation ?? 0}turn)`,\r\n        // backgroundColor: `red`,\r\n        pointerEvents: `none`,\r\n    } as const;\r\n    const styleRotation = {\r\n        ...size,\r\n        transform: `translate( ${size.width * -0.5 + Math.floor((s.offsetX ?? 0) * fontSize)}px, ${size.height * -0.5 + Math.floor((s.offsetY ?? 0) * fontSize)}px) rotate(${s.rotation ?? 0}turn) scale(${s.scale ?? 1})`,\r\n    };\r\n    return (\r\n        <View style={stylePosition}>\r\n            <View style={styleRotation}>\r\n                <Text style={gameStyles.sprite.text}>{text ?? s.text}</Text>\r\n            </View>\r\n        </View>\r\n    );\r\n};\r\n\r\nconst TextPositioned = ({ text, position }: { text: string, position: { x: number, y: number, rotation: number } }) => {\r\n    const s = gameStyles.answer.text;\r\n    const fontSize = text.length > 10 ? s.fontSize_small : s.fontSize;\r\n\r\n    const offsetY = -fontSize * 0.5 - 4;\r\n\r\n    const stylePosition = {\r\n        position: `absolute`,\r\n        transform: `translate(${position.x}px, ${position.y + offsetY}px) rotate(${position.rotation ?? 0}turn)`,\r\n        pointerEvents: `none`,\r\n        maxWidth: gameStyles.viewscreenView.width * 0.5,\r\n        // backgroundColor: `red`,\r\n    } as const;\r\n\r\n    return (\r\n        <View style={stylePosition}>\r\n            <Text style={{ ...gameStyles.answer.text, fontSize }}>{text}</Text>\r\n        </View>\r\n    );\r\n};\r\n","import React, { useState } from 'react';\r\nimport { View, Text, TouchableOpacity, TextInput } from 'react-native-lite';\r\n\r\n\r\nexport const createLeaderboard = <TScoreState extends {}>(args: {\r\n    storageKey: string;\r\n    sortKey: (item: TScoreState) => string | number;\r\n    sortDescending?: boolean;\r\n    scoreColumns: { name: string, getValue: (item: TScoreState) => string }[];\r\n}) => {\r\n\r\n    type LeaderboardScore = { name: string, score: TScoreState };\r\n    const leaderboard = {\r\n        saveScore: (name: string, score: TScoreState) => {\r\n            const data = leaderboard.loadScore();\r\n\r\n            data.push({ name, score });\r\n            data.sort((a, b) => args.sortKey(a.score) < args.sortKey(b.score) ? -1 : 1);\r\n\r\n            localStorage.setItem(args.storageKey, JSON.stringify(data));\r\n        },\r\n        loadScore: () => {\r\n            const json = localStorage.getItem(args.storageKey);\r\n            if (!json) { return []; }\r\n\r\n            const data = JSON.parse(json) as LeaderboardScore[];\r\n            data.sort((a, b) => (args.sortKey(a.score) > args.sortKey(b.score) ? -1 : 1) * (args.sortDescending ? -1 : 1));\r\n            return data;\r\n        },\r\n    };\r\n\r\n    const leaderboardInputStyles = {\r\n        container: {\r\n            flex: 1,\r\n            alignItems: `center`,\r\n            margin: 16,\r\n        },\r\n        textInput: {\r\n            fontFamily: `\"Lucida Console\", Monaco, monospace`,\r\n            fontSize: 16,\r\n            color: `#0000FF`,\r\n        },\r\n        buttonView: {\r\n            margin: 4,\r\n            padding: 4,\r\n            borderColor: `#FFFF00`,\r\n            borderStyle: `solid`,\r\n            borderWidth: 1,\r\n            borderRadius: 4,\r\n        },\r\n        buttonText: {\r\n            fontFamily: `\"Lucida Console\", Monaco, monospace`,\r\n            fontSize: 16,\r\n            color: `#FFFF00`,\r\n        },\r\n    } as const;\r\n\r\n    const LeaderboardNameInput = (props: { onSubmit: (value: string) => void }) => {\r\n        const [name, setName] = useState(``);\r\n        return (\r\n            <View style={leaderboardInputStyles.container}>\r\n                <TextInput style={leaderboardInputStyles.textInput} value={name} onChange={setName} placeholder='Name' keyboardType='default' autoCompleteType='off' />\r\n                <TouchableOpacity onPress={() => !!name && props.onSubmit(name)} style={!name ? { opacity: 0.5 } : {}}>\r\n                    <View style={leaderboardInputStyles.buttonView}>\r\n                        <Text style={leaderboardInputStyles.buttonText}>Save Score</Text>\r\n                    </View>\r\n                </TouchableOpacity>\r\n            </View >\r\n        );\r\n    };\r\n\r\n    const leaderboardStyles = {\r\n        container: {\r\n            marginTop: 16,\r\n            borderColor: `#FFFFFF`,\r\n            borderStyle: `solid`,\r\n            borderWidth: 1,\r\n            borderRadius: 0,\r\n        },\r\n        scoreView: {\r\n            flexDirection: `row`,\r\n            justifyContent: `space-around`,\r\n            padding: 4,\r\n            borderColor: `#FFFFFF`,\r\n            borderStyle: `solid`,\r\n            borderWidth: 1,\r\n            borderRadius: 0,\r\n        },\r\n        nameText: {\r\n            flex: 2,\r\n            fontFamily: `\"Lucida Console\", Monaco, monospace`,\r\n            fontSize: 12,\r\n            color: `#FFFFFF`,\r\n            overflow: `hidden`,\r\n        },\r\n        scoreText: {\r\n            flex: 1,\r\n            textAlign: `right`,\r\n            fontFamily: `\"Lucida Console\", Monaco, monospace`,\r\n            fontSize: 12,\r\n            color: `#FFFF00`,\r\n        },\r\n    } as const;\r\n\r\n    const LeaderboardViewInner = (props: { scores: LeaderboardScore[] }) => {\r\n\r\n        return (\r\n            <View style={leaderboardStyles.container}>\r\n                <View style={leaderboardStyles.scoreView}>\r\n                    <Text style={leaderboardStyles.nameText}>Leaderboard</Text>\r\n                    {args.scoreColumns.map(x => (\r\n                        <Text key={x.name} style={leaderboardStyles.scoreText} />\r\n                    ))}\r\n                </View>\r\n                <View style={leaderboardStyles.scoreView}>\r\n                    <Text style={leaderboardStyles.nameText}>Name</Text>\r\n                    {args.scoreColumns.map(x => (\r\n                        <Text key={x.name} style={leaderboardStyles.scoreText} >{x.name}</Text>\r\n                    ))}\r\n                </View>\r\n                {props.scores.map(x => (\r\n                    <View style={leaderboardStyles.scoreView}>\r\n                        <Text style={leaderboardStyles.nameText}>{x.name}</Text>\r\n                        {args.scoreColumns.map(c => (\r\n                            <Text key={x.name} style={leaderboardStyles.scoreText} >{c.getValue(x.score)}</Text>\r\n                        ))}\r\n                    </View>\r\n                ))}\r\n            </View>\r\n        );\r\n    };\r\n\r\n    const useLeaderboard = ({\r\n        getScore,\r\n    }: {\r\n        getScore: () => TScoreState;\r\n    }) => {\r\n\r\n        const [leaderboardScores, setLeaderboardScores] = useState({ scores: leaderboard.loadScore() } as { scores: LeaderboardScore[] });\r\n\r\n        const LeaderboardArea = (props: { gameOver: boolean, onScoreSaved: () => void }) => {\r\n\r\n            const onSaveScore = (name: string) => {\r\n                leaderboard.saveScore(name, getScore());\r\n                setLeaderboardScores({ scores: leaderboard.loadScore() });\r\n                props.onScoreSaved();\r\n            };\r\n\r\n            return (\r\n                <>\r\n                    {!!props.gameOver && (<LeaderboardNameInput onSubmit={onSaveScore} />)}\r\n                    <LeaderboardViewInner scores={leaderboardScores.scores} />\r\n                </>\r\n            );\r\n        };\r\n\r\n        return {\r\n            LeaderboardArea,\r\n        };\r\n    };\r\n\r\n\r\n    return {\r\n        useLeaderboard,\r\n    };\r\n};\r\n","import { ApiError } from './error';\r\n\r\nexport function fetchWithTimeout(url: string, options: RequestInit, timeout = 10000): Promise<Response> {\r\n    return Promise.race([\r\n        fetch(url, options),\r\n        new Promise((resolve, reject) =>\r\n            setTimeout(() => reject(new ApiError(`Fetch Timeout`)), timeout),\r\n        ) as Promise<Response>,\r\n    ]);\r\n}\r\n\r\nexport async function webRequest(url: string, data: unknown, options?: { method: 'POST' | 'PUT' }) {\r\n\r\n    const body = JSON.stringify(data);\r\n    const reqData: RequestInit = {\r\n        method: options?.method ?? `POST`,\r\n        headers: {\r\n            'Accept': `application/json`,\r\n            'Content-Type': `application/json`,\r\n            'Content-Length': `${body.length}`,\r\n        },\r\n        body,\r\n    };\r\n    const result = await fetchWithTimeout(url, reqData).catch((error) => { throw new ApiError(`Request Failure`, { url, data, error }); });\r\n    if (!result.ok) {\r\n        throw new ApiError(`Api Error`, { data: (await result.json().catch(error => {/* Ignore Parse Error */ })) ?? {}, responseStatus: result.status, request: { url, data } });\r\n    }\r\n    const resultObj = await result.json().catch((error) => { throw new ApiError(`Request Parse Failure`, { url, data, error }); });\r\n    return resultObj;\r\n}\r\n","'use strict';\nvar toInteger = require('./_to-integer');\nvar defined = require('./_defined');\n\nmodule.exports = function repeat(count) {\n  var str = String(defined(this));\n  var res = '';\n  var n = toInteger(count);\n  if (n < 0 || n == Infinity) throw RangeError(\"Count can't be negative\");\n  for (;n > 0; (n >>>= 1) && (str += str)) if (n & 1) res += str;\n  return res;\n};\n","import React, { useState } from 'react';\r\nimport { View, Text, TouchableOpacity, Platform } from 'react-native-lite';\r\nimport { ProblemService } from '../problems/problems-service';\r\n\r\n\r\nconst subjectStyles = {\r\n    container: {\r\n        margin: 16,\r\n    },\r\n    header: {\r\n        view: {\r\n            margin: 4,\r\n        },\r\n        text: {\r\n            fontSize: 16,\r\n        },\r\n    },\r\n    section: {\r\n        view: {\r\n            margin: 4,\r\n            flexDirection: `row`,\r\n        },\r\n        text: {\r\n            fontSize: 16,\r\n        },\r\n    },\r\n} as const;\r\n\r\nexport const SubjectNavigator = (props: { problemService: ProblemService, onOpen: () => void, onClose: () => void, onSubjectNavigation: () => void }) => {\r\n\r\n    const [isExpanded, setIsExpanded] = useState(false);\r\n    const toggle = () => {\r\n        if (!isExpanded) {\r\n            props.onOpen();\r\n        }\r\n        if (isExpanded) {\r\n            props.onClose();\r\n        }\r\n        setIsExpanded(s => !s);\r\n    };\r\n\r\n    return (\r\n        <View style={subjectStyles.container}>\r\n            <TouchableOpacity onPress={toggle}>\r\n                <View style={subjectStyles.header.view}>\r\n                    <Text style={subjectStyles.header.text}>Sections</Text>\r\n                </View>\r\n            </TouchableOpacity>\r\n            {isExpanded && (\r\n                <View>\r\n                    {props.problemService.getSections().map(s => (\r\n                        <TouchableOpacity key={s.key} onPress={() => {\r\n                            console.log(`SubjectNavigator onSection`, { s });\r\n                            props.problemService.gotoSection(s);\r\n                            props.onSubjectNavigation();\r\n                            setIsExpanded(false);\r\n                            if (Platform.OS === `web`) {\r\n                                window.scrollTo(0, 0);\r\n                            }\r\n                        }}>\r\n                            <View style={subjectStyles.section.view}>\r\n                                <Text style={subjectStyles.section.text}>{s.isComplete ? `` : ``}</Text>\r\n                                <Text style={subjectStyles.section.text}>{s.name}</Text>\r\n                            </View>\r\n                        </TouchableOpacity>\r\n                    ))}\r\n                </View>\r\n            )}\r\n\r\n        </View>\r\n    );\r\n};\r\n","import { ProblemStateStorage, ProblemService } from './problems-service';\r\n\r\nexport const createProblemStateStorage = (storageKey: string): ProblemStateStorage => {\r\n    const storage: ProblemStateStorage = {\r\n        load: async <T>() => {\r\n            try {\r\n                return JSON.parse(localStorage.getItem(storageKey) ?? `error - NOT FOUND`) as T;\r\n            }\r\n            catch{\r\n                return null;\r\n            }\r\n        },\r\n        save: async (value) => {\r\n            localStorage.setItem(storageKey, JSON.stringify(value));\r\n        },\r\n    };\r\n    return storage;\r\n};\r\n\r\nexport const createAutoSavedProblemService = (problemSource: ProblemService, storageKey: string): ProblemService => {\r\n    const storage = createProblemStateStorage(storageKey);\r\n\r\n    // Load \r\n    (async () => await problemSource.load(storage))();\r\n\r\n    return {\r\n        ...problemSource,\r\n        recordAnswer: (problem, answer) => {\r\n            problemSource.recordAnswer(problem, answer);\r\n\r\n            if (problem.isLastOfSection) {\r\n                (async () => await problemSource.save(storage))();\r\n            }\r\n        },\r\n    };\r\n};\r\n","export { delay } from 'utils/delay';\r\nexport { randomIndex, randomItem } from 'utils/random';\r\nexport { getValuesAsItems } from 'utils/objects';\r\nexport { moveItem } from 'utils/arrays';\r\nexport const randomBinary = (length: number) => String.fromCharCode(...[...new Array(length)].map(x => Math.random() * (126 - 32) + 32));\r\n"],"sourceRoot":""}