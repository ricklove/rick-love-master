{"version":3,"sources":["webpack:///D:/Projects/rick-love-master/code/doodle/doodle-paths.ts","webpack:///D:/Projects/rick-love-master/code/doodle/doodle-storage.ts","webpack:///D:/Projects/rick-love-master/code/games/educational-games/utils/keyboard-simplified.tsx","webpack:///D:/Projects/rick-love-master/code/games/educational-games/doodle-game.tsx","webpack:///D:/Projects/rick-love-master/code/games/educational-games/doodle-subjects/doodle-spelling.tsx"],"names":["doodleStoragePaths","storageAccess","JSON","parse","localStorage","getItem","value","setItem","stringify","createDoodleDrawingStorageService","a","remoteDoodle","createSmartUploader","getUploadUrl","doodleUploadUrl","setUploadUrl","x","uploadApiUrl","uploadApiConfig","uploadUrlPrefix","remoteVotes","scoresUploadUrl","memory","doodles","doodleScores","doodleVotes","load","map","key","k","prompt","p","timestamp","t","drawing","d","decodeDoodleDrawing","voteTotals","forEach","toKeyValueArray","doodleKey","score","service","saveDrawing","doodle","substr","Date","now","Math","floor","random","push","setTimeout","save","encodeDoodleDrawing","saveBestDrawingSelection","find","getDrawings","options","includeOtherPrompts","maxCount","samePromptDrawings","filter","otherPromptDrawings","allDrawings","randomItem","shuffle","slice","drawings","englishKeyboard","rows","keys","split","styles","container","rowView","flex","flexDirection","keyView","margin","padding","width","height","backgroundColor","justifyContent","alignItems","keyView_disabled","opacity","keyText","fontSize","keyText_wrong","color","KeyboardSimplified","expectedCharacter","showHints","onExpectedKeyPress","keyboard","useState","hintKeys","setHintKeys","wrongKeys","setWrongKeys","useEffect","hints","flatMap","trim","style","row","iRow","i","outline","onPress","s","includes","drawingChoicesView","maxWidth","flexWrap","drawingChoiceWrapper","drawingChoice","titleView","titleText","promptView","promptText","buttonView","buttonText","EducationalGame_Doodle","props","problemSourceKey","setProblemSourceKey","problemService","onOpen","onClose","onSubjectNavigation","EducationalGame_Doodle_Inner","problem","setProblem","mode","setMode","setDrawings","useRef","answers","isCorrect","current","gotoNextProblem","getNextProblem","question","gotoTypeMode","onQuestion","useAutoLoadingError","doWork","loading","error","stopIfObsolete","drawingStorage","result","gotoDrawPromptMode","gotoChooseBestMode","length","onDone","onChooseBest","segments","DoodleGameView_DrawWord","defaultDoodleDrawing","setDrawing","onChange","DoodleGameView_ChooseBest","typeStyles","completedText","DoodleGameView_Type","completed","remaining","status","setStatus","nextChar","EducationalGame_Doodle_Spelling","speechService","createSpeechService","Platform","OS","hasStarted","setHasStarted","languange","onClick","speak","alignSelf","size","createAutoSavedProblemService","createReviewProblemService","createSpellingProblemService","sectionSize"],"mappings":"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","file":"20-da54ce4375fc33bf4984.js","sourcesContent":["export const doodleStoragePaths = {\r\n    doodleSummary: `doodle/summary`,\r\n    doodleDrawingsPrefix: `doodle/drawings`,\r\n    doodleVotesPrefix: `doodle/votes`,\r\n} as const;\r\n","import { randomItem } from 'utils/random';\r\nimport { shuffle } from 'utils/arrays';\r\nimport { UploadUrl } from 'upload-api/client/types';\r\nimport { uploadApiConfig } from 'upload-api/client/config';\r\nimport { createSmartUploader } from 'upload-api/client/uploader';\r\nimport { toKeyValueArray } from 'utils/objects';\r\nimport { DoodleDrawingStorageService, DoodleData, decodeDoodleDrawing, encodeDoodleDrawing, DoodleScoreVote, DoodleScore, DoodleUserDrawingDataJson, DoodleUserVotesDataJson } from './doodle';\r\nimport { doodleStoragePaths } from './doodle-paths';\r\n\r\ntype DoodleStorageData = {\r\n    doodleUploadUrl?: UploadUrl;\r\n    scoresUploadUrl?: UploadUrl;\r\n};\r\n\r\nconst storageAccess = {\r\n    load: (): null | DoodleStorageData => {\r\n        try {\r\n            return JSON.parse(localStorage.getItem(`doodleStorage`) ?? `NULL!{}`);\r\n        } catch{ return null; }\r\n    },\r\n    save: (value: DoodleStorageData) => {\r\n        localStorage.setItem(`doodleStorage`, JSON.stringify(value));\r\n    },\r\n};\r\n\r\n\r\nexport const createDoodleDrawingStorageService = async () => {\r\n\r\n    const remoteDoodle = createSmartUploader<DoodleUserDrawingDataJson>({\r\n        getUploadUrl: async () => storageAccess.load()?.doodleUploadUrl ?? null,\r\n        setUploadUrl: async (x) => storageAccess.save({ ...(storageAccess.load() ?? {}), doodleUploadUrl: x }),\r\n        uploadApiUrl: uploadApiConfig.uploadApiUrl,\r\n        uploadUrlPrefix: doodleStoragePaths.doodleDrawingsPrefix,\r\n    });\r\n    const remoteVotes = createSmartUploader<DoodleUserVotesDataJson>({\r\n        getUploadUrl: async () => storageAccess.load()?.scoresUploadUrl ?? null,\r\n        setUploadUrl: async (x) => storageAccess.save({ ...(storageAccess.load() ?? {}), scoresUploadUrl: x }),\r\n        uploadApiUrl: uploadApiConfig.uploadApiUrl,\r\n        uploadUrlPrefix: doodleStoragePaths.doodleVotesPrefix,\r\n    });\r\n\r\n    const memory = {\r\n        doodles: [] as DoodleData[],\r\n        doodleScores: [] as DoodleScore[],\r\n        doodleVotes: [] as DoodleScoreVote[],\r\n    };\r\n\r\n    // Load from server\r\n    memory.doodles = (await remoteDoodle.load())?.doodles.map(x => ({\r\n        key: x.k,\r\n        prompt: x.p,\r\n        timestamp: x.t,\r\n        drawing: x.d ? decodeDoodleDrawing(x.d) : (x as unknown as DoodleData).drawing,\r\n    })) ?? [];\r\n    memory.doodleVotes = (await remoteVotes.load())?.doodleVotes ?? [];\r\n    const voteTotals = {} as { [key: string]: number };\r\n    memory.doodleVotes.forEach(x => { voteTotals[x.k] = (voteTotals[x.k] ?? 0) + 1; });\r\n    memory.doodleScores = toKeyValueArray(voteTotals).map(x => ({\r\n        doodleKey: x.key,\r\n        score: x.value,\r\n    }));\r\n\r\n    const service: DoodleDrawingStorageService = {\r\n        saveDrawing: async (prompt, drawing) => {\r\n            const doodle = { key: `${prompt.substr(0, 8)}:${Date.now()}:${Math.floor(Math.random() * 999999)}`, drawing, prompt, timestamp: Date.now() };\r\n            memory.doodles.push(doodle);\r\n\r\n            // Save to server\r\n            setTimeout(async () => {\r\n                await remoteDoodle.save({\r\n                    doodles: memory.doodles.map(x => ({\r\n                        k: x.key,\r\n                        p: x.prompt,\r\n                        t: x.timestamp,\r\n                        d: encodeDoodleDrawing(x.drawing),\r\n                    })),\r\n                });\r\n            });\r\n        },\r\n        saveBestDrawingSelection: async (doodle) => {\r\n            memory.doodleVotes.push({\r\n                k: doodle.key,\r\n                t: Date.now(),\r\n            });\r\n\r\n            let d = memory.doodleScores.find(x => x.doodleKey === doodle.key);\r\n            if (!d) {\r\n                d = {\r\n                    doodleKey: doodle.key,\r\n                    score: 0,\r\n                };\r\n                memory.doodleScores.push(d);\r\n            }\r\n            d.score = (d.score ?? 0) + 1;\r\n\r\n            // Save to server\r\n            setTimeout(async () => {\r\n                await remoteVotes.save({\r\n                    doodleVotes: memory.doodleVotes,\r\n                });\r\n            });\r\n        },\r\n        getDrawings: async (prompt, options) => {\r\n            const {\r\n                includeOtherPrompts = false,\r\n                maxCount = 4,\r\n            } = options ?? {};\r\n\r\n            const samePromptDrawings = memory.doodles.filter(x => x.prompt === prompt);\r\n            const otherPromptDrawings = includeOtherPrompts ? memory.doodles.filter(x => x.prompt !== prompt) : [];\r\n            const allDrawings =\r\n                includeOtherPrompts ? [randomItem(samePromptDrawings), ...shuffle(otherPromptDrawings).slice(0, maxCount - 1)]\r\n                    : samePromptDrawings;\r\n            const drawings = shuffle(allDrawings).slice(0, maxCount);\r\n            return { doodles: drawings };\r\n        },\r\n    };\r\n\r\n    return service;\r\n};\r\n","/* eslint-disable react/no-array-index-key */\r\nimport React, { useEffect, useState } from 'react';\r\nimport { View, Text, TouchableOpacity } from 'react-native-lite';\r\nimport { shuffle } from 'utils/arrays';\r\n\r\nconst englishKeyboard = {\r\n    rows: [\r\n        { keys: `qwertyuiop`.split(``) },\r\n        { keys: ` asdfghjkl`.split(``) },\r\n        { keys: `  zxcvbnm `.split(``) },\r\n    ],\r\n};\r\n\r\nconst styles = {\r\n    container: {},\r\n    rowView: { flex: 1, flexDirection: `row` },\r\n    keyView: {\r\n        margin: 2,\r\n        padding: 2,\r\n        width: 20,\r\n        height: 20,\r\n        backgroundColor: `#111111`,\r\n        justifyContent: `center`,\r\n        alignItems: `center`,\r\n    },\r\n    keyView_disabled: { opacity: 0.5 },\r\n    keyText: {\r\n        fontSize: 16,\r\n    },\r\n    keyText_wrong: {\r\n        fontSize: 16,\r\n        color: `#FF0000`,\r\n    },\r\n} as const;\r\n\r\nexport const KeyboardSimplified = ({ expectedCharacter, showHints, onExpectedKeyPress }: { expectedCharacter: string, showHints: boolean, onExpectedKeyPress: () => void }) => {\r\n    const keyboard = englishKeyboard;\r\n\r\n    const [hintKeys, setHintKeys] = useState(null as null | string[]);\r\n    const [wrongKeys, setWrongKeys] = useState([] as string[]);\r\n    useEffect(() => {\r\n        if (!showHints) { setHintKeys(null); }\r\n\r\n        const hints = [expectedCharacter, ...shuffle(keyboard.rows.flatMap(x => x.keys).map(x => x.trim()).filter(x => x)).slice(0, 3)];\r\n        setHintKeys(hints);\r\n        setWrongKeys([]);\r\n    }, [expectedCharacter, showHints]);\r\n\r\n    const onKeyPress = (key: string) => {\r\n        if (key === expectedCharacter) {\r\n            onExpectedKeyPress();\r\n            return;\r\n        }\r\n        // Remove from choices\r\n        if (showHints) {\r\n            setHintKeys(s => (s ?? []).filter(x => x !== key));\r\n            setWrongKeys(s => [...s, key]);\r\n        }\r\n    };\r\n\r\n    return (\r\n        <>\r\n            <View style={styles.container}>\r\n                {keyboard.rows.map((row, iRow) => (\r\n                    <View style={styles.rowView} key={`${iRow}`} >\r\n                        {row.keys.map((k, i) => (\r\n                            <TouchableOpacity key={`${k}${i}`} style={{ outline: `none` }} onPress={() => onKeyPress(k)}>\r\n                                <View style={!hintKeys || hintKeys.includes(k) ? {} : styles.keyView_disabled} >\r\n                                    <View style={styles.keyView}>\r\n                                        <Text style={wrongKeys.includes(k) ? styles.keyText_wrong : styles.keyText}>{k}</Text>\r\n                                    </View>\r\n                                </View>\r\n                            </TouchableOpacity>\r\n                        ))}\r\n                    </View>\r\n                ))}\r\n            </View>\r\n        </>\r\n    );\r\n};\r\n","import React, { useState, useEffect, useRef } from 'react';\r\nimport { DoodleDisplayView, DoodleDrawerView } from 'doodle/doodle-view';\r\nimport { defaultDoodleDrawing, DoodleDrawing, DoodleData, DoodleDrawingStorageService } from 'doodle/doodle';\r\nimport { View, Text, TouchableOpacity } from 'react-native-lite';\r\nimport { useAutoLoadingError } from 'utils-react/hooks';\r\nimport { ProblemService, Problem } from './problems/problems-service';\r\nimport { SubjectNavigator } from './utils/subject-navigator';\r\nimport { KeyboardSimplified } from './utils/keyboard-simplified';\r\n\r\nexport const styles = {\r\n    container: {\r\n        alignItems: `center`,\r\n    },\r\n    drawing: {\r\n        width: 312,\r\n        height: 312,\r\n        color: `#FFFFFF`,\r\n        backgroundColor: `#000000`,\r\n    },\r\n    drawingChoicesView: {\r\n        maxWidth: 312 + 4 * 4 + 4,\r\n        flexDirection: `row`,\r\n        flexWrap: `wrap`,\r\n    },\r\n    drawingChoiceWrapper: {\r\n        padding: 4,\r\n    },\r\n    drawingChoice: {\r\n        width: 78,\r\n        height: 78,\r\n        color: `#FFFFFF`,\r\n        backgroundColor: `#000000`,\r\n    },\r\n    titleView: {\r\n        justifyContent: `center`,\r\n        alignItems: `center`,\r\n    },\r\n    titleText: {\r\n        fontSize: 20,\r\n        color: `#FFFFFF`,\r\n    },\r\n    promptView: {\r\n        justifyContent: `center`,\r\n        alignItems: `center`,\r\n    },\r\n    promptText: {\r\n        fontSize: 20,\r\n        color: `#FFFF00`,\r\n    },\r\n    buttonView: {\r\n        padding: 8,\r\n        backgroundColor: `#111111`,\r\n    },\r\n    buttonText: {\r\n        fontSize: 20,\r\n        color: `#FFFF00`,\r\n    },\r\n} as const;\r\n\r\n\r\nexport const EducationalGame_Doodle = (props: { problemService: ProblemService, drawingStorage: DoodleDrawingStorageService }) => {\r\n    const [problemSourceKey, setProblemSourceKey] = useState(0);\r\n\r\n    return (<>\r\n        <EducationalGame_Doodle_Inner {...props} problemSourceKey={problemSourceKey} />\r\n        <SubjectNavigator problemService={props.problemService}\r\n            onOpen={() => { }}\r\n            onClose={() => { }}\r\n            onSubjectNavigation={() => { setProblemSourceKey(s => s + 1); }}\r\n        />\r\n    </>);\r\n};\r\n\r\nexport const EducationalGame_Doodle_Inner = (props: { problemService: ProblemService, drawingStorage: DoodleDrawingStorageService, problemSourceKey: number }) => {\r\n\r\n    const [problem, setProblem] = useState(null as null | Problem);\r\n    const [mode, setMode] = useState(`type` as 'type' | 'drawPrompt' | 'chooseCorrect' | 'chooseBest');\r\n    const [drawings, setDrawings] = useState(null as null | DoodleData[]);\r\n    const prompt = useRef(problem?.answers.find(x => x.isCorrect)?.value ?? ``);\r\n    prompt.current = problem?.answers.find(x => x.isCorrect)?.value ?? ``;\r\n\r\n    const gotoNextProblem = () => {\r\n        const p = props.problemService.getNextProblem();\r\n        if (!p.question) { return; }\r\n        setProblem(p);\r\n        setTimeout(gotoTypeMode);\r\n        p.onQuestion?.();\r\n    };\r\n\r\n    useEffect(() => {\r\n        gotoNextProblem();\r\n    }, [props.problemSourceKey]);\r\n\r\n    const { loading, error, doWork } = useAutoLoadingError();\r\n\r\n    const gotoTypeMode = () => {\r\n        doWork(async (stopIfObsolete) => {\r\n            const result = await props.drawingStorage.getDrawings(prompt.current);\r\n            setDrawings(result.doodles);\r\n            setMode(`type`);\r\n        });\r\n    };\r\n\r\n    const onTypeDone = () => {\r\n        doWork(async (stopIfObsolete) => {\r\n            setTimeout(gotoDrawPromptMode);\r\n        });\r\n    };\r\n\r\n    const gotoDrawPromptMode = () => {\r\n        setMode(`drawPrompt`);\r\n    };\r\n\r\n    const onDrawingDone = (drawing: DoodleDrawing) => {\r\n        // props.onDone(drawing);\r\n\r\n        // Save drawing with word prompt\r\n        doWork(async (stopIfObsolete) => {\r\n            if (drawing.segments.length > 0) {\r\n                await props.drawingStorage.saveDrawing(prompt.current, drawing);\r\n            }\r\n            stopIfObsolete();\r\n            setTimeout(gotoChooseBestMode);\r\n        });\r\n    };\r\n\r\n    const gotoChooseBestMode = () => {\r\n        doWork(async (stopIfObsolete) => {\r\n            const result = await props.drawingStorage.getDrawings(prompt.current);\r\n            stopIfObsolete();\r\n\r\n            if (result.doodles.length <= 1) {\r\n                gotoNextProblem();\r\n                return;\r\n            }\r\n\r\n            setDrawings(result.doodles);\r\n            setMode(`chooseBest`);\r\n        });\r\n    };\r\n\r\n    const onChooseBest = (value: DoodleData) => {\r\n        doWork(async (stopIfObsolete) => {\r\n            await props.drawingStorage.saveBestDrawingSelection(value);\r\n            stopIfObsolete();\r\n            gotoNextProblem();\r\n        });\r\n    };\r\n\r\n\r\n    if (!problem) {\r\n        return (\r\n            <>\r\n            </>\r\n        );\r\n    }\r\n\r\n    if (mode === `type`) {\r\n        return (\r\n            <>\r\n                <DoodleGameView_Type prompt={prompt.current} drawings={drawings ?? []} onDone={onTypeDone} />\r\n            </>\r\n        );\r\n    }\r\n\r\n    if (mode === `chooseBest` && drawings) {\r\n        return (\r\n            <>\r\n                <DoodleGameView_ChooseBest prompt={prompt.current} drawings={drawings} onChooseBest={onChooseBest} />\r\n            </>\r\n        );\r\n    }\r\n\r\n    return (\r\n        <>\r\n            <DoodleGameView_DrawWord prompt={prompt.current} onDone={onDrawingDone} />\r\n            {/* <DoodleDisplayView style={styles.drawing} drawing={defaultDoodleDrawing()} /> */}\r\n        </>\r\n    );\r\n};\r\n\r\nexport const DoodleGameView_DrawWord = (props: { prompt: string, onDone: (drawing: DoodleDrawing) => void }) => {\r\n    const [drawing, setDrawing] = useState(defaultDoodleDrawing());\r\n    const changeDoodle = (value: DoodleDrawing) => {\r\n        setDrawing(value);\r\n    };\r\n\r\n    const done = () => {\r\n        props.onDone(drawing);\r\n    };\r\n\r\n    useEffect(() => {\r\n        // Reset problem when prompt changes\r\n        setDrawing(defaultDoodleDrawing());\r\n    }, [props.prompt]);\r\n\r\n    return (\r\n        <View style={styles.container}>\r\n            <View style={styles.titleView}>\r\n                <Text style={styles.titleText}>Draw</Text>\r\n            </View>\r\n            <DoodleDrawerView style={styles.drawing} drawing={drawing} onChange={changeDoodle} />\r\n            <View style={styles.promptView}>\r\n                <Text style={styles.promptText}>{props.prompt}</Text>\r\n            </View>\r\n            <TouchableOpacity onPress={done}>\r\n                <View style={styles.buttonView}>\r\n                    <Text style={styles.buttonText}>Done</Text>\r\n                </View>\r\n            </TouchableOpacity>\r\n        </View>\r\n    );\r\n};\r\n\r\nexport const DoodleGameView_ChooseBest = (props: { prompt: string, drawings: DoodleData[], onChooseBest: (drawing: DoodleData) => void }) => {\r\n    return (\r\n        <View style={styles.container}>\r\n            <View style={styles.titleView}>\r\n                <Text style={styles.titleText}>Choose Best</Text>\r\n            </View>\r\n            <View style={styles.promptView}>\r\n                <Text style={styles.promptText}>{props.prompt}</Text>\r\n            </View>\r\n            <View style={styles.drawingChoicesView} >\r\n                {props.drawings.map(x => (\r\n                    <TouchableOpacity onPress={() => props.onChooseBest(x)}>\r\n                        <View style={styles.drawingChoiceWrapper} >\r\n                            <DoodleDisplayView style={styles.drawingChoice} drawing={x.drawing} />\r\n                        </View>\r\n                    </TouchableOpacity>\r\n                ))}\r\n            </View>\r\n        </View>\r\n    );\r\n};\r\n\r\nconst typeStyles = {\r\n    completedText: {\r\n        fontSize: 16,\r\n        color: `#FFFF00`,\r\n    },\r\n} as const;\r\nexport const DoodleGameView_Type = (props: { prompt: string, drawings: DoodleData[], onDone: () => void }) => {\r\n\r\n    const [status, setStatus] = useState({ completed: ``, remaining: props.prompt });\r\n    useEffect(() => {\r\n        setStatus({ completed: ``, remaining: props.prompt });\r\n    }, [props.prompt, props.drawings]);\r\n\r\n    const onExpectedKeyPress = () => {\r\n        setStatus(s => {\r\n            if (s.remaining.length <= 1) {\r\n                props.onDone();\r\n            }\r\n            const nextChar = s.remaining[0];\r\n            return {\r\n                completed: s.completed + nextChar,\r\n                remaining: s.remaining.substr(1),\r\n            };\r\n        });\r\n    };\r\n\r\n    return (\r\n        <View style={styles.container}>\r\n            <View style={styles.titleView}>\r\n                <Text style={styles.titleText}>Type Word</Text>\r\n            </View>\r\n            <View style={styles.drawingChoicesView} >\r\n                {props.drawings.map(x => (\r\n                    <View style={styles.drawingChoiceWrapper} >\r\n                        <DoodleDisplayView style={styles.drawingChoice} drawing={x.drawing} />\r\n                    </View>\r\n                ))}\r\n            </View>\r\n            <View>\r\n                <Text style={typeStyles.completedText}>{`${status.completed}${status.remaining.length > 0 ? `_` : ``}`}</Text>\r\n            </View>\r\n            <KeyboardSimplified expectedCharacter={status.remaining[0] ?? ` `} showHints onExpectedKeyPress={onExpectedKeyPress} />\r\n        </View>\r\n    );\r\n};\r\n","/* eslint-disable jsx-a11y/click-events-have-key-events */\r\n/* eslint-disable jsx-a11y/no-static-element-interactions */\r\nimport React, { useRef, useState, useEffect } from 'react';\r\nimport { Text, View, Platform, ActivityIndicator } from 'react-native-lite';\r\nimport { createDoodleDrawingStorageService } from 'doodle/doodle-storage';\r\nimport { DoodleDrawingStorageService } from 'doodle/doodle';\r\nimport { useAutoLoadingError } from 'utils-react/hooks';\r\nimport { EducationalGame_Doodle } from '../doodle-game';\r\nimport { createSpeechService } from '../utils/speech';\r\nimport { createReviewProblemService } from '../problems/problems-reviewer';\r\nimport { createSpellingProblemService } from '../problems/spelling/spelling-problem-service';\r\nimport { VoiceChooser } from '../utils/voice-chooser';\r\nimport { createAutoSavedProblemService } from '../problems/problem-state-storage';\r\n\r\nexport const EducationalGame_Doodle_Spelling = (props: {}) => {\r\n    const speechService = useRef(createSpeechService());\r\n    const [hasStarted, setHasStarted] = useState(Platform.OS !== `web`);\r\n\r\n    const { loading, error, doWork } = useAutoLoadingError();\r\n    const drawingStorage = useRef(null as null | DoodleDrawingStorageService);\r\n    useEffect(() => {\r\n        doWork(async (stopIfObsolete) => {\r\n            drawingStorage.current = await createDoodleDrawingStorageService();\r\n        });\r\n    }, []);\r\n\r\n    // Only web\r\n    if (!hasStarted) {\r\n        const speak = () => { speechService.current.speak(`Start`); setHasStarted(true); };\r\n        return (\r\n            <View>\r\n                <VoiceChooser languange='en' speechService={speechService.current} />\r\n                <div onClick={() => speak()}>\r\n                    <View style={{ height: 300, alignSelf: `center`, alignItems: `center`, justifyContent: `center` }}>\r\n                        <Text style={{ fontSize: 36 }}>Start</Text>\r\n                    </View>\r\n                </div>\r\n            </View>\r\n        );\r\n    }\r\n\r\n    if (loading || !drawingStorage.current) {\r\n        return (\r\n            <>\r\n                <ActivityIndicator size='large' color='#FFFF00' />\r\n            </>\r\n        );\r\n    }\r\n\r\n    return <EducationalGame_Doodle\r\n        problemService={createAutoSavedProblemService(createReviewProblemService(createSpellingProblemService({ speechService: speechService.current, sectionSize: 8 }), {}), `ProblemsSpellingDoodle`)}\r\n        drawingStorage={drawingStorage.current}\r\n    />;\r\n};\r\n"],"sourceRoot":""}