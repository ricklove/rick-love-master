{"version":3,"sources":["webpack:///D:/Projects/rick-love-master/code/games/educational-games/multiples-counting.tsx"],"names":["leaderboardService","createLeaderboard","storageKey","sortKey","x","timeMs","sortDescending","scoreColumns","name","getValue","toLocaleString","undefined","minimumFractionDigits","maximumFractionDigits","mistakes","EducationalGame_MultiplesCounting","props","useState","key","startTime","Date","now","gameWonTime","gameScore","setGameScore","createDefaultGameBoardState","gameBoard","setGameBoard","gameInput","setGameInput","lastGameBoard","useRef","leaderboard","useLeaderboard","getScore","onGameWon","s","onCorrect","value","newGameBoard","current","col","columns","find","multiple","maxTimesCorrect","times","setTimeout","nextInputState","onWrong","game","gameInputState","createGameInputState","useEffect","style","marginTop","marginBottom","padding","alignItems","width","GameScore","GameBoard","focus","GameInput","LeaderboardArea","gameOver","onScoreSaved","size","rows","Array","map","i","styles","cellView","height","backgroundColor","borderWidth","borderColor","borderStyle","justifyContent","focusCellView","cellHeaderView","focusCellHeaderView","cellText","fontFamily","fontSize","cellHeaderText","color","focusCellHeaderText","boardTick","setboardTick","id","setInterval","clearInterval","getBoardTickResult","flexDirection","r","c","borderLeftColor","borderRightColor","borderTopColor","borderBottomColor","includes","row","nextColumn","filter","buttons","m","t","correctValue","wrongValues","distinct","Math","round","random","slice","answers","shuffle","text","onPress","button","wasAnsweredWrong","onAnswer","inputStyles","outerContainer","container","margin","buttonView","buttonText","buttonText_wrong","y","setY","max","transform","scoreStyles","flex","mistakesText","timeMessage","setTimeMessage","mistakesMessage","setMistakesMessage"],"mappings":"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","file":"6-c3b4a5c61f08340f1b9a.js","sourcesContent":["import React, { useState, useEffect, useRef } from 'react';\r\nimport { View, Text, TouchableOpacity } from 'react-native-lite';\r\nimport { distinct, shuffle } from 'utils/arrays';\r\nimport { createLeaderboard } from './components/leaderboard';\r\n\r\n\r\nconst leaderboardService = createLeaderboard<{\r\n    mistakes: number;\r\n    timeMs: number;\r\n}>({\r\n    storageKey: `MultiplesCountingLeaderboard`,\r\n    sortKey: x => x.timeMs,\r\n    sortDescending: true,\r\n    scoreColumns: [\r\n        { name: `Time`, getValue: x => `${(x.timeMs / 1000).toLocaleString(undefined, { minimumFractionDigits: 1, maximumFractionDigits: 1 })}` },\r\n        { name: `Mistakes`, getValue: x => `${x.mistakes}` },\r\n    ],\r\n});\r\n\r\nexport const EducationalGame_MultiplesCounting = (props: {}) => {\r\n\r\n    const [gameScore, setGameScore] = useState({ key: 0, startTime: Date.now(), gameWonTime: undefined, mistakes: 0 } as GameScoreState & { key: number });\r\n    const [gameBoard, setGameBoard] = useState(createDefaultGameBoardState());\r\n    const [gameInput, setGameInput] = useState(null as null | GameInputState);\r\n    const lastGameBoard = useRef(gameBoard);\r\n\r\n    const leaderboard = leaderboardService.useLeaderboard({\r\n        getScore: () => ({ mistakes: gameScore.mistakes, timeMs: (gameScore.gameWonTime ?? Date.now()) - gameScore.startTime }),\r\n    });\r\n\r\n    const onGameWon = () => {\r\n        setGameScore(s => ({ ...s, gameWonTime: Date.now(), key: s.key + 1 }));\r\n    };\r\n\r\n    const onScoreSaved = () => {\r\n        // Restart Game\r\n        const newGameBoard = createDefaultGameBoardState();\r\n        setGameScore({ key: 0, startTime: Date.now(), gameWonTime: undefined, mistakes: 0 });\r\n        setGameBoard(newGameBoard);\r\n        nextInputState(newGameBoard);\r\n    };\r\n\r\n    const onCorrect = (value: { multiple: number, times: number }) => {\r\n        const newGameBoard = { ...lastGameBoard.current };\r\n        const col = newGameBoard.columns.find(x => x.multiple === value.multiple);\r\n        if (col) {\r\n            col.maxTimesCorrect = value.times;\r\n        };\r\n\r\n        setGameBoard(newGameBoard);\r\n        // setGameInput(null);\r\n\r\n        setTimeout(() => {\r\n            nextInputState(newGameBoard);\r\n        }, 100);\r\n    };\r\n    const onWrong = (value: { multiple: number, times: number }) => {\r\n        // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\r\n        setGameInput(s => ({ ...s! }));\r\n\r\n        setGameScore(s => ({ ...s, mistakes: s.mistakes + 1, key: s.key + 1 }));\r\n\r\n        // Reset column\r\n        // const newGameBoard = ({ ...gameBoard, columns: gameBoard.columns.map(x => x.multiple === value.multiple ? { maxTimesCorrect: 0, multiple: x.multiple } : x) });\r\n\r\n        // setGameBoard(newGameBoard);\r\n        // setGameInput(null);\r\n\r\n        // setTimeout(() => {\r\n        //     nextInputState(newGameBoard);\r\n        // }, 500);\r\n    };\r\n\r\n    const nextInputState = (game: GameBoardState) => {\r\n        const gameInputState = createGameInputState(game, onGameWon, onCorrect, onWrong);\r\n        setGameInput(gameInputState);\r\n    };\r\n\r\n    useEffect(() => {\r\n        nextInputState(gameBoard);\r\n    }, []);\r\n\r\n    lastGameBoard.current = gameBoard;\r\n\r\n    return (\r\n        <>\r\n            <View style={{ marginTop: 50, marginBottom: 150, padding: 2, alignItems: `center` }} >\r\n                <View style={{ width: 24 * 12 + 4 }}>\r\n                    <GameScore gameScore={gameScore} />\r\n                    <GameBoard gameBoard={gameBoard} focus={gameInput?.focus ?? { multiple: 0, times: 0 }} />\r\n                    {gameInput && !gameScore.gameWonTime && <GameInput gameInput={gameInput} />}\r\n                    <leaderboard.LeaderboardArea gameOver={!!gameScore.gameWonTime} onScoreSaved={onScoreSaved} />\r\n                </View>\r\n            </View>\r\n        </>\r\n    );\r\n};\r\n\r\n\r\ntype GameBoardState = {\r\n    size: number;\r\n    rows: { times: number }[];\r\n    columns: {\r\n        multiple: number;\r\n        maxTimesCorrect: number;\r\n    }[];\r\n};\r\n\r\nconst createDefaultGameBoardState = (): GameBoardState => {\r\n    const size = 12;\r\n    const gameBoard: GameBoardState = {\r\n        size,\r\n        rows: [...new Array(size)].map((x, i) => ({ times: i + 1 })),\r\n        columns: [...new Array(size)].map((x, i) => ({ multiple: i + 1, maxTimesCorrect: 0 })),\r\n    };\r\n\r\n    return gameBoard;\r\n};\r\n\r\nconst styles = {\r\n    cellView: {\r\n        width: 24,\r\n        height: 24,\r\n        backgroundColor: `rgba(0,0,0,0.75)`,\r\n        borderWidth: 1,\r\n        borderColor: `#111133`,\r\n        borderStyle: `solid`,\r\n        justifyContent: `center`,\r\n        alignItems: `center`,\r\n    },\r\n    focusCellView: {\r\n        width: 24,\r\n        height: 24,\r\n        borderWidth: 1,\r\n        borderColor: `#66FF66`,\r\n        borderStyle: `solid`,\r\n        justifyContent: `center`,\r\n        alignItems: `center`,\r\n    },\r\n    cellHeaderView: {\r\n        width: 24,\r\n        height: 24,\r\n        backgroundColor: `rgba(0,0,0,0.5)`,\r\n        borderWidth: 1,\r\n        borderColor: `#111133`,\r\n        borderStyle: `solid`,\r\n        justifyContent: `center`,\r\n        alignItems: `center`,\r\n    },\r\n    focusCellHeaderView: {\r\n        width: 24,\r\n        height: 24,\r\n        backgroundColor: `rgba(0,0,0,0.5)`,\r\n        borderWidth: 1,\r\n        borderColor: `#111133`,\r\n        borderStyle: `solid`,\r\n        justifyContent: `center`,\r\n        alignItems: `center`,\r\n    },\r\n    cellText: {\r\n        fontFamily: `\"Lucida Console\", Monaco, monospace`,\r\n        fontSize: 12,\r\n    },\r\n    cellHeaderText: {\r\n        fontFamily: `\"Lucida Console\", Monaco, monospace`,\r\n        fontSize: 12,\r\n        color: `#333300`,\r\n    },\r\n    focusCellHeaderText: {\r\n        fontFamily: `\"Lucida Console\", Monaco, monospace`,\r\n        fontSize: 12,\r\n        color: `#FFFF00`,\r\n    },\r\n} as const;\r\n\r\nconst GameBoard = ({ gameBoard, focus }: { gameBoard: GameBoardState, focus: { multiple: number, times: number } }) => {\r\n\r\n    const [boardTick, setboardTick] = useState(0);\r\n\r\n    useEffect(() => {\r\n        setboardTick(0);\r\n        const id = setInterval(() => {\r\n            setboardTick(s => s + 1);\r\n        }, 1000);\r\n        return () => clearInterval(id);\r\n    }, [/* Keep Going */]);\r\n\r\n    const getBoardTickResult = () => {\r\n        return boardTick % 5 === 0 ? `row` :\r\n            boardTick % 5 === 1 ? `col` :\r\n                `both`;\r\n    };\r\n\r\n    const getBorderStyle = () => {\r\n        const s = getBoardTickResult();\r\n\r\n        if (s === `both`) {\r\n            return {\r\n                borderLeftColor: styles.focusCellView.borderColor,\r\n                borderRightColor: styles.focusCellView.borderColor,\r\n                borderTopColor: styles.focusCellView.borderColor,\r\n                borderBottomColor: styles.focusCellView.borderColor,\r\n            } as const;\r\n        }\r\n\r\n        return {\r\n            borderLeftColor: !s.includes(`col`) ? `rgba(0,0,0,0.15)` : `#000000`,\r\n            borderRightColor: !s.includes(`col`) ? `rgba(0,0,0,0.15)` : `#000000`,\r\n            borderTopColor: !s.includes(`row`) ? `rgba(0,0,0,0.15)` : `#000000`,\r\n            borderBottomColor: !s.includes(`row`) ? `rgba(0,0,0,0.15)` : `#000000`,\r\n        } as const;\r\n    };\r\n\r\n    const getCellText = (col: number, row: number) => {\r\n        const s = getBoardTickResult();\r\n\r\n        if (s === `both`) {\r\n            return `${col * row}`;\r\n        }\r\n\r\n        return ``;\r\n        // if (s === `row`) {\r\n        //     return `${col}`;\r\n        // }\r\n\r\n        // return `${row}`;\r\n    };\r\n\r\n    return (\r\n        <>\r\n            <View style={{ flexDirection: `row` }} >\r\n                <View style={{ flexDirection: `column-reverse` }} >\r\n                    <View style={styles.focusCellHeaderView} >\r\n                        <Text style={styles.focusCellHeaderText} >x</Text>\r\n                    </View>\r\n                    {gameBoard.rows.map((r) => (\r\n                        <View key={r.times} style={focus.times === r.times ? styles.focusCellHeaderView : styles.cellHeaderView} >\r\n                            <Text style={focus.times === r.times ? styles.focusCellHeaderText : styles.cellHeaderText}>{`${r.times}`}</Text>\r\n                        </View>\r\n                    ))}\r\n                </View>\r\n\r\n                {gameBoard.columns.map((c) => (\r\n                    <View key={c.multiple} style={{ flexDirection: `column-reverse` }} >\r\n                        <View style={focus.multiple === c.multiple ? styles.focusCellHeaderView : styles.cellHeaderView} >\r\n                            <Text style={focus.multiple === c.multiple ? styles.focusCellHeaderText : styles.cellHeaderText}>{`${c.multiple}`}</Text>\r\n                        </View>\r\n                        {gameBoard.rows.map((r) => (\r\n                            <View key={r.times} style={focus.times >= r.times && focus.multiple >= c.multiple ? [styles.focusCellView, getBorderStyle()] : styles.cellView} >\r\n                                {c.maxTimesCorrect >= r.times ? (\r\n                                    <Text style={styles.cellText}>{`${getCellText(c.multiple, r.times)}`}</Text>\r\n                                ) : (\r\n                                        <Text style={styles.cellText} />\r\n                                    )}\r\n                            </View>\r\n                        ))}\r\n                    </View>\r\n                ))}\r\n\r\n            </View>\r\n        </>\r\n    );\r\n};\r\ntype GameInputState = {\r\n    key: string;\r\n    focus: { multiple: number, times: number };\r\n    buttons: {\r\n        value: number;\r\n        text: string;\r\n        onPress: () => void;\r\n        wasAnsweredWrong: boolean;\r\n    }[];\r\n};\r\n\r\nconst createGameInputState = (gameBoard: GameBoardState, onGameWon: () => void, onCorrect: (value: { multiple: number, times: number }) => void, onWrong: (value: { multiple: number, times: number }) => void): GameInputState => {\r\n    const nextColumn = gameBoard.columns.filter(x => x.maxTimesCorrect < gameBoard.size)[0];\r\n    if (!nextColumn) {\r\n        // Win state - All Complete\r\n        onGameWon();\r\n        return { key: ``, focus: { multiple: 0, times: 0 }, buttons: [] };\r\n    }\r\n\r\n    const m = nextColumn.multiple;\r\n    const t = nextColumn.maxTimesCorrect + 1;\r\n\r\n    const correctValue = m * t;\r\n    const wrongAnswerCount = 4;\r\n    const wrongValues =\r\n        distinct(\r\n            [...new Array(100)].map(() =>\r\n                Math.round(m + 1 - 2 * Math.random())\r\n                * Math.round(t + 1 - 2 * Math.random())\r\n                + Math.round(2 - 4 * Math.random()))\r\n                .filter(x => x !== correctValue)\r\n                .filter(x => x > 0),\r\n        ).slice(0, wrongAnswerCount);\r\n\r\n    const answers = shuffle([correctValue, ...wrongValues]);\r\n\r\n    const onAnswer = (value: number) => {\r\n        if (value === correctValue) {\r\n            onCorrect({ multiple: m, times: t });\r\n            return;\r\n        }\r\n\r\n        const button = buttons.find(x => x.value === value);\r\n        if (!button) { return; }\r\n        button.wasAnsweredWrong = true;\r\n        onWrong({ multiple: m, times: t });\r\n    };\r\n\r\n    const buttons = answers.map(x => ({\r\n        value: x,\r\n        text: `${x}`,\r\n        onPress: () => onAnswer(x),\r\n        wasAnsweredWrong: false,\r\n    }));\r\n\r\n    return {\r\n        key: `${m}*${t}`,\r\n        focus: { multiple: m, times: t },\r\n        buttons,\r\n    };\r\n};\r\n\r\nconst inputStyles = {\r\n    outerContainer: {\r\n        height: 150,\r\n    },\r\n    container: {\r\n        flexDirection: `row`,\r\n        justifyContent: `space-around`,\r\n        margin: 16,\r\n    },\r\n    buttonView: {\r\n        width: 48,\r\n        height: 48,\r\n        borderWidth: 2,\r\n        borderColor: `#6666FF`,\r\n        borderStyle: `solid`,\r\n        justifyContent: `center`,\r\n        alignItems: `center`,\r\n    },\r\n    buttonText: {\r\n        fontFamily: `\"Lucida Console\", Monaco, monospace`,\r\n        fontSize: 24,\r\n        color: `#FFFFFF`,\r\n    },\r\n    buttonText_wrong: {\r\n        fontFamily: `\"Lucida Console\", Monaco, monospace`,\r\n        fontSize: 24,\r\n        color: `#FF6666`,\r\n    },\r\n} as const;\r\n\r\nconst GameInput = ({ gameInput }: { gameInput: GameInputState }) => {\r\n\r\n    const [y, setY] = useState(0);\r\n\r\n    useEffect(() => {\r\n        setY(100);\r\n        const id = setInterval(() => {\r\n            setY(s => Math.max(0, s - 1));\r\n        }, 50);\r\n        return () => clearInterval(id);\r\n    }, [gameInput.key]);\r\n\r\n    // // Auto answer\r\n    // useEffect(() => {\r\n    //     const id = setInterval(() => {\r\n    //         gameInput.buttons[randomIndex(gameInput.buttons.length)].onPress();\r\n    //     }, 50);\r\n    //     return () => clearInterval(id);\r\n    // }, [gameInput.key]);\r\n\r\n    return (\r\n        <>\r\n            <View style={inputStyles.outerContainer}>\r\n                <View style={[inputStyles.container, { transform: `translate(0px,${y}px)` }]}>\r\n                    {gameInput.buttons.map(x => (\r\n                        <TouchableOpacity key={x.text + gameInput.key} onPress={x.wasAnsweredWrong ? () => {/* Ignore */ } : x.onPress}>\r\n                            <View style={inputStyles.buttonView}>\r\n                                <Text style={x.wasAnsweredWrong ? inputStyles.buttonText_wrong : inputStyles.buttonText}>{x.text}</Text>\r\n                            </View>\r\n                        </TouchableOpacity>))}\r\n                </View>\r\n            </View>\r\n        </>\r\n    );\r\n};\r\n\r\n\r\nconst scoreStyles = {\r\n    container: {\r\n        flex: 1,\r\n        alignItems: `center`,\r\n        margin: 16,\r\n    },\r\n    text: {\r\n        fontFamily: `\"Lucida Console\", Monaco, monospace`,\r\n        fontSize: 14,\r\n        color: `#FFFF00`,\r\n    },\r\n    mistakesText: {\r\n        fontFamily: `\"Lucida Console\", Monaco, monospace`,\r\n        fontSize: 14,\r\n        color: `#FF6666`,\r\n    },\r\n} as const;\r\n\r\ntype GameScoreState = {\r\n    startTime: number;\r\n    gameWonTime?: number;\r\n    mistakes: number;\r\n};\r\n\r\nconst GameScore = ({ gameScore }: { gameScore: GameScoreState }) => {\r\n\r\n    const [timeMessage, setTimeMessage] = useState(``);\r\n    const [mistakesMessage, setMistakesMessage] = useState(``);\r\n\r\n    useEffect(() => {\r\n        const id = setInterval(() => {\r\n            setMistakesMessage(gameScore.mistakes ? `${gameScore.mistakes ?? 0} Mistakes` : ``);\r\n\r\n            if (gameScore.gameWonTime) {\r\n                const timeMs = gameScore.gameWonTime - gameScore.startTime;\r\n                setTimeMessage(s => `${(timeMs / 1000).toLocaleString(undefined, { minimumFractionDigits: 1, maximumFractionDigits: 1 })} seconds`);\r\n                return;\r\n            }\r\n\r\n            const timeMs = Date.now() - gameScore.startTime;\r\n            setTimeMessage(s => `${(timeMs / 1000).toLocaleString(undefined, { minimumFractionDigits: 1, maximumFractionDigits: 1 })} seconds`);\r\n        }, 100);\r\n        return () => clearInterval(id);\r\n    }, [gameScore]);\r\n\r\n    // console.log(`GameInput`);\r\n    return (\r\n        <>\r\n            <View style={scoreStyles.container}>\r\n                <View>\r\n                    <Text style={scoreStyles.text}>{timeMessage}</Text>\r\n                </View>\r\n                <View>\r\n                    <Text style={scoreStyles.mistakesText}>{mistakesMessage}</Text>\r\n                </View>\r\n            </View>\r\n        </>\r\n    );\r\n};\r\n"],"sourceRoot":""}