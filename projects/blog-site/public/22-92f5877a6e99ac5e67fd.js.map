{"version":3,"sources":["webpack:///D:/Projects/rick-love-master/code/games/educational-games/multiples-monster.tsx"],"names":["leaderboardService","createLeaderboard","storageKey","sortKey","x","score","scoreColumns","name","getValue","timeMs","toLocaleString","undefined","minimumFractionDigits","maximumFractionDigits","EducationalGame_MultiplesMonster","props","useState","key","startTime","Date","now","gameOverTime","gameScore","setGameScore","createDefaultGameBoardState","gameBoard","setGameBoard","gameInput","setGameInput","lastGameBoard","useRef","leaderboard","useLeaderboard","getScore","onMove","value","newGameBoard","current","player","position","newPlayerCell","columns","col","cells","row","state","s","nextGameBoard","nextInputState","moveMonsters","setTimeout","game","gameInputState","createGameInputState","useEffect","style","marginTop","marginBottom","padding","alignItems","width","GameScore","GameBoard","focus","GameInput","LeaderboardArea","gameOver","onScoreSaved","maxTimes","Array","map","i","r","j","randomIndex","house","monsters","forEach","m","monster","updateBoard","board","p","mon","colDiff","rowDiff","Math","abs","sign","random","newMonster","maxMultiple","push","newBoard","deadMonsters","filter","liveMonsters","c","cellRaw","cell","updateBoardPosition","boardRaw","kind","styles","cellView","height","backgroundColor","borderWidth","borderColor","borderStyle","justifyContent","focusCellView","borderLeftColor","borderRightColor","cellHeaderView","focusCellHeaderView","cellText","fontFamily","fontSize","cellHeaderText","color","focusCellHeaderText","flexDirection","getCellText","nextCells","isOnSquare","buttons","text","onPress","shuffle","inputStyles","outerContainer","container","margin","buttonView","buttonText","y","setY","id","setInterval","max","clearInterval","console","log","transform","scoreStyles","flex","mistakesText","setTimeMessage","scoreMessage","setScoreMessage"],"mappings":"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","file":"22-92f5877a6e99ac5e67fd.js","sourcesContent":["import React, { useState, useEffect, useRef } from 'react';\r\nimport { View, Text, TouchableOpacity, TextInput } from 'react-native-lite';\r\nimport { distinct, shuffle } from 'utils/arrays';\r\nimport { randomIndex } from 'utils/random';\r\nimport { Stats } from 'fs';\r\nimport { createLeaderboard } from './components/leaderboard';\r\n\r\nconst leaderboardService = createLeaderboard<{\r\n    score: number;\r\n    timeMs: number;\r\n}>({\r\n    storageKey: `MultiplesMonsterLeaderboard`,\r\n    sortKey: x => x.score,\r\n    scoreColumns: [\r\n        { name: `Time`, getValue: x => `${(x.timeMs / 1000).toLocaleString(undefined, { minimumFractionDigits: 1, maximumFractionDigits: 1 })}` },\r\n        { name: `Score`, getValue: x => `${x.score}` },\r\n    ],\r\n});\r\n\r\nexport const EducationalGame_MultiplesMonster = (props: {}) => {\r\n\r\n    const [gameScore, setGameScore] = useState({ key: 0, startTime: Date.now(), gameOverTime: undefined, score: 0 } as GameScoreState & { key: number });\r\n    const [gameBoard, setGameBoard] = useState(createDefaultGameBoardState());\r\n    const [gameInput, setGameInput] = useState(null as null | GameInputState);\r\n    const lastGameBoard = useRef(gameBoard);\r\n\r\n    const leaderboard = leaderboardService.useLeaderboard({\r\n        getScore: () => ({ score: gameScore.score, timeMs: (gameScore.gameOverTime ?? Date.now()) - gameScore.startTime }),\r\n    });\r\n\r\n    const onGameOver = () => {\r\n        setGameScore(s => ({ ...s, gameOverTime: Date.now(), key: s.key + 1 }));\r\n    };\r\n\r\n    const onScoreSaved = () => {\r\n        // Restart Game\r\n        const newGameBoard = createDefaultGameBoardState();\r\n        setGameScore({ key: 0, startTime: Date.now(), gameOverTime: undefined, score: 0 });\r\n        setGameBoard(newGameBoard);\r\n        nextInputState(newGameBoard);\r\n    };\r\n\r\n    const onMove = (value: { col: number, row: number }) => {\r\n        const newGameBoard = { ...lastGameBoard.current };\r\n        newGameBoard.player.position = value;\r\n\r\n        let newPlayerCell = newGameBoard.columns[newGameBoard.player.position.col].cells[newGameBoard.player.position.row];\r\n        if (newPlayerCell.state === `blank`) {\r\n            setGameScore(s => ({ ...s, score: s.score + newPlayerCell.value }));\r\n        }\r\n        // Player Safe at House\r\n        if (newPlayerCell.state === `house`) {\r\n            // next level\r\n            const nextGameBoard = createDefaultGameBoardState();\r\n            setGameBoard(nextGameBoard);\r\n            nextInputState(nextGameBoard);\r\n            return;\r\n        }\r\n\r\n        moveMonsters(newGameBoard);\r\n\r\n        // Player dead\r\n        newPlayerCell = newGameBoard.columns[newGameBoard.player.position.col].cells[newGameBoard.player.position.row];\r\n        if (newPlayerCell.state === `monster`) {\r\n            onGameOver();\r\n        }\r\n\r\n        // const col = newGameBoard.columns.find(x => x.col === value.col);\r\n        // if (col) {\r\n        //     col.maxTimesCorrect = value.row;\r\n        // };\r\n        setGameBoard(newGameBoard);\r\n        setTimeout(() => {\r\n            nextInputState(newGameBoard);\r\n        }, 100);\r\n    };\r\n\r\n    const nextInputState = (game: GameBoardState) => {\r\n        const gameInputState = createGameInputState(game, onMove);\r\n        setGameInput(gameInputState);\r\n    };\r\n\r\n    useEffect(() => {\r\n        nextInputState(gameBoard);\r\n    }, []);\r\n\r\n    lastGameBoard.current = gameBoard;\r\n\r\n    return (\r\n        <>\r\n            <View style={{ marginTop: 50, marginBottom: 150, padding: 2, alignItems: `center` }} >\r\n                <View style={{ width: 24 * 12 + 4 }}>\r\n                    <GameScore gameScore={gameScore} />\r\n                    <GameBoard gameBoard={gameBoard} focus={gameBoard.player.position ?? { col: 0, row: 0 }} />\r\n                    {gameInput && !gameScore.gameOverTime && <GameInput gameInput={gameInput} />}\r\n                    <leaderboard.LeaderboardArea gameOver={!!gameScore.gameOverTime} onScoreSaved={onScoreSaved} />\r\n                </View>\r\n            </View>\r\n        </>\r\n    );\r\n};\r\n\r\n\r\ntype GameBoardState = {\r\n    key: number;\r\n    maxTimes: number;\r\n    columns: {\r\n        col: number;\r\n        cells: GameBoardCell[];\r\n    }[];\r\n    player: {\r\n        position: GameBoardPosition;\r\n    };\r\n    monsters: {\r\n        position: GameBoardPosition;\r\n    }[];\r\n    house: {\r\n        position: GameBoardPosition;\r\n    };\r\n};\r\n\r\ntype GameBoardPosition = {\r\n    col: number;\r\n    row: number;\r\n};\r\n\r\ntype GameBoardCell = {\r\n    col: number;\r\n    row: number;\r\n    value: number;\r\n    state: 'blank' | 'answer' | 'monster' | 'player' | 'house';\r\n};\r\n\r\nconst maxMultiple = 12;\r\n\r\nconst createDefaultGameBoardState = (): GameBoardState => {\r\n\r\n    const gameBoard: GameBoardState = {\r\n        key: 0,\r\n        maxTimes: maxMultiple,\r\n        columns: [...new Array(maxMultiple)].map((x, i) => ({\r\n            col: i,\r\n            cells: [...new Array(maxMultiple)].map((r, j) => ({\r\n                col: i,\r\n                row: j,\r\n                value: (i + 1) * (j + 1),\r\n                state: `blank`,\r\n            })),\r\n        })),\r\n        player: { position: { col: randomIndex(maxMultiple), row: randomIndex(maxMultiple) } },\r\n        house: { position: { col: randomIndex(maxMultiple), row: randomIndex(maxMultiple) } },\r\n        monsters: [...new Array(3)].map(x => ({ position: { col: randomIndex(maxMultiple), row: randomIndex(maxMultiple) } })),\r\n    };\r\n\r\n    while (gameBoard.house.position.row === gameBoard.player.position.row) {\r\n        gameBoard.house.position = { col: randomIndex(maxMultiple), row: randomIndex(maxMultiple) };\r\n    }\r\n\r\n    gameBoard.monsters.forEach(m => {\r\n        const monster = m;\r\n        while (monster.position.row === gameBoard.player.position.row) {\r\n            monster.position = { col: randomIndex(maxMultiple), row: randomIndex(maxMultiple) };\r\n        }\r\n    });\r\n\r\n    // Randomly place player\r\n    updateBoard(gameBoard);\r\n\r\n    return gameBoard;\r\n};\r\n\r\nconst moveMonsters = (board: GameBoardState) => {\r\n    updateBoard(board);\r\n\r\n    const p = board.player;\r\n    board.monsters.forEach(mon => {\r\n        const m = mon;\r\n        const colDiff = p.position.col - m.position.col;\r\n        const rowDiff = p.position.row - m.position.row;\r\n        if (Math.abs(colDiff) >= Math.abs(rowDiff)) {\r\n            m.position = { ...m.position, col: m.position.col + Math.sign(colDiff) };\r\n        } else {\r\n            m.position = { ...m.position, row: m.position.row + Math.sign(rowDiff) };\r\n        }\r\n\r\n\r\n    });\r\n\r\n    // Spawn random monster\r\n    if (Math.random() < 0.25) {\r\n        const newMonster = { position: { col: randomIndex(maxMultiple), row: randomIndex(maxMultiple) } };\r\n        if (Math.random() < 0.5) {\r\n            if (Math.random() < 0.5) {\r\n                newMonster.position.col = 0;\r\n            } else {\r\n                newMonster.position.col = maxMultiple - 1;\r\n            }\r\n        } else {\r\n            // eslint-disable-next-line no-lonely-if\r\n            if (Math.random() < 0.5) {\r\n                newMonster.position.row = 0;\r\n            } else {\r\n                newMonster.position.row = maxMultiple - 1;\r\n            }\r\n        }\r\n\r\n        board.monsters.push(newMonster);\r\n    }\r\n\r\n    // Remove monsters that run into answer\r\n    const newBoard = board;\r\n    const monsters = [...board.monsters];\r\n    const deadMonsters = monsters.filter(m => board.columns[m.position.col].cells[m.position.row].state === `answer`);\r\n    const liveMonsters = monsters.filter(m => board.columns[m.position.col].cells[m.position.row].state !== `answer`);\r\n\r\n    // Dead monsters destroy answer\r\n    deadMonsters.forEach(m => {\r\n        newBoard.columns[m.position.col].cells[m.position.row].state = `blank`;\r\n    });\r\n\r\n    newBoard.monsters = liveMonsters;\r\n\r\n    updateBoard(newBoard);\r\n};\r\n\r\nconst updateBoard = (state: GameBoardState) => {\r\n    state.columns.forEach(c => c.cells.forEach(cellRaw => {\r\n        const cell = cellRaw;\r\n        if (cell.state === `monster`) { cell.state = `blank`; }\r\n        if (cell.state === `player`) { cell.state = `answer`; }\r\n    }));\r\n\r\n    updateBoardPosition(state, state.house.position, `house`);\r\n    updateBoardPosition(state, state.player.position, `player`);\r\n    state.monsters.forEach(m => {\r\n        updateBoardPosition(state, m.position, `monster`);\r\n    });\r\n};\r\n\r\nconst updateBoardPosition = (boardRaw: GameBoardState, position: GameBoardPosition, kind: 'player' | 'monster' | 'house') => {\r\n    const board = boardRaw;\r\n    board.columns[position.col].cells[position.row].state = kind;\r\n    board.key += 1;\r\n};\r\n\r\nconst styles = {\r\n    cellView: {\r\n        width: 24,\r\n        height: 24,\r\n        backgroundColor: `rgba(0,0,0,0.75)`,\r\n        borderWidth: 1,\r\n        borderColor: `#111133`,\r\n        borderStyle: `solid`,\r\n        justifyContent: `center`,\r\n        alignItems: `center`,\r\n    },\r\n    focusCellView: {\r\n        width: 24,\r\n        height: 24,\r\n        borderWidth: 1,\r\n        borderColor: `#66FF66`,\r\n        borderLeftColor: `#FF66FF`,\r\n        borderRightColor: `#FF66FF`,\r\n        borderStyle: `solid`,\r\n        justifyContent: `center`,\r\n        alignItems: `center`,\r\n    },\r\n    cellHeaderView: {\r\n        width: 24,\r\n        height: 24,\r\n        backgroundColor: `rgba(0,0,0,0.5)`,\r\n        borderWidth: 1,\r\n        borderColor: `#111133`,\r\n        borderStyle: `solid`,\r\n        justifyContent: `center`,\r\n        alignItems: `center`,\r\n    },\r\n    focusCellHeaderView: {\r\n        width: 24,\r\n        height: 24,\r\n        backgroundColor: `rgba(0,0,0,0.5)`,\r\n        borderWidth: 1,\r\n        borderColor: `#111133`,\r\n        borderStyle: `solid`,\r\n        justifyContent: `center`,\r\n        alignItems: `center`,\r\n    },\r\n    cellText: {\r\n        fontFamily: `\"Lucida Console\", Monaco, monospace`,\r\n        fontSize: 12,\r\n    },\r\n    cellHeaderText: {\r\n        fontFamily: `\"Lucida Console\", Monaco, monospace`,\r\n        fontSize: 12,\r\n        color: `#333300`,\r\n    },\r\n    focusCellHeaderText: {\r\n        fontFamily: `\"Lucida Console\", Monaco, monospace`,\r\n        fontSize: 12,\r\n        color: `#FFFF00`,\r\n    },\r\n} as const;\r\n\r\nconst getCellText = (cell: GameBoardCell) => {\r\n    return cell.state === `answer` ? `${cell.value}`\r\n        : cell.state === `player` ? `😀`\r\n            : cell.state === `monster` ? `💀`\r\n                : cell.state === `house` ? `🏠`\r\n                    : ``;\r\n};\r\n\r\nconst GameBoard = ({ gameBoard, focus }: { gameBoard: GameBoardState, focus: { col: number, row: number } }) => {\r\n    return (\r\n        <>\r\n            <View style={{ flexDirection: `row` }} >\r\n                <View style={{ flexDirection: `column-reverse` }} >\r\n                    <View style={styles.focusCellHeaderView} >\r\n                        <Text style={styles.focusCellHeaderText} >x</Text>\r\n                    </View>\r\n                    {gameBoard.columns[0].cells.map((r) => (\r\n                        <View key={r.row} style={focus.row === r.row ? styles.focusCellHeaderView : styles.cellHeaderView} >\r\n                            <Text style={focus.row === r.row ? styles.focusCellHeaderText : styles.cellHeaderText}>{`${r.row + 1}`}</Text>\r\n                        </View>\r\n                    ))}\r\n                </View>\r\n\r\n                {gameBoard.columns.map((c) => (\r\n                    <View key={c.col} style={{ flexDirection: `column-reverse` }} >\r\n                        <View style={focus.col === c.col ? styles.focusCellHeaderView : styles.cellHeaderView} >\r\n                            <Text style={focus.col === c.col ? styles.focusCellHeaderText : styles.cellHeaderText}>{`${c.col + 1}`}</Text>\r\n                        </View>\r\n                        {c.cells.map((cell) => (\r\n                            <View key={cell.row} style={focus.row >= cell.row && focus.col >= c.col ? styles.focusCellView : styles.cellView} >\r\n                                <Text style={styles.cellText}>{getCellText(cell)}</Text>\r\n                            </View>\r\n                        ))}\r\n                    </View>\r\n                ))}\r\n\r\n            </View>\r\n        </>\r\n    );\r\n};\r\n\r\n\r\ntype GameInputState = {\r\n    key: string;\r\n    buttons: {\r\n        key: string;\r\n        text: string;\r\n        onPress: () => void;\r\n    }[];\r\n};\r\n\r\nconst createGameInputState = (gameBoard: GameBoardState, onMove: (value: { col: number, row: number }) => void): GameInputState => {\r\n    const { player } = gameBoard;\r\n\r\n    const nextCells = [\r\n        gameBoard.columns[player.position.col + 0]?.cells[player.position.row + 1],\r\n        gameBoard.columns[player.position.col + 0]?.cells[player.position.row - 1],\r\n        gameBoard.columns[player.position.col + 1]?.cells[player.position.row + 0],\r\n        gameBoard.columns[player.position.col - 1]?.cells[player.position.row + 0],\r\n    ].filter(x => x);\r\n\r\n    const isOnSquare = player.position.col === player.position.row;\r\n    const buttons = nextCells.map(x => ({\r\n        key: `${x.row} ${x.col}`,\r\n        text: `${x.value}${isOnSquare && player.position.col === x.col ? `↕` : isOnSquare && player.position.row === x.row ? `↔` : ``}`,\r\n        onPress: () => onMove(x),\r\n    }));\r\n\r\n    return {\r\n        key: `${gameBoard.key}`,\r\n        buttons: shuffle(buttons),\r\n    };\r\n};\r\n\r\nconst inputStyles = {\r\n    outerContainer: {\r\n        height: 150,\r\n    },\r\n    container: {\r\n        flexDirection: `row`,\r\n        justifyContent: `space-around`,\r\n        margin: 16,\r\n    },\r\n    buttonView: {\r\n        width: 48,\r\n        height: 48,\r\n        borderWidth: 2,\r\n        borderColor: `#6666FF`,\r\n        borderStyle: `solid`,\r\n        justifyContent: `center`,\r\n        alignItems: `center`,\r\n    },\r\n    buttonText: {\r\n        fontFamily: `\"Lucida Console\", Monaco, monospace`,\r\n        fontSize: 24,\r\n        color: `#FFFFFF`,\r\n    },\r\n} as const;\r\n\r\nconst GameInput = ({ gameInput }: { gameInput: GameInputState }) => {\r\n\r\n    const [y, setY] = useState(0);\r\n\r\n    useEffect(() => {\r\n        setY(100);\r\n        const id = setInterval(() => {\r\n            setY(s => Math.max(0, s - 1));\r\n        }, 50);\r\n        return () => clearInterval(id);\r\n    }, [gameInput.key]);\r\n\r\n    console.log(`GameInput`, { gameInput });\r\n    return (\r\n        <>\r\n            <View style={inputStyles.outerContainer}>\r\n                <View style={[inputStyles.container, { transform: `translate(0px,${y}px)` }]}>\r\n                    {gameInput.buttons.map(x => (\r\n                        <TouchableOpacity key={x.key} onPress={x.onPress}>\r\n                            <View style={inputStyles.buttonView}>\r\n                                <Text style={inputStyles.buttonText}>{x.text}</Text>\r\n                            </View>\r\n                        </TouchableOpacity>))}\r\n                </View>\r\n            </View>\r\n        </>\r\n    );\r\n};\r\n\r\n\r\nconst scoreStyles = {\r\n    container: {\r\n        flex: 1,\r\n        alignItems: `center`,\r\n        margin: 16,\r\n    },\r\n    text: {\r\n        fontFamily: `\"Lucida Console\", Monaco, monospace`,\r\n        fontSize: 14,\r\n        color: `#FFFF00`,\r\n    },\r\n    mistakesText: {\r\n        fontFamily: `\"Lucida Console\", Monaco, monospace`,\r\n        fontSize: 14,\r\n        color: `#FF6666`,\r\n    },\r\n} as const;\r\n\r\ntype GameScoreState = {\r\n    startTime: number;\r\n    gameOverTime?: number;\r\n    score: number;\r\n};\r\n\r\nconst GameScore = ({ gameScore }: { gameScore: GameScoreState }) => {\r\n\r\n    const [timeMessage, setTimeMessage] = useState(``);\r\n    const [scoreMessage, setScoreMessage] = useState(``);\r\n\r\n    useEffect(() => {\r\n        const id = setInterval(() => {\r\n\r\n            setScoreMessage(`${gameScore.score}`);\r\n\r\n            if (gameScore.gameOverTime) {\r\n                const timeMs = gameScore.gameOverTime - gameScore.startTime;\r\n                setTimeMessage(s => `${(timeMs / 1000).toLocaleString(undefined, { minimumFractionDigits: 1, maximumFractionDigits: 1 })} seconds`);\r\n                return;\r\n            }\r\n\r\n            const timeMs = Date.now() - gameScore.startTime;\r\n            setTimeMessage(s => `${(timeMs / 1000).toLocaleString(undefined, { minimumFractionDigits: 1, maximumFractionDigits: 1 })} seconds`);\r\n        }, 100);\r\n        return () => clearInterval(id);\r\n    }, [gameScore]);\r\n\r\n    // console.log(`GameInput`);\r\n    return (\r\n        <>\r\n            <View style={scoreStyles.container}>\r\n                {/* <View>\r\n                    <Text style={scoreStyles.text}>{timeMessage}</Text>\r\n                </View> */}\r\n                <View>\r\n                    <Text style={scoreStyles.text}>{scoreMessage}</Text>\r\n                </View>\r\n            </View>\r\n        </>\r\n    );\r\n};\r\n"],"sourceRoot":""}