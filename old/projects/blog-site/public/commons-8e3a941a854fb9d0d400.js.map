{"version":3,"sources":["webpack:///D:/Projects/rick-love-master/node_modules/@babel/runtime/helpers/esm/getPrototypeOf.js","webpack:///D:/Projects/rick-love-master/node_modules/@babel/runtime/helpers/esm/setPrototypeOf.js","webpack:///D:/Projects/rick-love-master/node_modules/@babel/runtime/helpers/esm/isNativeReflectConstruct.js","webpack:///D:/Projects/rick-love-master/node_modules/@babel/runtime/helpers/esm/construct.js","webpack:///D:/Projects/rick-love-master/node_modules/@babel/runtime/helpers/esm/wrapNativeSuper.js","webpack:///D:/Projects/rick-love-master/node_modules/@babel/runtime/helpers/esm/isNativeFunction.js","webpack:///D:/Projects/rick-love-master/code/utils/objects.ts","webpack:///D:/Projects/rick-love-master/node_modules/vscode-diff/dist/index.js","webpack:///D:/Projects/rick-love-master/code/networking/websockets-api/client/websocket-client-smart.ts","webpack:///D:/Projects/rick-love-master/code/networking/web-mesh/web-mesh-client.ts","webpack:///D:/Projects/rick-love-master/code/utils/random.ts","webpack:///D:/Projects/rick-love-master/code/controls-react/icon-kind.ts","webpack:///D:/Projects/rick-love-master/node_modules/gatsby/node_modules/core-js/modules/es.string.trim-end.js","webpack:///D:/Projects/rick-love-master/code/code-training/common/components/lesson-render-view.tsx","webpack:///D:/Projects/rick-love-master/code/games/doodle/doodle-storage.ts","webpack:///D:/Projects/rick-love-master/code/networking/user-data-service/user-profile-selection-view.tsx","webpack:///D:/Projects/rick-love-master/code/games/educational-games/progress-games/emoji-idle-game/emoji-skills/emoji-skill-tree.ts","webpack:///D:/Projects/rick-love-master/code/games/educational-games/progress-games/emoji-idle-game/emoji-idle-service.ts","webpack:///D:/Projects/rick-love-master/code/games/educational-games/progress-games/emoji-idle-game/emoji-idle-view.tsx","webpack:///D:/Projects/rick-love-master/code/games/educational-games/progress-games/progress-game.tsx","webpack:///D:/Projects/rick-love-master/code/utils/email-address.ts","webpack:///D:/Projects/rick-love-master/node_modules/vscode-diff/dist/charCode.js","webpack:///D:/Projects/rick-love-master/code/utils/error.ts","webpack:///D:/Projects/rick-love-master/code/games/educational-games/problems/problems-reviewer.ts","webpack:///D:/Projects/rick-love-master/code/utils/string-span.ts","webpack:///D:/Projects/rick-love-master/code/networking/upload-api/client/config.ts","webpack:///D:/Projects/rick-love-master/node_modules/dayjs/dayjs.min.js","webpack:///D:/Projects/rick-love-master/node_modules/dayjs/plugin/localizedFormat.js","webpack:///D:/Projects/rick-love-master/code/react-native-lite/index.tsx","webpack:///D:/Projects/rick-love-master/code/games/educational-games/utils/voice-chooser.tsx","webpack:///D:/Projects/rick-love-master/node_modules/gatsby/node_modules/core-js/modules/es.string.trim-start.js","webpack:///D:/Projects/rick-love-master/code/utils/subscribable.ts","webpack:///D:/Projects/rick-love-master/code/networking/upload-api/client/uploader.ts","webpack:///D:/Projects/rick-love-master/code/art/artwork/example-PavelDoGreat-fluid-simulation/src/ga.ts","webpack:///D:/Projects/rick-love-master/code/utils/json.ts","webpack:///D:/Projects/rick-love-master/code/controls-react/error-box.tsx","webpack:///D:/Projects/rick-love-master/code/games/doodle/doodle-view.tsx","webpack:///D:/Projects/rick-love-master/code/networking/websockets-api/client/websocket-client.ts","webpack:///D:/Projects/rick-love-master/code/utils/hash-code.ts","webpack:///D:/Projects/rick-love-master/code/code-training/common/lesson-hash.ts","webpack:///D:/Projects/rick-love-master/node_modules/@stripe/react-stripe-js/dist/react-stripe.umd.js","webpack:///D:/Projects/rick-love-master/code/utils/phone-number.ts","webpack:///D:/Projects/rick-love-master/code/code-training/lesson-editor/lesson-defaults.ts","webpack:///D:/Projects/rick-love-master/code/code-training/lesson-editor/lesson-editor.tsx","webpack:///D:/Projects/rick-love-master/code/code-training/lesson-editor/lesson-module-editor.tsx","webpack:///D:/Projects/rick-love-master/node_modules/@stripe/stripe-js/dist/stripe.esm.js","webpack:///D:/Projects/rick-love-master/code/payments/common/process-steps.ts","webpack:///D:/Projects/rick-love-master/code/payments/common/types.ts","webpack:///D:/Projects/rick-love-master/code/payments/providers/stripe/common/stripe-process-steps.ts","webpack:///D:/Projects/rick-love-master/code/payments/providers/stripe/client/stripe-payment-react.tsx","webpack:///D:/Projects/rick-love-master/code/games/doodle/doodle.ts","webpack:///D:/Projects/rick-love-master/node_modules/vscode-diff/dist/diff.js","webpack:///D:/Projects/rick-love-master/code/payments/providers/stripe/client/stripe-client-tokens.ts","webpack:///D:/Projects/rick-love-master/code/code-training/common/components/lesson-view.tsx","webpack:///D:/Projects/rick-love-master/node_modules/prismjs/components/prism-tsx.js","webpack:///D:/Projects/rick-love-master/node_modules/vscode-diff/dist/strings.js","webpack:///D:/Projects/rick-love-master/code/games/doodle/doodle-paths.ts","webpack:///D:/Projects/rick-love-master/node_modules/react-icons/lib/esm/iconsManifest.js","webpack:///D:/Projects/rick-love-master/node_modules/react-icons/lib/esm/iconContext.js","webpack:///D:/Projects/rick-love-master/node_modules/react-icons/lib/esm/iconBase.js","webpack:///D:/Projects/rick-love-master/code/networking/upload-api/client/web-client.ts","webpack:///D:/Projects/rick-love-master/code/games/educational-games/utils/speech.ts","webpack:///D:/Projects/rick-love-master/code/controls-react/button.tsx","webpack:///D:/Projects/rick-love-master/code/controls-react/index.tsx","webpack:///D:/Projects/rick-love-master/code/controls-react/inputs.tsx","webpack:///D:/Projects/rick-love-master/code/art/artwork/games/event-provider.ts","webpack:///D:/Projects/rick-love-master/code/utils/dates.ts","webpack:///D:/Projects/rick-love-master/node_modules/vscode-diff/dist/diffChange.js","webpack:///D:/Projects/rick-love-master/code/utils/delay.ts","webpack:///(webpack)/buildin/global.js","webpack:///D:/Projects/rick-love-master/code/art/artwork/games/utils.ts","webpack:///D:/Projects/rick-love-master/code/controls-react/icon.tsx","webpack:///D:/Projects/rick-love-master/code/themes/theme.ts","webpack:///D:/Projects/rick-love-master/code/art/artwork/example-PavelDoGreat-fluid-simulation/src/systems/webgl.ts","webpack:///D:/Projects/rick-love-master/node_modules/dat.gui/build/dat.gui.module.js","webpack:///D:/Projects/rick-love-master/code/art/artwork/example-PavelDoGreat-fluid-simulation/src/utils.ts","webpack:///D:/Projects/rick-love-master/code/art/artwork/example-PavelDoGreat-fluid-simulation/src/systems/texture.ts","webpack:///D:/Projects/rick-love-master/code/art/artwork/example-PavelDoGreat-fluid-simulation/src/systems/shader.ts","webpack:///D:/Projects/rick-love-master/code/art/artwork/example-PavelDoGreat-fluid-simulation/src/run.ts","webpack:///D:/Projects/rick-love-master/code/art/artwork/example-PavelDoGreat-fluid-simulation/src/systems/frame-buffer.ts","webpack:///D:/Projects/rick-love-master/code/art/artwork/example-PavelDoGreat-fluid-simulation/src/config.ts","webpack:///D:/Projects/rick-love-master/code/art/artwork/example-PavelDoGreat-fluid-simulation/src/gui.ts","webpack:///D:/Projects/rick-love-master/code/art/artwork/example-PavelDoGreat-fluid-simulation/src/shaders.ts","webpack:///D:/Projects/rick-love-master/code/utils/arrays.ts","webpack:///D:/Projects/rick-love-master/node_modules/prismjs/components/prism-typescript.js","webpack:///D:/Projects/rick-love-master/node_modules/gatsby/node_modules/core-js/internals/flatten-into-array.js","webpack:///D:/Projects/rick-love-master/node_modules/gatsby/node_modules/core-js/modules/es.array.unscopables.flat-map.js","webpack:///D:/Projects/rick-love-master/code/art/rando.ts","webpack:///D:/Projects/rick-love-master/node_modules/prismjs/prism.js","webpack:///D:/Projects/rick-love-master/code/utils-react/hooks.tsx","webpack:///D:/Projects/rick-love-master/code/controls-react/loading.tsx","webpack:///D:/Projects/rick-love-master/code/games/educational-games/problems/spelling/spelling-problem-service.ts","webpack:///D:/Projects/rick-love-master/code/code-training/common/components/tabs.tsx","webpack:///D:/Projects/rick-love-master/node_modules/prismjs/components/prism-jsx.js","webpack:///D:/Projects/rick-love-master/code/games/educational-games/components/game-pad-analog.tsx","webpack:///D:/Projects/rick-love-master/code/games/educational-games/utils/vectors.ts","webpack:///D:/Projects/rick-love-master/code/games/educational-games/star-blast-sideways.tsx","webpack:///D:/Projects/rick-love-master/code/games/educational-games/problems/multiples.ts","webpack:///D:/Projects/rick-love-master/code/games/doodle/keyboard-simplified.tsx","webpack:///D:/Projects/rick-love-master/code/games/doodle/doodle-components.tsx","webpack:///D:/Projects/rick-love-master/code/games/educational-games/components/leaderboard.tsx","webpack:///D:/Projects/rick-love-master/code/networking/user-data-service/user-profile-emojis.tsx","webpack:///D:/Projects/rick-love-master/code/networking/user-data-service/user-profile-manager-view.tsx","webpack:///D:/Projects/rick-love-master/code/code-training/lesson-player/lesson-module-player.tsx","webpack:///D:/Projects/rick-love-master/code/utils/web-request.ts","webpack:///D:/Projects/rick-love-master/node_modules/vscode-diff/dist/diffComputer.js","webpack:///D:/Projects/rick-love-master/code/code-training/common/diff.ts","webpack:///D:/Projects/rick-love-master/code/code-training/common/replacements.ts","webpack:///D:/Projects/rick-love-master/node_modules/dayjs/plugin/relativeTime.js","webpack:///D:/Projects/rick-love-master/node_modules/gatsby/node_modules/core-js/internals/string-trim-forced.js","webpack:///D:/Projects/rick-love-master/code/networking/websockets-api/client/config.ts","webpack:///D:/Projects/rick-love-master/node_modules/gatsby/node_modules/core-js/modules/es.array.flat-map.js","webpack:///D:/Projects/rick-love-master/code/games/educational-games/utils/subject-navigator.tsx","webpack:///D:/Projects/rick-love-master/code/games/educational-games/problems/problem-state-storage.ts","webpack:///D:/Projects/rick-love-master/code/networking/user-data-service/user-data-service.ts","webpack:///D:/Projects/rick-love-master/code/games/console-simulator/utils.ts","webpack:///D:/Projects/rick-love-master/code/code-training/common/components/code-editor-helpers.ts","webpack:///D:/Projects/rick-love-master/code/code-training/common/components/code-display.tsx","webpack:///D:/Projects/rick-love-master/code/code-training/common/components/emojis.ts","webpack:///D:/Projects/rick-love-master/code/code-training/common/components/lesson-file-editor-construct-code.tsx","webpack:///D:/Projects/rick-love-master/code/code-training/common/components/lesson-file-editor-understand-code.tsx","webpack:///D:/Projects/rick-love-master/code/code-training/common/components/lesson-file-editor.tsx"],"names":["_getPrototypeOf","o","Object","setPrototypeOf","getPrototypeOf","__proto__","_setPrototypeOf","p","_isNativeReflectConstruct","Reflect","construct","sham","Proxy","Date","prototype","toString","call","e","Parent","args","Class","a","push","apply","instance","Function","bind","arguments","_cache","Map","undefined","fn","indexOf","TypeError","has","get","set","Wrapper","this","constructor","create","value","enumerable","writable","configurable","getValuesAsItems","obj","keys","map","k","filter","x","toKeyValueObject","items","v","forEach","key","toMap","toKeyValueArray","__export","m","exports","hasOwnProperty","defineProperty","createWebMeshClient","channelKey","initialMeshState","initialState","reduceState","reduceClientsState","clientKey","localStorage","getItem","now","Math","floor","random","setItem","config","messageHandler","messages","events","sendRef","outbox","connection","subMessages","subEvents","sendIntervalId","sendOutbox","stateSub","createSubscribable","state","meshState","meshMetaData","clients","firstMessageTimestamp","lastMessageTimestamp","messageHistory","sendSyncStateTimeoutId","setTimeout","websocket","websocketsApiUrl","websocketsApiConfig","message","kind","clearTimeout","c","onStateChange","oldClients","lastActivityTimestamp","t","sort","b","join","updateClients","pingPongDropTimeoutId","clientKeys","includes","sendPong","some","sendSyncState","distinct_key","clientPriority","findIndex","send","createWebsocketClient","connect","subscribeMessages","_r","subscribeConnectionEvents","event","isConnected","setInterval","splice","length","unsubscribe","clearInterval","close","history","sendWebSocketMessage","unshift","pingPongInterval","deadClients2","oldClients2","isClosed","_webSocket","sendMessage","AppError","subscribe","randomIndex","randomItem","IconKind","$","$trimEnd","end","FORCED","forcedStringTrimMethod","trimEnd","target","proto","forced","trimRight","styles","container","iFrame","width","height","border","background","LessonRenderView","props","containerRef","useRef","lastWidth","lastHeight","intervalId","onResizeHeight","current","clientWidth","borderSize","contentWindow","document","body","scrollHeight","style","useEffect","iFrameUrl","ref","src","title","onLoad","LessonProjectStatePreview","projectState","setProjectState","useAutoLoadingError","loading","doWork","error","useState","setIFrameUrl","stopIfObsolete","r","storageAccess","JSON","parse","stringify","createDoodleDrawingStorageService","remoteDoodle","createSmartUploader","getUploadUrl","doodleUploadUrl","setUploadUrl","uploadApiUrl","uploadApiConfig","uploadUrlPrefix","doodleStoragePaths","doodleDrawingsPrefix","remoteVotes","scoresUploadUrl","doodleVotesPrefix","getSummaryData","uploadUrl","uploadApiWebClient","createUploadApiWebClient","createUploadUrl","serverUrl","getUrl","replace","relativePath","summaryUrl","doodleSummary","console","log","downloadData","summaryDataRaw","summaryData","doodles","prompt","timestamp","drawing","decodeDoodleDrawing","d","score","s","memory","doodleScores","doodleVotes","load","voteTotals","doodleKey","service","saveDrawing","doodle","substr","save","encodeDoodleDrawing","saveBestDrawingSelection","find","getDrawings","options","includeOtherPrompts","maxCount","allDoodles","samePromptDrawings","otherPromptDrawings","allDrawings","shuffle","slice","drawings","getAllDrawings","flexDirection","flexWrap","justifyContent","profileContainer","alignItems","profileCharacterView","borderWidth","borderStyle","borderColor","profileCharacterText","fontSize","textAlign","profileNameView","profileNameText","UserProfileSelectionView","userProfiles","setUserProfiles","isManagerVisible","setIsManagerVisible","reload","UserDataService","setup","getUserProfiles","profiles","onClose","onPress","setActiveUser","onUserSelected","emoji","name","buildEmojiSkillTree","maleSkillDoc","child_male","student_male","skillDoc","femaleSkillDoc","child_female","student_female","getFemaleVariant","maleNodes","parseSkillDoc","femaleNodes","babyNode","babyEmoji","gender","pay","requirementEmojis","startEmoji","parent","children","allNodes","root","child","allRequirements","parseRequirementsDoc","requirementsDoc","node","allCosts","cost","summary","totalCost","reduce","out","debug_totalRequirementsCost","doc","split","trim","line","parts","Number","parseInt","parseSkillLine","skillLine","payText","p1","RegExp","genderCharCodes","male","female","man","woman","String","fromCodePoint","storage","createService","skillTree","reqMap","defaultState","characterEmoji","emotion","lastEmotionTimestamp","money","multiplier","lastMultiplierChangeTimestamp","lastPurchaseTimestamp","townState","characters","sub","changeState","partialState","rewardInner","min","targetEmoji","targetOptions","skillNode","remainingSkills","targetSkillNode","reqs","reqs_remaining","requirementsPurchased","reqs_available","requirementsAvailable","requirementsNeeded","requirementsRemaining","subscribePetStateChange","reward","reward_major","reward_extreme","punish","max","selectOption","finishedTimestamp","serviceState","EmojiIdleService","fixed","position","top","right","left","zIndex","inner","emotionEmoji","fontFamily","characterEmoji_small","costText","color","costText_small","targetCharacterEmoji","objectEmoji","marginLeft","money_small","foodText","EmojiIdleView","gameState","setGameState","isExpanded","setIsExpanded","purchased","townStyles","payText_disabled","moneyText","townMoneyText","TownView","townPersons","character","skill","n","years","missingSkills","townMoney","flex","padding","toLocaleString","toFixed","opacity","CommandsView","offset","setOffset","targetOptionsLength","i","canBuy","borderRadius","paddingLeft","paddingRight","ScoreView","moneySizeOffset","setMoneySizeOffset","multiplierSizeOffset","setMultiplierSizeOffset","lastMultiplier","multiplierDelta","setMultiplierDelta","update","id","transform","padStart","EmojiCharacterView","PurchasedView","EmotionView","text","isEmotion","display","setDisplay","showEmotion","variant","getEmoji","ProgressGameService","onCorrect","onCompleteSection","onCompleteSubject","onWrong","createProgressGameProblemService","problemSource","recordAnswer","problem","answer","isCorrect","isReview","isLastOfSubject","uploadUserData","isLastOfSection","ProgressGameView","hasSelectedProfile","setHasSelectedProfile","userProfile","setUserProfile","getActiveUser","lastPurchase","Platform","OS","window","location","toEmailAddress","email","data","Error","ApiError","createReviewProblemService","maxNewReviewCount","reviewSequencePreviousLength","reviewQuestionPrefix","requiredCorrectInRow","problemSourceHistory","reviewProblems","lastReviewProblem","reviewSequence","repeatState","startReview","getSections","gotoSection","getNextProblem","reviewProblem","rSeq","iNext","iEnd","index","lastReviewProblemIndex","iStart","seq","question","answers","getReviewProblem","correctsInRow","newProblem","problemAlreadyInReview","newReview","_debug_problemKey","StringSpan","source","start","debug","lastIndexOf","indexOfAny","indexes","indexOfRegExp","lastIndex","exec","lastIndexOfRegex","len","splitOn","spans","iMin","iLast","splitOnRegExp","startsWith","trimStart","patterns","offsetStart","offsetEnd","newRange","toText","getChar","module","u","f","h","weekdays","months","Array","l","z","utcOffset","abs","date","year","month","clone","add","ceil","M","y","w","D","ms","Q","toLowerCase","S","g","locale","$L","utc","$u","$x","$offset","$d","NaN","test","match","substring","UTC","init","$y","getFullYear","$M","getMonth","$D","getDate","$W","getDay","$H","getHours","$m","getMinutes","$s","getSeconds","$ms","getMilliseconds","$utils","isValid","isSame","startOf","endOf","isAfter","isBefore","$g","unix","valueOf","getTime","toDate","$locale","weekStart","$set","daysInMonth","round","subtract","format","meridiem","YY","YYYY","MM","MMM","monthsShort","MMMM","DD","dd","weekdaysMin","ddd","weekdaysShort","dddd","H","HH","hh","A","mm","ss","SSS","Z","getTimezoneOffset","diff","toJSON","toISOString","toUTCString","extend","$i","isDayjs","en","Ls","LTS","LT","L","LL","LLL","LLLL","formats","toUpperCase","mergeStyles","isArray","item","viewStyleDefaults","textStyleDefaults","whiteSpace","finalizeTextStyle","userSelect","MozUserSelect","WebkitUserSelect","View","Text","numberOfLines","allStyles","overflow","wordWrap","textOverflow","TextInput","type","keyboardType","secureTextEntry","autoCompleteType","onKeyPress","onSubmitEditing","shiftKey","preventDefault","multiline","placeholder","disabled","editable","onFocus","onChange","onBlur","rows","onSelect","eTarget","selectionRange","selectionStart","selectionEnd","onSelectionChange","TouchableOpacity","lastPressTime","hasTouchStarted","onClick","onTouchStart","onTouchMove","onTouchEnd","role","tabIndex","Pressable","onIgnore","stopPropagation","cancelBubble","returnValue","onPressIn","onPressOut","onMouseDown","onMouseUp","onTouchCancel","onMouseLeave","onTouchEndCapture","ActivityIndicator","size","sizePx","CircleSvg","thickness","dashLength","PI","maxWidth","viewBox","xmlns","fill","stroke","strokeWidth","cx","cy","className","strokeDasharray","transformOrigin","Clipboard","setString","navigator","clipboard","writeText","VoiceChooser","languange","speechService","setLoading","setRenderId","refresh","getVoicesForLanguange","voice","setVoiceForLanguange","speak","margin","isSelected","lang","localService","$trimStart","trimLeft","lastState","callbacks","callback","fetchWithTimeout","method","headers","result","json","createUploader","uploadData","putUrl","ok","_uploadUrl","setupUploadUrl","prefix","uploader","renewUploadUrl","backupUrl","backupUploader","ga","jsonStringify_safe","shouldFormat","visited","_","val","errorBoxStyle","view","theme","view_error","text_error","text_errorMessage","icon","icon_errorMessage","button","outlineColor","colors","outline","ErrorBox","ErrorBox_Inner","expanded","setExpanded","errorAsString","errorMessage","errorDetails","errorObjText","canExpand","collapsed","copy","retryCallback","retry","ErrorMessage","backgroundColor","DoodleTestView","defaultDoodleDrawing","setDoodle","DoodleDrawerView","DoodleDisplayView","scale","segment","setSegment","segmentClientStart","divHost","nativeEvent","pos","div","rect","getBoundingClientRect","clientX","clientY","points","segments","onClientMove","lastPos","onMove","onIgnoreNative","addEventListener","passive","removeEventListener","preserveAspectRatio","doodleSegmentToSvgPath_line","bottom","onMouseMove","touches","redrawId","setRedrawId","enableRedraw","DoodleDisplayView_Inner","shouldAnimate","animatePointsPerSecond","tick","setTick","totalPoints","flatMap","remainingPoints","MAX_SAFE_INTEGER","maxPoints","DoodleBrowser","setDoodles","DoodleBrowseView","grouped","groupItems","subscribable","subscribableEvents","createSocket","socket","WebSocket","activeSocket","connectionStatus","messageContainer","reconnect","readyState","OPEN","hashCode","str","seed","ch","h1","h2","charCodeAt","imul","calculateFilesHashCode","files","allText","content","path","language","React","_typeof","Symbol","iterator","_objectWithoutProperties","excluded","sourceKeys","_objectWithoutPropertiesLoose","getOwnPropertySymbols","sourceSymbolKeys","propertyIsEnumerable","_slicedToArray","arr","_arrayWithHoles","_arr","_n","_d","_e","_s","_i","next","done","err","_iterableToArrayLimit","minLen","_arrayLikeToArray","from","_unsupportedIterableToArray","_nonIterableRest","arr2","emptyFunction","emptyFunctionWithReset","resetWarningCache","propTypes","createCommonjsModule","shim","propName","componentName","propFullName","secret","getShim","isRequired","ReactPropTypes","array","bool","func","number","object","string","symbol","any","arrayOf","element","elementType","instanceOf","objectOf","oneOf","oneOfType","shape","exact","checkPropTypes","PropTypes","factoryWithThrowingShims","isUnknownObject","raw","isEqual","leftArray","leftPlainObject","leftKeys","rightKeys","keySet","allKeys","every","usePrevious","validateStripe","maybeStripe","elements","createToken","createPaymentMethod","confirmCardPayment","parseStripeProp","then","isPromise","tag","stripePromise","Promise","resolve","stripe","ElementsContext","createContext","displayName","useElementsContextWithUseCase","useCaseMessage","ctx","useCase","concat","parseElementsContext","useContext","ElementsConsumer","_ref2","useCallbackReference","cb","extractUpdateableOptions","paymentRequest","noop","createElementComponent","isServer","charAt","Element","createElement","_ref","_ref$options","_ref$onBlur","_ref$onFocus","_ref$onReady","onReady","_ref$onChange","_ref$onEscape","onEscape","_ref$onClick","elementRef","domNode","callOnReady","callOnBlur","callOnFocus","callOnClick","callOnChange","callOnEscape","useLayoutEffect","mount","on","prevOptions","warn","updateableOptions","destroy","__elementType","AuBankAccountElement","CardElement","CardNumberElement","CardExpiryElement","CardCvcElement","FpxBankElement","IbanElement","IdealBankElement","PaymentRequestButtonElement","Elements","rawStripeProp","_final","isMounted","parsed","useMemo","_React$useState2","setContext","prevStripe","anyStripe","_registerWrapper","version","Provider","useElements","useStripe","factory","formatPhoneNumber_UsaCanada","phoneNumberMask_UsaCanada","corrected","toStandardPhoneNumber","digitsNo1","digits","letters","iDigit","full","createDefaultLesson","file","file0","file2","focusIndex","focusLength","filesHashCode","focus","filePath","objective","explanation","task","descriptions","experiments","cloneLesson","lesson","newLesson","createDefaultLessonModule","lessons","containerPanel","editorModeTabRowView","editorModeTabView","alignSelf","marginRight","editorModeTabView_selected","editorModeTabText","editorModeTabText_selected","buttonView","buttonText","sectionHeaderText","infoView","infoText","wrap","lessonFieldView","lessonFieldLabelText","minWidth","lessonFieldText","jsonText","createLessonState","lessonJson","lessonSteps","constructCode","lessonData","understandCode","LessonEditor","setData","editorMode","setEditorMode","projectEditorMode","fileEditorMode_focus","fileEditorMode_noFocus","changeLessonState","onLessonChange","label","projectData","onProjectDataChange","LessonField","LessonField_Descriptions","LessonField_Experiments","j","onDelete","replacements","comment","LessonField_Experiment","modifiedProjectState","setModifiedProjectState","lastFocus","setLastFocus","commentText","setCommentText","lessonExperiments_createReplacementProjectState","lessonExperiments_calculateProjectStateReplacements","selection","textDecoration","LessonModuleEditor","setModule","activeLesson","setActiveLesson","mode","setMode","header","getKey","getLabel","selected","newModule","selectedTabText","onCreateNewItem","V3_URL","V3_URL_REGEX","EXISTING_SCRIPT_MESSAGE","loadScript","params","reject","Stripe","script","scripts","querySelectorAll","findScript","queryString","advancedFraudSignals","headOrBody","head","appendChild","injectScript","initStripe","startTime","registerWrapper","stripePromise$1","loadCalled","ProcessSteps_CreateSavedPaymentMethod","PaymentError","ProcessSteps_CreateSavedPaymentMethod_Stripe","_02_Server_SetupSavedPaymentMethod","_03_Client_CollectPaymentDetails","_04_Server_ObtainPaymentMethod","logProcessStep_CreateSavedPaymentMethod_Stripe","step","status","wrapProcessStep_CreateSavedPaymentMethod_Stripe","execute","createPaymentClientComponents_stripe","_len","_key","loadStripe","stripePublicKey","AppWrapperComponent","PaymentMethodEntryComponent","paymentMethodSetupToken","onPaymentMethodReady","stripeError","setStripeError","handleSubmit","_03A_Client_CollectPaymentDetails","setupInfo","stripeDecodeClientSetupToken","confirmCardSetup","clientSecret","payment_method","card","getElement","billing_details","customerBillingDetails","setupIntent","stripeEncodeClientToken","inputStyle","base","textColor","fontSmoothing","invalid","textColor_invalid","iconColor","inputContainerStyle","marginBottom","elementPadding","textPadding","buttonStyle","fontWeight","buttonJustifyContent","buttonAlignment","errorContainerStyle","errorMessageStyle","onSubmit","encodeDoodleSegmentPoints","last","decodeDoodleSegmentPoints","pointsString","point","doodleText","diffChange_1","createStringSequence","getLength","getElementAtIndex","stringDiff","original","modified","pretty","LcsDiff","ComputeDiff","Debug","Assert","condition","MyArray","Copy","sourceArray","sourceIndex","destinationArray","destinationIndex","DiffChangeHelper","m_changes","m_originalStart","MAX_VALUE","m_modifiedStart","m_originalCount","m_modifiedCount","MarkNextChange","DiffChange","AddOriginalElement","originalIndex","modifiedIndex","AddModifiedElement","getChanges","getReverseChanges","reverse","originalSequence","newSequence","continueProcessingPredicate","OriginalSequence","ModifiedSequence","ContinueProcessingPredicate","m_forwardHistory","m_reverseHistory","ElementsAreEqual","newIndex","OriginalElementsAreEqual","index1","index2","ModifiedElementsAreEqual","_ComputeDiff","originalStart","originalEnd","modifiedStart","modifiedEnd","changes","ComputeDiffRecursive","PrettifyChanges","quitEarlyArr","midOriginalArr","midModifiedArr","ComputeRecursionPoint","midOriginal","midModified","leftChanges","rightChanges","ConcatenateChanges","WALKTRACE","diagonalForwardBase","diagonalForwardStart","diagonalForwardEnd","diagonalForwardOffset","diagonalReverseBase","diagonalReverseStart","diagonalReverseEnd","diagonalReverseOffset","forwardPoints","reversePoints","deltaIsEven","forwardChanges","diagonal","reverseChanges","changeHelper","diagonalMin","diagonalMax","diagonalRelative","lastOriginalIndex","MIN_VALUE","historyIndex","originalStartPoint","modifiedStartPoint","lastForwardChange","getOriginalEnd","getModifiedEnd","numDifferences","tempOriginalIndex","maxDifferences","numDiagonals","furthestOriginalIndex","furthestModifiedIndex","ClipDiagonalBound","MaxDifferencesHistory","matchLengthOfLongest","temp","change","originalStop","modifiedStop","checkOriginal","originalLength","checkModified","modifiedLength","mergedChangeArr","ChangesOverlap","prevChange","bestDelta","bestScore","_boundaryScore","delta","_OriginalIsBoundary","_OriginalRegionIsBoundary","_ModifiedIsBoundary","_ModifiedRegionIsBoundary","diagonalBaseIndex","diffEven","stripeEncodeClientSetupToken","sectionHeader2Text","LessonView_PreviewResult","onDone","isDone","setIsDone","onTaskDone","LessonView_ConstructCode","LessonView_UnderstandCode","experimentStyles","instructionsText","experimentView","experimentItemRow","experimentItemView","experimentItemView_active","borderLeft","experimentItemText","LessonView_ExperimentCode","activeExperiment","setActiveExperiment","activeFocus","setActiveFocus","changeExperiment","focusReplacements","minIndex","maxEndIndex","lengthDeltas","lengthDelta","Prism","typescript","util","languages","tsx","pattern","flags","lookbehind","firstNonWhitespaceIndex","chCode","lastNonWhitespaceIndex","startIndex","doodlePartyDrawingsPrefix","DefaultContext","attr","IconContext","__assign","assign","__rest","GenIcon","IconBase","Tree2Element","tree","elem","conf","computedSize","svgProps","Consumer","apiRequest","endpoint","url","requestData","webRequest","resultObj","createSpeechService","synth","speechSynthesis","selectedVoices","voiceLang","SpeechSynthesisUtterance","voices","getVoices","Button","styleAlt","button_formAction_alt","button_formAction","extractViewStyle","extractTextStyle","C","Loading","LoadingInline","View_Panel","view_panel","View_Form","view_form","View_FormFields","view_formFields","View_FieldRow","view_fieldRow","View_FormActionRow","view_formActionRow","Text_FormTitle","text_formTitle","Text_FieldLabel","text_fieldLabel","Button_FieldInline","button_fieldInline_alt","button_fieldInline","Button_FormAction","Input_Text","input_fieldEntry","Input_Username","Input_Password","showPassword","setShowPassword","eye","eyeSlash","Input_Phone","valueActual","setValueActual","Input_Email","Input_Currency","parseFloat","createEventProvider","canvas","windowSubs","canvasSubs","clientToGamePosition","rectCached","canvasPos","scaleByPixelRatio","windowAddEventListener","handler","canvasAddEventListener","tools","getMouseGamePosition","getTouchPositions","touch","dayjs","localizedFormat","relativeTime","formatDate","formatDate_FromNow","fromNow","delay","timeout","Vector2","divide","lengthSq","distanceSq","equal","Rect2","collidesRectangle","sizeRatio","input","pixelRatio","devicePixelRatio","Icon","menu","component","MdMenu","back","MdArrowBack","MdErrorOutline","FiChevronDown","FiChevronRight","MdContentCopy","FaRedo","dashboard","MdDashboard","FaPlus","remove","FaMinus","FaEye","FaEyeSlash","checkChecked","FaCheckSquare","checkUnchecked","FaSquare","MdCheckBoxOutlineBlank","getIcon","IconComponent","sizes","marginTop","paddingTop","paddingBottom","lineHeight","basicThemeColors","text_header","text_button","border_minor","border_input","background_field","background_button","background_error","loader","getBorderSizes","all","borderLeftWidth","borderRightWidth","borderTopWidth","borderBottomWidth","basicThemeSizes","borderWidth_minor","borderWidth_input","sectionGap","elementGap","rowGap","rowPadding","fontSize_input","fontSize_button","fontSize_header","minWidth_label","minWidth_input","minWidth_button","basicFont","fontWeight_normal","fontWeight_button","fontWeight_header","createTheme","font","borderProps","borderProps_minor","borderProps_input","sTextView","getSupportedFormat","gl","internalFormat","texture","createTexture","bindTexture","TEXTURE_2D","texParameteri","TEXTURE_MIN_FILTER","NEAREST","TEXTURE_MAG_FILTER","TEXTURE_WRAP_S","CLAMP_TO_EDGE","TEXTURE_WRAP_T","texImage2D","fbo","createFramebuffer","bindFramebuffer","FRAMEBUFFER","framebufferTexture2D","COLOR_ATTACHMENT0","checkFramebufferStatus","FRAMEBUFFER_COMPLETE","supportRenderTextureFormat","gl2","R16F","RG16F","RG","RGBA16F","RGBA","colorToString","forceCSSHex","colorFormat","__state","conversionName","hex","ARR_EACH","ARR_SLICE","Common","BREAK","each","isObject","isUndefined","defaults","compose","toCall","itr","scope","defer","fnc","debounce","threshold","callImmediately","delayed","callNow","toArray","isNull","isNaN","_isNaN","_x","isNumber","isString","isBoolean","isFunction","INTERPRETATIONS","litmus","conversions","THREE_CHAR_HEX","read","space","write","SIX_CHAR_HEX","CSS_RGB","CSS_RGBA","HEX","RGB_ARRAY","RGBA_ARRAY","RGBA_OBJ","RGB_OBJ","HSVA_OBJ","HSV_OBJ","toReturn","interpret","family","conversion","tmpComponent","ColorMath","hsv_to_rgb","hi","q","rgb_to_hsv","rgb_to_hex","hex_with_component","component_from_hex","componentIndex","classCallCheck","Constructor","createClass","defineProperties","descriptor","protoProps","staticProps","property","receiver","desc","getOwnPropertyDescriptor","getter","inherits","subClass","superClass","possibleConstructorReturn","self","ReferenceError","Color","defineRGBComponent","componentHexIndex","recalculateRGB","defineHSVComponent","recalculateHSV","COMPONENTS","Controller","initialValue","domElement","__onChange","__onFinishChange","newValue","updateDisplay","getValue","EVENT_MAP_INV","HTMLEvents","MouseEvents","KeyboardEvents","CSS_VALUE_PIXELS","cssValueToPixels","dom","makeSelectable","selectable","onselectstart","KhtmlUserSelect","unselectable","makeFullscreen","hor","vert","vertical","horizontal","fakeEvent","eventType","pars","aux","evt","createEvent","initMouseEvent","bubbles","cancelable","clickCount","initKeyboardEvent","initKeyEvent","ctrlKey","altKey","metaKey","keyCode","charCode","initEvent","dispatchEvent","newBool","attachEvent","unbind","detachEvent","addClass","classes","removeClass","removeAttribute","hasClass","getWidth","getComputedStyle","getHeight","getOffset","el","offsetParent","offsetLeft","offsetTop","isActive","activeElement","href","BooleanController","_Controller","_this2","_this","__prev","__checkbox","setAttribute","setValue","checked","OptionController","opts","__select","opt","innerHTML","desiredValue","selectedIndex","StringController","__input","blur","numDecimals","NumberController","_params","__min","__max","__step","__impliedStep","pow","LN10","__precision","_v","minValue","maxValue","stepValue","NumberControllerBox","_NumberController","__truncationSuspended","prevY","onFinish","onMouseDrag","attempted","decimals","tenTo","i1","i2","o1","o2","NumberControllerSlider","bgRect","__background","__foreground","pct","FunctionController","__button","fire","ColorController","__color","__temp","__selector","__saturation_field","__field_knob","__field_knob_border","__hue_knob","__hue_field","__input_textShadow","valueField","fieldDown","setSV","fieldUpSV","fieldDownH","setH","fieldUpH","toOriginal","fieldRect","boxShadow","borderRight","cursor","linearGradient","cssText","textShadow","mismatch","flip","_flip","toHexString","vendors","vendor","css","cssContent","indoc","injected","getElementsByTagName","saveDialogContents","ControllerFactory","requestAnimationFrame$1","requestAnimationFrame","webkitRequestAnimationFrame","mozRequestAnimationFrame","oRequestAnimationFrame","msRequestAnimationFrame","CenteredDiv","backgroundElement","WebkitTransition","transition","hide","webkitTransform","layout","innerWidth","innerHeight","___$insertStyle","SUPPORTS_LOCAL_STORAGE","SAVE_DIALOGUE","autoPlaceVirgin","autoPlaceContainer","hideableGuis","GUI","__ul","__folders","__controllers","__rememberedObjects","__rememberedObjectIndecesToControllers","__listening","closeOnTop","autoPlace","DEFAULT_WIDTH","resizable","hideable","preset","scrollable","useLocalStorage","getLocalStorageHash","saveToLocalStorage","titleRow","getRoot","gui","__preset_select","setPresetSelectIndex","revert","setWidth","closed","CLASS_CLOSED","onResize","__closeButton","TEXT_OPEN","TEXT_CLOSED","CLASS_MAIN","savedGui","CLASS_CLOSE_BUTTON","CLASS_CLOSE_TOP","insertBefore","childNodes","CLASS_CLOSE_BOTTOM","titleRowName","createTextNode","addRow","CLASS_AUTO_PLACE_CONTAINER","CLASS_AUTO_PLACE","__resizeHandler","onResizeDebounced","addResizeHandle","getSaveObject","saveToLocalStorageIfPossible","newDom","liBefore","li","removeListeners","markPresetModified","recallSavedValue","controller","matchedIndex","controllerMap","remembered","presetMap","_add","factoryArgs","before","__li","CLASS_CONTROLLER_ROW","__gui","_options","nextSibling","nextElementSibling","_nextSibling","_name","firstElementChild","listen","box","pc","pb","returned","oldName","wasListening","newController","borderLeftColor","isModified","augmentController","addPresetOption","setSelected","showHideExplain","explain","addSaveMenu","__save_row","firstChild","gears","button2","button3","select","getElementById","localStorageCheckBox","newConstructorTextArea","which","show","presetName","saveAs","pmouseX","drag","dragStop","CLASS_DRAG","dragStart","__resize_handle","getCurrentPreset","useInitialValues","savedValues","toggleHide","CLASS_TOO_TALL","_keydownHandler","addColor","removeChild","subfolder","removeFolder","addFolder","newGuiParams","folders","folder","parentElement","open","offsetHeight","remember","updateDisplays","controllerArray","GUI$1","clamp01","correctDeltaX","aspectRatio","correctDeltaY","generateColor","HSVtoRGB","hash","randomIntRange","minInclusive","maxInclusive","createTextureUtils","ext","createFrameBufferObject","getResolution","resolution","drawingBufferWidth","drawingBufferHeight","captureScreenshot","render","res","formatRGBA","halfFloatTexType","filename","uri","link","datauri","captureCanvas","getContext","imageData","createImageData","putImageData","textureToCanvas","Uint8Array","nid","normalizeTexture","frameBuffer","Float32Array","readPixels","FLOAT","framebufferToTexture","toDataURL","download","append","click","URL","revokeObjectURL","ShaderMaterial","vertexShader","fragmentShaderSource","programs","activeProgram","uniforms","setKeywords","keywords","program","fragmentShader","compileShader","FRAGMENT_SHADER","createProgram","getUniforms","useProgram","ShaderProgram","runFluidSimulator","host","contentPath","timeProvider","isPaused","resizeCanvas","PointerEntity","texcoordX","texcoordY","prevTexcoordX","prevTexcoordY","deltaX","deltaY","down","moved","pointers","splatStack","webGlSystem","alpha","depth","stencil","antialias","preserveDrawingBuffer","getExtension","supportLinearFiltering","HALF_FLOAT","clearColor","formatRG","formatR","RED","gl1","halfFloat","HALF_FLOAT_OES","getWebGLSystem","frameBufferFactory","param","activeTexture","TEXTURE0","viewport","clear","COLOR_BUFFER_BIT","texelSizeX","texelSizeY","attach","createDoubleFrameBufferObject","fbo1","fbo2","swap","createFrameBufferFactory","shaderFactory","keywordsString","keyword","addKeywords","shader","createShader","shaderSource","getShaderParameter","COMPILE_STATUS","trace","getShaderInfoLog","attachShader","linkProgram","getProgramParameter","LINK_STATUS","getProgramInfoLog","uniformCount","ACTIVE_UNIFORMS","uniformName","getActiveUniform","getUniformLocation","createShaderFactory","SIM_RESOLUTION","DYE_RESOLUTION","CAPTURE_RESOLUTION","DENSITY_DISSIPATION","VELOCITY_DISSIPATION","PRESSURE","PRESSURE_ITERATIONS","CURL","SPLAT_RADIUS","SPLAT_FORCE","SHADING","COLORFUL","COLOR_UPDATE_SPEED","PAUSED","BACK_COLOR","TRANSPARENT","BLOOM","BLOOM_ITERATIONS","BLOOM_RESOLUTION","BLOOM_INTENSITY","BLOOM_THRESHOLD","BLOOM_SOFT_KNEE","SUNRAYS","SUNRAYS_RESOLUTION","SUNRAYS_WEIGHT","MOTION_X","MOTION_Y","userAgent","disableGui","initFramebuffers","updateKeywords","dat","onFinishChange","fun","bloomFolder","sunraysFolder","captureFolder","github","githubIcon","startGUI","ditheringTexture","LINEAR","REPEAT","RGB","UNSIGNED_BYTE","image","Image","createTextureAsync","dye","velocity","divergence","curl","pressure","bloom","sunrays","sunraysTemp","shaders","baseVertexShader","VERTEX_SHADER","blurVertexShader","blurShader","copyShader","clearShader","colorShader","checkerboardShader","displayShaderSource","bloomPrefilterShader","bloomBlurShader","bloomFinalShader","sunraysMaskShader","sunraysShader","splatShader","advectionShader","divergenceShader","curlShader","vorticityShader","pressureShader","gradientSubtractShader","createShaders","blurProgram","copyProgram","clearProgram","colorProgram","checkerboardProgram","bloomPrefilterProgram","bloomBlurProgram","bloomFinalProgram","sunraysMaskProgram","sunraysProgram","splatProgram","advectionProgram","divergenceProgram","curlProgram","vorticityProgram","pressureProgram","gradientSubtractProgram","displayMaterial","blit","bindBuffer","ARRAY_BUFFER","createBuffer","bufferData","STATIC_DRAW","ELEMENT_ARRAY_BUFFER","Uint16Array","vertexAttribPointer","enableVertexAttribArray","drawElements","TRIANGLES","UNSIGNED_SHORT","createFrameBufferUtils","bloomFramebuffers","resizeDoubleFBO","newFBO","uniform1i","uTexture","resizeFBO","simRes","dyeRes","texType","rgba","rg","filtering","disable","BLEND","initBloomFramebuffers","initSunraysFramebuffers","displayKeywords","frameTick","dt","dtActual","lastUpdateTime","calcDeltaTime","colorUpdateTimer","range","updateColors","lastSplat","pop","multipleSplats","pointer","dx","dy","splat","applyInputs","uniform2f","texelSize","uVelocity","uCurl","uniform1f","uDivergence","uPressure","dyeTexelSize","velocityId","uSource","dissipation","motion","clientHeight","mask","destination","knee","curve0","curve1","curve2","uniform3f","curve","dest","blendFunc","ONE","enable","baseTex","intensity","applyBloom","weight","iterations","ONE_MINUS_SRC_ALPHA","uniform4f","drawColor","drawCheckerboard","uBloom","uDithering","getTextureScale","ditherScale","uSunrays","drawDisplay","amount","uTarget","radius","correctRadius","disableInput","updatePointerDownData","posX","posY","updatePointerMoveData","updatePointerUpData","offsetX","offsetY","targetTouches","entries","pageX","pageY","identifier","changedTouches","code","pointerMap","disableStartupSplats","getDisplaySize","getFrameTick","updateConfig","active","moveItem","to","distinct","Set","groups","sameArrayContents","greedy","inside","typeInside","alias","ts","toLength","flattenIntoArray","sourceLen","mapper","thisArg","targetIndex","mapFn","addToUnscopables","createRandomGenerator","xmur3","_self","uniqueId","manual","disableWorkerMessageHandler","encode","tokens","Token","objId","deepClone","getLanguage","currentScript","stack","defaultActivation","no","classList","contains","redef","insert","grammar","ret","token","newToken","old","DFS","propertyType","plugins","highlightAll","async","highlightAllUnder","env","selector","hooks","run","highlightElement","nodeName","textContent","insertHighlightedCode","highlightedCode","Worker","worker","onmessage","postMessage","immediateClose","highlight","tokenize","rest","tokenList","LinkedList","addAfter","matchGrammar","startNode","startPos","rematch","cause","patternObj","global","currentNode","tail","reach","removeCount","matchPattern","matchStr","after","removeFrom","prev","removeRange","wrapped","list","matchedStr","lookbehindLength","newNode","count","attributes","aliases","highlightAutomaticallyCallback","hasAttribute","WorkerGlobalScope","markup","tagName","includedCdataInside","def","html","mathml","svg","xml","ssml","atom","rss","addInlined","clike","javascript","regex","js","matches","msMatchesSelector","webkitMatchesSelector","EXTENSIONS","SELECTOR","pre","getAttribute","extension","setLanguageClass","autoloader","loadLanguages","xhr","XMLHttpRequest","onreadystatechange","responseText","statusText","fileHighlight","logged","useMounted","mounted","useDebounce","timeMs","debouncer","timeoutId","action","loadingError","setLoadingError","doWorkInner","contextInit","doCall","createSpellingProblemService","maxAnswers","sectionSize","speech","spellingEntries","getSpellingEntries","sectionCount","nextIndex","completedSectionKeys","getSectionKey","sectionIndex","loaded","isComplete","correctValue","word","wrongAnswerCount","wrongValues","mispellings","onQuestion","sectionKey","mainView","mainView_column","tabView","tabView_selected","tabText","tabText_selected","headerTabView","headerTabText","moveButtonView","justifyContents","TabsListEditorComponent","TabsComponent","oldIndex","newItems","onAdd","newItem","jsx","stringifyToken","walkTokens","openedTags","notTagNorBrace","openedBraces","plainText","GamepadAnalogStateful","moveDirection","buttons","isDown","onPressStateChange","onMovePressIn","dir","onMovePressOut","inputStyles","section","moveSectionWrapper","moveSectionRotation","row","cellTouch","cellView","pointerEvents","cellText","moveCellText","cellEmptyView","cellTextOcclusionView","GamepadAnalog","cellViewStyle","onKeyDown","onKeyUp","DirectionButton","direction","ActionButton","Fragment","getDistanceSq","EducationalGame_StarBlastSideways_Multiples","problemService","createAutoSavedProblemService","bVal","EducationalGame_StarBlastSideways","EducationalGame_StarBlastSideways_Inner","paused","pauseState","setPauseState","pressState","setPressState","problemSourceKey","setProblemSourceKey","gamepad","onOpen","onSubjectNavigation","viewscreen","gameStyles","directAnswerButtonContainer","directAnswerButton","directAnswerButton_hidden","viewscreenView","sprite","viewSize","fontSize_small","gameOver","GameView","getDefaultGameState","lastActualTimeMs","lastGameTime","gameSpeed","lives","getGameTime","actualTimePassed","gameTime","gameTimePassed","playerPositionState","rotation","projectilesState","lastShotActualTime","shots","debris","enemiesState","enemies","problemsState","restartGame","e2","gotoNextProblem","pSize","newProblemState","problemTime","isAnsweredWrong","newEnemyState","ans","enemy","vel","onHit","ignore","destroyed","gameLastTime","gameLoop","gameDeltaTime","getCommonState","playerPosition","onLoseLife","deadTime","gameOverTime","gameResult","updateGame","playerResult","updatePlayer","projectilesResult","updateProjectiles","enemiesResult","updateEnemies","timeSinceProblem","hasHitGround","explodeTime","weaponsLock","lockedEnemy","lockedAtPlayerPosition","playerTargetPosition","directAnswer","dirPress","targetPos","sign","targetRotation","gw","gh","playerPos","didShoot","destoyed","pad","hPad","shift","newShots","radiusSq","radiusSq_enemies","radiusSq_player","wPad","closestEnemyToPlayer","newEnemies","Sprite","getSpriteEmoji","stylePosition","styleRotation","TextPositioned","englishKeyboard","rowView","keyView","keyView_disabled","keyText","keyText_wrong","KeyboardSimplified","expectedCharacter","showHints","onExpectedKeyPress","keyboard","hintKeys","setHintKeys","wrongKeys","setWrongKeys","hints","iRow","drawingChoicesView","drawingChoiceWrapper","drawingChoice","titleView","titleText","promptView","promptText","hintText","buttonRowView","DoodleGameView_DrawWord","setDrawing","hint","onSkip","DoodleGameView_ChooseBest","onChooseBest","typeStyles","completedText","DoodleGameView_TypeExpected","completed","remaining","setStatus","sayAgain","nextChar","createLeaderboard","leaderboard","saveScore","loadScore","sortKey","storageKey","sortDescending","leaderboardInputStyles","textInput","LeaderboardNameInput","setName","leaderboardStyles","scoreView","nameText","scoreText","LeaderboardViewInner","scoreColumns","scores","useLeaderboard","getScore","leaderboardScores","setLeaderboardScores","LeaderboardArea","onScoreSaved","userProfileChracters","UserProfileManagerView","onActiveUserChange","onUserProfileChange","onUserAdded","AddUserProfileView","shareCode","setShareCode","addUserFromShareCode","UserProfileView","setCharacters","setUserProfileInfo","onNameChange","createShareCode","UserProfileName","isEditingName","setIsEditingName","changeName","getLessonNavigatorItems","lastLesson","lastLessonMainFile","LessonModulePlayer","setItems","activeItem","setActiveItem","nextStep","useTimeout","itemsToUse","activeItemToUse","itemSteps","activeItemStepIndex","activeItemIndex","nextItem","LessonModuleNavigator","targetItem","borderTop","repo","navigatorStyles","outerContainer","contentContainer","itemsContainer","itemView_header","itemView","itemView_selected","itemText","itemText_selected","hasLoadedHash","isNarrowScreen","setIsNarrowScreen","matchItem","replaceState","timeoutMs","race","fetch","reqData","catch","responseStatus","request","diff_1","strings","computeDiff","modifiedSequence","LineMarkerSequence","lines","startColumns","endColumns","length_1","_getFirstNonBlankColumn","_getLastNonBlankColumn","_lines","_startColumns","_endColumns","getStartLineNumber","getStartColumn","getEndLineNumber","getEndColumn","txt","defaultValue","getCharSequence","shouldIgnoreTrimWhitespace","endIndex","charCodes","lineNumbers","columns","lineContent","startColumn","endColumn","col","CharSequence","_charCodes","_lineNumbers","_columns","CharChange","originalStartLineNumber","originalStartColumn","originalEndLineNumber","originalEndColumn","modifiedStartLineNumber","modifiedStartColumn","modifiedEndLineNumber","modifiedEndColumn","createFromDiffChange","diffChange","originalCharSequence","modifiedCharSequence","LineChange","charChanges","createFromDiffResult","originalLineSequence","modifiedLineSequence","shouldComputeCharChanges","shouldPostProcessCharChanges","rawChanges","currChange","originalMatchingLength","modifiedMatchingLength","postProcessCharChanges","length_2","DiffComputer","originalLines","modifiedLines","shouldMakePrettyDiff","maximumRunTimeMs","computationStartTime","_continueProcessingPredicate","lineChanges","length_3","originalLineIndex","modifiedLineIndex","nextChange","originalLine","modifiedLine","_pushTrimWhitespaceCharChange","originalMaxColumn","modifiedMaxColumn","originalLineNumber","modifiedLineNumber","_mergeTrimWhitespaceCharChange","getSpanRange","endLine","startLine","otherAtStart","afterEnd","span","cAfterEnd","lineSpans","otherAtEnd","cStart","aSpan","bSpan","aLineSpans","bLineSpans","aSpanRange","bSpanRange","finalProjectState","newProjectState","oldFile","newFile","future","past","yy","fromToBase","thresholds","rounding","toNow","fails","whitespaces","METHOD_NAME","toObject","aFunction","arraySpeciesCreate","callbackfn","O","subjectStyles","SubjectNavigator","scrollTo","createProblemStateStorage","uploadApi","getUserProfile","getActiveUserProfile","uploadBackup","uploadWithAutoRenew","updateUserProfileFromServer","updateAllProfilesFromServer","isSetupStarted","isSetupDone","getUserDataServiceState","setUserDataServiceState","getUserData","userState","activeUserProfileKey","metadata","clearUserData","removeItem","lastUploadTimestamp","setUserData","userData","userProfileKey","upload","newUploarUrl","doSetup","newUploadUrlResult","newState","changeTimestamp","user","stateJson","downloadUserDataIfNewer","info","uData","shareablePath","shareUrlResult","shareGetUrl","sharedUploadUrl","userKey","randomBinary","fromCharCode","getCodeParts","codeWithClasses","tagsWithCode","iTagLast","iTagLength","tagContext","tagsWithClasses","context","classInfos","cParts","classContentParts","classContent","parseHighlightedSpans","codeParts","indexAfterEnd","_rawCode","codePartsFailed","codePartsAll","modifyCodeParts","isInSelection","inRange","codeFocus","getCodePart","shouldSplitStart","shouldSplitEnd","iCodeStart","iCodeAfterEnd","within","getAutoComplete","codeFocusCompleted","nextPartIndexRaw","nextPartIndex","activePartText","iDone","lengthCompleted","activePartTextCompleted","matchWords","choices","textCompleted","isWrong","activeIndex","CodeDisplay","inputOptions","Cursor","CodeSpan","cursorIndex","promptIndex","hasCursor","hasActive","hasPrompt","CursorComponent","cursorBlinkState","setCursorBlinkState","autoCompleteStyles","wrapper","item_selected","textNew","AutoCompleteComponent","autoComplete","onAutocomplete","promptStyles","text_positive","text_negative","PromptComponent","promptRaw","feedback","hideFeedback","setHideFeedback","showFeedback","textStyle","isNegative","goodEmojis","badEmojis","LessonFileContentEditor_ConstructCode","setCodeParts","inputRef","setAutoComplete","inputText","setInputText","setIsActive","setFeedback","nextLetter","changeInputText","valueRaw","newInput","wasBackspace","wasTab","endsWith","wasReturn","wasPeriod","wasSpace","isWhitespace","wasCorrectRaw","wasAutoComplete","activeAutoComplete","value2","wasCorrect_ignoreWhitespace","wasCorrect","activeCodeParts","incomplete","codePartsCompleted","isIncomplete","showBlank","getCodePartsCompleted","choice","iSelected","iSelectedNew","LessonFileContentEditor_UnderstandCode","fillInBlanks","setFillInBlanks","fillInBlank","setFillInBlank","descriptionsWithBlanks","textWithBlanks","textWithoutBlanks","onPressCodePart","part","iBlank","nextWithBlanks","withoutBlank","activePrompt","LessonProjectFilesEditor","activeFilePath","setActiveFilePath","lastFocusSet","focusFile","newFocus","activeFile","attempt","fileEditorMode","LessonFileEditor","filePathEdit","setFilePathEdit","onCodeChange","LessonFileContentEditor","LessonFileContentEditor_Display","LessonFileContentEditor_Edit"],"mappings":"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","file":"commons-8e3a941a854fb9d0d400.js","sourcesContent":["export default function _getPrototypeOf(o) {\n  _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf : function _getPrototypeOf(o) {\n    return o.__proto__ || Object.getPrototypeOf(o);\n  };\n  return _getPrototypeOf(o);\n}","export default function _setPrototypeOf(o, p) {\n  _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) {\n    o.__proto__ = p;\n    return o;\n  };\n\n  return _setPrototypeOf(o, p);\n}","export default function _isNativeReflectConstruct() {\n  if (typeof Reflect === \"undefined\" || !Reflect.construct) return false;\n  if (Reflect.construct.sham) return false;\n  if (typeof Proxy === \"function\") return true;\n\n  try {\n    Date.prototype.toString.call(Reflect.construct(Date, [], function () {}));\n    return true;\n  } catch (e) {\n    return false;\n  }\n}","import setPrototypeOf from \"@babel/runtime/helpers/esm/setPrototypeOf\";\nimport isNativeReflectConstruct from \"@babel/runtime/helpers/esm/isNativeReflectConstruct\";\nexport default function _construct(Parent, args, Class) {\n  if (isNativeReflectConstruct()) {\n    _construct = Reflect.construct;\n  } else {\n    _construct = function _construct(Parent, args, Class) {\n      var a = [null];\n      a.push.apply(a, args);\n      var Constructor = Function.bind.apply(Parent, a);\n      var instance = new Constructor();\n      if (Class) setPrototypeOf(instance, Class.prototype);\n      return instance;\n    };\n  }\n\n  return _construct.apply(null, arguments);\n}","import getPrototypeOf from \"@babel/runtime/helpers/esm/getPrototypeOf\";\nimport setPrototypeOf from \"@babel/runtime/helpers/esm/setPrototypeOf\";\nimport isNativeFunction from \"@babel/runtime/helpers/esm/isNativeFunction\";\nimport construct from \"@babel/runtime/helpers/esm/construct\";\nexport default function _wrapNativeSuper(Class) {\n  var _cache = typeof Map === \"function\" ? new Map() : undefined;\n\n  _wrapNativeSuper = function _wrapNativeSuper(Class) {\n    if (Class === null || !isNativeFunction(Class)) return Class;\n\n    if (typeof Class !== \"function\") {\n      throw new TypeError(\"Super expression must either be null or a function\");\n    }\n\n    if (typeof _cache !== \"undefined\") {\n      if (_cache.has(Class)) return _cache.get(Class);\n\n      _cache.set(Class, Wrapper);\n    }\n\n    function Wrapper() {\n      return construct(Class, arguments, getPrototypeOf(this).constructor);\n    }\n\n    Wrapper.prototype = Object.create(Class.prototype, {\n      constructor: {\n        value: Wrapper,\n        enumerable: false,\n        writable: true,\n        configurable: true\n      }\n    });\n    return setPrototypeOf(Wrapper, Class);\n  };\n\n  return _wrapNativeSuper(Class);\n}","export default function _isNativeFunction(fn) {\n  return Function.toString.call(fn).indexOf(\"[native code]\") !== -1;\n}","export const getValuesAsItems = <T>(obj: T) => {\r\n    return Object.keys(obj).map(k => k as keyof typeof obj).map(k => obj[k]).filter(x => x);\r\n};\r\n\r\nexport const toKeyValueObject = <T>(items: { key: string, value: T }[]): { [key: string]: T } => {\r\n    const v = {} as { [key: string]: T };\r\n    items.forEach(x => { v[x.key] = x.value; });\r\n    return v;\r\n};\r\n\r\nexport const toMap = <T>(items: { key: string, value: T }[]): Map<string, T> => {\r\n    const v = new Map(items.map(x => [x.key, x.value]));\r\n    return v;\r\n};\r\n\r\nexport const toKeyValueArray = <T>(obj: { [key: string]: T }): { key: string, value: T }[] => {\r\n    return Object.keys(obj).map(k => k as keyof typeof obj).map(k => ({ key: k as string, value: obj[k] }));\r\n};\r\n","\"use strict\";\n\nfunction __export(m) {\n  for (var p in m) {\n    if (!exports.hasOwnProperty(p)) exports[p] = m[p];\n  }\n}\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\n__export(require(\"./diffComputer\"));\n\n__export(require(\"./diff\"));\n\n__export(require(\"./charCode\"));\n\n__export(require(\"./diffChange\"));\n\n__export(require(\"./strings\"));","import { WebsocketConnectionEvent } from './types';\r\nimport { createWebsocketClient } from './websocket-client';\r\n\r\nexport const createWebsocketConnection_smart = <TWebsocketMessage>(config: { websocketsApiUrl: string, channelKey: string }, messageHandler: (message: TWebsocketMessage) => void) => {\r\n    const messages = [] as (TWebsocketMessage & { _r: number })[];\r\n    const events = [] as WebsocketConnectionEvent[];\r\n    const sendRef = {\r\n        send: null as null | ((message: TWebsocketMessage) => void),\r\n    };\r\n    const outbox = [] as TWebsocketMessage[];\r\n\r\n    const connection = createWebsocketClient({ websocketsApiUrl: config.websocketsApiUrl })\r\n        .connect<TWebsocketMessage>({ channelKey: config.channelKey });\r\n\r\n    const subMessages = connection.subscribeMessages(message => {\r\n        messageHandler(message);\r\n        messages.push({ ...message, _r: Date.now() });\r\n    });\r\n    const subEvents = connection.subscribeConnectionEvents(event => {\r\n        sendRef.send = connection.isConnected() ? connection.send : null;\r\n        events.push(event);\r\n    });\r\n\r\n    const sendIntervalId = setInterval(() => sendOutbox(), 250);\r\n\r\n    const unsubscribe = () => {\r\n        clearInterval(sendIntervalId);\r\n        sendRef.send = null;\r\n        subMessages.unsubscribe();\r\n        subEvents.unsubscribe();\r\n        connection.close();\r\n    };\r\n\r\n    const sendOutbox = () => {\r\n        if (!sendRef.send) { return; }\r\n\r\n        const o = outbox.splice(0, outbox.length);\r\n        for (const x of o) {\r\n            sendRef.send(x);\r\n        }\r\n    };\r\n\r\n    const sendMessageWithOutbox = (message: TWebsocketMessage) => {\r\n        if (!sendRef.send) {\r\n            outbox.push(message);\r\n            return;\r\n        }\r\n\r\n        sendOutbox();\r\n        sendRef.send(message);\r\n    };\r\n\r\n\r\n    return {\r\n        send: sendMessageWithOutbox,\r\n        unsubscribe,\r\n        history: {\r\n            messages,\r\n            events,\r\n        },\r\n    };\r\n};\r\n","import { createWebsocketConnection_smart } from 'websockets-api/client/websocket-client-smart';\r\nimport { createSubscribable } from 'utils/subscribable';\r\nimport { AppError } from 'utils/error';\r\nimport { websocketsApiConfig } from 'websockets-api/client/config';\r\nimport { distinct_key } from 'utils/arrays';\r\n\r\ntype Timestamp = number & { __type: 'Timestamp' }\r\ntype ClientKey = string & { __type: 'ClientKey' }\r\nconst createWebMeshClient_websocketOnly = <TMeshState, TMeshMessage>({\r\n    channelKey,\r\n    initialState: initialMeshState,\r\n    reduceState,\r\n    reduceClientsState,\r\n}: {\r\n    channelKey: string;\r\n    initialState: TMeshState;\r\n    reduceState: (previousState: TMeshState, message: TMeshMessage) => TMeshState;\r\n    reduceClientsState: (previousState: TMeshState, clients: { key: string, lastActivityTimestamp: Timestamp }[]) => TMeshState;\r\n}) => {\r\n    const WEB_MESH_CLIENT_KEY = `_webMeshClientKey`;\r\n    const clientKey = (localStorage.getItem(WEB_MESH_CLIENT_KEY) ?? (`${Date.now()}-${Math.floor(Math.random() * 999999)}`)) as ClientKey;\r\n    localStorage.setItem(WEB_MESH_CLIENT_KEY, clientKey);\r\n\r\n    const stateSub = createSubscribable<TMeshState>();\r\n    const state = {\r\n        meshState: initialMeshState,\r\n        meshMetaData: {\r\n            clients: [] as { key: string, lastActivityTimestamp: Timestamp }[],\r\n            firstMessageTimestamp: 0 as Timestamp,\r\n            lastMessageTimestamp: 0 as Timestamp,\r\n        },\r\n    };\r\n    const messageHistory = [] as WebSocketMessageWithSenderInfo[];\r\n\r\n    type WebSocketMessage = (\r\n        { kind: 'join' }\r\n        | { kind: 'close' }\r\n        | { kind: 'sync', state: typeof state }\r\n        | { kind: 'ping', clientKeys: string[] }\r\n        | { kind: 'pong' }\r\n        | { kind: 'drop', clientKeys: string[] }\r\n        | { kind: 'message', message: TMeshMessage }\r\n    );\r\n    type WebSocketMessageWithSenderInfo = { t: Timestamp, c: ClientKey } & WebSocketMessage;\r\n\r\n    const updateClients = (message: { c: ClientKey, t: Timestamp }) => {\r\n        const oldClients = [...state.meshMetaData.clients];\r\n        state.meshMetaData.clients = state.meshMetaData.clients.filter(x => x.key !== message.c);\r\n        state.meshMetaData.clients.push({ key: message.c, lastActivityTimestamp: message.t });\r\n        state.meshMetaData.clients.sort((a, b) => -(a.lastActivityTimestamp - b.lastActivityTimestamp));\r\n\r\n        if (oldClients.map(x => x.key).join(`;`) !== state.meshMetaData.clients.map(x => x.key).join(`;`)) {\r\n            state.meshState = reduceClientsState(state.meshState, state.meshMetaData.clients);\r\n            stateSub.onStateChange(state.meshState);\r\n        }\r\n    };\r\n\r\n    let sendSyncStateTimeoutId = setTimeout(() => { }, 0);\r\n    const websocket = createWebsocketConnection_smart<WebSocketMessageWithSenderInfo>({ websocketsApiUrl: websocketsApiConfig.websocketsApiUrl, channelKey: `wm_${channelKey}` }, message => {\r\n\r\n        if (message.kind === `close`) {\r\n            clearTimeout(sendSyncStateTimeoutId);\r\n            state.meshMetaData.clients = state.meshMetaData.clients.filter(x => x.key !== message.c);\r\n            state.meshState = reduceClientsState(state.meshState, state.meshMetaData.clients);\r\n            stateSub.onStateChange(state.meshState);\r\n            return;\r\n        }\r\n\r\n        updateClients(message);\r\n\r\n        if (message.kind === `pong`) {\r\n            clearTimeout(pingPongDropTimeoutId ?? 0);\r\n            pingPongDropTimeoutId = null;\r\n            return;\r\n        }\r\n        if (message.kind === `ping`) {\r\n            clearTimeout(pingPongDropTimeoutId ?? 0);\r\n            pingPongDropTimeoutId = null;\r\n            if (message.clientKeys.includes(clientKey)) {\r\n                setTimeout(sendPong);\r\n            }\r\n            return;\r\n        }\r\n        if (message.kind === `drop`) {\r\n            clearTimeout(pingPongDropTimeoutId ?? 0);\r\n            pingPongDropTimeoutId = null;\r\n            state.meshMetaData.clients = state.meshMetaData.clients.filter(x => !message.clientKeys.some(c => c === x.key));\r\n            state.meshState = reduceClientsState(state.meshState, state.meshMetaData.clients);\r\n            stateSub.onStateChange(state.meshState);\r\n            return;\r\n        }\r\n\r\n        if (message.kind === `join`) {\r\n            clearTimeout(sendSyncStateTimeoutId);\r\n\r\n            // Is self, ignore\r\n            if (message.c === clientKey) { return; }\r\n\r\n            // Respond with sync\r\n            const clientPriority = state.meshMetaData.clients.findIndex(x => x.key === clientKey) - 1;\r\n            const waitTime = clientPriority >= 0 ? clientPriority * 2000 : 10 * 1000;\r\n            sendSyncStateTimeoutId = setTimeout(sendSyncState, waitTime);\r\n            return;\r\n        }\r\n        if (message.kind === `sync`) {\r\n            // Is self, ignore\r\n            if (message.c === clientKey) { return; }\r\n\r\n            if (state.meshMetaData.firstMessageTimestamp\r\n                && state.meshMetaData.firstMessageTimestamp < message.state.meshMetaData.firstMessageTimestamp) {\r\n                // Ignore if the data is not complete (and send new sync message if needed)\r\n                sendSyncStateTimeoutId = setTimeout(sendSyncState, 10 * 1000);\r\n                return;\r\n            }\r\n\r\n            clearTimeout(sendSyncStateTimeoutId);\r\n\r\n            state.meshMetaData.firstMessageTimestamp = message.state.meshMetaData.firstMessageTimestamp;\r\n            state.meshMetaData.lastMessageTimestamp = message.state.meshMetaData.lastMessageTimestamp;\r\n            // state.meshMetaData.clients = message.state.meshMetaData.clients;\r\n            state.meshMetaData.clients = distinct_key([...state.meshMetaData.clients, ...message.state.meshMetaData.clients], x => x.key);\r\n            state.meshState = message.state.meshState;\r\n\r\n            // TODO: What about out of order messages?\r\n            // Replay missing messages\r\n            const missingMessages = messageHistory.filter(x => x.t > state.meshMetaData.lastMessageTimestamp);\r\n            for (const m of missingMessages) {\r\n                if (m.kind !== `message`) { return; }\r\n                state.meshState = reduceState(state.meshState, m.message);\r\n                state.meshMetaData.lastMessageTimestamp = m.t;\r\n            }\r\n\r\n            state.meshState = reduceClientsState(state.meshState, state.meshMetaData.clients);\r\n            stateSub.onStateChange(state.meshState);\r\n            return;\r\n        }\r\n        if (message.kind === `message`) {\r\n            // Accept own message into state once it returns\r\n            messageHistory.push(message);\r\n\r\n            if (!state.meshMetaData.firstMessageTimestamp) { state.meshMetaData.firstMessageTimestamp = message.t; }\r\n            state.meshMetaData.lastMessageTimestamp = message.t;\r\n            state.meshState = reduceState(state.meshState, message.message);\r\n            stateSub.onStateChange(state.meshState);\r\n        }\r\n    });\r\n\r\n    const sendWebSocketMessage = (message: WebSocketMessage) => {\r\n        websocket.send({ ...message, c: clientKey, t: Date.now() as Timestamp });\r\n    };\r\n    const connect = () => {\r\n        sendWebSocketMessage({ kind: `join` });\r\n    };\r\n    const sendSyncState = () => {\r\n        // Move self to front of client list\r\n        state.meshMetaData.clients = state.meshMetaData.clients.filter(x => x.key !== clientKey);\r\n        state.meshMetaData.clients.unshift({ key: clientKey, lastActivityTimestamp: Date.now() as Timestamp });\r\n\r\n        sendWebSocketMessage({ kind: `sync`, state });\r\n    };\r\n\r\n    // Ping-pong (Keep Alive)\r\n    const sendPong = () => {\r\n        sendWebSocketMessage({ kind: `pong` });\r\n    };\r\n    let pingPongDropTimeoutId = null as null | ReturnType<typeof setTimeout>;\r\n    const pingPongInterval = setInterval(() => {\r\n        if (pingPongDropTimeoutId) { return; }\r\n\r\n        const deadClients = state.meshMetaData.clients.filter(x => Date.now() > 45 * 1000 + x.lastActivityTimestamp);\r\n        if (deadClients.length > 0) {\r\n            // state.meshMetaData.clients = state.meshMetaData.clients.filter(x => !deadClients.some(d => d.key === x.key));\r\n            const clientPriority = state.meshMetaData.clients.findIndex(x => x.key === clientKey);\r\n            pingPongDropTimeoutId = setTimeout(() => {\r\n                pingPongDropTimeoutId = null;\r\n                const deadClients2 = state.meshMetaData.clients.filter(x => Date.now() > 45 * 1000 + x.lastActivityTimestamp);\r\n                if (deadClients2.length <= 0) { return; }\r\n                sendWebSocketMessage({ kind: `drop`, clientKeys: deadClients2.map(x => x.key) });\r\n            }, clientPriority * 5000);\r\n            return;\r\n        }\r\n\r\n        const oldClients = state.meshMetaData.clients.filter(x => Date.now() > 30 * 1000 + x.lastActivityTimestamp);\r\n        if (oldClients.length <= 0) { return; }\r\n\r\n        const clientPriority = state.meshMetaData.clients.findIndex(x => x.key === clientKey);\r\n        pingPongDropTimeoutId = setTimeout(() => {\r\n            pingPongDropTimeoutId = null;\r\n            const oldClients2 = state.meshMetaData.clients.filter(x => Date.now() > 30 * 1000 + x.lastActivityTimestamp);\r\n            if (oldClients2.length <= 0) { return; }\r\n\r\n            sendWebSocketMessage({ kind: `ping`, clientKeys: oldClients2.map(x => x.key) });\r\n        }, clientPriority * 5000);\r\n    }, 5000);\r\n\r\n    // Close\r\n    let isClosed = false;\r\n    const close = () => {\r\n        if (isClosed) { return; }\r\n        isClosed = true;\r\n        sendWebSocketMessage({ kind: `close` });\r\n        websocket.unsubscribe();\r\n        clearInterval(pingPongInterval);\r\n    };\r\n    const sendMessage = (message: TMeshMessage) => {\r\n        if (isClosed) { throw new AppError(`The connection is closed`); }\r\n        sendWebSocketMessage({ kind: `message`, message });\r\n    };\r\n\r\n\r\n    // Begin\r\n    connect();\r\n\r\n    return {\r\n        _webSocket: {\r\n            history: websocket.history,\r\n        },\r\n        clientKey,\r\n        sendMessage,\r\n        subscribe: stateSub.subscribe,\r\n        close,\r\n    };\r\n};\r\n\r\nexport type WebMeshClient = ReturnType<typeof createWebMeshClient>;\r\nexport type WebMeshClientWebSocketHistory = WebMeshClient['_webSocket']['history'];\r\nexport const createWebMeshClient = createWebMeshClient_websocketOnly;\r\n","export const randomIndex = (length: number) => {\r\n    const x = Math.floor(length * Math.random());\r\n    return x >= length ? length - 1 : x;\r\n};\r\nexport const randomItem = <T>(items: T[]) => items[randomIndex(items.length)];\r\n\r\nexport const randomOrder = <T>(items: T[]): T[] => items\r\n    .map(x => ({ x, i: Math.random() }))\r\n    .sort((a, b) => a.i - b.i)\r\n    .map(x => x.x);\r\n\r\n","\r\nexport enum IconKind {\r\n    // common icons\r\n    menu,\r\n    back,\r\n    error,\r\n    expanded,\r\n    collapsed,\r\n    copy,\r\n    retry,\r\n    dashboard,\r\n    add,\r\n    remove,\r\n    eye,\r\n    eyeSlash,\r\n\r\n    checkChecked,\r\n    checkUnchecked,\r\n\r\n    // navigation icons\r\n    account,\r\n    message,\r\n    subscription,\r\n    calendar,\r\n    contacts,\r\n    keys,\r\n    resources,\r\n    admin,\r\n}\r\n","'use strict';\nvar $ = require('../internals/export');\nvar $trimEnd = require('../internals/string-trim').end;\nvar forcedStringTrimMethod = require('../internals/string-trim-forced');\n\nvar FORCED = forcedStringTrimMethod('trimEnd');\n\nvar trimEnd = FORCED ? function trimEnd() {\n  return $trimEnd(this);\n} : ''.trimEnd;\n\n// `String.prototype.{ trimEnd, trimRight }` methods\n// https://tc39.es/ecma262/#sec-string.prototype.trimend\n// https://tc39.es/ecma262/#String.prototype.trimright\n$({ target: 'String', proto: true, forced: FORCED }, {\n  trimEnd: trimEnd,\n  trimRight: trimEnd\n});\n","import React, { useEffect, useRef, useState } from 'react';\r\nimport { Loading } from 'controls-react/loading';\r\nimport { useAutoLoadingError } from 'utils-react/hooks';\r\nimport { LessonProjectState, SetProjectState } from '../lesson-types';\r\n\r\nconst styles = {\r\n    container: {\r\n\r\n    },\r\n    iFrame: {\r\n        width: `100%`,\r\n        height: 300,\r\n        border: `solid 4px #888888`,\r\n        background: `#FFFFFF`,\r\n    },\r\n} as const;\r\n\r\nexport const LessonRenderView = (props: { iFrameUrl: string }) => {\r\n\r\n    const containerRef = useRef(null as null | HTMLDivElement);\r\n    const lastWidth = useRef(``);\r\n    const lastHeight = useRef(``);\r\n    const intervalId = useRef(setInterval(() => { }, 100 * 1000));\r\n    const onResizeHeight = (target: HTMLIFrameElement) => {\r\n        if (!containerRef.current) { return; }\r\n\r\n        try {\r\n            const borderSize = 4;\r\n            const width = `${containerRef.current.clientWidth - borderSize * 2}px`;\r\n            const height = `${(target.contentWindow?.document.body.scrollHeight ?? 300) + borderSize * 2}px`;\r\n            if (height !== lastHeight.current\r\n                || width !== lastWidth.current) {\r\n                lastWidth.current = width;\r\n                lastHeight.current = height;\r\n                target.style.width = width;\r\n                target.style.height = height;\r\n                target.style.border = `solid ${borderSize}px #888888`;\r\n            }\r\n        } catch {\r\n            // Ignore cross-domain error\r\n        }\r\n    };\r\n\r\n    const onLoad = (target: HTMLIFrameElement) => {\r\n        onResizeHeight(target);\r\n        clearInterval(intervalId.current);\r\n        intervalId.current = setInterval(() => onResizeHeight(target), 100);\r\n    };\r\n    useEffect(() => {\r\n        lastHeight.current = ``;\r\n        clearInterval(intervalId.current);\r\n        intervalId.current = setInterval(() => { }, 100 * 1000);\r\n        return () => {\r\n            clearInterval(intervalId.current);\r\n        };\r\n    }, [props.iFrameUrl]);\r\n\r\n    return (\r\n        <>\r\n            <div style={styles.container} ref={containerRef}>\r\n                <iframe style={styles.iFrame} src={props.iFrameUrl} title='Preview'\r\n                    onLoad={e => { onLoad(e.target as HTMLIFrameElement); }}\r\n                />\r\n            </div>\r\n        </>\r\n    );\r\n};\r\n\r\nexport const LessonProjectStatePreview = ({ projectState, setProjectState }: { projectState: LessonProjectState, setProjectState: SetProjectState }) => {\r\n    const { loading, error, doWork } = useAutoLoadingError();\r\n    const [iFrameUrl, setIFrameUrl] = useState(null as null | string);\r\n    useEffect(() => {\r\n        doWork(async (stopIfObsolete) => {\r\n            const r = await setProjectState(projectState);\r\n            setIFrameUrl(r.iFrameUrl);\r\n        });\r\n    }, [\r\n        projectState,\r\n    ]);\r\n    return (\r\n        <>\r\n            <Loading loading={loading} />\r\n            {!loading && iFrameUrl && (\r\n                <LessonRenderView iFrameUrl={iFrameUrl} />\r\n            )}\r\n        </>\r\n    );\r\n};\r\n","import { randomItem } from 'utils/random';\r\nimport { shuffle, distinct_key } from 'utils/arrays';\r\nimport { UploadUrl } from 'upload-api/client/types';\r\nimport { uploadApiConfig } from 'upload-api/client/config';\r\nimport { createSmartUploader, downloadData } from 'upload-api/client/uploader';\r\nimport { toKeyValueArray } from 'utils/objects';\r\nimport { createUploadApiWebClient } from 'upload-api/client/web-client';\r\nimport { DoodleDrawingStorageService, DoodleData, decodeDoodleDrawing, encodeDoodleDrawing, DoodleScoreVote, DoodleScore, DoodleUserDrawingDataJson, DoodleUserVotesDataJson, DoodleSummaryDataJson } from './doodle';\r\nimport { doodleStoragePaths } from './doodle-paths';\r\n\r\ntype DoodleStorageData = {\r\n    doodleUploadUrl?: UploadUrl;\r\n    scoresUploadUrl?: UploadUrl;\r\n};\r\n\r\nconst storageAccess = {\r\n    load: (): null | DoodleStorageData => {\r\n        try {\r\n            return JSON.parse(localStorage.getItem(`doodleStorage.v2`) ?? `NULL!{}`);\r\n        } catch{ return null; }\r\n    },\r\n    save: (value: DoodleStorageData) => {\r\n        localStorage.setItem(`doodleStorage.v2`, JSON.stringify(value));\r\n    },\r\n};\r\n\r\n\r\nexport const createDoodleDrawingStorageService = async () => {\r\n\r\n    const remoteDoodle = createSmartUploader<DoodleUserDrawingDataJson>({\r\n        getUploadUrl: async () => storageAccess.load()?.doodleUploadUrl ?? null,\r\n        setUploadUrl: async (x) => storageAccess.save({ ...(storageAccess.load() ?? {}), doodleUploadUrl: x }),\r\n        uploadApiUrl: uploadApiConfig.uploadApiUrl,\r\n        uploadUrlPrefix: doodleStoragePaths.doodleDrawingsPrefix,\r\n    });\r\n    const remoteVotes = createSmartUploader<DoodleUserVotesDataJson>({\r\n        getUploadUrl: async () => storageAccess.load()?.scoresUploadUrl ?? null,\r\n        setUploadUrl: async (x) => storageAccess.save({ ...(storageAccess.load() ?? {}), scoresUploadUrl: x }),\r\n        uploadApiUrl: uploadApiConfig.uploadApiUrl,\r\n        uploadUrlPrefix: doodleStoragePaths.doodleVotesPrefix,\r\n    });\r\n\r\n    const getSummaryData = async () => {\r\n        try {\r\n            let uploadUrl = storageAccess.load()?.doodleUploadUrl;\r\n\r\n            if (!uploadUrl) {\r\n                const uploadApiWebClient = createUploadApiWebClient(uploadApiConfig);\r\n                uploadUrl = (await uploadApiWebClient.createUploadUrl({})).uploadUrl;\r\n            }\r\n\r\n            const serverUrl = uploadUrl?.getUrl.replace(uploadUrl.relativePath, ``);\r\n            const summaryUrl = `${serverUrl}${doodleStoragePaths.doodleSummary}`;\r\n            console.log(`getSummaryData`, { uploadUrl, serverUrl, summaryUrl });\r\n\r\n            const summaryDataRaw = await downloadData(summaryUrl) as DoodleSummaryDataJson;\r\n            const summaryData = {\r\n                doodles: summaryDataRaw.doodles.map(x => ({\r\n                    key: x.k,\r\n                    prompt: x.p,\r\n                    timestamp: x.t,\r\n                    drawing: decodeDoodleDrawing(x.d),\r\n                    score: x.s,\r\n                })),\r\n            };\r\n            return summaryData;\r\n        } catch{\r\n            return { doodles: [] };\r\n        }\r\n    };\r\n    const summaryData = await getSummaryData();\r\n\r\n    const memory = {\r\n        doodles: [] as DoodleData[],\r\n        doodleScores: [] as DoodleScore[],\r\n        doodleVotes: [] as DoodleScoreVote[],\r\n    };\r\n\r\n\r\n    // Load from server\r\n    memory.doodles = (await remoteDoodle.load())?.doodles.map(x => ({\r\n        key: x.k,\r\n        prompt: x.p,\r\n        timestamp: x.t,\r\n        drawing: x.d ? decodeDoodleDrawing(x.d) : (x as unknown as DoodleData).drawing,\r\n    })) ?? [];\r\n    memory.doodleVotes = (await remoteVotes.load())?.doodleVotes ?? [];\r\n\r\n    const voteTotals = {} as { [key: string]: number };\r\n    // memory.doodleVotes.forEach(x => { voteTotals[x.k] = (voteTotals[x.k] ?? 0) + 1; });\r\n    summaryData.doodles.forEach(x => { voteTotals[x.key] = (voteTotals[x.key] ?? 0) + x.score; });\r\n    memory.doodleScores = toKeyValueArray(voteTotals).map(x => ({\r\n        doodleKey: x.key,\r\n        score: x.value,\r\n    }));\r\n\r\n    const service: DoodleDrawingStorageService = {\r\n        saveDrawing: async (prompt, drawing) => {\r\n            const doodle = { key: `${prompt.substr(0, 8)}:${Date.now()}:${Math.floor(Math.random() * 999999)}`, drawing, prompt, timestamp: Date.now() };\r\n            memory.doodles.push(doodle);\r\n\r\n            // Save to server\r\n            setTimeout(async () => {\r\n                await remoteDoodle.save({\r\n                    doodles: memory.doodles.map(x => ({\r\n                        k: x.key,\r\n                        p: x.prompt,\r\n                        t: x.timestamp,\r\n                        d: encodeDoodleDrawing(x.drawing),\r\n                    })),\r\n                });\r\n            });\r\n        },\r\n        saveBestDrawingSelection: async (doodle) => {\r\n            memory.doodleVotes.push({\r\n                k: doodle.key,\r\n                t: Date.now(),\r\n            });\r\n\r\n            let d = memory.doodleScores.find(x => x.doodleKey === doodle.key);\r\n            if (!d) {\r\n                d = {\r\n                    doodleKey: doodle.key,\r\n                    score: 0,\r\n                };\r\n                memory.doodleScores.push(d);\r\n            }\r\n            d.score = (d.score ?? 0) + 1;\r\n\r\n            // Save to server\r\n            setTimeout(async () => {\r\n                await remoteVotes.save({\r\n                    doodleVotes: memory.doodleVotes,\r\n                });\r\n            });\r\n        },\r\n        getDrawings: async (prompt, options) => {\r\n            const {\r\n                includeOtherPrompts = false,\r\n                maxCount = 4,\r\n            } = options ?? {};\r\n\r\n            const allDoodles = distinct_key([...summaryData.doodles, ...memory.doodles.map(x => ({ ...x, score: memory.doodleScores.find(s => s.doodleKey === x.key)?.score ?? 0 }))], x => x.key);\r\n\r\n            const samePromptDrawings = allDoodles.filter(x => x.prompt === prompt).sort((a, b) => -(a.score - b.score));\r\n            console.log(`getDrawings`, { samePromptDrawings });\r\n\r\n            const otherPromptDrawings = includeOtherPrompts ? allDoodles.filter(x => x.prompt !== prompt) : [];\r\n            const allDrawings =\r\n                includeOtherPrompts ? [randomItem(samePromptDrawings), ...shuffle(otherPromptDrawings).slice(0, maxCount - 1)]\r\n                    : samePromptDrawings;\r\n            const drawings = shuffle(allDrawings).slice(0, maxCount);\r\n            return { doodles: drawings };\r\n        },\r\n        getAllDrawings: async () => {\r\n            const allDoodles = distinct_key([...summaryData.doodles, ...memory.doodles.map(x => ({ ...x, score: memory.doodleScores.find(s => s.doodleKey === x.key)?.score ?? 0 }))], x => x.key);\r\n            return { doodles: allDoodles };\r\n        },\r\n    };\r\n\r\n    return service;\r\n};\r\n","import React, { useState, useEffect } from 'react';\r\nimport { View, Text, TouchableOpacity } from 'react-native-lite';\r\nimport { useAutoLoadingError } from 'utils-react/hooks';\r\nimport { UserDataService, UserProfileInfo } from './user-data-service';\r\nimport { UserProfileManagerView } from './user-profile-manager-view';\r\n\r\nconst styles = {\r\n    container: {\r\n        flexDirection: `row`,\r\n        flexWrap: `wrap`,\r\n        justifyContent: `space-around`,\r\n    },\r\n    profileContainer: {\r\n        flexDirection: `column`,\r\n        alignItems: `center`,\r\n    },\r\n    profileCharacterView: {\r\n        width: 80,\r\n        height: 80,\r\n        borderWidth: 1,\r\n        borderStyle: `solid`,\r\n        borderColor: `#888888`,\r\n    },\r\n    profileCharacterText: {\r\n        fontSize: 48,\r\n        textAlign: `center`,\r\n    },\r\n    profileNameView: {\r\n    },\r\n    profileNameText: {\r\n\r\n    },\r\n} as const;\r\n\r\nexport const UserProfileSelectionView = (props: { onUserSelected: () => void }) => {\r\n    const { loading, error, doWork } = useAutoLoadingError();\r\n    const [userProfiles, setUserProfiles] = useState(null as null | UserProfileInfo[]);\r\n    const [isManagerVisible, setIsManagerVisible] = useState(false);\r\n\r\n    const reload = () => doWork(async (stopIfObsolete) => {\r\n        await UserDataService.get().setup();\r\n        stopIfObsolete();\r\n\r\n        const profiles = await UserDataService.get().getUserProfiles();\r\n        setUserProfiles(profiles);\r\n    });\r\n\r\n    const selectUser = (key: string) => doWork(async (stopIfObsolete) => {\r\n        await UserDataService.get().setActiveUser(key);\r\n        props.onUserSelected();\r\n    });\r\n\r\n    const onEditProfiles = () => {\r\n        setIsManagerVisible(true);\r\n    };\r\n\r\n    useEffect(() => {\r\n        reload();\r\n    }, []);\r\n\r\n    if (!userProfiles) {\r\n        return (<></>);\r\n    }\r\n\r\n    if (isManagerVisible) {\r\n        return <UserProfileManagerView onClose={() => { setIsManagerVisible(false); reload(); }} />;\r\n    }\r\n\r\n    return (\r\n        <View style={styles.container}>\r\n            {userProfiles.map(x => (\r\n                <TouchableOpacity key={x.key} onPress={() => selectUser(x.key)}>\r\n                    <View style={styles.profileContainer}>\r\n                        <View style={styles.profileCharacterView}>\r\n                            <Text style={styles.profileCharacterText}>{x.emoji ?? ``}</Text>\r\n                        </View>\r\n                        <View style={styles.profileNameView}>\r\n                            <Text style={styles.profileNameText}>{x.name}</Text>\r\n                        </View>\r\n                    </View>\r\n                </TouchableOpacity>\r\n            ))}\r\n            <TouchableOpacity onPress={onEditProfiles}>\r\n                <View style={styles.profileContainer}>\r\n                    <View style={styles.profileCharacterView}>\r\n                        <Text style={styles.profileCharacterText}>{`  `}</Text>\r\n                    </View>\r\n                    <View style={styles.profileNameView}>\r\n                        <Text style={styles.profileNameText}>Edit</Text>\r\n                    </View>\r\n                </View>\r\n            </TouchableOpacity>\r\n        </View>\r\n    );\r\n};\r\n","export type EmojiSkillNode = {\r\n    emoji: string;\r\n    name: string;\r\n    gender: `baby` | `male` | `female`;\r\n    pay: number;\r\n    startEmoji: null | string;\r\n    requirementEmojis: string[];\r\n    debug_totalRequirementsCost?: string;\r\n\r\n    parent: null | EmojiSkillNode;\r\n    children: EmojiSkillNode[];\r\n};\r\nexport type EmojiSkillRequirement = {\r\n    emoji: string;\r\n    cost: number;\r\n};\r\nexport type EmojiSkillTree = {\r\n    allNodes: EmojiSkillNode[];\r\n    allRequirements: EmojiSkillRequirement[];\r\n    root: EmojiSkillNode;\r\n};\r\n\r\n\r\nexport const buildEmojiSkillTree = (): EmojiSkillTree => {\r\n    const maleSkillDoc = `${child_male}\\n${student_male}\\n${skillDoc}`;\r\n    const femaleSkillDoc = `${child_female}\\n${student_female}\\n\\n${getFemaleVariant(skillDoc)}`;\r\n    const maleNodes = parseSkillDoc(maleSkillDoc, `male`);\r\n    const femaleNodes = parseSkillDoc(femaleSkillDoc, `female`);\r\n    const babyNode: EmojiSkillNode = {\r\n        emoji: babyEmoji,\r\n        name: `baby`,\r\n        gender: `baby`,\r\n        pay: 0,\r\n        requirementEmojis: [],\r\n        startEmoji: null,\r\n        parent: null,\r\n        children: [],\r\n    };\r\n    const allNodes = [babyNode, ...maleNodes, ...femaleNodes];\r\n    const root = babyNode;\r\n\r\n    allNodes.forEach(child => {\r\n        const parent = allNodes.find(x => child.startEmoji === x.emoji);\r\n        if (!parent) { return; }\r\n\r\n        parent.children.push(child);\r\n        child.parent = parent;\r\n    });\r\n\r\n    const allRequirements = parseRequirementsDoc(requirementsDoc);\r\n\r\n    allNodes.forEach(node => {\r\n        const allCosts = node.requirementEmojis\r\n            .map(r => allRequirements.find(x => x.emoji === r) ?? { emoji: r, cost: 0 });\r\n\r\n        const summary = allCosts\r\n            .map(x => `${x.emoji} = ${x.cost}`)\r\n            .join(`\\n`);\r\n\r\n        // eslint-disable-next-line unicorn/no-reduce\r\n        const totalCost = allCosts.reduce((out, x) => { out += x.cost; return out; }, 0);\r\n        node.debug_totalRequirementsCost = `${totalCost} =\\n${summary}`;\r\n    });\r\n\r\n    const tree: EmojiSkillTree = {\r\n        allNodes,\r\n        root,\r\n        allRequirements,\r\n    };\r\n\r\n    // const allRequirements = distinct(allNodes.flatMap(x => x.requirementEmojis));\r\n    // const allRequirementsDoc = allRequirements.map(x => `${x} = 0`).join(`\\n`);\r\n\r\n    // console.log(`buildSkillTree`, { tree, maleSkillDoc, femaleSkillDoc });\r\n    return tree;\r\n};\r\n// setTimeout(buildEmojiSkillTree);\r\n\r\nconst parseRequirementsDoc = (doc: string) => {\r\n    const lines = doc.split(`\\n`).map(x => x.trim()).filter(x => x);\r\n    const nodes = lines.map(line => {\r\n        const parts = line.split(`=`).map(x => x.trim()).filter(x => x);\r\n        const r: EmojiSkillRequirement = {\r\n            emoji: parts[0],\r\n            cost: Number.parseInt(parts[1], 10),\r\n        };\r\n        return r;\r\n    });\r\n    return nodes;\r\n};\r\n\r\nconst parseSkillDoc = (doc: string, gender: 'male' | 'female') => {\r\n    const lines = doc.split(`\\n`).map(x => x.trim()).filter(x => x);\r\n    const nodes = lines.map(x => parseSkillLine(x, gender));\r\n    return nodes;\r\n};\r\n\r\nconst parseSkillLine = (skillLine: string, gender: 'male' | 'female'): EmojiSkillNode => {\r\n    const [name, payText, p1] = skillLine.split(`:`).map(x => x.trim());\r\n    const pay = Number.parseInt(payText, 10);\r\n    const [end, p2] = p1.split(`=`).map(x => x.trim());\r\n    const [start, requirementsStr] = p2.split(`+`).map(x => x.trim());\r\n    const requirements = requirementsStr.split(` `).map(x => x.trim()).filter(x => x);\r\n    return { name, pay, emoji: end, startEmoji: start, requirementEmojis: requirements, children: [], parent: null, gender };\r\n};\r\n\r\nconst getFemaleVariant = (emoji: string) => {\r\n    return emoji\r\n        .replace(new RegExp(genderCharCodes.male, `g`), genderCharCodes.female)\r\n        .replace(new RegExp(genderCharCodes.man, `g`), genderCharCodes.woman);\r\n};\r\n\r\nconst genderCharCodes = {\r\n    man: String.fromCodePoint(0x1F468),\r\n    woman: String.fromCodePoint(0x1F469),\r\n    male: String.fromCodePoint(0x1F469),\r\n    female: String.fromCodePoint(0x1F469),\r\n};\r\n\r\nconst babyEmoji = ``;\r\nconst child_male = `boy               : 0 :  =  +           `;\r\nconst child_female = `girl            : 0 :  =  +           `;\r\nconst student_male = `  student_boy   : 0 :  =  +          `;\r\nconst student_female = `student_girl  : 0 :  =  +          `;\r\n\r\nconst skillDoc = `\r\nfactory_worker      :   20000 :  =  +                    \r\nmechanic            :   30000 :  =  +               \r\nconstruction_worker :   75000 :  =  +                             \r\nartist              :   35000 :  =  +                     \r\nsinger              :   40000 :  =  +               \r\nfarmer              :   50000 :  =  +                   \r\ncook                :   40000 :  =  +                   \r\nfirefighter         :   55000 :  =  +          \r\npolice_officer      :   60000 :  =  +                    \r\ndetective           :   70000 :  =  +                 \r\nteacher             :   50000 :  =  +       \r\noffice_worker       :   60000 :  =  +                     \r\ntechnologist        :   80000 :  =  +                      \r\nscientist           :   90000 :  =  +                    \r\njudge               :  120000 :  =  +          \r\nhealth_worker       :  100000 :  =  +          \r\npilot               :  110000 :  =  +            \r\nastronaut           :  130000 :  =  +       \r\n`;\r\n\r\nconst requirementsDoc = `\r\n = 10\r\n = 10\r\n = 20\r\n = 20\r\n = 10\r\n = 20\r\n = 30\r\n = 50\r\n = 25\r\n = 150\r\n = 200\r\n\r\n = 20\r\n = 20\r\n = 10\r\n = 20\r\n = 30\r\n\r\n = 30\r\n = 10\r\n = 20\r\n = 500\r\n = 15\r\n = 350\r\n = 1250\r\n = 7000\r\n = 800\r\n = 10000\r\n\r\n = 20\r\n = 80\r\n = 110\r\n = 25\r\n = 15\r\n = 300\r\n = 700\r\n = 35000\r\n = 150\r\n = 75\r\n = 150\r\n = 3000\r\n = 16000\r\n = 32000\r\n = 100\r\n = 70\r\n = 50\r\n = 35\r\n = 15\r\n = 15\r\n = 80\r\n = 150\r\n = 400\r\n = 150\r\n = 120\r\n = 750\r\n = 320\r\n = 450\r\n = 320\r\n = 1450\r\n = 25\r\n = 10\r\n = 35\r\n = 25\r\n = 30\r\n = 350\r\n = 150\r\n = 120\r\n = 100\r\n = 15000\r\n = 25\r\n = 30\r\n = 20\r\n = 75\r\n = 100\r\n = 50\r\n = 120\r\n = 350\r\n = 120\r\n = 225\r\n = 150\r\n = 250\r\n = 50\r\n = 75\r\n = 135000\r\n = 15000\r\n = 750\r\n = 500\r\n = 1250\r\n = 150\r\n = 55000\r\n = 250\r\n = 55\r\n = 85\r\n = 125\r\n = 25\r\n = 75\r\n = 25\r\n = 60\r\n = 30\r\n = 16000\r\n = 250\r\n = 150\r\n = 50\r\n = 750\r\n = 75\r\n = 150\r\n = 50\r\n = 1500\r\n = 150\r\n = 25\r\n = 3500\r\n = 150\r\n = 300\r\n = 250\r\n = 150\r\n = 650\r\n = 150\r\n = 100\r\n = 120\r\n = 1200\r\n = 1500\r\n = 75000\r\n = 550\r\n = 50\r\n = 850\r\n = 1500000\r\n = 350\r\n = 150000000\r\n`;\r\n","import { createSubscribable } from 'utils/subscribable';\r\nimport { toMap } from 'utils/objects';\r\nimport { buildEmojiSkillTree } from './emoji-skills/emoji-skill-tree';\r\n\r\nexport type EmojiIdleEmotionKind = 'excited' | 'happy' | 'normal' | 'angry' | 'sick' | 'dead';\r\nexport type EmojiIdleState = {\r\n    characterEmoji: string;\r\n    targetEmoji?: string;\r\n    targetOptions?: { emoji: string }[];\r\n    requirementsPurchased?: string[];\r\n    requirementsAvailable?: { emoji: string, cost: number }[];\r\n    requirementsRemaining?: { emoji: string, cost: number }[];\r\n    requirementsNeeded?: { emoji: string, cost: number }[];\r\n    lastPurchaseTimestamp: number;\r\n\r\n    emotion: EmojiIdleEmotionKind;\r\n    lastEmotionTimestamp: number;\r\n\r\n    money: number;\r\n\r\n    multiplier: number;\r\n    lastMultiplierChangeTimestamp: number;\r\n\r\n    townState: {\r\n        characters: {\r\n            characterEmoji: string;\r\n            finishedTimestamp: number;\r\n            // requirementsPurchased: string[];\r\n        }[];\r\n    };\r\n};\r\n\r\nconst storageKey = `EmojiIdleState`;\r\nconst storage = {\r\n    save: (value: EmojiIdleState) => { localStorage.setItem(storageKey, JSON.stringify(value)); },\r\n    load: () => {\r\n        if (!localStorage.getItem(storageKey)) { return null; }\r\n        try {\r\n            return JSON.parse(localStorage.getItem(storageKey) ?? ``);\r\n        } catch{\r\n            return null;\r\n        }\r\n    },\r\n};\r\n\r\nconst createService = () => {\r\n    const skillTree = buildEmojiSkillTree();\r\n    const reqMap = toMap(skillTree.allRequirements.map(x => ({ key: x.emoji, value: x })));\r\n\r\n    const defaultState: EmojiIdleState = {\r\n        characterEmoji: skillTree.root.emoji,\r\n        emotion: `normal`,\r\n        lastEmotionTimestamp: Date.now(),\r\n        money: 0,\r\n        multiplier: 1,\r\n        lastMultiplierChangeTimestamp: Date.now(),\r\n        lastPurchaseTimestamp: Date.now(),\r\n        townState: {\r\n            characters: [],\r\n        },\r\n    };\r\n    let s: EmojiIdleState = storage.load() ?? defaultState;\r\n\r\n    // Load missing state fields\r\n    s = { ...defaultState, ...s };\r\n\r\n    // // Hard code Missing Town Characters for Kids Accounts\r\n    // s.townState = {\r\n    //     // characters: [...skillTree.allNodes.filter(x => x.children.length <= 0).slice(0, 5).map(x => ({\r\n    //     //     characterEmoji: x.emoji,\r\n    //     //     finishedTimestamp: Date.now() - Math.random() * 1000 * 60 * 60 * 24 * 7,\r\n    //     // }))],\r\n    //     characters: [...skillTree.allNodes\r\n    //         .filter(x => x.name === `artist` && x.gender === `female`)\r\n    //         .map(x => ({\r\n    //             characterEmoji: x.emoji,\r\n    //             finishedTimestamp: Math.floor(Date.now() - 0.25 * 1000 * 60 * 60 * 24),\r\n    //         }))],\r\n    // };\r\n\r\n    const sub = createSubscribable<EmojiIdleState>(s);\r\n\r\n    const changeState = (partialState: Partial<EmojiIdleState>) => {\r\n        // console.log(`changePetState`, { partialState, before: { ...s } });\r\n        s = { ...s, ...partialState };\r\n        sub.onStateChange(s);\r\n        storage.save(s);\r\n    };\r\n\r\n    const rewardInner = (value: number) => {\r\n        // max multiplier - keeps things more linear?\r\n        const maxMultiplier = 100;\r\n        changeState({\r\n            money: s.money + s.multiplier,\r\n            multiplier: Math.min(maxMultiplier, s.multiplier + value),\r\n            lastMultiplierChangeTimestamp: Date.now(),\r\n        });\r\n    };\r\n\r\n    const punish = () => {\r\n        // This is the only way to lose multiplier\r\n        changeState({\r\n            multiplier: Math.max(1, s.multiplier - 5),\r\n            lastMultiplierChangeTimestamp: Date.now(),\r\n        });\r\n    };\r\n\r\n    const selectOption = (emoji: string) => {\r\n        // console.log(`selectOption`, { emoji });\r\n\r\n        // Choose character\r\n        if (s.targetOptions?.find(x => x.emoji === emoji)) {\r\n            if (emoji === skillTree.root.emoji) {\r\n                // Add finished character to town\r\n                s.townState.characters.push({\r\n                    characterEmoji: s.characterEmoji,\r\n                    finishedTimestamp: Date.now(),\r\n                });\r\n            }\r\n\r\n            changeState({\r\n                targetEmoji: emoji,\r\n                targetOptions: undefined,\r\n                emotion: `excited`,\r\n                lastEmotionTimestamp: Date.now(),\r\n                lastPurchaseTimestamp: Date.now(),\r\n\r\n                money: 0,\r\n                // money: emoji === skillTree.root.emoji ? 0 : s.money,\r\n            });\r\n        }\r\n\r\n        // Purchases\r\n        const r = s.requirementsAvailable?.find(x => x.emoji === emoji);\r\n        if (r && r.cost <= s.money) {\r\n            // Purchase \r\n            changeState({\r\n                requirementsPurchased: [...s.requirementsPurchased ?? [], r.emoji],\r\n                requirementsRemaining: undefined,\r\n                money: s.money - r.cost,\r\n                requirementsAvailable: undefined,\r\n                emotion: `excited`,\r\n                lastEmotionTimestamp: Date.now(),\r\n                lastPurchaseTimestamp: Date.now(),\r\n            });\r\n        }\r\n\r\n        // Ignore\r\n    };\r\n\r\n    // Update state\r\n    setInterval(() => {\r\n        const second = 1000;\r\n        const minute = 60 * second;\r\n        const hour = 60 * minute;\r\n\r\n        // console.log(`emoji - idle - service update`, {});\r\n\r\n        // This is too powerful against slow players\r\n        // // Decrease Multiplier over time\r\n        // const decTime = 3 * second;\r\n        // if (s.multiplier > 1 && Date.now() > s.lastMultiplierChangeTimestamp + decTime) {\r\n        //     const timeDelta = Date.now() - s.lastMultiplierChangeTimestamp;\r\n        //     const multChange = Math.floor(timeDelta / decTime);\r\n\r\n        //     // console.log(`emoji - idle - service`, { timeDelta, multChange });\r\n        //     changeState({\r\n        //         multiplier: Math.max(1, s.multiplier - multChange),\r\n        //         lastMultiplierChangeTimestamp: Date.now(),\r\n        //     });\r\n        // }\r\n\r\n        // Choose target\r\n        if (!s.targetEmoji && !s.targetOptions) {\r\n            const skillNode = skillTree.allNodes.find(x => x.emoji === s.characterEmoji);\r\n            if (skillNode) {\r\n                let t = skillNode.children.map(x => ({ emoji: x.emoji }));\r\n                const remainingSkills = t.filter(x => !s.townState.characters.find(c => c.characterEmoji));\r\n\r\n                if (remainingSkills.length > 0) {\r\n                    t = remainingSkills;\r\n                }\r\n\r\n                if (t.length === 0) {\r\n                    // Top of skill tree\r\n                    changeState({\r\n                        targetOptions: [{ emoji: skillTree.root.emoji }],\r\n                    });\r\n                }\r\n                // else if (t.length === 1) {\r\n                //     // Auto select\r\n                //     changeState({\r\n                //         targetEmoji: t[0].emoji,\r\n                //     });\r\n                // } \r\n                else {\r\n                    changeState({\r\n                        targetOptions: t,\r\n                    });\r\n                }\r\n            }\r\n        }\r\n\r\n        // Populate Available Requirements\r\n        if (s.targetEmoji) {\r\n            const targetSkillNode = skillTree.allNodes.find(x => x.emoji === s.targetEmoji);\r\n            if (targetSkillNode) {\r\n                // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\r\n                const reqs = targetSkillNode.requirementEmojis.map(x => reqMap.get(x)).filter(x => x).map(x => x!);\r\n                const reqs_remaining = reqs.filter(x => !s.requirementsPurchased?.includes(x.emoji));\r\n                reqs_remaining.sort((a, b) => a.cost - b.cost);\r\n                const reqs_available = reqs_remaining.filter(x => x.cost <= s.money);\r\n\r\n                if (reqs_available.length !== s.requirementsAvailable?.length) {\r\n                    changeState({\r\n                        requirementsNeeded: reqs,\r\n                        requirementsAvailable: reqs_available,\r\n                    });\r\n                }\r\n\r\n                if (reqs_remaining.length !== s.requirementsRemaining?.length) {\r\n                    changeState({\r\n                        requirementsRemaining: reqs_remaining,\r\n                    });\r\n                }\r\n\r\n                // Target completed\r\n                if (reqs_remaining.length <= 0) {\r\n                    changeState({\r\n                        characterEmoji: s.targetEmoji,\r\n                        targetEmoji: undefined,\r\n                        targetOptions: undefined,\r\n                        requirementsAvailable: undefined,\r\n                        requirementsNeeded: undefined,\r\n                        requirementsPurchased: undefined,\r\n                    });\r\n                }\r\n            }\r\n\r\n            // Emotion\r\n            if (Date.now() > (s.lastEmotionTimestamp ?? 0) + 15 * second) {\r\n                // TODO: Sickness\r\n                const emotion = Date.now() > (s.lastPurchaseTimestamp ?? 0) + 5 * minute ? `angry`\r\n                    : `normal`;\r\n\r\n                if (s.emotion !== emotion) {\r\n                    changeState({ emotion, lastEmotionTimestamp: Date.now() });\r\n                }\r\n            }\r\n        }\r\n\r\n    }, 1000);\r\n\r\n    return {\r\n        subscribePetStateChange: sub.subscribe,\r\n        reward: () => rewardInner(1),\r\n        reward_major: () => rewardInner(10),\r\n        reward_extreme: () => rewardInner(100),\r\n        punish,\r\n\r\n        selectOption,\r\n    };\r\n};\r\n\r\nexport type EmojiIdleService = ReturnType<typeof createService>;\r\n\r\nconst serviceState = {\r\n    instance: null as null | EmojiIdleService,\r\n};\r\nexport const EmojiIdleService = {\r\n    get: () => {\r\n        // eslint-disable-next-line no-return-assign\r\n        return serviceState.instance ?? (serviceState.instance = createService());\r\n    },\r\n    reset: () => {\r\n        serviceState.instance = createService();\r\n    },\r\n};\r\n","import React, { useState, useEffect, useRef } from 'react';\r\nimport { View, Text, TouchableOpacity } from 'react-native-lite';\r\nimport { shuffle } from 'utils/arrays';\r\nimport { EmojiIdleService, EmojiIdleState, EmojiIdleEmotionKind } from './emoji-idle-service';\r\nimport { buildEmojiSkillTree } from './emoji-skills/emoji-skill-tree';\r\n\r\nexport const styles = {\r\n    container: {\r\n        height: 40,\r\n    },\r\n    fixed: {\r\n        position: `fixed`,\r\n        top: 0, right: 0, left: 0,\r\n        zIndex: 1000,\r\n    },\r\n    inner: {\r\n        position: `relative`,\r\n        height: 40,\r\n    },\r\n    emotionEmoji: {\r\n        fontFamily: `\"Lucida Console\", Monaco, monospace`,\r\n        fontSize: 24,\r\n    },\r\n    characterEmoji: {\r\n        fontFamily: `\"Lucida Console\", Monaco, monospace`,\r\n        fontSize: 24,\r\n    },\r\n    characterEmoji_small: {\r\n        fontFamily: `\"Lucida Console\", Monaco, monospace`,\r\n        fontSize: 16,\r\n    },\r\n    costText: {\r\n        fontFamily: `\"Lucida Console\", Monaco, monospace`,\r\n        fontSize: 16,\r\n        color: `#00FF00`,\r\n    },\r\n    costText_small: {\r\n        fontFamily: `\"Lucida Console\", Monaco, monospace`,\r\n        fontSize: 10,\r\n        color: `#00FF00`,\r\n    },\r\n    targetCharacterEmoji: {\r\n        fontFamily: `\"Lucida Console\", Monaco, monospace`,\r\n        fontSize: 16,\r\n    },\r\n    objectEmoji: {\r\n        fontFamily: `\"Lucida Console\", Monaco, monospace`,\r\n        fontSize: 12,\r\n    },\r\n\r\n    money: {\r\n        fontFamily: `\"Lucida Console\", Monaco, monospace`,\r\n        fontSize: 20,\r\n        color: `#FFFF00`,\r\n        marginLeft: 8,\r\n    },\r\n    money_small: {\r\n        fontFamily: `\"Lucida Console\", Monaco, monospace`,\r\n        fontSize: 16,\r\n        color: `#FFFF00`,\r\n    },\r\n    multiplier: {\r\n        fontFamily: `\"Lucida Console\", Monaco, monospace`,\r\n        fontSize: 14,\r\n        color: `#FF00FF`,\r\n        marginLeft: 8,\r\n    },\r\n    foodText: {\r\n        fontFamily: `\"Lucida Console\", Monaco, monospace`,\r\n        fontSize: 12,\r\n        color: `#333300`,\r\n    },\r\n} as const;\r\n\r\nexport const EmojiIdleView = (props: {}) => {\r\n    const [gameState, setGameState] = useState(null as null | EmojiIdleState);\r\n    const [isExpanded, setIsExpanded] = useState(false);\r\n    useEffect(() => {\r\n        const service = EmojiIdleService.get();\r\n        const sub = service.subscribePetStateChange(setGameState);\r\n        return () => sub.unsubscribe();\r\n    });\r\n\r\n    if (isExpanded && gameState) {\r\n        return (\r\n            <TownView gameState={gameState} onClose={() => setIsExpanded(false)} />\r\n        );\r\n    }\r\n\r\n    return (\r\n        <View style={styles.container}>\r\n            <View style={styles.fixed}>\r\n                <View style={styles.inner}>\r\n                    <EmojiCharacterView\r\n                        emoji={gameState?.characterEmoji ?? ``}\r\n                        targetEmoji={gameState?.targetEmoji ?? ``}\r\n                        emotion={gameState?.emotion ?? null}\r\n                        purchased={gameState?.requirementsPurchased ?? []}\r\n                        onPress={() => setIsExpanded(s => !s)}\r\n                    />\r\n                    {gameState && <CommandsView gameState={gameState} />}\r\n                    {/* {gameState && gameState.food > 0 && [...new Array(gameState.food)].map((x, i) => (\r\n                        // eslint-disable-next-line react/no-array-index-key\r\n                        <View key={`${i}`} style={{ position: `absolute`, transform: `translate(${100 + i * 87 % 100}px,${4 + i * 43 % 12}px)` }} >\r\n                            <Text style={styles.foodText}>{getFoodVariant(i)}</Text>\r\n                        </View>\r\n                    ))} */}\r\n                </View>\r\n            </View>\r\n        </View>\r\n    );\r\n};\r\n\r\nexport const townStyles = {\r\n    container: {\r\n        background: `#555555`,\r\n    },\r\n    payText: {\r\n        fontFamily: `\"Lucida Console\", Monaco, monospace`,\r\n        fontSize: 14,\r\n        color: `#FFFFFF`,\r\n    },\r\n    payText_disabled: {\r\n        fontFamily: `\"Lucida Console\", Monaco, monospace`,\r\n        fontSize: 14,\r\n        color: `#CCCCCC`,\r\n    },\r\n    moneyText: {\r\n        fontFamily: `\"Lucida Console\", Monaco, monospace`,\r\n        fontSize: 16,\r\n        color: `#FFFF00`,\r\n    },\r\n    townMoneyText: {\r\n        fontFamily: `\"Lucida Console\", Monaco, monospace`,\r\n        fontSize: 16,\r\n        color: `#00FF00`,\r\n    },\r\n} as const;\r\n\r\nconst skillTree = buildEmojiSkillTree();\r\nconst TownView = ({ gameState, onClose }: { gameState: EmojiIdleState, onClose: () => void }) => {\r\n    // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\r\n    const townPersons = gameState.townState.characters.map(x => ({\r\n        character: x,\r\n        skill: skillTree.allNodes.find(n => n.emoji === x.characterEmoji) ?? skillTree.root,\r\n    }))\r\n        .filter(x => x.skill.pay)\r\n        .map(x => ({\r\n            ...x,\r\n            years: (Date.now() - x.character.finishedTimestamp) / (24 * 60 * 60 * 1000),\r\n            money: Math.floor((Date.now() - x.character.finishedTimestamp) / (24 * 60 * 60 * 1000) * x.skill.pay),\r\n        }));\r\n    const missingSkills = skillTree.allNodes.filter(x => x.children.length <= 0 && !gameState.townState.characters.find(t => t.characterEmoji === x.emoji));\r\n    // eslint-disable-next-line unicorn/no-reduce\r\n    const townMoney = townPersons.reduce((out, x) => { out += x.money ?? 0; return out; }, 0);\r\n    return (\r\n        <View style={townStyles.container}>\r\n            <View>\r\n                <View style={{ background: `#333333`, flexDirection: `row`, alignItems: `center` }}>\r\n                    <View style={{ position: `relative`, width: 100, height: 40 }}>\r\n                        <View style={{ position: `absolute`, left: 0, top: 0, flexDirection: `column`, alignItems: `flex-end` }} >\r\n                            <TouchableOpacity onPress={() => onClose()}>\r\n                                <Text style={styles.characterEmoji}>{`  `}</Text>\r\n                            </TouchableOpacity>\r\n                        </View>\r\n                    </View>\r\n                    <View style={{ flex: 1 }} />\r\n                    <View style={{ padding: 4 }}>\r\n                        <Text style={townStyles.townMoneyText}>{`$${(townMoney).toLocaleString()}`}</Text>\r\n                    </View>\r\n                </View>\r\n            </View>\r\n            <View style={{ background: `#333333`, flexDirection: `row`, alignItems: `center` }}>\r\n                <View style={{ position: `relative`, width: 100, height: 40 }}>\r\n                    <EmojiCharacterView\r\n                        emoji={gameState?.characterEmoji ?? ``}\r\n                        targetEmoji={gameState?.targetEmoji ?? ``}\r\n                        emotion={gameState?.emotion ?? null}\r\n                        purchased={gameState?.requirementsPurchased ?? []}\r\n                        onPress={() => onClose()}\r\n                    />\r\n                </View>\r\n            </View>\r\n            {/* Finished Characters */}\r\n            {townPersons.map(x => (\r\n                <View style={{ background: `#333333`, flexDirection: `row`, alignItems: `center` }}>\r\n                    <View style={{ position: `relative`, width: 100, height: 40 }}>\r\n                        <EmojiCharacterView\r\n                            emoji={x.character.characterEmoji}\r\n                            targetEmoji=''\r\n                            emotion='happy'\r\n                            purchased={x.skill?.requirementEmojis ?? []}\r\n                        />\r\n                    </View>\r\n                    <View style={{ padding: 4 }}>\r\n                        <Text style={townStyles.payText}>{`$${(x.skill?.pay ?? 0).toLocaleString()}`}</Text>\r\n                    </View>\r\n                    <View style={{ padding: 4 }}>\r\n                        <Text style={townStyles.payText}>{`x${(x.years).toFixed(1)}`}</Text>\r\n                    </View>\r\n                    <View style={{ flex: 1 }} />\r\n                    <View style={{ padding: 4 }}>\r\n                        <Text style={townStyles.moneyText}>{`$${(x.money).toLocaleString()}`}</Text>\r\n                    </View>\r\n                </View>\r\n            ))}\r\n            {/* Missing Characters */}\r\n            {missingSkills.map(x => (\r\n                <View style={{ background: `#555555`, flexDirection: `row`, alignItems: `center` }}>\r\n                    <View style={{ position: `relative`, width: 100, height: 40, opacity: 0.5 }}>\r\n                        <EmojiCharacterView\r\n                            emoji={x.emoji}\r\n                            targetEmoji=''\r\n                            emotion={null}\r\n                            purchased={[]}\r\n                        />\r\n                    </View>\r\n                    <View style={{ padding: 4 }}>\r\n                        <Text style={townStyles.payText_disabled}>{`$${(x.pay).toLocaleString()}`}</Text>\r\n                    </View>\r\n                </View>\r\n            ))}\r\n        </View>\r\n    );\r\n};\r\n\r\nconst CommandsView = ({ gameState }: { gameState: EmojiIdleState }) => {\r\n\r\n    const [offset, setOffset] = useState(0);\r\n    useEffect(() => {\r\n        setOffset(0);\r\n    }, [gameState.targetOptions, gameState.requirementsAvailable]);\r\n\r\n    if (gameState.targetOptions && gameState.targetOptions.length > 0) {\r\n        const listSize = 4;\r\n        const targetOptionsLength = gameState.targetOptions.length;\r\n        return (\r\n            <View style={{ position: `absolute`, top: 0, left: 0, right: 0 }} >\r\n                <View style={{ flexDirection: `row`, justifyContent: `center` }}>\r\n                    {gameState.targetOptions.slice(offset, offset + listSize).map(x => (\r\n                        <TouchableOpacity key={x.emoji} onPress={() => EmojiIdleService.get().selectOption(x.emoji)}>\r\n                            <View>\r\n                                <Text style={styles.characterEmoji}>{x.emoji}</Text>\r\n                            </View>\r\n                        </TouchableOpacity>\r\n                    ))}\r\n                    {targetOptionsLength > listSize && (\r\n                        <TouchableOpacity onPress={() => setOffset(s => { const i = s + 5; return i >= targetOptionsLength ? 0 : i; })}>\r\n                            <View>\r\n                                <Text style={styles.characterEmoji}>{offset + listSize < targetOptionsLength ? `` : ``}</Text>\r\n                            </View>\r\n                        </TouchableOpacity>\r\n                    )}\r\n                </View>\r\n            </View>\r\n        );\r\n    }\r\n\r\n    // if (gameState.requirementsAvailable && gameState.requirementsAvailable.length > 0) {\r\n    //     return (\r\n    //         <View style={{ position: `absolute`, top: 0, left: 0, right: 0 }} >\r\n    //             <View style={{ alignSelf: `center`, alignItems: `center`, background: `#222222`, borderRadius: 4, padding: 4 }}>\r\n    //                 <View style={{ flexDirection: `row`, justifyContent: `center` }}>\r\n    //                     {gameState.requirementsAvailable.slice(0, 5).map(x => (\r\n    //                         <TouchableOpacity key={x.emoji} onPress={() => EmojiIdleService.get().selectOption(x.emoji)}>\r\n    //                             <View style={{ flexDirection: `column`, margin: 4, alignItems: `center`, background: `#333333`, borderRadius: 4 }}>\r\n    //                                 <Text style={styles.characterEmoji}>{x.emoji}</Text>\r\n    //                                 <Text style={styles.costText}>{`$${x.cost.toLocaleString()}`}</Text>\r\n    //                             </View>\r\n    //                         </TouchableOpacity>\r\n    //                     ))}\r\n    //                 </View>\r\n    //                 <Text style={styles.money_small}>{`$${(gameState.money ?? 0).toLocaleString()}`}</Text>\r\n    //             </View>\r\n    //         </View>\r\n    //     );\r\n    // }\r\n\r\n    const reqs = gameState.requirementsRemaining ?? [];\r\n    const reqShowLength = 3;\r\n    return (\r\n        <View>\r\n            <ScoreView {...gameState ?? { money: 0, multiplier: 1 }} />\r\n            <View style={{ position: `absolute`, left: 90, top: 0, flexDirection: `row`, zIndex: 10 }} >\r\n                {reqs.slice(0, reqShowLength).map(x => {\r\n                    const canBuy = x.cost <= gameState.money;\r\n                    return (\r\n                        <TouchableOpacity key={x.emoji} onPress={() => EmojiIdleService.get().selectOption(x.emoji)}>\r\n                            <View style={{ flexDirection: `column`, alignItems: `center`, background: canBuy ? `#003300` : `#553300`, borderRadius: 4, paddingLeft: 2, paddingRight: 2 }}>\r\n                                <Text style={styles.characterEmoji_small}>{x.emoji}</Text>\r\n                                <Text style={{ ...styles.costText_small, ...(canBuy ? {} : { color: `#FF0000` }) }}>{`$${x.cost.toLocaleString()}`}</Text>\r\n                            </View>\r\n                        </TouchableOpacity>\r\n                    );\r\n                })}\r\n            </View>\r\n        </View>\r\n    );\r\n};\r\n\r\n\r\nconst ScoreView = ({ money, multiplier }: { money: number, multiplier: number }) => {\r\n\r\n    const [moneySizeOffset, setMoneySizeOffset] = useState(0);\r\n    const [multiplierSizeOffset, setMultiplierSizeOffset] = useState(0);\r\n    const lastMultiplier = useRef(multiplier);\r\n    const [multiplierDelta, setMultiplierDelta] = useState(0);\r\n\r\n\r\n    useEffect(() => {\r\n        setMoneySizeOffset(5);\r\n\r\n        const update = () => {\r\n            setMoneySizeOffset(s => {\r\n                if (s > 0) {\r\n                    return s - 1;\r\n                }\r\n                clearInterval(id);\r\n                return 0;\r\n            });\r\n        };\r\n        update();\r\n\r\n        const id = setInterval(update, 25);\r\n        return () => clearInterval(id);\r\n    }, [money]);\r\n\r\n    useEffect(() => {\r\n        setMultiplierSizeOffset(10);\r\n        setMultiplierDelta(multiplier - lastMultiplier.current);\r\n        lastMultiplier.current = multiplier;\r\n\r\n        const update = () => {\r\n            setMultiplierSizeOffset(s => {\r\n                if (s > 0) {\r\n                    return s - 1;\r\n                }\r\n                clearInterval(id);\r\n                return 0;\r\n            });\r\n        };\r\n        update();\r\n\r\n        const id = setInterval(update, 25);\r\n        return () => clearInterval(id);\r\n    }, [multiplier]);\r\n\r\n\r\n    return (\r\n        <View style={{ position: `absolute`, top: 0, right: 4 }} >\r\n            <View style={{ flexDirection: `row`, justifyContent: `flex-end` }}>\r\n                <View style={{ transform: `translate(-${moneySizeOffset}px,${2 * moneySizeOffset}px) scale(${moneySizeOffset * 0.1 + 1})` }}>\r\n                    <Text style={styles.money}>{`$${(money ?? 0).toLocaleString()}`}</Text>\r\n                </View>\r\n                <View style={{ transform: `translate(-${multiplierSizeOffset}px,${2 * multiplierSizeOffset}px) scale(${multiplierSizeOffset * 0.1 + 1})` }}>\r\n                    <Text style={{ ...styles.multiplier, ...(multiplierDelta < -5 ? { color: `#FF0000` } : multiplierDelta < 0 ? { color: `#FFFF00` } : { color: `#00FF00` }) }}>{`x${(multiplier ?? 1).toLocaleString()}`.padStart(4, ` `)}</Text>\r\n                </View>\r\n            </View>\r\n        </View>\r\n    );\r\n};\r\n\r\nconst EmojiCharacterView = ({ emoji, targetEmoji, emotion, purchased, onPress }: { emoji: string, targetEmoji: string, emotion: null | EmojiIdleEmotionKind, purchased: string[], onPress?: () => void }) => {\r\n    return (\r\n        <>\r\n            <PurchasedView purchased={purchased} />\r\n            <View style={{ position: `absolute`, left: 20, top: 0, flexDirection: `column`, alignItems: `flex-end` }} >\r\n                <TouchableOpacity onPress={() => onPress?.()}>\r\n                    <EmotionView emotion={emotion ?? null} emoji={emoji} />\r\n                </TouchableOpacity>\r\n            </View>\r\n            <View style={{ position: `absolute`, left: 66, top: 0, flexDirection: `column`, alignItems: `flex-end` }} >\r\n                <Text style={styles.targetCharacterEmoji}>{`${targetEmoji}`}</Text>\r\n            </View>\r\n        </>\r\n    );\r\n};\r\n\r\nconst PurchasedView = ({ purchased }: { purchased: string[] }) => {\r\n    const [offset, setOffset] = useState(0);\r\n    useEffect(() => {\r\n        const update = () => {\r\n            setOffset(s => s + 1);\r\n        };\r\n        update();\r\n\r\n        const id = setInterval(update, 200);\r\n        return () => clearInterval(id);\r\n    }, [purchased.length]);\r\n\r\n    return (\r\n        <>\r\n            {purchased.map((x, i) => (\r\n                <View key={x} style={{ position: `absolute`, left: 0, top: 0, flexDirection: `column`, alignItems: `flex-end` }} >\r\n                    <View style={{ transform: `translate(${((i * 17) + offset) % 60}px,${((i * 5) + offset) % 24}px)` }}>\r\n                        <Text style={styles.objectEmoji}>{`${x}`}</Text>\r\n                    </View>\r\n                </View>\r\n            ))}\r\n        </>\r\n    );\r\n};\r\n\r\nconst EmotionView = ({ emotion, emoji }: { emotion: null | EmojiIdleEmotionKind, emoji: string }) => {\r\n    const [display, setDisplay] = useState({ text: emoji, isEmotion: false });\r\n    useEffect(() => {\r\n        if (!emotion) {\r\n            return () => { };\r\n        }\r\n        let showEmotion = false;\r\n        let variant = 0;\r\n        const update = () => {\r\n            showEmotion = !showEmotion;\r\n            if (!showEmotion) {\r\n                setDisplay({ text: emoji, isEmotion: false });\r\n                return;\r\n            }\r\n            setDisplay({ text: getEmoji(emotion, variant++), isEmotion: true });\r\n        };\r\n        update();\r\n\r\n        const id = setInterval(update, 3000);\r\n        return () => clearInterval(id);\r\n    }, [emotion, emoji]);\r\n\r\n    return (\r\n        <Text style={display.isEmotion ? styles.emotionEmoji : styles.characterEmoji}>{display.text}</Text>\r\n    );\r\n};\r\n\r\n// \r\n// \r\n// \r\n// \r\n// \r\nconst getEmoji = (emotion: null | EmojiIdleEmotionKind, variant: number) => {\r\n    // console.log(`getEmoji`, { emotion, variant });\r\n\r\n    // Setup State\r\n    if (!emotion) { return ``; }\r\n\r\n    if (emotion === `excited`) {\r\n        const items = shuffle([``, ``, ``, ``, ``, ``, ``]);\r\n        return items[variant % items.length];\r\n    }\r\n    if (emotion === `happy`) {\r\n        const items = [``, ``, ``, ``, ``];\r\n        return items[variant % items.length];\r\n    }\r\n    if (emotion === `normal`) {\r\n        // const items = [``, ``, ``, ``, ``, ``, ``];\r\n        const items = [``, ``, ``, ``];\r\n        return items[variant % items.length];\r\n    }\r\n    if (emotion === `angry`) {\r\n        const items = [``, ``, ``, ``, ``, ``, ``];\r\n        return items[variant % items.length];\r\n    }\r\n    if (emotion === `sick`) {\r\n        const items = [``, ``, ``, ``, ``, ``, ``];\r\n        return items[variant % items.length];\r\n    }\r\n    if (emotion === `dead`) {\r\n        const items = [``, ``, ``];\r\n        return items[variant % items.length];\r\n    }\r\n\r\n    // Unknown\r\n    return ``;\r\n};\r\n\r\nconst foodItems = shuffle(` \r\n                             \r\n                            \r\n                       `\r\n    .replace(`\\n`, ` `).split(` `).map(x => x.trim()).filter(x => x));\r\n\r\nconst getFoodVariant = (variant: number) => {\r\n    return foodItems[variant % foodItems.length];\r\n};\r\n","import React, { useEffect, useState } from 'react';\r\nimport { UserDataService, UserProfileInfo } from 'user-data-service/user-data-service';\r\nimport { useAutoLoadingError } from 'utils-react/hooks';\r\nimport { UserProfileManagerView } from 'user-data-service/user-profile-manager-view';\r\nimport { UserProfileSelectionView } from 'user-data-service/user-profile-selection-view';\r\nimport { View, Text, TouchableOpacity, Platform } from 'react-native-lite';\r\nimport { ProblemService } from '../problems/problems-service';\r\nimport { EmojiIdleView } from './emoji-idle-game/emoji-idle-view';\r\nimport { EmojiIdleService } from './emoji-idle-game/emoji-idle-service';\r\n\r\nexport const ProgressGameService = {\r\n    onCorrect: () => {\r\n        EmojiIdleService.get().reward();\r\n    },\r\n    onCompleteSection: () => {\r\n        EmojiIdleService.get().reward_major();\r\n    },\r\n    onCompleteSubject: () => {\r\n        EmojiIdleService.get().reward_extreme();\r\n    },\r\n    onWrong: () => {\r\n        EmojiIdleService.get().punish();\r\n    },\r\n};\r\n\r\nexport const createProgressGameProblemService = (problemSource: ProblemService, options?: {}): ProblemService => {\r\n    const service: ProblemService = {\r\n        ...problemSource,\r\n        recordAnswer: (problem, answer) => {\r\n            // (async () => UserDataService.get().markUserDataChanged())();\r\n\r\n            if (answer.isCorrect) {\r\n                ProgressGameService.onCorrect();\r\n\r\n                if (!problem.isReview && problem.isLastOfSubject) {\r\n                    ProgressGameService.onCompleteSubject();\r\n\r\n                    // Save User Data (delayed to let other state update)\r\n                    setTimeout(async () => {\r\n                        await UserDataService.get().uploadUserData();\r\n                    }, 1000);\r\n                } else if (!problem.isReview && problem.isLastOfSection) {\r\n                    ProgressGameService.onCompleteSection();\r\n\r\n                    // Save User Data (delayed to let other state update)\r\n                    setTimeout(async () => {\r\n                        await UserDataService.get().uploadUserData();\r\n                    }, 1000);\r\n                }\r\n\r\n            } else {\r\n                ProgressGameService.onWrong();\r\n            }\r\n\r\n            return problemSource.recordAnswer(problem, answer);\r\n        },\r\n    };\r\n    return service;\r\n};\r\n\r\nexport const ProgressGameView = () => {\r\n    const { loading, error, doWork } = useAutoLoadingError();\r\n    const [hasSelectedProfile, setHasSelectedProfile] = useState(false);\r\n    const [userProfile, setUserProfile] = useState(null as null | UserProfileInfo);\r\n\r\n    // Save UserData after Purchase\r\n    const subscribeToSaveOnPurchase = () => {\r\n        let lastPurchase = Date.now();\r\n        const subscription = EmojiIdleService.get().subscribePetStateChange((x) => {\r\n            console.log(`ProgressGameView subscribePetStateChange`, { lastPurchase, x });\r\n            if (lastPurchase >= x.lastPurchaseTimestamp) { return; }\r\n            lastPurchase = x.lastPurchaseTimestamp;\r\n            // Save User Data (delayed to let other state update)\r\n            setTimeout(async () => {\r\n                await UserDataService.get().uploadUserData();\r\n            }, 1000);\r\n        });\r\n        return subscription;\r\n    };\r\n\r\n    useEffect(() => {\r\n        setUserProfile(UserDataService.get().getActiveUser() ?? null);\r\n        EmojiIdleService.reset();\r\n\r\n        const sub = subscribeToSaveOnPurchase();\r\n        return () => {\r\n            sub.unsubscribe();\r\n        };\r\n    }, [hasSelectedProfile]);\r\n\r\n    useEffect(() => {\r\n        // Load User Data\r\n        doWork(async () => {\r\n            await UserDataService.get().setup();\r\n            EmojiIdleService.reset();\r\n        });\r\n    }, []);\r\n\r\n    const onChangeProfile = () => {\r\n        // setHasSelectedProfile(false);\r\n        // Force Reload Page\r\n        if (Platform.OS === `web`) {\r\n            window.location.reload();\r\n        }\r\n    };\r\n\r\n    if (loading) {\r\n        return <></>;\r\n    }\r\n\r\n    if (!hasSelectedProfile) {\r\n        return <UserProfileSelectionView onUserSelected={() => setHasSelectedProfile(true)} />;\r\n    }\r\n\r\n    return (\r\n        <>\r\n            <EmojiIdleView />\r\n            <View>\r\n                <TouchableOpacity onPress={onChangeProfile}>\r\n                    <View style={{ flexDirection: `row`, alignItems: `center`, justifyContent: `flex-start`, padding: 4 }}>\r\n                        <Text style={{ fontSize: 32 }}>{userProfile?.emoji ?? ``}</Text>\r\n                        <Text style={{ fontSize: 14 }}>{userProfile?.name ?? ``}</Text>\r\n                    </View>\r\n                </TouchableOpacity>\r\n            </View>\r\n        </>\r\n    );\r\n};\r\n","\r\nexport type EmailAddress = string & { __type: 'email' };\r\nexport const toEmailAddress = (email: string): EmailAddress => {\r\n    return email.trim() as EmailAddress;\r\n};\r\n","\"use strict\"; // Updated from commit 8087b0a - vscode/src/vs/base/common/charCode.ts\n\n/*---------------------------------------------------------------------------------------------\r\n *  Copyright (c) Microsoft Corporation. All rights reserved.\r\n *  Licensed under the MIT License. See License.txt in the project root for license information.\r\n *--------------------------------------------------------------------------------------------*/\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});","/* eslint-disable max-classes-per-file */\r\nexport type ErrorState = { message: string, data?: unknown, error?: unknown, retryCallback?: () => void };\r\n\r\nexport class AppError extends Error implements ErrorState {\r\n    constructor(public message: string, public data?: unknown) {\r\n        super();\r\n    }\r\n}\r\n\r\nexport class ApiError extends Error implements ErrorState {\r\n    constructor(public message: string, public data?: unknown) {\r\n        super();\r\n    }\r\n}\r\n\r\nexport class MockError extends Error implements ErrorState {\r\n    constructor(public message: string, public data?: unknown) {\r\n        super();\r\n    }\r\n}\r\n\r\nexport class NotImplementedError extends Error implements ErrorState {\r\n    constructor(public message: string = `Not Implemented`, public data?: unknown) {\r\n        super();\r\n    }\r\n}\r\n","import { shuffle } from 'utils/arrays';\r\nimport { ProblemService, Problem, ProblemResult } from './problems-service';\r\n\r\nexport const createReviewProblemService = (problemSource: ProblemService, {\r\n    maxNewReviewCount = 3,\r\n    reviewSequencePreviousLength = 1,\r\n    reviewQuestionPrefix = ` `,\r\n    requiredCorrectInRow = 3,\r\n}: {\r\n    maxNewReviewCount?: number;\r\n    reviewSequencePreviousLength?: number;\r\n    reviewQuestionPrefix?: string;\r\n    requiredCorrectInRow?: number;\r\n}): ProblemService => {\r\n    const state = {\r\n        problemSourceHistory: [] as Problem[],\r\n        reviewProblems: [] as { index: number, correctsInRow: number }[],\r\n        lastReviewProblem: null as null | { index: number, correctsInRow: number },\r\n        reviewSequence: null as null | { iNext: number, iStart: number, iEnd: number },\r\n        repeatState: `new` as 'new' | 'review',\r\n    };\r\n\r\n    const startReview = () => {\r\n        console.log(`createReviewProblemService startReview`, state);\r\n        state.repeatState = `review`;\r\n    };\r\n\r\n    const getReviewProblem = (): null | Problem => {\r\n        console.log(`createReviewProblemService getReviewProblem`, state);\r\n\r\n        const rSeq = state.reviewSequence;\r\n        if (rSeq && rSeq.iNext > rSeq.iEnd) {\r\n            console.log(`createReviewProblemService getReviewProblem - End of Sequence`, { rSeq, state });\r\n            state.reviewSequence = null;\r\n        }\r\n\r\n        if (!state.reviewSequence) {\r\n            // If reached end of review problems, exit review mode\r\n            const reviewProblem = state.reviewProblems.find(x => x.index > (state.lastReviewProblem?.index ?? -1));\r\n            if (!reviewProblem) {\r\n                console.log(`createReviewProblemService getReviewProblem - No Review Problem (with greater order than last)`, { reviewProblems: state.reviewProblems, lastReviewProblem: state.lastReviewProblem, state });\r\n                state.lastReviewProblem = null;\r\n                return null;\r\n            }\r\n\r\n            const lastReviewProblemIndex = state.lastReviewProblem?.index ?? -1;\r\n            state.lastReviewProblem = reviewProblem;\r\n\r\n            console.log(`createReviewProblemService getReviewProblem - Start Review Sequence`, state);\r\n            const iStart = Math.max(0, reviewProblem.index - reviewSequencePreviousLength, lastReviewProblemIndex + 1);\r\n\r\n            state.reviewSequence = {\r\n                iNext: iStart,\r\n                iStart,\r\n                iEnd: reviewProblem.index,\r\n            };\r\n        }\r\n\r\n        // Next in sequence\r\n        const seq = state.reviewSequence;\r\n        const p = state.problemSourceHistory[seq.iNext];\r\n        seq.iNext++;\r\n\r\n        return {\r\n            ...p,\r\n            question: reviewQuestionPrefix + p.question,\r\n            answers: shuffle(p.answers),\r\n        };\r\n    };\r\n\r\n    const service: ProblemService = {\r\n        load: problemSource.load,\r\n        save: problemSource.save,\r\n\r\n        getSections: problemSource.getSections,\r\n        gotoSection: problemSource.gotoSection,\r\n\r\n        getNextProblem: (): ProblemResult => {\r\n            console.log(`createReviewProblemService getNextProblem`, state);\r\n\r\n            if (state.repeatState === `review`) {\r\n                const reviewProblem = getReviewProblem();\r\n                if (reviewProblem) {\r\n                    return { ...reviewProblem, isReview: true };\r\n                }\r\n\r\n                console.log(`createReviewProblemService getNextProblem - No Review Problem - Change Mode to NEW`, state);\r\n                state.repeatState = `new`;\r\n            }\r\n\r\n            if (state.reviewProblems.filter(x => x.correctsInRow <= 1).length >= maxNewReviewCount) {\r\n                startReview();\r\n                return service.getNextProblem();\r\n            }\r\n\r\n            const newProblem = problemSource.getNextProblem();\r\n            if (newProblem.question) {\r\n                state.problemSourceHistory.push(newProblem);\r\n            } else {\r\n                // Done - Finish Review\r\n                startReview();\r\n                return service.getNextProblem();\r\n            }\r\n            return newProblem;\r\n        },\r\n        recordAnswer: (problem, answer) => {\r\n            console.log(`createReviewProblemService recordAnswer`, state);\r\n\r\n            // if (answer.isCorrect) {\r\n\r\n            //     problemSource.recordAnswer(problem, answer);\r\n            //     return;\r\n            // }\r\n\r\n            const i = state.problemSourceHistory.findIndex(x => x.key === problem.key);\r\n            if (i < 0) {\r\n                problemSource.recordAnswer(problem, answer);\r\n                return;\r\n            }\r\n\r\n            const problemAlreadyInReview = state.reviewProblems.find(x => x.index === i);\r\n            if (answer.isCorrect) {\r\n                // Correct\r\n                if (problemAlreadyInReview) {\r\n                    problemAlreadyInReview.correctsInRow++;\r\n\r\n                    // Remove if enough corrects in a row \r\n                    state.reviewProblems = state.reviewProblems.filter(x => x.correctsInRow <= requiredCorrectInRow);\r\n                }\r\n            } else {\r\n                // Wrong \r\n                // eslint-disable-next-line no-lonely-if\r\n                if (problemAlreadyInReview) {\r\n                    problemAlreadyInReview.correctsInRow = 0;\r\n                } else {\r\n                    // Insert Review Problem in Index order\r\n                    const newReview = { index: i, correctsInRow: 0, _debug_problemKey: problem.key };\r\n                    state.reviewProblems.push(newReview);\r\n                    state.reviewProblems.sort((a, b) => a.index - b.index);\r\n                    // state.problemsToReview = distinct_key(state.problemsToReview, x => `${x.index}`);\r\n                }\r\n            }\r\n\r\n\r\n            problemSource.recordAnswer(problem, answer);\r\n        },\r\n    };\r\n\r\n    return service;\r\n};\r\n","/* eslint-disable no-cond-assign */\r\nimport { AppError } from './error';\r\n\r\nconst DEBUG = true;\r\n\r\nexport class StringSpan {\r\n    readonly debug?: string = undefined;\r\n\r\n    public readonly source: string;\r\n\r\n    public readonly start: number;\r\n\r\n    public readonly length: number;\r\n\r\n    constructor(source: string, start?: number, length?: number) {\r\n        this.source = source;\r\n        this.start = start ?? 0;\r\n        this.length = length ?? source.length;\r\n\r\n        if (DEBUG) {\r\n            this.debug = this.toText();\r\n        }\r\n    }\r\n\r\n    toText() { return this.source.substr(this.start, this.length); }\r\n\r\n    getChar(index: number) {\r\n        if (index < this.start || index >= this.start + this.length) { throw new AppError(`StringSpan.getChar(): Out of range`, { index, s: this }); }\r\n        return this.source[index];\r\n    }\r\n\r\n    indexOf = (d: string) => {\r\n        const i = this.source.indexOf(d, this.start);\r\n        if (i < this.start) { return -1; }\r\n        if (i >= this.start + this.length) { return -1; }\r\n        return i;\r\n    }\r\n\r\n    lastIndexOf = (d: string) => {\r\n        const i = this.source.lastIndexOf(d, this.start + this.length);\r\n        if (i < this.start) { return -1; }\r\n        if (i >= this.start + this.length) { return -1; }\r\n        return i;\r\n    }\r\n\r\n    indexOfAny = (d: string[]) => {\r\n        const indexes = d.map(x => this.source.indexOf(x, this.start)).filter(x => x >= 0);\r\n        if (indexes.length <= 0) { return -1; }\r\n\r\n        const i = Math.min(...indexes);\r\n        if (i < 0) { return -1; }\r\n        if (i > this.start + this.length) { return -1; }\r\n        return i;\r\n    }\r\n\r\n    indexOfRegExp = (d: RegExp) => {\r\n        d.lastIndex = this.start;\r\n        const m = d.exec(this.source);\r\n        const i = m?.index ?? -1;\r\n        if (i < 0) { return { index: -1, length: 0 }; }\r\n        if (i > this.start + this.length) { return { index: -1, length: 0 }; }\r\n        return { index: i, length: m?.length ?? 0 };\r\n    }\r\n\r\n    lastIndexOfRegex = (d: RegExp) => {\r\n        d.lastIndex = this.start;\r\n        let m: null | RegExpExecArray;\r\n        let i = -1;\r\n        let len = 0;\r\n        while (m = d.exec(this.source)) {\r\n            if (m.index > this.start + this.length) { break; }\r\n            if (m.index < 0) { break; }\r\n            i = m.index;\r\n            len = m.length;\r\n        };\r\n        return { index: i, length: len };\r\n    }\r\n\r\n    splitOn = (d: string, maxCount: number | null = null) => {\r\n        const spans = [] as StringSpan[];\r\n\r\n        const s = this.source;\r\n        const iMin = this.start;\r\n        const iEnd = this.start + this.length;\r\n\r\n        let iLast = iMin;\r\n        let i = this.indexOf(d);\r\n\r\n        while (i >= 0\r\n            && i <= iEnd\r\n            && (!maxCount || spans.length < maxCount - 1)) {\r\n            spans.push(new StringSpan(s, iLast, i - iLast));\r\n\r\n            iLast = i;\r\n            i = s.indexOf(d, i + d.length);\r\n        }\r\n\r\n        i = iEnd;\r\n        spans.push(new StringSpan(s, iLast, i - iLast));\r\n\r\n        const spans_inRange = spans.filter(x => x.length > 0\r\n            && x.start >= this.start\r\n            && x.start + x.length <= this.start + this.length);\r\n\r\n        return spans_inRange;\r\n    };\r\n\r\n    splitOnRegExp = (d: RegExp, maxCount: number | null = null) => {\r\n        const spans = [] as StringSpan[];\r\n\r\n        const s = this.source;\r\n        const iMin = this.start;\r\n        const iEnd = this.start + this.length;\r\n\r\n        let iLast = iMin;\r\n\r\n        // Reset regexp\r\n        d.lastIndex = this.start;\r\n        let m = d.exec(s);\r\n\r\n        while (m\r\n            && m.index <= iEnd\r\n            && (!maxCount || spans.length < maxCount - 1)) {\r\n            spans.push(new StringSpan(s, iLast, m.index - iLast));\r\n\r\n            iLast = m.index;\r\n            m = d.exec(s);\r\n        }\r\n\r\n        const i = iEnd;\r\n        spans.push(new StringSpan(s, iLast, i - iLast));\r\n\r\n        const spans_inRange = spans.filter(x => x.length > 0\r\n            && x.start >= this.start\r\n            && x.start + x.length <= this.start + this.length);\r\n\r\n        return spans_inRange;\r\n    };\r\n\r\n    // private static regex_spaces = new RegExp('\\\\s', 'g');\r\n    // trimStart = (regex?: RegExp) => {\r\n    //     const r = regex ?? StringSpan.regex_spaces;\r\n    //     r.lastIndex = this.start;\r\n\r\n    //     let m: null | RegExpExecArray;\r\n    //     let i = -1;\r\n    //     let len = 0;\r\n\r\n    //     let iNext = this.start;\r\n    //     while (m = r.exec(this.source)) {\r\n    //         if (m.index !== iNext) { break; }\r\n    //         iNext += m.length;\r\n    //         r.lastIndex = iNext;\r\n    //     };\r\n\r\n    //     if (iNext === this.start) { return this; }\r\n    //     return this.transform(iNext - this.start, 0);\r\n    // }\r\n    // trimEnd = (regex?: RegExp) => {\r\n    //     const r = regex ?? StringSpan.regex_spaces;\r\n    //     const matches = this.source.match(r);\r\n\r\n    //     const mInRange = matches?.filter(x => x.);\r\n\r\n    //     if (iNext === this.start) { return this; }\r\n    //     return this.transform(iNext - this.start, 0);\r\n    // }\r\n    // trim = (regex?: RegExp) => {\r\n    //     return this.trimStart(regex).trimEnd(regex);\r\n    // }\r\n\r\n    startsWith = (text: string) => {\r\n        return this.source.startsWith(text, this.start);\r\n    }\r\n\r\n    trimStart = (patterns: string | string[] = [` `, `\\t`, `\\r`, `\\n`]) => {\r\n        const s = this.source;\r\n        patterns = typeof patterns === `string` ? [patterns] : patterns;\r\n\r\n        let i = this.start;\r\n        let iLast = -1;\r\n\r\n        while (i !== iLast) {\r\n            iLast = i;\r\n            for (const p of patterns) {\r\n                if (s.startsWith(p, i)) {\r\n                    i += p.length;\r\n                    break;\r\n                }\r\n            }\r\n        }\r\n\r\n        return this.transform(i - this.start, 0);\r\n    }\r\n\r\n    trimEnd = (patterns: string | string[] = [` `, `\\t`, `\\r`, `\\n`]) => {\r\n        const s = this.source;\r\n        patterns = typeof patterns === `string` ? [patterns] : patterns;\r\n\r\n        let i = this.start + this.length;\r\n        let iLast = -1;\r\n\r\n        while (i !== iLast) {\r\n            iLast = i;\r\n            for (const p of patterns) {\r\n                if (i - p.length >= 0 && s.startsWith(p, i - p.length)) {\r\n                    i -= p.length;\r\n                    break;\r\n                }\r\n            }\r\n        }\r\n\r\n        return this.transform(0, i - (this.start + this.length));\r\n    }\r\n\r\n    trim = (patterns: string | string[] = [` `, `\\t`, `\\r`, `\\n`]) => {\r\n        return this.trimStart(patterns).trimEnd(patterns);\r\n    }\r\n\r\n    transform = (offsetStart: number, offsetEnd: number) => {\r\n        return new StringSpan(this.source, this.start + offsetStart, this.length + offsetEnd - offsetStart);\r\n    };\r\n\r\n    newRange = (start: number, length: number) => {\r\n        return new StringSpan(this.source, start, length);\r\n    };\r\n};\r\n\r\n\r\nconst runStringSpanTests = () => {\r\n    const text = ` This is a new test! `;\r\n    const s = new StringSpan(text, 0, text.length);\r\n\r\n    const test = (name: string, actual: unknown, expected: unknown) => {\r\n        if (actual !== expected) { console.error(`FAIL - ${name}`, { actual, expected }); }\r\n        else { console.log(`PASS - ${name}`); }\r\n    };\r\n\r\n    test(`new`, s.toText(), text);\r\n\r\n    test(`startsWith`, s.startsWith(` `), true);\r\n    test(`startsWith`, s.startsWith(`T`), false);\r\n\r\n    test(`indexOf(a)`, s.indexOf(`a`), text.indexOf(`a`));\r\n    test(`indexOf(i)`, s.indexOf(`i`), text.indexOf(`i`));\r\n    test(`indexOf( )`, s.indexOf(` `), text.indexOf(` `));\r\n\r\n    test(`lastIndexOf(a)`, s.lastIndexOf(`a`), text.lastIndexOf(`a`));\r\n    test(`lastIndexOf(i)`, s.lastIndexOf(`i`), text.lastIndexOf(`i`));\r\n    test(`lastIndexOf( )`, s.lastIndexOf(` `), text.lastIndexOf(` `));\r\n\r\n    test(`splitOn`, s.splitOn(` `).join(``), text.split(` `).join(` `));\r\n    test(`splitOnRegExp`, s.splitOnRegExp(/\\W/g).join(``), text.split(` `).join(` `));\r\n    test(`splitOnRegExp`, s.splitOnRegExp(/\\W/g).join(`,`), ` This, is, a, new, test,!, `);\r\n    test(`splitOnRegExp`, s.splitOnRegExp(/is/g).join(`,`), ` Th,is ,is a new test! `);\r\n    test(`splitOnRegExp`, new StringSpan(`<span class=\"ca cb cc\">test</span>`).splitOnRegExp(/('|\")/g).join(`,`), `<span class=,\"ca cb cc,\">test</span>`);\r\n\r\n    const s2 = new StringSpan(`<span class=\"ca cb cc\">test</span>`).splitOn(`</span>`)[0].splitOn(`class`)[1];\r\n    test(`splitOn       - s2`, s2.toText(), `class=\"ca cb cc\">test`);\r\n    test(`splitOnRegExp - s2`, s2.splitOnRegExp(/</g).join(`,`), `class=\"ca cb cc\">test`);\r\n    test(`splitOnRegExp - s2`, s2.splitOnRegExp(/>/g).join(`,`), `class=\"ca cb cc\",>test`);\r\n    test(`splitOnRegExp - s2`, s2.splitOnRegExp(/('|\")/g).join(`,`), `class=,\"ca cb cc,\">test`);\r\n\r\n    test(`trimStart`, s.trimStart().toText(), text.trimStart());\r\n    test(`trimEnd`, s.trimEnd().toText(), text.trimEnd());\r\n    test(`trim`, s.trim().toText(), text.trim());\r\n    test(`trim Single`, s.trim(` `).toText(), `This is a new test!`);\r\n    test(`trim Multiple`, s.trim([` `, `!`]).toText(), `This is a new test`);\r\n    test(`trim Words`, s.trim([` `, `!`, `This`]).toText(), `is a new test`);\r\n    test(`trim Complex`, s.trim().trim([`This`, `test!`]).trim().toText(), `is a new`);\r\n};\r\n\r\n// runStringSpanTests();\r\n","export const uploadApiConfig = {\r\n    uploadApiUrl: `https://s7mrgkmtk5.execute-api.us-east-1.amazonaws.com/prod/upload-api`,\r\n};\r\n","!function (t, e) {\n  \"object\" == typeof exports && \"undefined\" != typeof module ? module.exports = e() : \"function\" == typeof define && define.amd ? define(e) : t.dayjs = e();\n}(this, function () {\n  \"use strict\";\n\n  var t = \"millisecond\",\n      e = \"second\",\n      n = \"minute\",\n      r = \"hour\",\n      i = \"day\",\n      s = \"week\",\n      u = \"month\",\n      a = \"quarter\",\n      o = \"year\",\n      f = \"date\",\n      h = /^(\\d{4})[-/]?(\\d{1,2})?[-/]?(\\d{0,2})[^0-9]*(\\d{1,2})?:?(\\d{1,2})?:?(\\d{1,2})?[.:]?(\\d+)?$/,\n      c = /\\[([^\\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,\n      d = {\n    name: \"en\",\n    weekdays: \"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday\".split(\"_\"),\n    months: \"January_February_March_April_May_June_July_August_September_October_November_December\".split(\"_\")\n  },\n      $ = function $(t, e, n) {\n    var r = String(t);\n    return !r || r.length >= e ? t : \"\" + Array(e + 1 - r.length).join(n) + t;\n  },\n      l = {\n    s: $,\n    z: function z(t) {\n      var e = -t.utcOffset(),\n          n = Math.abs(e),\n          r = Math.floor(n / 60),\n          i = n % 60;\n      return (e <= 0 ? \"+\" : \"-\") + $(r, 2, \"0\") + \":\" + $(i, 2, \"0\");\n    },\n    m: function t(e, n) {\n      if (e.date() < n.date()) return -t(n, e);\n      var r = 12 * (n.year() - e.year()) + (n.month() - e.month()),\n          i = e.clone().add(r, u),\n          s = n - i < 0,\n          a = e.clone().add(r + (s ? -1 : 1), u);\n      return +(-(r + (n - i) / (s ? i - a : a - i)) || 0);\n    },\n    a: function a(t) {\n      return t < 0 ? Math.ceil(t) || 0 : Math.floor(t);\n    },\n    p: function p(h) {\n      return {\n        M: u,\n        y: o,\n        w: s,\n        d: i,\n        D: f,\n        h: r,\n        m: n,\n        s: e,\n        ms: t,\n        Q: a\n      }[h] || String(h || \"\").toLowerCase().replace(/s$/, \"\");\n    },\n    u: function u(t) {\n      return void 0 === t;\n    }\n  },\n      y = \"en\",\n      M = {};\n\n  M[y] = d;\n\n  var m = function m(t) {\n    return t instanceof S;\n  },\n      D = function D(t, e, n) {\n    var r;\n    if (!t) return y;\n    if (\"string\" == typeof t) M[t] && (r = t), e && (M[t] = e, r = t);else {\n      var i = t.name;\n      M[i] = t, r = i;\n    }\n    return !n && r && (y = r), r || !n && y;\n  },\n      v = function v(t, e) {\n    if (m(t)) return t.clone();\n    var n = \"object\" == typeof e ? e : {};\n    return n.date = t, n.args = arguments, new S(n);\n  },\n      g = l;\n\n  g.l = D, g.i = m, g.w = function (t, e) {\n    return v(t, {\n      locale: e.$L,\n      utc: e.$u,\n      x: e.$x,\n      $offset: e.$offset\n    });\n  };\n\n  var S = function () {\n    function d(t) {\n      this.$L = D(t.locale, null, !0), this.parse(t);\n    }\n\n    var $ = d.prototype;\n    return $.parse = function (t) {\n      this.$d = function (t) {\n        var e = t.date,\n            n = t.utc;\n        if (null === e) return new Date(NaN);\n        if (g.u(e)) return new Date();\n        if (e instanceof Date) return new Date(e);\n\n        if (\"string\" == typeof e && !/Z$/i.test(e)) {\n          var r = e.match(h);\n\n          if (r) {\n            var i = r[2] - 1 || 0,\n                s = (r[7] || \"0\").substring(0, 3);\n            return n ? new Date(Date.UTC(r[1], i, r[3] || 1, r[4] || 0, r[5] || 0, r[6] || 0, s)) : new Date(r[1], i, r[3] || 1, r[4] || 0, r[5] || 0, r[6] || 0, s);\n          }\n        }\n\n        return new Date(e);\n      }(t), this.$x = t.x || {}, this.init();\n    }, $.init = function () {\n      var t = this.$d;\n      this.$y = t.getFullYear(), this.$M = t.getMonth(), this.$D = t.getDate(), this.$W = t.getDay(), this.$H = t.getHours(), this.$m = t.getMinutes(), this.$s = t.getSeconds(), this.$ms = t.getMilliseconds();\n    }, $.$utils = function () {\n      return g;\n    }, $.isValid = function () {\n      return !(\"Invalid Date\" === this.$d.toString());\n    }, $.isSame = function (t, e) {\n      var n = v(t);\n      return this.startOf(e) <= n && n <= this.endOf(e);\n    }, $.isAfter = function (t, e) {\n      return v(t) < this.startOf(e);\n    }, $.isBefore = function (t, e) {\n      return this.endOf(e) < v(t);\n    }, $.$g = function (t, e, n) {\n      return g.u(t) ? this[e] : this.set(n, t);\n    }, $.unix = function () {\n      return Math.floor(this.valueOf() / 1e3);\n    }, $.valueOf = function () {\n      return this.$d.getTime();\n    }, $.startOf = function (t, a) {\n      var h = this,\n          c = !!g.u(a) || a,\n          d = g.p(t),\n          $ = function $(t, e) {\n        var n = g.w(h.$u ? Date.UTC(h.$y, e, t) : new Date(h.$y, e, t), h);\n        return c ? n : n.endOf(i);\n      },\n          l = function l(t, e) {\n        return g.w(h.toDate()[t].apply(h.toDate(\"s\"), (c ? [0, 0, 0, 0] : [23, 59, 59, 999]).slice(e)), h);\n      },\n          y = this.$W,\n          M = this.$M,\n          m = this.$D,\n          D = \"set\" + (this.$u ? \"UTC\" : \"\");\n\n      switch (d) {\n        case o:\n          return c ? $(1, 0) : $(31, 11);\n\n        case u:\n          return c ? $(1, M) : $(0, M + 1);\n\n        case s:\n          var v = this.$locale().weekStart || 0,\n              S = (y < v ? y + 7 : y) - v;\n          return $(c ? m - S : m + (6 - S), M);\n\n        case i:\n        case f:\n          return l(D + \"Hours\", 0);\n\n        case r:\n          return l(D + \"Minutes\", 1);\n\n        case n:\n          return l(D + \"Seconds\", 2);\n\n        case e:\n          return l(D + \"Milliseconds\", 3);\n\n        default:\n          return this.clone();\n      }\n    }, $.endOf = function (t) {\n      return this.startOf(t, !1);\n    }, $.$set = function (s, a) {\n      var h,\n          c = g.p(s),\n          d = \"set\" + (this.$u ? \"UTC\" : \"\"),\n          $ = (h = {}, h[i] = d + \"Date\", h[f] = d + \"Date\", h[u] = d + \"Month\", h[o] = d + \"FullYear\", h[r] = d + \"Hours\", h[n] = d + \"Minutes\", h[e] = d + \"Seconds\", h[t] = d + \"Milliseconds\", h)[c],\n          l = c === i ? this.$D + (a - this.$W) : a;\n\n      if (c === u || c === o) {\n        var y = this.clone().set(f, 1);\n        y.$d[$](l), y.init(), this.$d = y.set(f, Math.min(this.$D, y.daysInMonth())).$d;\n      } else $ && this.$d[$](l);\n\n      return this.init(), this;\n    }, $.set = function (t, e) {\n      return this.clone().$set(t, e);\n    }, $.get = function (t) {\n      return this[g.p(t)]();\n    }, $.add = function (t, a) {\n      var f,\n          h = this;\n      t = Number(t);\n\n      var c = g.p(a),\n          d = function d(e) {\n        var n = v(h);\n        return g.w(n.date(n.date() + Math.round(e * t)), h);\n      };\n\n      if (c === u) return this.set(u, this.$M + t);\n      if (c === o) return this.set(o, this.$y + t);\n      if (c === i) return d(1);\n      if (c === s) return d(7);\n      var $ = (f = {}, f[n] = 6e4, f[r] = 36e5, f[e] = 1e3, f)[c] || 1,\n          l = this.$d.getTime() + t * $;\n      return g.w(l, this);\n    }, $.subtract = function (t, e) {\n      return this.add(-1 * t, e);\n    }, $.format = function (t) {\n      var e = this;\n      if (!this.isValid()) return \"Invalid Date\";\n\n      var n = t || \"YYYY-MM-DDTHH:mm:ssZ\",\n          r = g.z(this),\n          i = this.$locale(),\n          s = this.$H,\n          u = this.$m,\n          a = this.$M,\n          o = i.weekdays,\n          f = i.months,\n          h = function h(t, r, i, s) {\n        return t && (t[r] || t(e, n)) || i[r].substr(0, s);\n      },\n          d = function d(t) {\n        return g.s(s % 12 || 12, t, \"0\");\n      },\n          $ = i.meridiem || function (t, e, n) {\n        var r = t < 12 ? \"AM\" : \"PM\";\n        return n ? r.toLowerCase() : r;\n      },\n          l = {\n        YY: String(this.$y).slice(-2),\n        YYYY: this.$y,\n        M: a + 1,\n        MM: g.s(a + 1, 2, \"0\"),\n        MMM: h(i.monthsShort, a, f, 3),\n        MMMM: h(f, a),\n        D: this.$D,\n        DD: g.s(this.$D, 2, \"0\"),\n        d: String(this.$W),\n        dd: h(i.weekdaysMin, this.$W, o, 2),\n        ddd: h(i.weekdaysShort, this.$W, o, 3),\n        dddd: o[this.$W],\n        H: String(s),\n        HH: g.s(s, 2, \"0\"),\n        h: d(1),\n        hh: d(2),\n        a: $(s, u, !0),\n        A: $(s, u, !1),\n        m: String(u),\n        mm: g.s(u, 2, \"0\"),\n        s: String(this.$s),\n        ss: g.s(this.$s, 2, \"0\"),\n        SSS: g.s(this.$ms, 3, \"0\"),\n        Z: r\n      };\n\n      return n.replace(c, function (t, e) {\n        return e || l[t] || r.replace(\":\", \"\");\n      });\n    }, $.utcOffset = function () {\n      return 15 * -Math.round(this.$d.getTimezoneOffset() / 15);\n    }, $.diff = function (t, f, h) {\n      var c,\n          d = g.p(f),\n          $ = v(t),\n          l = 6e4 * ($.utcOffset() - this.utcOffset()),\n          y = this - $,\n          M = g.m(this, $);\n      return M = (c = {}, c[o] = M / 12, c[u] = M, c[a] = M / 3, c[s] = (y - l) / 6048e5, c[i] = (y - l) / 864e5, c[r] = y / 36e5, c[n] = y / 6e4, c[e] = y / 1e3, c)[d] || y, h ? M : g.a(M);\n    }, $.daysInMonth = function () {\n      return this.endOf(u).$D;\n    }, $.$locale = function () {\n      return M[this.$L];\n    }, $.locale = function (t, e) {\n      if (!t) return this.$L;\n      var n = this.clone(),\n          r = D(t, e, !0);\n      return r && (n.$L = r), n;\n    }, $.clone = function () {\n      return g.w(this.$d, this);\n    }, $.toDate = function () {\n      return new Date(this.valueOf());\n    }, $.toJSON = function () {\n      return this.isValid() ? this.toISOString() : null;\n    }, $.toISOString = function () {\n      return this.$d.toISOString();\n    }, $.toString = function () {\n      return this.$d.toUTCString();\n    }, d;\n  }(),\n      p = S.prototype;\n\n  return v.prototype = p, [[\"$ms\", t], [\"$s\", e], [\"$m\", n], [\"$H\", r], [\"$W\", i], [\"$M\", u], [\"$y\", o], [\"$D\", f]].forEach(function (t) {\n    p[t[1]] = function (e) {\n      return this.$g(e, t[0], t[1]);\n    };\n  }), v.extend = function (t, e) {\n    return t.$i || (t(e, S, v), t.$i = !0), v;\n  }, v.locale = D, v.isDayjs = m, v.unix = function (t) {\n    return v(1e3 * t);\n  }, v.en = M[y], v.Ls = M, v.p = {}, v;\n});","!function (e, t) {\n  \"object\" == typeof exports && \"undefined\" != typeof module ? module.exports = t() : \"function\" == typeof define && define.amd ? define(t) : e.dayjs_plugin_localizedFormat = t();\n}(this, function () {\n  \"use strict\";\n\n  var e = {\n    LTS: \"h:mm:ss A\",\n    LT: \"h:mm A\",\n    L: \"MM/DD/YYYY\",\n    LL: \"MMMM D, YYYY\",\n    LLL: \"MMMM D, YYYY h:mm A\",\n    LLLL: \"dddd, MMMM D, YYYY h:mm A\"\n  };\n  return function (t, n, o) {\n    var r = n.prototype,\n        M = r.format;\n    o.en.formats = e, r.format = function (t) {\n      void 0 === t && (t = \"YYYY-MM-DDTHH:mm:ssZ\");\n\n      var n = this.$locale().formats,\n          o = function (t, n) {\n        return t.replace(/(\\[[^\\]]+])|(LTS?|l{1,4}|L{1,4})/g, function (t, o, r) {\n          var M = r && r.toUpperCase();\n          return o || n[r] || e[r] || n[M].replace(/(\\[[^\\]]+])|(MMMM|MM|DD|dddd)/g, function (e, t, n) {\n            return t || n.slice(1);\n          });\n        });\n      }(t, void 0 === n ? {} : n);\n\n      return M.call(this, o);\n    };\n  };\n});","import './index.css';\r\nimport React, { ReactNode, useRef } from 'react';\r\nimport { ThemeTextStyle, ThemeViewStyle } from 'themes/theme';\r\n\r\nfunction mergeStyles<T>(items: (T | undefined | null) | (T | T[] | undefined | null)[]): T {\r\n    if (Array.isArray(items)) {\r\n        if (items.length === 1) { return mergeStyles(items[0]) ?? {} as T; }\r\n        let item = { ...mergeStyles(items[0]) };\r\n        items.forEach(x => { item = { ...item, ...mergeStyles(x ?? {}) }; });\r\n        return (item ?? {}) as T;\r\n    }\r\n    return items as T;\r\n};\r\n\r\nconst viewStyleDefaults = {\r\n    display: `flex`,\r\n    flexDirection: `column`,\r\n} as const;\r\n\r\nconst textStyleDefaults = {\r\n    whiteSpace: `pre`,\r\n} as const;\r\n\r\nconst finalizeTextStyle = <T extends unknown>(style: T) => {\r\n    const s = style as {\r\n        userSelect?: 'none';\r\n        MozUserSelect?: 'none';\r\n        WebkitUserSelect?: 'none';\r\n    };\r\n    if (s.userSelect === `none`) {\r\n        s.MozUserSelect = `none`;\r\n        s.WebkitUserSelect = `none`;\r\n    }\r\n\r\n    return style;\r\n};\r\n\r\nexport const View = (props: { style?: ThemeViewStyle | ThemeViewStyle[], children?: ReactNode }) => { return (<div style={mergeStyles([viewStyleDefaults, props.style])}>{props.children}</div>); };\r\nexport const Text = (props: { style?: ThemeTextStyle | ThemeTextStyle[], children?: string, numberOfLines?: undefined | 1 }) => {\r\n    if (props.numberOfLines === 1) {\r\n        const singleLineStyle = {\r\n            overflow: `hidden`,\r\n            whiteSpace: `nowrap`,\r\n            wordWrap: `break-word`,\r\n            textOverflow: `ellipsis`,\r\n        } as const;\r\n        const allStyles = mergeStyles([textStyleDefaults, props.style, singleLineStyle]);\r\n        return (<span style={finalizeTextStyle(allStyles)}>{props.children}</span>);\r\n    }\r\n    const allStyles = mergeStyles([textStyleDefaults, props.style]);\r\n    return (<span style={finalizeTextStyle(allStyles)}>{props.children}</span>);\r\n};\r\nexport const TextInput = (props: {\r\n    style?: ThemeTextStyle | ThemeTextStyle[];\r\n    keyboardType: 'default' | 'numeric' | 'phone-pad' | 'email-address';\r\n    autoCompleteType: 'off' | 'username' | 'password' | 'email' | 'name' | 'tel' | 'street-address' | 'postal-code';\r\n    secureTextEntry?: boolean;\r\n    placeholder?: string;\r\n    editable?: boolean;\r\n    value: string;\r\n    onChange: (value: string) => void;\r\n    onSubmitEditing?: () => void;\r\n    onFocus?: () => void;\r\n    onBlur?: () => void;\r\n    multiline?: boolean;\r\n    numberOfLines?: number;\r\n    onSelectionChange?: (value: {\r\n        start: number;\r\n        /** Exclusive (iNext actually) */\r\n        end: number;\r\n    }) => void;\r\n}) => {\r\n    const type = props.keyboardType === `numeric` ? `number`\r\n        : (props.secureTextEntry ? `password`\r\n            : `text`);\r\n\r\n    const name = props.autoCompleteType === `username` ? `username`\r\n        : (props.autoCompleteType === `password` ? `password`\r\n            : undefined);\r\n\r\n    const onKeyPress = props.onSubmitEditing && ((e: React.KeyboardEvent<HTMLInputElement | HTMLTextAreaElement>) => {\r\n        if (e.key === `Enter` && !e.shiftKey) {\r\n            e.preventDefault();\r\n            props.onSubmitEditing?.();\r\n        }\r\n    }) || undefined;\r\n\r\n    if (props.multiline) {\r\n        return (<textarea\r\n            name={name} id={name}\r\n            style={mergeStyles([textStyleDefaults, props.style])}\r\n            placeholder={props.placeholder}\r\n            disabled={!(props.editable ?? true)}\r\n            value={props.value}\r\n            onFocus={props.onFocus}\r\n            onChange={(e) => props.onChange(e.target.value)}\r\n            onKeyPress={onKeyPress}\r\n            onBlur={props.onBlur}\r\n            rows={props.numberOfLines}\r\n            onSelect={e => {\r\n                const eTarget = e.target as unknown as {\r\n                    selectionStart?: number;\r\n                    selectionEnd?: number;\r\n                };\r\n                const selectionRange = { start: eTarget.selectionStart ?? 0, end: eTarget.selectionEnd ?? 0 };\r\n                // console.log(`textare onSelect`, { selectionRange, eTarget });\r\n                if (!eTarget.selectionStart && !eTarget.selectionEnd) { return; }\r\n                props.onSelectionChange?.(selectionRange);\r\n            }}\r\n        />);\r\n    }\r\n\r\n    return (<input type={type}\r\n        name={name} id={name}\r\n        style={mergeStyles([textStyleDefaults, props.style])}\r\n        placeholder={props.placeholder}\r\n        disabled={!(props.editable ?? true)}\r\n        value={props.value}\r\n        onFocus={props.onFocus}\r\n        onChange={(e) => props.onChange(e.target.value)}\r\n        onKeyPress={onKeyPress}\r\n        onBlur={props.onBlur}\r\n    />);\r\n\r\n};\r\nexport const TouchableOpacity = (props: { style?: ThemeViewStyle | ThemeViewStyle[], children?: ReactNode, onPress: () => void }) => {\r\n\r\n    // Prevent Initial Press (already pressing when created)\r\n    const lastPressTime = useRef(Date.now());\r\n    const onPress = () => {\r\n        // Prevent duplicate triggers\r\n        if (Date.now() < lastPressTime.current + 250) {\r\n            // console.log(`TouchableOpacity - prevented duplicate trigger`, { lastPressTime: lastPressTime.current, now: Date.now() });\r\n            return;\r\n        }\r\n        lastPressTime.current = Date.now();\r\n\r\n        props.onPress();\r\n    };\r\n\r\n    const hasTouchStarted = useRef(true);\r\n\r\n    return (\r\n        <div style={mergeStyles([viewStyleDefaults, props.style])}\r\n            onClick={onPress}\r\n            onKeyPress={onPress}\r\n            onTouchStart={() => { hasTouchStarted.current = true; }}\r\n            onTouchMove={() => { hasTouchStarted.current = false; }}\r\n            onTouchEnd={() => { if (hasTouchStarted.current) { onPress(); } }}\r\n            role='button'\r\n            tabIndex={0}>\r\n            {props.children}\r\n        </div>\r\n    );\r\n};\r\n\r\nexport const Pressable = (props: { style?: ThemeViewStyle | ThemeViewStyle[], children?: ReactNode, onPressIn: () => void, onPressOut: () => void }) => {\r\n\r\n    const onIgnore = (e: React.MouseEvent | React.TouchEvent) => {\r\n        e.preventDefault();\r\n        e.stopPropagation?.();\r\n        (e as unknown as { [key: string]: boolean }).cancelBubble = true;\r\n        (e as unknown as { [key: string]: boolean }).returnValue = false;\r\n        return false;\r\n    };\r\n\r\n    const onPressIn = (e: React.MouseEvent | React.TouchEvent) => {\r\n        props.onPressIn();\r\n        return onIgnore(e);\r\n    };\r\n    const onPressOut = (e: React.MouseEvent | React.TouchEvent) => {\r\n        props.onPressOut();\r\n        return onIgnore(e);\r\n    };\r\n\r\n    return (\r\n        <div style={mergeStyles([viewStyleDefaults, props.style])}\r\n            onMouseDown={onPressIn}\r\n            onMouseUp={onPressOut}\r\n            onTouchStart={onPressIn}\r\n            onTouchEnd={onPressOut}\r\n            onTouchCancel={onPressOut}\r\n            onTouchMove={onIgnore}\r\n            onMouseLeave={onPressOut}\r\n            onTouchEndCapture={onPressOut}\r\n            role='button'\r\n            tabIndex={0}>\r\n            {props.children}\r\n        </div>\r\n    );\r\n};\r\n\r\nexport const ActivityIndicator = ({ size, color }: { size: 'large' | 'small', color: string }) => {\r\n    const sizePx = size === `small` ? 16 : 32;\r\n    return (\r\n        <CircleSvg size={sizePx} thickness={sizePx / 8} color={color} />\r\n    );\r\n};\r\n\r\n// Based on: https://glennmccomb.com/articles/building-a-pure-css-animated-svg-spinner/\r\nconst CircleSvg = ({ size, thickness, color }: { size: number, thickness: number, color: string }) => {\r\n    const circumference = 2 * Math.PI * (size - thickness) * 0.5;\r\n    const dashLength = circumference * 0.6;\r\n    return (\r\n        <svg style={{ maxWidth: size }} viewBox={`0 0 ${size} ${size}`} xmlns='http://www.w3.org/2000/svg'>\r\n            <circle style={{\r\n                fill: `transparent`,\r\n                stroke: color,\r\n                strokeWidth: thickness,\r\n                opacity: 0.5,\r\n            }} cx={size * 0.5} cy={size * 0.5} r={size * 0.5 - thickness} />\r\n            <circle className='activity-spinner' style={{\r\n                strokeDasharray: dashLength,\r\n                fill: `transparent`,\r\n                stroke: color,\r\n                strokeWidth: thickness,\r\n                transformOrigin: `${size * 0.5}px ${size * 0.5}px`,\r\n            }} cx={size * 0.5} cy={size * 0.5} r={size * 0.5 - thickness} />\r\n        </svg>\r\n    );\r\n};\r\n\r\n\r\nexport const Platform = {\r\n    OS: `web` as 'web' | 'ios' | 'android',\r\n};\r\n\r\nexport const Clipboard = {\r\n    setString: async (value: string) => { await navigator.clipboard.writeText(value); },\r\n};\r\n","import React, { useState, useEffect } from 'react';\r\nimport { Text, View, ActivityIndicator, TouchableOpacity } from 'react-native-lite';\r\nimport { SpeechService } from './speech';\r\n\r\nexport const VoiceChooser = ({ languange, speechService }: { languange: string, speechService: SpeechService }) => {\r\n    const [loading, setLoading] = useState(true);\r\n    // eslint-disable-next-line @typescript-eslint/no-unused-vars\r\n    const [renderId, setRenderId] = useState(0);\r\n\r\n    const refresh = () => {\r\n        setLoading(true);\r\n        setTimeout(() => {\r\n            setLoading(false);\r\n        }, 1000);\r\n    };\r\n\r\n    useEffect(() => {\r\n        refresh();\r\n    }, []);\r\n\r\n    const selectVoice = (voice: SpeechSynthesisVoice) => {\r\n        speechService.setVoiceForLanguange(languange, voice);\r\n        setRenderId(s => s + 1);\r\n        speechService.speak(voice.name, languange);\r\n    };\r\n\r\n    return (\r\n        <View>\r\n            <TouchableOpacity onPress={refresh}>\r\n                <Text style={{ fontSize: 24 }}>{`Voice for ${languange}`}</Text>\r\n            </TouchableOpacity>\r\n            {loading && <ActivityIndicator size='small' color='red' />}\r\n            {!loading && (\r\n                <>\r\n                    {speechService.getVoicesForLanguange(languange).map(x => (\r\n                        <TouchableOpacity key={x.voice.name} onPress={() => { selectVoice(x.voice); }}>\r\n                            <View>\r\n                                <Text style={{ margin: 4, fontSize: 14, whiteSpace: `normal` }} >{`${x.isSelected ? `` : ``} ${x.voice.lang} - ${x.voice.name} - ${x.voice.localService ? `local` : `web`}`}</Text>\r\n                            </View>\r\n                        </TouchableOpacity>\r\n                    ))}\r\n                </>\r\n            )}\r\n        </View>\r\n    );\r\n};\r\n","'use strict';\nvar $ = require('../internals/export');\nvar $trimStart = require('../internals/string-trim').start;\nvar forcedStringTrimMethod = require('../internals/string-trim-forced');\n\nvar FORCED = forcedStringTrimMethod('trimStart');\n\nvar trimStart = FORCED ? function trimStart() {\n  return $trimStart(this);\n} : ''.trimStart;\n\n// `String.prototype.{ trimStart, trimLeft }` methods\n// https://tc39.es/ecma262/#sec-string.prototype.trimstart\n// https://tc39.es/ecma262/#String.prototype.trimleft\n$({ target: 'String', proto: true, forced: FORCED }, {\n  trimStart: trimStart,\n  trimLeft: trimStart\n});\n","\r\nexport type Subscription<T> = (state: T) => void;\r\nexport type Subscribe<T> = (callback: (state: T) => void) => { unsubscribe: () => void };\r\n\r\nexport const createSubscribable = <T>(initialState?: T) => {\r\n    let lastState = initialState;\r\n    const callbacks = [] as (null | Subscription<T>)[];\r\n    const subscribe = (callback: Subscription<T>) => {\r\n        const i = callbacks.length;\r\n        callbacks.push(callback);\r\n\r\n        // Send Initial State if it exists\r\n        setTimeout(() => {\r\n            if (!lastState) { return; }\r\n            callback(lastState);\r\n        });\r\n\r\n        return {\r\n            unsubscribe: () => {\r\n                callbacks[i] = null;\r\n            },\r\n        };\r\n    };\r\n    const onStateChange = (state: T) => {\r\n        lastState = state;\r\n        callbacks.forEach(x => x?.(state));\r\n    };\r\n    return {\r\n        subscribe,\r\n        onStateChange,\r\n    };\r\n};\r\n","import { fetchWithTimeout } from 'utils/web-request';\r\nimport { AppError } from 'utils/error';\r\nimport { UploadUrl } from './types';\r\nimport { createUploadApiWebClient } from './web-client';\r\n\r\nexport const downloadData = async (getUrl: string) => {\r\n    const result = await fetchWithTimeout(getUrl, {\r\n        method: `GET`,\r\n        headers: {\r\n            'Accept': `application/json`,\r\n        },\r\n    });\r\n    const json = await result.json() as { data: unknown };\r\n    return json.data;\r\n};\r\n\r\n\r\nexport const createUploader = (uploadUrl: UploadUrl) => {\r\n    return {\r\n        uploadData: async (data: unknown) => {\r\n            const body = JSON.stringify({ data });\r\n            const result = await fetchWithTimeout(uploadUrl.putUrl, {\r\n                method: `PUT`,\r\n                headers: {\r\n                    'Accept': `application/json`,\r\n                    'Content-Type': `application/json`,\r\n                    'Content-Length': `${body.length}`,\r\n                },\r\n                body,\r\n            });\r\n\r\n            if (!result.ok) {\r\n                throw new AppError(`Upload Failed`);\r\n            }\r\n        },\r\n        downloadData: async (): Promise<unknown> => {\r\n            return await downloadData(uploadUrl.getUrl);\r\n        },\r\n    };\r\n};\r\n\r\nexport const createSmartUploader = <T extends {}>(args: { getUploadUrl: () => Promise<null | UploadUrl>, setUploadUrl: (uploadUrl: UploadUrl) => Promise<void>, uploadUrlPrefix: string, uploadApiUrl: string }) => {\r\n    const uploadApiWebClient = createUploadApiWebClient(args);\r\n\r\n    let _uploadUrl = null as null | UploadUrl;\r\n\r\n    const setupUploadUrl = async () => {\r\n        if (_uploadUrl) { return _uploadUrl; }\r\n\r\n        _uploadUrl = await args.getUploadUrl();\r\n        if (_uploadUrl) { return _uploadUrl; }\r\n\r\n        _uploadUrl = (await uploadApiWebClient.createUploadUrl({ prefix: args.uploadUrlPrefix })).uploadUrl;\r\n        await args.setUploadUrl(_uploadUrl);\r\n        return _uploadUrl;\r\n    };\r\n\r\n    return {\r\n        load: async (): Promise<null | T> => {\r\n            const uploadUrl = await setupUploadUrl();\r\n\r\n            try {\r\n                const data = await downloadData(uploadUrl.getUrl);\r\n                return data as T;\r\n            } catch{\r\n                return null;\r\n            }\r\n        },\r\n        save: async (data: T) => {\r\n            let uploadUrl = await setupUploadUrl();\r\n\r\n            try {\r\n                const uploader = createUploader(uploadUrl);\r\n                await uploader.uploadData(data);\r\n            } catch{\r\n                // Try again after renew upload token\r\n                uploadUrl = (await uploadApiWebClient.renewUploadUrl({ uploadUrl })).uploadUrl;\r\n                await args.setUploadUrl(uploadUrl);\r\n                _uploadUrl = uploadUrl;\r\n\r\n                const uploader = createUploader(uploadUrl);\r\n                await uploader.uploadData(data);\r\n            }\r\n\r\n            // Upload backup (temp)\r\n            const backupUrl = (await uploadApiWebClient.createUploadUrl({ prefix: `backup/${uploadUrl.relativePath}` })).uploadUrl;\r\n            const backupUploader = createUploader(backupUrl);\r\n            await backupUploader.uploadData(data);\r\n        },\r\n    };\r\n};\r\n","// eslint-disable-next-line import/no-mutable-exports\r\ndeclare let ga: (send: 'send', event: 'event', name: string, message: string) => void;\r\nif (typeof (ga) === `undefined`) { ga = () => { }; }\r\nexport { ga };\r\n","export type JsonTyped<T> = string & { __json: T };\r\n\r\nexport const jsonParse = <T>(json: JsonTyped<T>): T => {\r\n    return JSON.parse(json) as T;\r\n};\r\nexport const jsonParse_smart = <T>(json: T | JsonTyped<T>): T => {\r\n    if (typeof json === `string`) {\r\n        return JSON.parse(json) as T;\r\n    }\r\n    return json as T;\r\n};\r\nexport const jsonStringify = <T>(obj: T) => JSON.stringify(obj) as JsonTyped<T>;\r\n\r\nexport const jsonStringify_safe = (obj: unknown, shouldFormat?: boolean): string => {\r\n    const visited = [] as unknown[];\r\n\r\n    return JSON.stringify(obj, (_, val: unknown) => {\r\n        if (val != null && typeof val == `object`) {\r\n            if (visited.includes(val)) {\r\n                return `[OBJ-DUPLICATED]`;\r\n            }\r\n            visited.push(val);\r\n        }\r\n        return val;\r\n    }, shouldFormat ? 2 : 0);\r\n};\r\n","import React, { useState } from 'react';\r\nimport { View, Text, TouchableOpacity, Clipboard } from 'react-native-lite';\r\nimport { theme } from 'themes/theme';\r\nimport { ErrorState } from 'utils/error';\r\nimport { jsonStringify_safe } from 'utils/json';\r\nimport { Icon } from './icon';\r\nimport { IconKind } from './icon-kind';\r\n\r\nconst DEBUG = true;\r\n\r\nconst errorBoxStyle = {\r\n    view: theme.view_error,\r\n    text: theme.text_error,\r\n    text_errorMessage: theme.text_errorMessage,\r\n    icon: theme.icon,\r\n    icon_errorMessage: theme.icon_errorMessage,\r\n    button: { outlineColor: theme.colors.outline },\r\n};\r\n\r\nexport const ErrorBox = ({ error }: { error: ErrorState | null | undefined }) => {\r\n    if (!error) { return (<></>); }\r\n    return (<ErrorBox_Inner error={error} />);\r\n};\r\n\r\nconst ErrorBox_Inner = (props: { error: ErrorState }) => {\r\n    const [expanded, setExpanded] = useState(false);\r\n\r\n    // console.log(`ErrorBox`, { error: props.error, expanded });\r\n\r\n    const errorAsString = typeof props.error === `string` ? `${props.error}` : null;\r\n    const errorMessage = props.error.message ?? errorAsString ?? `Unknown Error`;\r\n    const errorDetails = props.error.data && jsonStringify_safe(props.error.data, true) || undefined;\r\n    const errorObjText = DEBUG && props.error && jsonStringify_safe(props.error, true) || undefined;\r\n    const canExpand = !!errorDetails || !!errorObjText;\r\n\r\n    return (\r\n        <View style={errorBoxStyle.view}>\r\n            <View style={{ flexDirection: `row` }}>\r\n                <TouchableOpacity style={{ flex: 1, flexDirection: `row`, alignItems: `center`, ...errorBoxStyle.button }} onPress={() => setExpanded(!expanded)}>\r\n                    {canExpand && (expanded ? <Icon style={errorBoxStyle.icon} kind={IconKind.expanded} /> : <Icon style={errorBoxStyle.icon} kind={IconKind.collapsed} />)}\r\n                    <View style={{ paddingRight: 8 }}>\r\n                        <Icon style={errorBoxStyle.icon} kind={IconKind.error} />\r\n                    </View>\r\n                    <View style={{ flex: 1, overflow: `hidden` }}>\r\n                        <Text style={errorBoxStyle.text} numberOfLines={!expanded ? 1 : undefined}>{errorMessage}</Text>\r\n                    </View>\r\n                </TouchableOpacity>\r\n                {DEBUG && (\r\n                    <TouchableOpacity style={{ flexDirection: `row`, alignItems: `center`, paddingLeft: 8, ...errorBoxStyle.button }} onPress={() => Clipboard.setString(jsonStringify_safe({ errorMessage, errorDetails, errorObjText }, true))}>\r\n                        <Icon style={errorBoxStyle.icon} kind={IconKind.copy} />\r\n                    </TouchableOpacity>\r\n                )}\r\n                {props.error.retryCallback && (\r\n                    <TouchableOpacity style={{ flexDirection: `row`, alignItems: `center`, paddingLeft: 8, ...errorBoxStyle.button }} onPress={props.error.retryCallback}>\r\n                        <Icon style={errorBoxStyle.icon} kind={IconKind.retry} />\r\n                    </TouchableOpacity>\r\n                )}\r\n            </View>\r\n            {canExpand && expanded && !!errorDetails && (<Text style={{ ...errorBoxStyle.text }}>{errorDetails}</Text>)}\r\n            {canExpand && expanded && !!errorObjText && (<Text style={{ ...errorBoxStyle.text }}>{errorObjText}</Text>)}\r\n        </View>\r\n    );\r\n};\r\n\r\n\r\nexport const ErrorMessage = (props: { children: string }) => {\r\n    return (\r\n        <View style={{ flexDirection: `row`, alignItems: `center` }}>\r\n            <View style={{ paddingLeft: 8, paddingRight: 8 }}>\r\n                <Icon style={errorBoxStyle.icon_errorMessage} kind={IconKind.error} />\r\n            </View>\r\n            <View style={{ overflow: `hidden` }}>\r\n                <Text style={errorBoxStyle.text_errorMessage} numberOfLines={1}>{props.children}</Text>\r\n            </View>\r\n        </View>\r\n    );\r\n};\r\n","/* eslint-disable react/no-array-index-key */\r\n/* eslint-disable jsx-a11y/no-static-element-interactions */\r\nimport React, { useState, useRef, useEffect } from 'react';\r\nimport { View, Text, ActivityIndicator, TouchableOpacity } from 'react-native-lite';\r\nimport { groupItems } from 'utils/arrays';\r\nimport { toKeyValueArray } from 'utils/objects';\r\nimport { useAutoLoadingError } from 'utils-react/hooks';\r\nimport { defaultDoodleDrawing, DoodleSegment, DoodleDrawing, doodleSegmentToSvgPath_line, DoodleDataWithScore } from './doodle';\r\nimport { createDoodleDrawingStorageService } from './doodle-storage';\r\n\r\nexport const styles = {\r\n    drawing: {\r\n        width: 312,\r\n        height: 312,\r\n        color: `#FFFFFF`,\r\n        backgroundColor: `#000000`,\r\n    },\r\n};\r\n\r\nexport const DoodleTestView = (props: {}) => {\r\n    const [doodle, setDoodle] = useState(defaultDoodleDrawing());\r\n\r\n    return (\r\n        <>\r\n            <DoodleDrawerView style={styles.drawing} drawing={doodle} onChange={setDoodle} />\r\n            <DoodleDisplayView style={styles.drawing} drawing={doodle} />\r\n        </>\r\n    );\r\n};\r\n\r\n// export const DoodleDrawingView = (props: { drawing?: DoodleDrawing, onDrawingChanged: (drawing: DoodleDrawing) => void }) => {\r\n\r\n//     const [doodle, setDoodle] = useState(props.drawing ?? defaultDoodleDrawing());\r\n//     const changeDoodle = (value: DoodleDrawing) => {\r\n//         setDoodle(value);\r\n//         props.onDrawingChanged(value);\r\n//     };\r\n\r\n//     return (\r\n//         <>\r\n//             <DoodleDrawer style={styles.drawing} drawing={doodle} onChange={changeDoodle} />\r\n//             {/* <div>\r\n//                 {JSON.stringify(doodle)}\r\n//             </div> */}\r\n//             {/* <div>\r\n//                 {JSON.stringify(decodeDoodleDrawing(encodeDoodleDrawing(doodle)))}\r\n//             </div> */}\r\n\r\n//             {/* <div>\r\n//                 {encodeDoodleDrawing(doodle).doodleText}\r\n//             </div> */}\r\n//             {/* <div>\r\n//                 {encodeDoodleDrawing(decodeDoodleDrawing(encodeDoodleDrawing(doodle))).doodleText}\r\n//             </div>  */}\r\n//         </>\r\n//     );\r\n// };\r\n\r\n\r\nexport const DoodleDrawerView = (props: { style: { width: number, height: number, color: string, backgroundColor: string }, drawing: DoodleDrawing, onChange: (drawing: DoodleDrawing) => void }) => {\r\n    const { style, drawing, onChange } = props;\r\n    const scale = style.width / drawing.width;\r\n\r\n    const [segment, setSegment] = useState(null as null | DoodleSegment);\r\n    const segmentClientStart = useRef(null as null | { clientX: number, clientY: number, x: number, y: number });\r\n    const divHost = useRef(null as null | HTMLDivElement);\r\n\r\n    type Ev = React.SyntheticEvent;\r\n\r\n    const onIgnore = (e: Ev) => {\r\n        e.preventDefault();\r\n        e.stopPropagation();\r\n        e.nativeEvent.cancelBubble = true;\r\n        e.nativeEvent.returnValue = false;\r\n        return false;\r\n    };\r\n\r\n    const onPressIn = (event: (Ev) & { clientX?: number, clientY?: number }, pos?: { clientX: number, clientY: number }) => {\r\n        // console.log(`onPressIn`, { event, pos });\r\n        const div = divHost.current;\r\n        if (!div) { return onIgnore(event); }\r\n\r\n        const rect = div.getBoundingClientRect();\r\n\r\n\r\n        const p = {\r\n            clientX: pos?.clientX ?? event.clientX ?? 0,\r\n            clientY: pos?.clientY ?? event.clientY ?? 0,\r\n        };\r\n\r\n        segmentClientStart.current = {\r\n            clientX: p.clientX,\r\n            clientY: p.clientY,\r\n            x: Math.floor((p.clientX - rect.x) / scale),\r\n            y: Math.floor((p.clientY - rect.y) / scale),\r\n        };\r\n\r\n        setSegment({\r\n            points: [{\r\n                x: segmentClientStart.current.x,\r\n                y: segmentClientStart.current.y,\r\n            }],\r\n        });\r\n\r\n        return onIgnore(event);\r\n    };\r\n    const onPressOut = (event: Ev) => {\r\n        // console.log(`onPressOut`, { event });\r\n        const s = segment;\r\n        if (!s) { return onIgnore(event); }\r\n\r\n        onChange({\r\n            ...drawing,\r\n            segments: [...drawing.segments, s],\r\n        });\r\n        setSegment(null);\r\n        segmentClientStart.current = null;\r\n\r\n        return onIgnore(event);\r\n    };\r\n    const onMove = (pos: { x: number, y: number }) => {\r\n        setSegment(s => {\r\n            if (!s) { return null; }\r\n            const lastPos = s.points[s.points.length - 1];\r\n            if (Math.abs(lastPos.x - pos.x) + Math.abs(lastPos.y - pos.y) <= 2) {\r\n                return s;\r\n            }\r\n            return { points: [...s.points, pos] };\r\n        });\r\n    };\r\n    const onClientMove = (event: (Ev) & { clientX?: number, clientY?: number }, pos?: { clientX: number, clientY: number }) => {\r\n        if (!segmentClientStart.current) {\r\n            return onIgnore(event);\r\n        }\r\n\r\n        // console.log(`onClientMove`, { event, pos });\r\n        const p = {\r\n            clientX: pos?.clientX ?? event.clientX ?? 0,\r\n            clientY: pos?.clientY ?? event.clientY ?? 0,\r\n        };\r\n        const dPos = {\r\n            x: Math.floor((p.clientX - segmentClientStart.current.clientX) / scale) + segmentClientStart.current.x,\r\n            y: Math.floor((p.clientY - segmentClientStart.current.clientY) / scale) + segmentClientStart.current.y,\r\n        };\r\n\r\n        onMove(dPos);\r\n        return onIgnore(event);\r\n    };\r\n\r\n    // useEffect(() => {\r\n    //     console.log(`divHost`, { divHost });\r\n    //     const div = divHost.current;\r\n    //     if (!div) { return () => { }; }\r\n\r\n    //     const onTouchStart = (x: Event) => onPressIn(x, (x as TouchEvent).touches[0]);\r\n    //     const onTouchMove = (x: Event) => onClientMove(x, (x as TouchEvent).touches[0]);\r\n\r\n    //     div.addEventListener(`mouseDown`, onPressIn, { passive: false });\r\n    //     div.addEventListener(`onTouchStart`, onTouchStart, { passive: false });\r\n    //     div.addEventListener(`onMouseUp`, onPressOut, { passive: false });\r\n    //     div.addEventListener(`onTouchEnd`, onPressOut, { passive: false });\r\n    //     div.addEventListener(`onMouseLeave`, onPressOut, { passive: false });\r\n    //     div.addEventListener(`onTouchEndCapture`, onPressOut, { passive: false });\r\n    //     div.addEventListener(`onMouseMove`, onClientMove, { passive: false });\r\n    //     div.addEventListener(`onTouchMove`, onTouchMove, { passive: false });\r\n\r\n    //     return () => {\r\n    //         div.removeEventListener(`mouseDown`, onPressIn);\r\n    //         div.removeEventListener(`onTouchStart`, onTouchStart);\r\n    //         div.removeEventListener(`onMouseUp`, onPressOut);\r\n    //         div.removeEventListener(`onTouchEnd`, onPressOut);\r\n    //         div.removeEventListener(`onMouseLeave`, onPressOut);\r\n    //         div.removeEventListener(`onTouchEndCapture`, onPressOut);\r\n    //         div.removeEventListener(`onMouseMove`, onClientMove);\r\n    //         div.removeEventListener(`onTouchMove`, onTouchMove);\r\n    //     };\r\n    // }, [divHost.current]);\r\n\r\n    useEffect(() => {\r\n        // console.log(`Disable scroll on touch`);\r\n        // Disable document scroll\r\n        const onIgnoreNative = (e: Event) => {\r\n            // If not drawing, don't ignore\r\n            if (!segmentClientStart.current) { return true; }\r\n\r\n            // console.log(`Prevent scroll on touch`);\r\n            e.preventDefault();\r\n            e.stopPropagation();\r\n            e.cancelBubble = true;\r\n            e.returnValue = false;\r\n            return false;\r\n        };\r\n        document.addEventListener(`touchmove`, onIgnoreNative, { passive: false });\r\n        return () => {\r\n            document.removeEventListener(`touchmove`, onIgnoreNative);\r\n        };\r\n    }, []);\r\n\r\n    return (\r\n        <>\r\n            <div style={{ position: `relative`, width: style.width, height: style.height, backgroundColor: style.backgroundColor }}>\r\n                <svg style={{ width: style.width, height: style.height }} viewBox={`0 0 ${drawing.width} ${drawing.height}`} preserveAspectRatio='none' xmlns='http://www.w3.org/2000/svg'>\r\n                    {drawing.segments.map((x, i) => (\r\n                        <path key={i} d={doodleSegmentToSvgPath_line(x)} stroke={style.color} fill='transparent' />\r\n                    ))}\r\n                    {segment && (\r\n                        <path d={doodleSegmentToSvgPath_line(segment)} stroke={style.color} fill='transparent' />\r\n                    )}\r\n                </svg>\r\n                <div ref={divHost} style={{ position: `absolute`, left: 0, right: 0, top: 0, bottom: 0, zIndex: 10 }}\r\n                    onMouseDown={onPressIn}\r\n                    onMouseUp={onPressOut}\r\n                    onMouseMove={onClientMove}\r\n                    onMouseLeave={onPressOut}\r\n                    onTouchStart={x => onPressIn(x, x.touches[0])}\r\n                    onTouchEnd={onPressOut}\r\n                    onTouchCancel={onPressOut}\r\n                    onTouchMove={x => onClientMove(x, x.touches[0])}\r\n                    onTouchEndCapture={onPressOut}\r\n                />\r\n            </div>\r\n            {/* <div>{doodleToSvg(drawing)}</div>\r\n            <div>{encodeDoodleDrawing(drawing).doodleText}</div> */}\r\n        </>\r\n    );\r\n};\r\n\r\nexport const DoodleDisplayView = (props: {\r\n    style: { width: number, height: number, color: string, backgroundColor: string };\r\n    drawing: DoodleDrawing;\r\n    shouldAnimate?: boolean;\r\n    animatePointsPerSecond?: number;\r\n    enableRedraw?: boolean;\r\n}) => {\r\n\r\n    const [redrawId, setRedrawId] = useState(0);\r\n\r\n    const redraw = () => {\r\n        if (!props.enableRedraw) { return; }\r\n        setRedrawId(s => s + 1);\r\n    };\r\n\r\n    if (props.enableRedraw) {\r\n        return (\r\n            <TouchableOpacity onPress={redraw}>\r\n                <DoodleDisplayView_Inner key={redrawId} {...props} shouldAnimate={redrawId > 0 ? true : (props.shouldAnimate ?? true)} />\r\n            </TouchableOpacity>\r\n        );\r\n    }\r\n    return (\r\n        <DoodleDisplayView_Inner {...props} />\r\n    );\r\n};\r\nconst DoodleDisplayView_Inner = ({\r\n    style,\r\n    drawing,\r\n    shouldAnimate = true,\r\n    animatePointsPerSecond = 20,\r\n}: {\r\n    style: { width: number, height: number, color: string, backgroundColor: string };\r\n    drawing: DoodleDrawing;\r\n    shouldAnimate?: boolean;\r\n    animatePointsPerSecond?: number;\r\n}) => {\r\n    const [tick, setTick] = useState(0);\r\n    const totalPoints = drawing.segments.flatMap(x => x.points).length;\r\n\r\n    useEffect(() => {\r\n        if (!shouldAnimate) { return () => { }; }\r\n\r\n        // console.log(`DoodleDisplayView_Inner.useEffect`);\r\n        const id = setInterval(() => {\r\n            // console.log(`DoodleDisplayView_Inner.useEffect.setInterval`);\r\n            setTick(s => {\r\n                if (s > totalPoints) { clearInterval(id); }\r\n                return s + Math.ceil(animatePointsPerSecond / 10);\r\n            });\r\n        }, 10);\r\n\r\n        return () => {\r\n            clearInterval(id);\r\n        };\r\n    }, [drawing]);\r\n\r\n    let remainingPoints = shouldAnimate ? tick : Number.MAX_SAFE_INTEGER;\r\n    return (\r\n        <div style={{ width: style.width, height: style.height, backgroundColor: style.backgroundColor }}>\r\n            <svg style={{ width: style.width, height: style.height }} viewBox={`0 0 ${drawing.width} ${drawing.height}`} preserveAspectRatio='none' xmlns='http://www.w3.org/2000/svg'>\r\n                {drawing.segments.map((x, i) => {\r\n                    const maxPoints = remainingPoints;\r\n                    remainingPoints = Math.max(0, remainingPoints - x.points.length);\r\n                    return (\r\n                        <path key={i} d={doodleSegmentToSvgPath_line({ points: [...x.points.slice(0, maxPoints)] })} stroke={style.color} fill='transparent' />\r\n                    );\r\n                })}\r\n            </svg>\r\n        </div>\r\n    );\r\n};\r\n\r\nexport const DoodleBrowser = () => {\r\n    const { loading, error, doWork } = useAutoLoadingError();\r\n    const [doodles, setDoodles] = useState([] as DoodleDataWithScore[]);\r\n    useEffect(() => {\r\n        doWork(async () => {\r\n            const service = await createDoodleDrawingStorageService();\r\n            const result = await service.getAllDrawings();\r\n            setDoodles(result.doodles);\r\n        });\r\n    }, []);\r\n\r\n    if (loading) {\r\n        return (\r\n            <ActivityIndicator size='large' color='#FFFF00' />\r\n        );\r\n    }\r\n\r\n    return (\r\n        <DoodleBrowseView doodles={doodles} />\r\n    );\r\n};\r\nexport const DoodleBrowseView = ({ doodles }: { doodles: DoodleDataWithScore[] }) => {\r\n\r\n    const grouped = toKeyValueArray(groupItems(doodles, x => x.prompt));\r\n\r\n    return (\r\n        <>\r\n            {grouped.map(g => (\r\n                <View key={g.key} style={{ padding: 4 }}>\r\n                    <Text style={{ fontSize: 12 }} >{g.key}</Text>\r\n                    <View style={{ padding: 4, flexDirection: `row`, flexWrap: `wrap` }}>\r\n                        {g.value.map(x => (\r\n                            <View key={x.key} style={{ padding: 4, alignItems: `center` }}>\r\n                                <DoodleDisplayView style={{ width: 104, height: 104, color: `#FFFFFF`, backgroundColor: `#000000` }} drawing={x.drawing} shouldAnimate={false} enableRedraw />\r\n                                <Text >{`${x.score}`}</Text>\r\n                            </View>\r\n                        ))}\r\n                    </View>\r\n                </View>\r\n            ))}\r\n        </>\r\n    );\r\n};\r\n","import { createSubscribable } from 'utils/subscribable';\r\nimport { AppError } from 'utils/error';\r\nimport { WebsocketApi, WebsocketConnectionEvent, WebsocketConnectionData } from './types';\r\n\r\nexport const createWebsocketClient = (config: { websocketsApiUrl: string }): WebsocketApi => {\r\n\r\n    const api: WebsocketApi = {\r\n        connect: <T>({ channelKey }: WebsocketConnectionData) => {\r\n            // With this implementation, the server simply echos all messages to all clients\r\n            // The client will filter those messages client-side with the key\r\n            // NOTE: When the server filters via keys (providing privacy), this will continue to work without changes\r\n\r\n            type MessageContainer = {\r\n                message: T | null;\r\n                key: string;\r\n            };\r\n\r\n            const subscribable = createSubscribable<T>();\r\n            const subscribableEvents = createSubscribable<WebsocketConnectionEvent>();\r\n\r\n            // Connect to websocket (and reconnect, etc.)\r\n            const createSocket = () => {\r\n                const socket = new WebSocket(`${config.websocketsApiUrl}`);\r\n\r\n                // Connection opened\r\n                socket.addEventListener(`open`, (event) => {\r\n                    if (socket !== activeSocket) {\r\n                        socket.close();\r\n                        return;\r\n                    }\r\n\r\n                    subscribableEvents.onStateChange({ connectionStatus: `opened` });\r\n\r\n                    // Send a key message\r\n                    const messageContainer: MessageContainer = {\r\n                        message: null,\r\n                        key: channelKey,\r\n                    };\r\n                    socket.send(JSON.stringify(messageContainer));\r\n\r\n                });\r\n                socket.addEventListener(`close`, (event) => {\r\n                    if (socket !== activeSocket) {\r\n                        socket.close();\r\n                        return;\r\n                    }\r\n\r\n                    subscribableEvents.onStateChange({ connectionStatus: `closed` });\r\n                    reconnect();\r\n                });\r\n                socket.addEventListener(`error`, (event) => {\r\n                    if (socket !== activeSocket) {\r\n                        socket.close();\r\n                        return;\r\n                    }\r\n\r\n                    subscribableEvents.onStateChange({ connectionStatus: `error`, error: { message: `Websocket Error`, error: event } });\r\n                    reconnect();\r\n                });\r\n\r\n                // Listen for messages\r\n                socket.addEventListener(`message`, (event) => {\r\n                    // console.log(`socket message`, { event });\r\n                    if (socket !== activeSocket) {\r\n                        socket.close();\r\n                        return;\r\n                    }\r\n\r\n                    const m = JSON.parse(event.data) as MessageContainer;\r\n                    if (m.key !== channelKey || !m.message) { return; }\r\n                    subscribable.onStateChange(m.message);\r\n                });\r\n\r\n                return socket;\r\n            };\r\n\r\n            let isClosed = false;\r\n            let activeSocket: null | WebSocket = createSocket();\r\n            const reconnect = () => {\r\n                if (isClosed) { return; }\r\n\r\n                setTimeout(() => {\r\n                    activeSocket = createSocket();\r\n                }, 50);\r\n            };\r\n\r\n            // Send Messages\r\n            const send = (message: T) => {\r\n                if (!activeSocket || activeSocket.readyState !== WebSocket.OPEN) {\r\n                    throw new AppError(`Websocket is not open`);\r\n                }\r\n                const messageContainer: MessageContainer = {\r\n                    message,\r\n                    key: channelKey,\r\n                };\r\n                activeSocket.send(JSON.stringify(messageContainer));\r\n            };\r\n\r\n            return {\r\n                send,\r\n                isConnected: () => activeSocket?.readyState === WebSocket.OPEN,\r\n                subscribeMessages: subscribable.subscribe,\r\n                subscribeConnectionEvents: subscribableEvents.subscribe,\r\n                close: () => {\r\n                    isClosed = true;\r\n                    activeSocket?.close();\r\n                    activeSocket = null;\r\n                },\r\n            };\r\n        },\r\n    };\r\n\r\n    return api;\r\n};\r\n","/* eslint-disable no-bitwise */\r\n\r\n// From: https://stackoverflow.com/a/52171480\r\n/** Generate an integer hashCode */\r\nconst cyrb53 = (str: string, seed = 0): number => {\r\n    let h1 = 0xDEADBEEF ^ seed; let h2 = 0x41C6CE57 ^ seed;\r\n    for (let i = 0, ch; i < str.length; i++) {\r\n        ch = str.charCodeAt(i);\r\n        h1 = Math.imul(h1 ^ ch, 2654435761);\r\n        h2 = Math.imul(h2 ^ ch, 1597334677);\r\n    }\r\n    h1 = Math.imul(h1 ^ (h1 >>> 16), 2246822507) ^ Math.imul(h2 ^ (h2 >>> 13), 3266489909);\r\n    h2 = Math.imul(h2 ^ (h2 >>> 16), 2246822507) ^ Math.imul(h1 ^ (h1 >>> 13), 3266489909);\r\n\r\n    // 53-bit int\r\n    return 4294967296 * (2097151 & h2) + (h1 >>> 0);\r\n\r\n    // Generate a 64-bit hashcode as a string\r\n    // return (h2 >>> 0).toString(16).padStart(8, `0`) + (h1 >>> 0).toString(16).padStart(8, `0`);\r\n};\r\n\r\nexport const hashCode = cyrb53;\r\n","import { hashCode } from 'utils/hash-code';\r\nimport { LessonProjectState, LessonProjectStateFilesHashCode } from './lesson-types';\r\n\r\nexport const calculateFilesHashCode = (files: LessonProjectState['files']): LessonProjectStateFilesHashCode => {\r\n    const allText = files.map(x => `${x.content}:${x.path}:${x.language}::`).join(``);\r\n    return `${hashCode(allText)}` as LessonProjectStateFilesHashCode;\r\n};\r\n","(function (global, factory) {\n  typeof exports === 'object' && typeof module !== 'undefined' ? factory(exports, require('react')) : typeof define === 'function' && define.amd ? define(['exports', 'react'], factory) : (global = global || self, factory(global.ReactStripe = {}, global.React));\n})(this, function (exports, React) {\n  'use strict';\n\n  React = React && Object.prototype.hasOwnProperty.call(React, 'default') ? React['default'] : React;\n\n  function _typeof(obj) {\n    \"@babel/helpers - typeof\";\n\n    if (typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\") {\n      _typeof = function _typeof(obj) {\n        return typeof obj;\n      };\n    } else {\n      _typeof = function _typeof(obj) {\n        return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj;\n      };\n    }\n\n    return _typeof(obj);\n  }\n\n  function _objectWithoutPropertiesLoose(source, excluded) {\n    if (source == null) return {};\n    var target = {};\n    var sourceKeys = Object.keys(source);\n    var key, i;\n\n    for (i = 0; i < sourceKeys.length; i++) {\n      key = sourceKeys[i];\n      if (excluded.indexOf(key) >= 0) continue;\n      target[key] = source[key];\n    }\n\n    return target;\n  }\n\n  function _objectWithoutProperties(source, excluded) {\n    if (source == null) return {};\n\n    var target = _objectWithoutPropertiesLoose(source, excluded);\n\n    var key, i;\n\n    if (Object.getOwnPropertySymbols) {\n      var sourceSymbolKeys = Object.getOwnPropertySymbols(source);\n\n      for (i = 0; i < sourceSymbolKeys.length; i++) {\n        key = sourceSymbolKeys[i];\n        if (excluded.indexOf(key) >= 0) continue;\n        if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue;\n        target[key] = source[key];\n      }\n    }\n\n    return target;\n  }\n\n  function _slicedToArray(arr, i) {\n    return _arrayWithHoles(arr) || _iterableToArrayLimit(arr, i) || _unsupportedIterableToArray(arr, i) || _nonIterableRest();\n  }\n\n  function _arrayWithHoles(arr) {\n    if (Array.isArray(arr)) return arr;\n  }\n\n  function _iterableToArrayLimit(arr, i) {\n    if (typeof Symbol === \"undefined\" || !(Symbol.iterator in Object(arr))) return;\n    var _arr = [];\n    var _n = true;\n    var _d = false;\n    var _e = undefined;\n\n    try {\n      for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) {\n        _arr.push(_s.value);\n\n        if (i && _arr.length === i) break;\n      }\n    } catch (err) {\n      _d = true;\n      _e = err;\n    } finally {\n      try {\n        if (!_n && _i[\"return\"] != null) _i[\"return\"]();\n      } finally {\n        if (_d) throw _e;\n      }\n    }\n\n    return _arr;\n  }\n\n  function _unsupportedIterableToArray(o, minLen) {\n    if (!o) return;\n    if (typeof o === \"string\") return _arrayLikeToArray(o, minLen);\n    var n = Object.prototype.toString.call(o).slice(8, -1);\n    if (n === \"Object\" && o.constructor) n = o.constructor.name;\n    if (n === \"Map\" || n === \"Set\") return Array.from(o);\n    if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen);\n  }\n\n  function _arrayLikeToArray(arr, len) {\n    if (len == null || len > arr.length) len = arr.length;\n\n    for (var i = 0, arr2 = new Array(len); i < len; i++) {\n      arr2[i] = arr[i];\n    }\n\n    return arr2;\n  }\n\n  function _nonIterableRest() {\n    throw new TypeError(\"Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\");\n  }\n\n  function createCommonjsModule(fn, module) {\n    return module = {\n      exports: {}\n    }, fn(module, module.exports), module.exports;\n  }\n  /**\n   * Copyright (c) 2013-present, Facebook, Inc.\n   *\n   * This source code is licensed under the MIT license found in the\n   * LICENSE file in the root directory of this source tree.\n   */\n\n\n  var ReactPropTypesSecret = 'SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED';\n  var ReactPropTypesSecret_1 = ReactPropTypesSecret;\n\n  function emptyFunction() {}\n\n  function emptyFunctionWithReset() {}\n\n  emptyFunctionWithReset.resetWarningCache = emptyFunction;\n\n  var factoryWithThrowingShims = function factoryWithThrowingShims() {\n    function shim(props, propName, componentName, location, propFullName, secret) {\n      if (secret === ReactPropTypesSecret_1) {\n        // It is still safe when called from React.\n        return;\n      }\n\n      var err = new Error('Calling PropTypes validators directly is not supported by the `prop-types` package. ' + 'Use PropTypes.checkPropTypes() to call them. ' + 'Read more at http://fb.me/use-check-prop-types');\n      err.name = 'Invariant Violation';\n      throw err;\n    }\n\n    shim.isRequired = shim;\n\n    function getShim() {\n      return shim;\n    } // Keep this list in sync with production version in `./factoryWithTypeCheckers.js`.\n\n\n    var ReactPropTypes = {\n      array: shim,\n      bool: shim,\n      func: shim,\n      number: shim,\n      object: shim,\n      string: shim,\n      symbol: shim,\n      any: shim,\n      arrayOf: getShim,\n      element: shim,\n      elementType: shim,\n      instanceOf: getShim,\n      node: shim,\n      objectOf: getShim,\n      oneOf: getShim,\n      oneOfType: getShim,\n      shape: getShim,\n      exact: getShim,\n      checkPropTypes: emptyFunctionWithReset,\n      resetWarningCache: emptyFunction\n    };\n    ReactPropTypes.PropTypes = ReactPropTypes;\n    return ReactPropTypes;\n  };\n\n  var propTypes = createCommonjsModule(function (module) {\n    /**\n     * Copyright (c) 2013-present, Facebook, Inc.\n     *\n     * This source code is licensed under the MIT license found in the\n     * LICENSE file in the root directory of this source tree.\n     */\n    {\n      // By explicitly using `prop-types` you are opting into new production behavior.\n      // http://fb.me/prop-types-in-prod\n      module.exports = factoryWithThrowingShims();\n    }\n  });\n\n  var isUnknownObject = function isUnknownObject(raw) {\n    return raw !== null && _typeof(raw) === 'object';\n  };\n\n  var isPromise = function isPromise(raw) {\n    return isUnknownObject(raw) && typeof raw.then === 'function';\n  }; // We are using types to enforce the `stripe` prop in this lib,\n  // but in an untyped integration `stripe` could be anything, so we need\n  // to do some sanity validation to prevent type errors.\n\n\n  var isStripe = function isStripe(raw) {\n    return isUnknownObject(raw) && typeof raw.elements === 'function' && typeof raw.createToken === 'function' && typeof raw.createPaymentMethod === 'function' && typeof raw.confirmCardPayment === 'function';\n  };\n\n  var PLAIN_OBJECT_STR = '[object Object]';\n\n  var isEqual = function isEqual(left, right) {\n    if (!isUnknownObject(left) || !isUnknownObject(right)) {\n      return left === right;\n    }\n\n    var leftArray = Array.isArray(left);\n    var rightArray = Array.isArray(right);\n    if (leftArray !== rightArray) return false;\n    var leftPlainObject = Object.prototype.toString.call(left) === PLAIN_OBJECT_STR;\n    var rightPlainObject = Object.prototype.toString.call(right) === PLAIN_OBJECT_STR;\n    if (leftPlainObject !== rightPlainObject) return false;\n    if (!leftPlainObject && !leftArray) return false;\n    var leftKeys = Object.keys(left);\n    var rightKeys = Object.keys(right);\n    if (leftKeys.length !== rightKeys.length) return false;\n    var keySet = {};\n\n    for (var i = 0; i < leftKeys.length; i += 1) {\n      keySet[leftKeys[i]] = true;\n    }\n\n    for (var _i = 0; _i < rightKeys.length; _i += 1) {\n      keySet[rightKeys[_i]] = true;\n    }\n\n    var allKeys = Object.keys(keySet);\n\n    if (allKeys.length !== leftKeys.length) {\n      return false;\n    }\n\n    var l = left;\n    var r = right;\n\n    var pred = function pred(key) {\n      return isEqual(l[key], r[key]);\n    };\n\n    return allKeys.every(pred);\n  };\n\n  var usePrevious = function usePrevious(value) {\n    var ref = React.useRef(value);\n    React.useEffect(function () {\n      ref.current = value;\n    }, [value]);\n    return ref.current;\n  };\n\n  var INVALID_STRIPE_ERROR = 'Invalid prop `stripe` supplied to `Elements`. We recommend using the `loadStripe` utility from `@stripe/stripe-js`. See https://stripe.com/docs/stripe-js/react#elements-props-stripe for details.'; // We are using types to enforce the `stripe` prop in this lib, but in a real\n  // integration `stripe` could be anything, so we need to do some sanity\n  // validation to prevent type errors.\n\n  var validateStripe = function validateStripe(maybeStripe) {\n    if (maybeStripe === null || isStripe(maybeStripe)) {\n      return maybeStripe;\n    }\n\n    throw new Error(INVALID_STRIPE_ERROR);\n  };\n\n  var parseStripeProp = function parseStripeProp(raw) {\n    if (isPromise(raw)) {\n      return {\n        tag: 'async',\n        stripePromise: Promise.resolve(raw).then(validateStripe)\n      };\n    }\n\n    var stripe = validateStripe(raw);\n\n    if (stripe === null) {\n      return {\n        tag: 'empty'\n      };\n    }\n\n    return {\n      tag: 'sync',\n      stripe: stripe\n    };\n  };\n\n  var ElementsContext = /*#__PURE__*/React.createContext(null);\n  ElementsContext.displayName = 'ElementsContext';\n\n  var parseElementsContext = function parseElementsContext(ctx, useCase) {\n    if (!ctx) {\n      throw new Error(\"Could not find Elements context; You need to wrap the part of your app that \".concat(useCase, \" in an <Elements> provider.\"));\n    }\n\n    return ctx;\n  };\n  /**\n   * The `Elements` provider allows you to use [Element components](https://stripe.com/docs/stripe-js/react#element-components) and access the [Stripe object](https://stripe.com/docs/js/initializing) in any nested component.\n   * Render an `Elements` provider at the root of your React app so that it is available everywhere you need it.\n   *\n   * To use the `Elements` provider, call `loadStripe` from `@stripe/stripe-js` with your publishable key.\n   * The `loadStripe` function will asynchronously load the Stripe.js script and initialize a `Stripe` object.\n   * Pass the returned `Promise` to `Elements`.\n   *\n   * @docs https://stripe.com/docs/stripe-js/react#elements-provider\n   */\n\n\n  var Elements = function Elements(_ref) {\n    var rawStripeProp = _ref.stripe,\n        options = _ref.options,\n        children = _ref.children;\n\n    var _final = React.useRef(false);\n\n    var isMounted = React.useRef(true);\n    var parsed = React.useMemo(function () {\n      return parseStripeProp(rawStripeProp);\n    }, [rawStripeProp]);\n\n    var _React$useState = React.useState(function () {\n      return {\n        stripe: null,\n        elements: null\n      };\n    }),\n        _React$useState2 = _slicedToArray(_React$useState, 2),\n        ctx = _React$useState2[0],\n        setContext = _React$useState2[1];\n\n    var prevStripe = usePrevious(rawStripeProp);\n    var prevOptions = usePrevious(options);\n\n    if (prevStripe !== null) {\n      if (prevStripe !== rawStripeProp) {\n        console.warn('Unsupported prop change on Elements: You cannot change the `stripe` prop after setting it.');\n      }\n\n      if (!isEqual(options, prevOptions)) {\n        console.warn('Unsupported prop change on Elements: You cannot change the `options` prop after setting the `stripe` prop.');\n      }\n    }\n\n    if (!_final.current) {\n      if (parsed.tag === 'sync') {\n        _final.current = true;\n        setContext({\n          stripe: parsed.stripe,\n          elements: parsed.stripe.elements(options)\n        });\n      }\n\n      if (parsed.tag === 'async') {\n        _final.current = true;\n        parsed.stripePromise.then(function (stripe) {\n          if (stripe && isMounted.current) {\n            // Only update Elements context if the component is still mounted\n            // and stripe is not null. We allow stripe to be null to make\n            // handling SSR easier.\n            setContext({\n              stripe: stripe,\n              elements: stripe.elements(options)\n            });\n          }\n        });\n      }\n    }\n\n    React.useEffect(function () {\n      return function () {\n        isMounted.current = false;\n      };\n    }, []);\n    React.useEffect(function () {\n      var anyStripe = ctx.stripe;\n\n      if (!anyStripe || !anyStripe._registerWrapper) {\n        return;\n      }\n\n      anyStripe._registerWrapper({\n        name: 'react-stripe-js',\n        version: \"1.2.0\"\n      });\n    }, [ctx.stripe]);\n    return /*#__PURE__*/React.createElement(ElementsContext.Provider, {\n      value: ctx\n    }, children);\n  };\n\n  var useElementsContextWithUseCase = function useElementsContextWithUseCase(useCaseMessage) {\n    var ctx = React.useContext(ElementsContext);\n    return parseElementsContext(ctx, useCaseMessage);\n  };\n  /**\n   * @docs https://stripe.com/docs/stripe-js/react#useelements-hook\n   */\n\n\n  var useElements = function useElements() {\n    var _useElementsContextWi = useElementsContextWithUseCase('calls useElements()'),\n        elements = _useElementsContextWi.elements;\n\n    return elements;\n  };\n  /**\n   * @docs https://stripe.com/docs/stripe-js/react#usestripe-hook\n   */\n\n\n  var useStripe = function useStripe() {\n    var _useElementsContextWi2 = useElementsContextWithUseCase('calls useStripe()'),\n        stripe = _useElementsContextWi2.stripe;\n\n    return stripe;\n  };\n  /**\n   * @docs https://stripe.com/docs/stripe-js/react#elements-consumer\n   */\n\n\n  var ElementsConsumer = function ElementsConsumer(_ref2) {\n    var children = _ref2.children;\n    var ctx = useElementsContextWithUseCase('mounts <ElementsConsumer>'); // Assert to satisfy the busted React.FC return type (it should be ReactNode)\n\n    return children(ctx);\n  };\n\n  ElementsConsumer.propTypes = {\n    children: propTypes.func.isRequired\n  };\n\n  var useCallbackReference = function useCallbackReference(cb) {\n    var ref = React.useRef(cb);\n    React.useEffect(function () {\n      ref.current = cb;\n    }, [cb]);\n    return function () {\n      if (ref.current) {\n        ref.current.apply(ref, arguments);\n      }\n    };\n  };\n\n  var extractUpdateableOptions = function extractUpdateableOptions(options) {\n    if (!isUnknownObject(options)) {\n      return {};\n    }\n\n    var _ = options.paymentRequest,\n        rest = _objectWithoutProperties(options, [\"paymentRequest\"]);\n\n    return rest;\n  };\n\n  var noop = function noop() {};\n\n  var capitalized = function capitalized(str) {\n    return str.charAt(0).toUpperCase() + str.slice(1);\n  };\n\n  var createElementComponent = function createElementComponent(type, isServer) {\n    var displayName = \"\".concat(capitalized(type), \"Element\");\n\n    var ClientElement = function ClientElement(_ref) {\n      var id = _ref.id,\n          className = _ref.className,\n          _ref$options = _ref.options,\n          options = _ref$options === void 0 ? {} : _ref$options,\n          _ref$onBlur = _ref.onBlur,\n          onBlur = _ref$onBlur === void 0 ? noop : _ref$onBlur,\n          _ref$onFocus = _ref.onFocus,\n          onFocus = _ref$onFocus === void 0 ? noop : _ref$onFocus,\n          _ref$onReady = _ref.onReady,\n          onReady = _ref$onReady === void 0 ? noop : _ref$onReady,\n          _ref$onChange = _ref.onChange,\n          onChange = _ref$onChange === void 0 ? noop : _ref$onChange,\n          _ref$onEscape = _ref.onEscape,\n          onEscape = _ref$onEscape === void 0 ? noop : _ref$onEscape,\n          _ref$onClick = _ref.onClick,\n          onClick = _ref$onClick === void 0 ? noop : _ref$onClick;\n\n      var _useElementsContextWi = useElementsContextWithUseCase(\"mounts <\".concat(displayName, \">\")),\n          elements = _useElementsContextWi.elements;\n\n      var elementRef = React.useRef(null);\n      var domNode = React.useRef(null);\n      var callOnReady = useCallbackReference(onReady);\n      var callOnBlur = useCallbackReference(onBlur);\n      var callOnFocus = useCallbackReference(onFocus);\n      var callOnClick = useCallbackReference(onClick);\n      var callOnChange = useCallbackReference(onChange);\n      var callOnEscape = useCallbackReference(onEscape);\n      React.useLayoutEffect(function () {\n        if (elementRef.current == null && elements && domNode.current != null) {\n          var element = elements.create(type, options);\n          elementRef.current = element;\n          element.mount(domNode.current);\n          element.on('ready', function () {\n            return callOnReady(element);\n          });\n          element.on('change', callOnChange);\n          element.on('blur', callOnBlur);\n          element.on('focus', callOnFocus);\n          element.on('escape', callOnEscape); // Users can pass an an onClick prop on any Element component\n          // just as they could listen for the `click` event on any Element,\n          // but only the PaymentRequestButton will actually trigger the event.\n\n          element.on('click', callOnClick);\n        }\n      });\n      var prevOptions = React.useRef(options);\n      React.useEffect(function () {\n        if (prevOptions.current && prevOptions.current.paymentRequest !== options.paymentRequest) {\n          console.warn('Unsupported prop change: options.paymentRequest is not a customizable property.');\n        }\n\n        var updateableOptions = extractUpdateableOptions(options);\n\n        if (Object.keys(updateableOptions).length !== 0 && !isEqual(updateableOptions, extractUpdateableOptions(prevOptions.current))) {\n          if (elementRef.current) {\n            elementRef.current.update(updateableOptions);\n            prevOptions.current = options;\n          }\n        }\n      }, [options]);\n      React.useEffect(function () {\n        var element = elementRef.current;\n        return function () {\n          if (element) {\n            element.destroy();\n          }\n        };\n      }, []);\n      return /*#__PURE__*/React.createElement(\"div\", {\n        id: id,\n        className: className,\n        ref: domNode\n      });\n    }; // Only render the Element wrapper in a server environment.\n\n\n    var ServerElement = function ServerElement(props) {\n      // Validate that we are in the right context by calling useElementsContextWithUseCase.\n      useElementsContextWithUseCase(\"mounts <\".concat(displayName, \">\"));\n      var id = props.id,\n          className = props.className;\n      return /*#__PURE__*/React.createElement(\"div\", {\n        id: id,\n        className: className\n      });\n    };\n\n    var Element = isServer ? ServerElement : ClientElement;\n    Element.propTypes = {\n      id: propTypes.string,\n      className: propTypes.string,\n      onChange: propTypes.func,\n      onBlur: propTypes.func,\n      onFocus: propTypes.func,\n      onReady: propTypes.func,\n      onClick: propTypes.func,\n      options: propTypes.object\n    };\n    Element.displayName = displayName;\n    Element.__elementType = type;\n    return Element;\n  };\n\n  var isServer = typeof window === 'undefined';\n  /**\n   * Requires beta access:\n   * Contact [Stripe support](https://support.stripe.com/) for more information.\n   *\n   * @docs https://stripe.com/docs/stripe-js/react#element-components\n   */\n\n  var AuBankAccountElement = createElementComponent('auBankAccount', isServer);\n  /**\n   * @docs https://stripe.com/docs/stripe-js/react#element-components\n   */\n\n  var CardElement = createElementComponent('card', isServer);\n  /**\n   * @docs https://stripe.com/docs/stripe-js/react#element-components\n   */\n\n  var CardNumberElement = createElementComponent('cardNumber', isServer);\n  /**\n   * @docs https://stripe.com/docs/stripe-js/react#element-components\n   */\n\n  var CardExpiryElement = createElementComponent('cardExpiry', isServer);\n  /**\n   * @docs https://stripe.com/docs/stripe-js/react#element-components\n   */\n\n  var CardCvcElement = createElementComponent('cardCvc', isServer);\n  /**\n   * @docs https://stripe.com/docs/stripe-js/react#element-components\n   */\n\n  var FpxBankElement = createElementComponent('fpxBank', isServer);\n  /**\n   * @docs https://stripe.com/docs/stripe-js/react#element-components\n   */\n\n  var IbanElement = createElementComponent('iban', isServer);\n  /**\n   * @docs https://stripe.com/docs/stripe-js/react#element-components\n   */\n\n  var IdealBankElement = createElementComponent('idealBank', isServer);\n  /**\n   * @docs https://stripe.com/docs/stripe-js/react#element-components\n   */\n\n  var PaymentRequestButtonElement = createElementComponent('paymentRequestButton', isServer);\n  exports.AuBankAccountElement = AuBankAccountElement;\n  exports.CardCvcElement = CardCvcElement;\n  exports.CardElement = CardElement;\n  exports.CardExpiryElement = CardExpiryElement;\n  exports.CardNumberElement = CardNumberElement;\n  exports.Elements = Elements;\n  exports.ElementsConsumer = ElementsConsumer;\n  exports.FpxBankElement = FpxBankElement;\n  exports.IbanElement = IbanElement;\n  exports.IdealBankElement = IdealBankElement;\n  exports.PaymentRequestButtonElement = PaymentRequestButtonElement;\n  exports.useElements = useElements;\n  exports.useStripe = useStripe;\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n});","export type PhoneNumber = string & { __type: 'PhoneNumber', format: '+19785551234' };\r\nexport type PhoneNumberFormatted = string & { __type: 'PhoneNumber', format: '(###) ###-####' };\r\n\r\nexport function formatPhoneNumber_UsaCanada(text: string): PhoneNumberFormatted {\r\n    return phoneNumberMask_UsaCanada(text).corrected as PhoneNumberFormatted;\r\n}\r\n\r\nexport function toStandardPhoneNumber(text: string): PhoneNumber {\r\n    return `+1${phoneNumberMask_UsaCanada(text).digitsNo1}` as PhoneNumber;\r\n}\r\n\r\nexport function toStandardPhoneNumber_optional(text: string | null | undefined): PhoneNumber | undefined {\r\n    if (!text) { return undefined; }\r\n    return `+1${phoneNumberMask_UsaCanada(text).digitsNo1}` as PhoneNumber;\r\n}\r\n\r\nexport function phoneNumberMask_UsaCanada(x: string | null | undefined) {\r\n    const numberMask = `(###) ###-####`;\r\n    const digits = x\r\n        ?.replace(/^(\\+1|1)/, ``)\r\n        .replace(/\\D/g, ``)\r\n        .split(``) ?? [];\r\n    const letters = numberMask.split(``);\r\n    let iDigit = 0;\r\n    let iLast = -1;\r\n    for (let i = 0; i < letters.length; i++) {\r\n        if (letters[i] === `#` && iDigit < digits.length) {\r\n            letters[i] = digits[iDigit];\r\n            iDigit++;\r\n            iLast = i;\r\n        }\r\n    }\r\n    const full = letters.join(``);\r\n    const corrected = letters.slice(0, iLast + 1).join(``);\r\n    return { corrected, full, digitsNo1: digits.join(``) };\r\n}\r\n","import { LessonData, LessonModule } from '../common/lesson-types';\r\nimport { calculateFilesHashCode } from '../common/lesson-hash';\r\n\r\nexport const createDefaultLesson = (): LessonData => {\r\n    const file = {\r\n        path: `test.tsx`,\r\n        content: `\r\nimport React from 'react';\r\n\r\nexport const MinimalReactComponent = (props: {}) => {\r\n    return (\r\n        <span>Hello World!</span>\r\n    );\r\n};\r\n        `.trim(),\r\n        language: `tsx` as const,\r\n    };\r\n    const file0 = {\r\n        path: `test0.tsx`,\r\n        content: `\r\nimport React from 'react';\r\n\r\nexport const MinimalReactComponent0 = (props: {}) => {\r\n    return (\r\n        <span>Hello World 0!</span>\r\n    );\r\n};\r\n        `.trim(),\r\n        language: `tsx` as const,\r\n    };\r\n    const file2 = {\r\n        path: `test2.tsx`,\r\n        content: `\r\nimport React from 'react';\r\n\r\nexport const MinimalReactComponent2 = (props: {}) => {\r\n    return (\r\n        <span>Hello World 2!</span>\r\n    );\r\n};\r\n        `.trim(),\r\n        language: `tsx` as const,\r\n    };\r\n\r\n    const focusIndex = file.content.indexOf(`<span>Hello World!</span>`);\r\n    const focusLength = `<span>Hello World!</span>`.length;\r\n    const files = [file0, file, file2];\r\n    const lesson: LessonData = {\r\n        key: `Lesson-${Date.now()}-${(`${Math.random()}`).substr(2)}`,\r\n        projectState: {\r\n            files,\r\n            filesHashCode: calculateFilesHashCode(files),\r\n        },\r\n        focus: {\r\n            filePath: file.path,\r\n            index: focusIndex,\r\n            length: focusLength,\r\n        },\r\n        title: `Test Lesson`,\r\n        objective: `Test the Editor`,\r\n        explanation: `Learn some stuff`,\r\n        task: `Make a test variable true`,\r\n        descriptions: [],\r\n        experiments: [],\r\n    };\r\n    return lesson;\r\n};\r\n\r\nexport const cloneLesson = (lesson: LessonData): LessonData => {\r\n    const newLesson = JSON.parse(JSON.stringify(lesson));\r\n    return {\r\n        ...newLesson,\r\n        key: `Lesson-${Date.now()}-${(`${Math.random()}`).substr(2)}`,\r\n    };\r\n};\r\n\r\nexport const createDefaultLessonModule = (): LessonModule => {\r\n    return {\r\n        key: `Module-${Date.now()}-${(`${Math.random()}`).substr(2)}`,\r\n        title: `Module`,\r\n        lessons: [createDefaultLesson()],\r\n    };\r\n};\r\n","/* eslint-disable react/no-array-index-key */\r\nimport React, { useEffect, useState } from 'react';\r\nimport { View, Text, TextInput, TouchableOpacity } from 'react-native-lite';\r\nimport { LessonProjectFilesEditor, LessonProjectEditorMode, LessonFileEditorMode } from '../common/components/lesson-file-editor';\r\nimport { LessonData, LessonExperiment, LessonProjectFileSelection, LessonProjectState, LessonStep_ConstructCode, LessonStep_UnderstandCode, SetProjectState } from '../common/lesson-types';\r\nimport { lessonExperiments_createReplacementProjectState, lessonExperiments_calculateProjectStateReplacements } from '../common/replacements';\r\nimport { LessonView_ConstructCode, LessonView_ExperimentCode, LessonView_UnderstandCode } from '../common/components/lesson-view';\r\nimport { LessonProjectStatePreview, LessonRenderView } from '../common/components/lesson-render-view';\r\nimport { calculateFilesHashCode } from '../common/lesson-hash';\r\n\r\nconst styles = {\r\n    container: {\r\n        background: `#111111`,\r\n    },\r\n    containerPanel: {\r\n        background: `#292a2d`,\r\n    },\r\n    editorModeTabRowView: {\r\n        flexDirection: `row`,\r\n        paddingLeft: 16,\r\n    },\r\n    editorModeTabView: {\r\n        background: `#1e1e1e`,\r\n        alignSelf: `flex-start`,\r\n        padding: 8,\r\n        marginRight: 1,\r\n    },\r\n    editorModeTabView_selected: {\r\n        background: `#292a2d`,\r\n        alignSelf: `flex-start`,\r\n        padding: 8,\r\n        marginRight: 1,\r\n    },\r\n    editorModeTabText: {\r\n        fontSize: 14,\r\n        color: `#FFFFFFF`,\r\n    },\r\n    editorModeTabText_selected: {\r\n        fontSize: 14,\r\n        color: `#FFFF88`,\r\n    },\r\n    buttonView: {\r\n        background: `#1e1e1e`,\r\n        alignSelf: `flex-start`,\r\n        padding: 8,\r\n        margin: 1,\r\n    },\r\n    buttonText: {\r\n        fontSize: 14,\r\n        color: `#FFFFFFF`,\r\n    },\r\n    sectionHeaderText: {\r\n        margin: 8,\r\n        fontSize: 18,\r\n        color: `#FFFF88`,\r\n    },\r\n    infoView: {\r\n    },\r\n    infoText: {\r\n        margin: 8,\r\n        fontSize: 12,\r\n        wrap: `wrap`,\r\n    },\r\n    lessonFieldView: {\r\n        flexDirection: `row`,\r\n    },\r\n    lessonFieldLabelText: {\r\n        minWidth: 80,\r\n        padding: 4,\r\n        fontSize: 12,\r\n    },\r\n    lessonFieldText: {\r\n        flex: 1,\r\n        padding: 4,\r\n        fontSize: 12,\r\n        wrap: `wrap`,\r\n    },\r\n    jsonText: {\r\n        padding: 4,\r\n        fontSize: 12,\r\n        color: `#FFFFFF`,\r\n        background: `#000000`,\r\n    },\r\n} as const;\r\n\r\nconst createLessonState = (lesson: LessonData, lessonJson?: string) => {\r\n    type LessonSteps = {\r\n        constructCode: LessonStep_ConstructCode;\r\n        understandCode: LessonStep_UnderstandCode;\r\n    };\r\n    const lessonSteps: LessonSteps = {\r\n        constructCode: {\r\n            lessonData: lesson,\r\n        },\r\n        understandCode: {\r\n            lessonData: lesson,\r\n        },\r\n    };\r\n\r\n    return {\r\n        lesson,\r\n        lessonJson: lessonJson ?? JSON.stringify(lesson, null, 2),\r\n        lessonSteps,\r\n    };\r\n};\r\n\r\nexport const LessonEditor = (props: { value: LessonData, onChange: (value: LessonData) => void, setProjectState: SetProjectState }) => {\r\n\r\n    const [data, setData] = useState(createLessonState(props.value));\r\n    type EditorMode = 'edit' | 'json' | 'construct-code' | 'understand-code' | 'experiment-code' | 'preview';\r\n    const [editorMode, setEditorMode] = useState(`edit` as EditorMode);\r\n    const editorModes = [\r\n        { value: `edit`, label: `Edit` },\r\n        { value: `json`, label: `Json` },\r\n        { value: `construct-code`, label: `Construct Code` },\r\n        { value: `understand-code`, label: `Understand Code` },\r\n        { value: `experiment-code`, label: `Experiment Code` },\r\n        { value: `preview`, label: `Preview` },\r\n    ] as { value: EditorMode, label: string }[];\r\n    const projectEditorMode: LessonProjectEditorMode =\r\n        editorMode === `edit` ? `edit`\r\n            : `display`;\r\n    const fileEditorMode_focus: LessonFileEditorMode =\r\n        editorMode === `edit` ? `edit`\r\n            : editorMode === `construct-code` ? `construct-code`\r\n                : `display`;\r\n    const fileEditorMode_noFocus: LessonFileEditorMode =\r\n        editorMode === `edit` ? `edit`\r\n            : editorMode === `construct-code` ? `display`\r\n                : `display`;\r\n\r\n    const changeLessonState = (value: typeof data) => {\r\n        setData(value);\r\n        props.onChange(value.lesson);\r\n    };\r\n    const changeLessonJson = (json: string) => {\r\n        changeLessonState(createLessonState(JSON.parse(json), json));\r\n    };\r\n\r\n    const onProjectDataChange = (projectData: { projectState?: LessonProjectState, focus?: LessonProjectFileSelection }) => {\r\n        changeLessonState(createLessonState({\r\n            ...data.lesson,\r\n            ...projectData,\r\n        }));\r\n    };\r\n    const onLessonChange = (lesson: Partial<LessonData>) => {\r\n        changeLessonState(createLessonState({\r\n            ...data.lesson,\r\n            ...lesson,\r\n        }));\r\n    };\r\n\r\n    const {\r\n        projectState,\r\n        focus,\r\n    } = data.lesson;\r\n\r\n    return (\r\n        <>\r\n            <View style={styles.container}>\r\n                <View style={styles.editorModeTabRowView}>\r\n                    {editorModes.map(x => (\r\n                        <TouchableOpacity key={x.value + editorMode} onPress={() => setEditorMode(x.value)}>\r\n                            <View style={x.value === editorMode ? styles.editorModeTabView_selected : styles.editorModeTabView}>\r\n                                <Text style={x.value === editorMode ? styles.editorModeTabText_selected : styles.editorModeTabText}>{x.label}</Text>\r\n                            </View>\r\n                        </TouchableOpacity>\r\n                    ))}\r\n                </View>\r\n                <View style={styles.containerPanel}>\r\n                    {editorMode === `json` && (\r\n                        <>\r\n                            <Text style={styles.sectionHeaderText}>Lesson Data</Text>\r\n                            <View>\r\n                                <TextInput\r\n                                    style={styles.jsonText}\r\n                                    value={data.lessonJson}\r\n                                    onChange={changeLessonJson}\r\n                                    autoCompleteType='off'\r\n                                    keyboardType='default'\r\n                                    multiline\r\n                                    numberOfLines={20}\r\n                                />\r\n                            </View>\r\n                        </>\r\n                    )}\r\n                    {editorMode === `edit` && (\r\n                        <>\r\n                            <Text style={styles.sectionHeaderText}>Project Files</Text>\r\n                            <LessonProjectFilesEditor\r\n                                projectData={{\r\n                                    projectState,\r\n                                    focus,\r\n                                }}\r\n                                fileEditorMode_focus={fileEditorMode_focus}\r\n                                fileEditorMode_noFocus={fileEditorMode_noFocus}\r\n                                projectEditorMode={projectEditorMode}\r\n                                onProjectDataChange={onProjectDataChange}\r\n                                lessonData={data.lesson}\r\n                            />\r\n                            <Text style={styles.sectionHeaderText}>Lesson</Text>\r\n                            <View style={styles.infoView}>\r\n                                <LessonField label='Title' value={data.lesson.title} onChange={x => onLessonChange({ title: x })} />\r\n                                <LessonField label='Objective' value={data.lesson.objective} onChange={x => onLessonChange({ objective: x })} />\r\n                                <LessonField label='Explanation' value={data.lesson.explanation} onChange={x => onLessonChange({ explanation: x })} />\r\n                                <LessonField label='Task' value={data.lesson.task} onChange={x => onLessonChange({ task: x })} />\r\n                                <LessonField_Descriptions label='Descriptions' value={data.lesson.descriptions} onChange={x => onLessonChange({ descriptions: x })} />\r\n                                <LessonField_Experiments label='Experiments' value={data.lesson.experiments} onChange={x => onLessonChange({ experiments: x })} lessonData={data.lesson} />\r\n                            </View>\r\n                        </>\r\n                    )}\r\n                    {editorMode === `construct-code` && (\r\n                        <LessonView_ConstructCode data={data.lesson} />\r\n                    )}\r\n                    {editorMode === `understand-code` && (\r\n                        <LessonView_UnderstandCode data={data.lesson} />\r\n                    )}\r\n                    {editorMode === `experiment-code` && (\r\n                        <LessonView_ExperimentCode data={data.lesson} setProjectState={props.setProjectState} />\r\n                    )}\r\n                    {editorMode === `preview` && (\r\n                        <LessonProjectStatePreview projectState={data.lesson.projectState} setProjectState={props.setProjectState} />\r\n                    )}\r\n                </View>\r\n            </View>\r\n        </>\r\n    );\r\n};\r\n\r\nconst LessonField = ({ label, value, onChange }: { label: string, value: string, onChange: (value: string) => void }) => {\r\n    return (\r\n        <View style={styles.lessonFieldView}>\r\n            <Text style={styles.lessonFieldLabelText}>{label}</Text>\r\n            <TextInput\r\n                style={styles.lessonFieldText}\r\n                value={value}\r\n                onChange={onChange}\r\n                autoCompleteType='off'\r\n                keyboardType='default'\r\n            />\r\n        </View>\r\n    );\r\n};\r\n\r\nconst LessonField_Descriptions = ({ label, value, onChange }: { label: string, value: string[], onChange: (value: string[]) => void }) => {\r\n    return (\r\n        <View style={styles.lessonFieldView}>\r\n            <Text style={styles.lessonFieldLabelText}>{label}</Text>\r\n            <TextInput\r\n                style={styles.lessonFieldText}\r\n                value={value.join(`\\n`)}\r\n                onChange={x => onChange(x.replace(/\\r\\n/, `\\n`).split(`\\n`))}\r\n                autoCompleteType='off'\r\n                keyboardType='default'\r\n                multiline\r\n                numberOfLines={5}\r\n            />\r\n        </View>\r\n    );\r\n};\r\n\r\n\r\nconst LessonField_Experiments = ({ label, value, onChange, lessonData }: {\r\n    label: string; value: LessonExperiment[]; onChange: (value: LessonExperiment[]) => void;\r\n    lessonData: LessonData;\r\n}) => {\r\n    return (\r\n        <View style={{}}>\r\n            <Text style={styles.lessonFieldLabelText}>{label}</Text>\r\n            {value.map((x, i) => (\r\n                <LessonField_Experiment key={`${i}`} label={`Experiment ${i}`} value={x}\r\n                    onChange={v => onChange(value.map((y, j) => i === j ? v : y))}\r\n                    onDelete={() => { value.splice(i, 1); onChange(value); }} lessonData={lessonData} />\r\n            ))}\r\n            <TouchableOpacity onPress={() => { value.push({ replacements: [], comment: ``, filesHashCode: calculateFilesHashCode([]) }); onChange(value); }}>\r\n                <View style={styles.buttonView}>\r\n                    <Text style={styles.buttonText}>{`${``} Add Experiment`}</Text>\r\n                </View>\r\n            </TouchableOpacity>\r\n        </View>\r\n    );\r\n};\r\n\r\n\r\nconst LessonField_Experiment = ({\r\n    label,\r\n    value,\r\n    onChange,\r\n    onDelete,\r\n    lessonData,\r\n}: {\r\n    label: string;\r\n    value: LessonExperiment;\r\n    onChange: (value: LessonExperiment) => void;\r\n    onDelete: () => void;\r\n    lessonData: LessonData;\r\n}) => {\r\n    const [modifiedProjectState, setModifiedProjectState] = useState(lessonData.projectState);\r\n    const [lastFocus, setLastFocus] = useState({ filePath: modifiedProjectState.files[0].path, index: 0, length: modifiedProjectState.files[0].content.length });\r\n    const [commentText, setCommentText] = useState(value.comment ?? ``);\r\n\r\n    useEffect(() => {\r\n        setModifiedProjectState(s => (lessonExperiments_createReplacementProjectState(lessonData.projectState, value.replacements)));\r\n    }, [lessonData.projectState]);\r\n\r\n    const changeProjectData = (data: { projectState?: LessonProjectState, focus?: LessonProjectFileSelection }) => {\r\n        if (data.focus) {\r\n            setLastFocus(data.focus);\r\n        }\r\n\r\n        if (!data.projectState) { return; }\r\n        // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\r\n        setModifiedProjectState(data.projectState!);\r\n        onChange({ ...lessonExperiments_calculateProjectStateReplacements(lessonData.projectState, data.projectState), comment: commentText, filesHashCode: calculateFilesHashCode(lessonData.projectState.files) });\r\n    };\r\n\r\n    return (\r\n        <View style={{}}>\r\n            <View style={{ flexDirection: `row` }}>\r\n                <Text style={styles.lessonFieldLabelText}>{label}</Text>\r\n                <View style={{ flex: 1 }} />\r\n                <TouchableOpacity onPress={onDelete}>\r\n                    <View style={styles.buttonView}>\r\n                        <Text style={styles.buttonText}>{`${``} Delete Experiment`}</Text>\r\n                    </View>\r\n                </TouchableOpacity>\r\n            </View>\r\n            <View style={styles.lessonFieldView}>\r\n                <Text style={styles.lessonFieldLabelText}>Comment</Text>\r\n                <TextInput\r\n                    style={styles.lessonFieldText}\r\n                    value={commentText}\r\n                    onChange={setCommentText}\r\n                    onBlur={() => onChange({ ...value, comment: commentText })}\r\n                    autoCompleteType='off'\r\n                    keyboardType='default'\r\n                />\r\n            </View>\r\n            <LessonProjectFilesEditor\r\n                key={modifiedProjectState.filesHashCode}\r\n                projectData={{\r\n                    projectState: modifiedProjectState,\r\n                    focus: lastFocus,\r\n                }}\r\n                fileEditorMode_focus='edit'\r\n                fileEditorMode_noFocus='edit'\r\n                projectEditorMode='display'\r\n                onProjectDataChange={changeProjectData}\r\n                lessonData={lessonData}\r\n            />\r\n            {value.replacements.map(x => (\r\n                <View key={x.selection.filePath + x.selection.index} >\r\n                    <View style={{ flexDirection: `row` }}>\r\n                        <Text style={{ minWidth: 80 }}>File</Text>\r\n                        <Text style={{ marginLeft: 4, background: `#111111` }}>{`${x.selection.filePath}`}</Text>\r\n                    </View>\r\n                    <View style={{ flexDirection: `row` }}>\r\n                        <Text style={{ minWidth: 80 }}>Match</Text>\r\n                        <Text style={{ marginLeft: 4, background: `#111111`, color: `#FF8888`, textDecoration: `line-through` }}>{`${lessonData.projectState.files.find(f => f.path === x.selection.filePath)?.content.substr(x.selection.index, x.selection.length)}`}</Text>\r\n                    </View>\r\n                    <View style={{ flexDirection: `row` }}>\r\n                        <Text style={{ minWidth: 80 }}>Replace</Text>\r\n                        <Text style={{ marginLeft: 4, background: `#111111`, color: `#8888FF` }}>{`${x.content}`}</Text>\r\n                    </View>\r\n                </View>\r\n            ))}\r\n        </View>\r\n    );\r\n};\r\n","/* eslint-disable react/no-array-index-key */\r\nimport React, { useState } from 'react';\r\nimport { TouchableOpacity, View, Text, TextInput } from 'react-native-lite';\r\nimport { TabsComponent, TabsListEditorComponent } from '../common/components/tabs';\r\nimport { LessonData, LessonModule, LessonProjectState, SetProjectState } from '../common/lesson-types';\r\nimport { cloneLesson, createDefaultLesson, createDefaultLessonModule } from './lesson-defaults';\r\nimport { LessonEditor } from './lesson-editor';\r\n\r\n\r\nconst styles = {\r\n    container: {\r\n        background: `#111111`,\r\n    },\r\n    containerPanel: {\r\n        background: `#292a2d`,\r\n    },\r\n    sectionHeaderText: {\r\n        margin: 8,\r\n        fontSize: 18,\r\n        color: `#FFFF88`,\r\n    },\r\n    jsonText: {\r\n        padding: 4,\r\n        fontSize: 12,\r\n        color: `#FFFFFF`,\r\n        background: `#000000`,\r\n    },\r\n} as const;\r\n\r\n\r\nexport const LessonModuleEditor = (props: { value?: LessonModule, onChange?: (value: LessonModule) => void, setProjectState: SetProjectState }) => {\r\n    const [module, setModule] = useState(props.value ?? createDefaultLessonModule());\r\n    const [activeLesson, setActiveLesson] = useState(module.lessons[0]);\r\n    const [mode, setMode] = useState(`lesson` as 'lesson' | 'json');\r\n\r\n    const changeActiveLesson = (value: LessonData) => {\r\n        setModule(s => {\r\n            const newModule = {\r\n                ...s,\r\n                lessons: s.lessons.map(x => {\r\n                    if (x === activeLesson) {\r\n                        return value;\r\n                    }\r\n                    return x;\r\n                }),\r\n            };\r\n            setTimeout(() => {\r\n                props.onChange?.(newModule);\r\n            });\r\n            return newModule;\r\n        });\r\n        setActiveLesson(value);\r\n    };\r\n    const changeModuleTitle = (value: string) => {\r\n        setModule(s => {\r\n            const newModule = {\r\n                ...s,\r\n                title: value,\r\n            };\r\n            setTimeout(() => {\r\n                props.onChange?.(newModule);\r\n            });\r\n            return newModule;\r\n        });\r\n    };\r\n\r\n    return (\r\n        <>\r\n\r\n            <View style={styles.container}>\r\n                <TabsComponent\r\n                    header='Module'\r\n                    items={[`lesson` as const, `json` as const]}\r\n                    getKey={x => x}\r\n                    getLabel={x => x}\r\n                    selected={mode}\r\n                    onSelect={setMode}\r\n                />\r\n                <TextInput\r\n                    style={styles.jsonText}\r\n                    value={module.title}\r\n                    onChange={changeModuleTitle}\r\n                    autoCompleteType='off'\r\n                    keyboardType='default'\r\n                />\r\n                {mode === `lesson` && (\r\n                    <>\r\n                        <TabsListEditorComponent\r\n                            style={{ selectedTabText: { color: `#88FF88` } }}\r\n                            header='Lessons'\r\n                            items={module.lessons}\r\n                            onChange={x => setModule(s => ({ ...s, lessons: x }))}\r\n                            getKey={x => x.key}\r\n                            getLabel={x => x.title}\r\n                            selected={activeLesson}\r\n                            onSelect={x => setActiveLesson(x)}\r\n                            onCreateNewItem={() => cloneLesson(activeLesson) ?? createDefaultLesson()}\r\n                        />\r\n                        {activeLesson && (\r\n                            <>\r\n                                <LessonEditor key={activeLesson.key} value={activeLesson} onChange={changeActiveLesson} setProjectState={props.setProjectState} />\r\n                            </>\r\n                        )}\r\n                    </>\r\n                )}\r\n                {mode === `json` && (\r\n                    <>\r\n                        <Text style={styles.sectionHeaderText}>Module Data</Text>\r\n                        <View>\r\n                            <TextInput\r\n                                style={styles.jsonText}\r\n                                value={JSON.stringify(module, null, 2)}\r\n                                onChange={x => setModule(JSON.parse(x))}\r\n                                autoCompleteType='off'\r\n                                keyboardType='default'\r\n                                multiline\r\n                                numberOfLines={20}\r\n                            />\r\n                        </View>\r\n                    </>\r\n                )}\r\n            </View>\r\n        </>\r\n    );\r\n};\r\n","var V3_URL = 'https://js.stripe.com/v3';\nvar V3_URL_REGEX = /^https:\\/\\/js\\.stripe\\.com\\/v3\\/?(\\?.*)?$/;\nvar EXISTING_SCRIPT_MESSAGE = 'loadStripe.setLoadParameters was called but an existing Stripe.js script already exists in the document; existing script parameters will be used';\n\nvar findScript = function findScript() {\n  var scripts = document.querySelectorAll(\"script[src^=\\\"\".concat(V3_URL, \"\\\"]\"));\n\n  for (var i = 0; i < scripts.length; i++) {\n    var script = scripts[i];\n\n    if (!V3_URL_REGEX.test(script.src)) {\n      continue;\n    }\n\n    return script;\n  }\n\n  return null;\n};\n\nvar injectScript = function injectScript(params) {\n  var queryString = params && !params.advancedFraudSignals ? '?advancedFraudSignals=false' : '';\n  var script = document.createElement('script');\n  script.src = \"\".concat(V3_URL).concat(queryString);\n  var headOrBody = document.head || document.body;\n\n  if (!headOrBody) {\n    throw new Error('Expected document.body not to be null. Stripe.js requires a <body> element.');\n  }\n\n  headOrBody.appendChild(script);\n  return script;\n};\n\nvar registerWrapper = function registerWrapper(stripe, startTime) {\n  if (!stripe || !stripe._registerWrapper) {\n    return;\n  }\n\n  stripe._registerWrapper({\n    name: 'stripe-js',\n    version: \"1.11.0\",\n    startTime: startTime\n  });\n};\n\nvar stripePromise = null;\n\nvar loadScript = function loadScript(params) {\n  // Ensure that we only attempt to load Stripe.js at most once\n  if (stripePromise !== null) {\n    return stripePromise;\n  }\n\n  stripePromise = new Promise(function (resolve, reject) {\n    if (typeof window === 'undefined') {\n      // Resolve to null when imported server side. This makes the module\n      // safe to import in an isomorphic code base.\n      resolve(null);\n      return;\n    }\n\n    if (window.Stripe && params) {\n      console.warn(EXISTING_SCRIPT_MESSAGE);\n    }\n\n    if (window.Stripe) {\n      resolve(window.Stripe);\n      return;\n    }\n\n    try {\n      var script = findScript();\n\n      if (script && params) {\n        console.warn(EXISTING_SCRIPT_MESSAGE);\n      } else if (!script) {\n        script = injectScript(params);\n      }\n\n      script.addEventListener('load', function () {\n        if (window.Stripe) {\n          resolve(window.Stripe);\n        } else {\n          reject(new Error('Stripe.js not available'));\n        }\n      });\n      script.addEventListener('error', function () {\n        reject(new Error('Failed to load Stripe.js'));\n      });\n    } catch (error) {\n      reject(error);\n      return;\n    }\n  });\n  return stripePromise;\n};\n\nvar initStripe = function initStripe(maybeStripe, args, startTime) {\n  if (maybeStripe === null) {\n    return null;\n  }\n\n  var stripe = maybeStripe.apply(undefined, args);\n  registerWrapper(stripe, startTime);\n  return stripe;\n}; // own script injection.\n\n\nvar stripePromise$1 = Promise.resolve().then(function () {\n  return loadScript(null);\n});\nvar loadCalled = false;\nstripePromise$1[\"catch\"](function (err) {\n  if (!loadCalled) {\n    console.warn(err);\n  }\n});\n\nvar loadStripe = function loadStripe() {\n  for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n    args[_key] = arguments[_key];\n  }\n\n  loadCalled = true;\n  var startTime = Date.now();\n  return stripePromise$1.then(function (maybeStripe) {\n    return initStripe(maybeStripe, args, startTime);\n  });\n};\n\nexport { loadStripe };","\r\nexport enum ProcessSteps_CreateSavedPaymentMethod {\r\n    _01_Client_BeginCreateSavedPaymentMethod = 100,\r\n    _02_Server_SetupSavedPaymentMethod = 200,\r\n    _03_Client_CollectPaymentDetails = 300,\r\n    _04_Server_ObtainPaymentMethod = 400,\r\n    _05_Server_SavePaymentMethod = 500,\r\n};\r\n\r\nexport const logProcessStep_CreateSavedPaymentMethod = (step: ProcessSteps_CreateSavedPaymentMethod, status?: 'BEGIN' | 'END' | 'FAIL', data?: unknown) => {\r\n    // TODO: Implement Universal Logger\r\n\r\n    // eslint-disable-next-line no-console\r\n    console.log(`CreateSavedPaymentMethod: ${ProcessSteps_CreateSavedPaymentMethod[step]} ${status}`, data);\r\n};\r\n\r\nexport const wrapProcessStep_CreateSavedPaymentMethod = async <TResult>(step: ProcessSteps_CreateSavedPaymentMethod, execute: () => Promise<TResult>): Promise<TResult> => {\r\n    try {\r\n        logProcessStep_CreateSavedPaymentMethod(step, `BEGIN`);\r\n\r\n        const result = await execute();\r\n        logProcessStep_CreateSavedPaymentMethod(step, `END`);\r\n        return result;\r\n    } catch (error) {\r\n        logProcessStep_CreateSavedPaymentMethod(step, `FAIL`, { error });\r\n        throw error;\r\n    }\r\n};\r\n","/** This token is used to identify a specific app user with the user's id in the provider's context (i.e. customer id) */\r\nexport type PaymentProviderUserToken = unknown & { __type: 'PaymentProviderUserToken' };\r\n/** This token is used to identify the client as it negotiates directly with the provider to enter payment method data */\r\nexport type PaymentProviderSavedPaymentMethodClientSetupToken = unknown & { __type: 'PaymentProviderSavedPaymentMethodClientSetupToken' };\r\n/** This token is used to identify the payment method obtained on the client from the provider */\r\nexport type PaymentProviderSavedPaymentMethodClientToken = unknown & { __type: 'PaymentProviderSavedPaymentMethodClientToken' };\r\n/** This token is used to identify the payment method long term after being verified by the provider on the server */\r\nexport type PaymentProviderSavedPaymentMethodStorageToken = unknown & { __type: 'PaymentProviderSavedPaymentMethodStorageToken' };\r\n\r\n/** PaymentProviderName identifies the payment provider and it's implementation (i.e. stripe, paypal, etc.) */\r\nexport type PaymentProviderName = string & { __type: 'PaymentProviderName' };\r\n\r\n/** PaymentMethodStorageKey is the auto generated storage key to uniquely identify a stored payment method */\r\nexport type PaymentMethodStorageKey = string & { __type: 'PaymentMethodStorageKey' };\r\n\r\nexport type PaymentMethodExpiration = {\r\n    year: number;\r\n    month: number;\r\n};\r\nexport type PaymentMethodClientInfo = {\r\n    key: PaymentMethodStorageKey;\r\n    providerName: PaymentProviderName;\r\n    title: string;\r\n    expiration: PaymentMethodExpiration;\r\n};\r\n\r\nexport type PaymentAmount = { currency: 'usd', usdCents: number };\r\n\r\nexport type PaymentTransaction = {\r\n    providerName: PaymentProviderName;\r\n    created: Date;\r\n    amount: PaymentAmount;\r\n    status: 'success' | 'incomplete' | 'terminated';\r\n}\r\n\r\n/** Payment Client to Server Calls\r\n * \r\n * These are the calls made on the client to the server, it supports multiple payment provider types\r\n * \r\n * Note: this is scoped to the user associated with the client\r\n */\r\nexport type PaymentClientApi = {\r\n    // Normal Flow\r\n    setupSavedPaymentMethod: (params: { providerName: PaymentProviderName }) => Promise<PaymentProviderSavedPaymentMethodClientSetupToken>;\r\n    saveSavedPaymentMethod: (params: { providerName: PaymentProviderName, paymentMethodClientToken: PaymentProviderSavedPaymentMethodClientToken }) => Promise<void>;\r\n\r\n    // Management of Payment Methods\r\n    getSavedPaymentMethods: () => Promise<PaymentMethodClientInfo[]>;\r\n    deleteSavedPaymentMethod: (params: { key: PaymentMethodStorageKey }) => Promise<void>;\r\n\r\n    // Management of Payments\r\n    debug_triggerPayment: (params: { amount: PaymentAmount }) => Promise<void>;\r\n    getPayments: () => Promise<PaymentTransaction[]>;\r\n    // getPaymentsRequiringUserAction: () => Promise<PaymentTransaction[]>;\r\n}\r\n\r\n\r\n/** Payment Server to Server Calls\r\n * \r\n * These are the calls intended to be used server-side to process payments\r\n * \r\n */\r\nexport type PaymentServerApi = {\r\n    /** This will use the payment methods in order until one succeeds */\r\n    chargeUsingSavedPaymentMethods: (params: { amount: PaymentAmount }) => Promise<void>;\r\n}\r\n\r\n/** Payment Server to Payment Provider Api Calls\r\n * \r\n * This wraps the provider-specific server code\r\n */\r\nexport type PaymentProviderApi = {\r\n    providerName: PaymentProviderName;\r\n    setupSavedPaymentMethod: (userToken: PaymentProviderUserToken | null) => Promise<{\r\n        newUserToken?: PaymentProviderUserToken;\r\n        setupToken: PaymentProviderSavedPaymentMethodClientSetupToken;\r\n    }>;\r\n    obtainSavedPaymentMethod: (userToken: PaymentProviderUserToken, clientToken: PaymentProviderSavedPaymentMethodClientToken) => Promise<{\r\n        token: PaymentProviderSavedPaymentMethodStorageToken;\r\n        title: string;\r\n        expiration: PaymentMethodExpiration;\r\n    }>;\r\n    chargeSavedPaymentMethod: (userToken: PaymentProviderUserToken, token: PaymentProviderSavedPaymentMethodStorageToken, amount: PaymentAmount) => Promise<void>;\r\n\r\n    getPayments: (userToken: PaymentProviderUserToken) => Promise<PaymentTransaction[]>;\r\n}\r\n\r\n/** Payment Server Dependencies */\r\nexport type PaymentMethodStorageData = {\r\n    /** Key should be auto-generated by storage provider */\r\n    key: PaymentMethodStorageKey;\r\n    title: string;\r\n    expiration: PaymentMethodExpiration;\r\n    providerName: PaymentProviderName;\r\n    paymentMethodStorageToken: PaymentProviderSavedPaymentMethodStorageToken;\r\n};\r\n\r\nexport type PaymentUserTokenData = {\r\n    providerName: PaymentProviderName;\r\n    userToken: PaymentProviderUserToken;\r\n};\r\n\r\nexport type PaymentStorageProviderApi = {\r\n    getUserToken: (params: { providerName: PaymentProviderName }) => Promise<PaymentUserTokenData | null>;\r\n    setUserToken: (params: PaymentUserTokenData) => Promise<void>;\r\n\r\n    savePaymentMethod: (params: Omit<PaymentMethodStorageData, 'key'>) => Promise<void>;\r\n    /** Return all saved payment methods - In the order that they were created */\r\n    getSavedPaymentMethods: () => Promise<PaymentMethodStorageData[]>;\r\n    deleteSavedPaymentMethod: (params: { key: PaymentMethodStorageKey }) => Promise<void>;\r\n}\r\n\r\nexport class PaymentError extends Error {\r\n    constructor(public message: string, public data?: unknown) { super(); }\r\n}\r\n","/* eslint-disable @typescript-eslint/quotes */\r\n/* eslint-disable prefer-template */\r\nimport { ProcessSteps_CreateSavedPaymentMethod } from '../../../common/process-steps';\r\n\r\n// Saved Payments: https://stripe.com/docs/payments/save-and-reuse\r\nexport enum ProcessSteps_CreateSavedPaymentMethod_Stripe {\r\n    _02A_Server_GetOrCreateCustomer = ProcessSteps_CreateSavedPaymentMethod._02_Server_SetupSavedPaymentMethod + 1,\r\n    _02B_Server_CreateSetupIntent = ProcessSteps_CreateSavedPaymentMethod._02_Server_SetupSavedPaymentMethod + 2,\r\n    _03A_Client_CollectPaymentDetails = ProcessSteps_CreateSavedPaymentMethod._03_Client_CollectPaymentDetails + 1,\r\n    _04A_Server_ObtainPaymentMethod = ProcessSteps_CreateSavedPaymentMethod._04_Server_ObtainPaymentMethod + 1,\r\n    _04B_Server_ObtainPaymentMethodDetails = ProcessSteps_CreateSavedPaymentMethod._04_Server_ObtainPaymentMethod + 2,\r\n};\r\n\r\nexport const logProcessStep_CreateSavedPaymentMethod_Stripe = (step: ProcessSteps_CreateSavedPaymentMethod_Stripe, status?: 'BEGIN' | 'END' | 'FAIL', data?: unknown) => {\r\n    // TODO: Implement Universal Logger\r\n\r\n    // eslint-disable-next-line no-console\r\n    console.log(`CreateSavedPaymentMethod_Stripe: ${ProcessSteps_CreateSavedPaymentMethod_Stripe[step]} ${status}`, data);\r\n};\r\n\r\nexport const wrapProcessStep_CreateSavedPaymentMethod_Stripe = async <TResult>(step: ProcessSteps_CreateSavedPaymentMethod_Stripe, execute: () => Promise<TResult>): Promise<TResult> => {\r\n    try {\r\n        logProcessStep_CreateSavedPaymentMethod_Stripe(step, `BEGIN`);\r\n\r\n        const result = await execute();\r\n        logProcessStep_CreateSavedPaymentMethod_Stripe(step, `END`);\r\n        return result;\r\n    } catch (error) {\r\n        logProcessStep_CreateSavedPaymentMethod_Stripe(step, `FAIL`, { error });\r\n        throw error;\r\n    }\r\n};\r\n","import React, { useState } from 'react';\r\nimport { Elements, CardElement, useStripe, useElements } from '@stripe/react-stripe-js';\r\nimport { loadStripe, PaymentMethod, PaymentMethodCreateParams } from '@stripe/stripe-js';\r\nimport { PaymentClientComponents } from '../../../common/types-react';\r\nimport { PaymentError } from '../../../common/types';\r\nimport { stripeDecodeClientSetupToken, stripeEncodeClientToken } from './stripe-client-tokens';\r\nimport { wrapProcessStep_CreateSavedPaymentMethod_Stripe, ProcessSteps_CreateSavedPaymentMethod_Stripe } from '../common/stripe-process-steps';\r\n\r\nexport const createPaymentClientComponents_stripe = (params: { stripePublicKey: string }): PaymentClientComponents => {\r\n\r\n    const stripePromise = loadStripe(params.stripePublicKey);\r\n\r\n    const components: PaymentClientComponents = {\r\n        AppWrapperComponent: ({ children }) => (<Elements stripe={stripePromise}>{children}</Elements>),\r\n        PaymentMethodEntryComponent: ({ style, paymentMethodSetupToken, onPaymentMethodReady }) => {\r\n            const stripe = useStripe();\r\n            const elements = useElements();\r\n\r\n            const [stripeError, setStripeError] = useState(null as null | { message: string, error: unknown });\r\n\r\n            const handleSubmit = async (event: React.FormEvent<HTMLFormElement>) => {\r\n                event.preventDefault();\r\n                if (!stripe || !elements) { return; }\r\n\r\n                try {\r\n                    // Completed SetupIntent -> Used to get PaymentMethod\r\n                    const setupIntent = await wrapProcessStep_CreateSavedPaymentMethod_Stripe(\r\n                        ProcessSteps_CreateSavedPaymentMethod_Stripe._03A_Client_CollectPaymentDetails,\r\n                        async () => {\r\n\r\n                            const setupInfo = stripeDecodeClientSetupToken(paymentMethodSetupToken);\r\n\r\n                            const result = await stripe.confirmCardSetup(setupInfo.clientSecret, {\r\n                                payment_method: {\r\n                                    // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\r\n                                    card: elements.getElement(CardElement)!,\r\n                                    billing_details: setupInfo.customerBillingDetails,\r\n                                },\r\n                            });\r\n\r\n                            if (result.error || !result.setupIntent) {\r\n                                throw new PaymentError(`Stripe Payment Error`, result.error);\r\n                            }\r\n\r\n                            return result.setupIntent;\r\n                        });\r\n                    if (!setupIntent) { return; }\r\n\r\n                    onPaymentMethodReady(stripeEncodeClientToken({ setupIntent }));\r\n                } catch (error) {\r\n                    setStripeError({ message: `Stripe Payment Error`, error });\r\n                }\r\n            };\r\n\r\n            const s = style;\r\n            const inputStyle = {\r\n                base: {\r\n                    color: s.textColor,\r\n                    fontSize: s.fontSize ? `${s.fontSize}px` : ``,\r\n                    fontFamily: s.fontFamily,\r\n                    fontSmoothing: `antialiased`,\r\n                    \"::placeholder\": {\r\n                        color: s.textColor,\r\n                        opacity: 0.8,\r\n                    },\r\n                },\r\n                invalid: {\r\n                    color: s.textColor_invalid,\r\n                    iconColor: s.textColor_invalid,\r\n                },\r\n            };\r\n            const inputContainerStyle = {\r\n                marginBottom: s.elementPadding,\r\n                padding: s.textPadding,\r\n                backgroundColor: s.backgroundColor,\r\n                borderWidth: 1, borderStyle: `solid`, borderColor: s.borderColor, borderRadius: s.borderRadius,\r\n            };\r\n            const buttonStyle = {\r\n                color: s.textColor,\r\n                backgroundColor: s.backgroundColor,\r\n                borderWidth: 1, borderStyle: `solid`, borderColor: s.borderColor, borderRadius: s.borderRadius,\r\n\r\n                fontSize: s.fontSize ? `${s.fontSize}px` : ``,\r\n                fontFamily: s.fontFamily,\r\n                fontSmoothing: `antialiased`,\r\n                fontWeight: `bold`,\r\n                padding: s.textPadding,\r\n                marginBottom: s.elementPadding,\r\n            } as const;\r\n            const buttonJustifyContent = s.buttonAlignment === `left` ? `flex-start`\r\n                : (s.buttonAlignment === `right` ? `flex-end`\r\n                    : `center`);\r\n\r\n            const errorContainerStyle = {\r\n                marginBottom: s.elementPadding,\r\n                padding: s.textPadding,\r\n                backgroundColor: s.backgroundColor,\r\n                borderWidth: 1, borderStyle: `solid`, borderColor: s.borderColor, borderRadius: s.borderRadius,\r\n            };\r\n            const errorMessageStyle = {\r\n                color: s.textColor_invalid,\r\n\r\n                fontSize: s.fontSize ? `${s.fontSize}px` : ``,\r\n                fontFamily: s.fontFamily,\r\n                fontSmoothing: `antialiased`,\r\n                fontWeight: `bold`,\r\n                padding: s.textPadding,\r\n                marginBottom: s.elementPadding,\r\n            } as const;\r\n\r\n            return (\r\n                <form onSubmit={handleSubmit}>\r\n                    <div style={inputContainerStyle}>\r\n                        <CardElement options={{ style: inputStyle }} />\r\n                    </div>\r\n                    {stripeError && (\r\n                        <>\r\n                            <div style={errorContainerStyle}>\r\n                                <span style={errorMessageStyle}>{stripeError.message}</span>\r\n                            </div>\r\n                        </>\r\n                    )}\r\n\r\n                    {!stripeError && (\r\n                        <div style={{ display: `flex`, flexDirection: `row`, justifyContent: buttonJustifyContent }}>\r\n                            <button type='submit' disabled={!stripe || !elements} style={buttonStyle}>{s.buttonText ?? `Subscribe`}</button>\r\n                        </div>\r\n                    )}\r\n                </form>\r\n            );\r\n        },\r\n    };\r\n\r\n    return components;\r\n};\r\n","export type DoodleDrawingStorageService = {\r\n    saveDrawing: (prompt: string, drawing: DoodleDrawing) => Promise<void>;\r\n    saveBestDrawingSelection: (doodle: DoodleData) => Promise<void>;\r\n    getDrawings: (prompt: string, options?: { includeOtherPrompts?: boolean, maxCount?: number }) => Promise<{ doodles: DoodleData[] }>;\r\n    getAllDrawings: () => Promise<{ doodles: DoodleDataWithScore[] }>;\r\n};\r\n\r\n\r\nexport type DoodleSummaryDataJson = {\r\n    doodles: DoodleData_EncodedWithScore[];\r\n};\r\nexport type DoodleData_EncodedWithScore = DoodleData_Encoded & {\r\n    s: number;\r\n};\r\n\r\nexport type DoodleUserDrawingDataJson = {\r\n    doodles: DoodleData_Encoded[];\r\n};\r\n\r\nexport type DoodleUserVotesDataJson = {\r\n    doodleVotes: DoodleScoreVote[];\r\n};\r\n\r\nexport type DoodleScoreVote = {\r\n    // Doodle Key\r\n    k: string;\r\n    // Doodle Timestamp\r\n    t: number;\r\n};\r\n\r\nexport type DoodleScore = {\r\n    doodleKey: string;\r\n    score: number;\r\n};\r\n\r\nexport type DoodleDataWithScore = {\r\n    key: string;\r\n    drawing: DoodleDrawing;\r\n    prompt: string;\r\n    timestamp: number;\r\n    score: number;\r\n};\r\n\r\nexport type DoodleData = {\r\n    key: string;\r\n    drawing: DoodleDrawing;\r\n    prompt: string;\r\n    timestamp: number;\r\n};\r\nexport type DoodleData_Encoded = {\r\n    // Doodle Key\r\n    k: string;\r\n    // Doodle Drawing\r\n    d: DoodleDrawingEncoded;\r\n    // Prompt\r\n    p: string;\r\n    // Doodle Timestamp\r\n    t: number;\r\n};\r\n\r\nexport type DoodleDrawing = {\r\n    width: number;\r\n    height: number;\r\n    segments: DoodleSegment[];\r\n};\r\nexport type DoodleSegment = {\r\n    points: { x: number, y: number }[];\r\n};\r\n\r\n// const sampleDrawing: DoodleDrawing = {\r\n//     width: 128,\r\n//     height: 128,\r\n//     segments: [{\r\n//         points: [\r\n//             { x: 10, y: 10 },\r\n//             { x: 50, y: 10 },\r\n//             { x: 50, y: 50 },\r\n//             { x: 10, y: 50 },\r\n//             { x: 10, y: 10 },\r\n//         ],\r\n//     }],\r\n// };\r\n\r\nexport const defaultDoodleDrawing = (): DoodleDrawing => ({\r\n    width: 104,\r\n    height: 104,\r\n    segments: [],\r\n});\r\n\r\nexport type DoodleDrawingEncoded = {\r\n    doodleText: string;\r\n};\r\ntype DoodleDrawingEncodedObj = {\r\n    w: number;\r\n    h: number;\r\n    s: {\r\n        x: number;\r\n        y: number;\r\n        p: string;\r\n    }[];\r\n};\r\nconst encodeDoodleSegmentPoints = (points: { x: number, y: number }[]): string => {\r\n    if (points.length <= 0) { return ``; }\r\n    let last = points[0];\r\n    let t = ``;\r\n\r\n    points.slice(1).forEach(p => {\r\n        t += `${p.x - last.x},${p.y - last.y};`;\r\n        last = p;\r\n    });\r\n\r\n    return t;\r\n};\r\nconst decodeDoodleSegmentPoints = (x: number, y: number, pointsString: string): { x: number, y: number }[] => {\r\n    if (!pointsString) { return [{ x, y }]; }\r\n    let last = { x, y };\r\n    const pointRelPos = pointsString.split(`;`).filter(p => p);\r\n    const points = pointRelPos.map(p => {\r\n        const parts = p.split(`,`);\r\n        const point = {\r\n            x: last.x + Number.parseInt(parts[0], 10),\r\n            y: last.y + Number.parseInt(parts[1], 10),\r\n        };\r\n        last = point;\r\n        return point;\r\n    });\r\n\r\n    return [...points];\r\n};\r\n\r\nexport const encodeDoodleDrawing = (doodle: DoodleDrawing): DoodleDrawingEncoded => {\r\n    const o: DoodleDrawingEncodedObj = {\r\n        w: doodle.width,\r\n        h: doodle.height,\r\n        s: doodle.segments.map(x => ({\r\n            x: x.points[0].x,\r\n            y: x.points[0].y,\r\n            p: encodeDoodleSegmentPoints(x.points),\r\n        })),\r\n    };\r\n    return { doodleText: JSON.stringify(o) };\r\n};\r\nexport const decodeDoodleDrawing = (doodle: DoodleDrawingEncoded): DoodleDrawing => {\r\n    const o: DoodleDrawingEncodedObj = JSON.parse(doodle.doodleText) as DoodleDrawingEncodedObj;\r\n    return {\r\n        width: o.w,\r\n        height: o.h,\r\n        segments: o.s.map(p => {\r\n            return {\r\n                points: [{ x: p.x, y: p.y }, ...decodeDoodleSegmentPoints(p.x, p.y, p.p)],\r\n            };\r\n        }),\r\n    };\r\n};\r\n\r\n\r\n// const doodleSegmentToSvgPath_bezier = (segment: DoodleSegment) => {\r\n//     const delta1 = {\r\n//         x: segment.points[2].x - segment.points[1].x,\r\n//         y: segment.points[2].y - segment.points[1].y,\r\n//     };\r\n//     const controlPoint = {\r\n//         x: segment.points[1].x - delta1.x * 0.5,\r\n//         y: segment.points[1].y - delta1.y * 0.5,\r\n//     };\r\n//     return `M${segment.points[0].x} ${segment.points[0].y} Q${controlPoint.x} ${controlPoint.y} ${segment.points[1].x} ${segment.points[1].y}T${segment.points.slice(2, -1).map(p => `${p.x} ${p.y}`).join(` `)}`;\r\n// };\r\n\r\n\r\nexport const doodleSegmentToSvgPath_line = (segment: DoodleSegment) => {\r\n    if (segment.points.length <= 0) { return ``; }\r\n    if (segment.points.length === 1) { return `M${segment.points[0].x} ${segment.points[0].y} L${segment.points[0].x} ${segment.points[0].y}`; }\r\n\r\n    let last = segment.points[0];\r\n    return `M${segment.points[0].x} ${segment.points[0].y} l${segment.points.slice(1).map(p => {\r\n        const t = `${p.x - last.x} ${p.y - last.y}`;\r\n        last = p;\r\n        return t;\r\n    }).join(` `)}`;\r\n};\r\n\r\nexport const doodleToSvg = (drawing: DoodleDrawing) => {\r\n    // preserveAspectRatio='none' stroke='#000000' fill='transparent' xmlns='http://www.w3.org/2000/svg'\r\n    return `\r\n<svg viewBox='0 0 ${drawing.width} ${drawing.height}' stroke='#000000' fill='transparent'>\r\n    ${drawing.segments.map((x, i) => (\r\n        `<path d='${doodleSegmentToSvgPath_line(x)}' />`\r\n    )).join(``)}\r\n</svg>\r\n    `.trim();\r\n};\r\n","\"use strict\"; // Updated from commit ae2f5e1 - vscode/src/vs/base/common/diff/diff.ts\n\n/*---------------------------------------------------------------------------------------------\r\n *  Copyright (c) Microsoft Corporation. All rights reserved.\r\n *  Licensed under the MIT License. See License.txt in the project root for license information.\r\n *--------------------------------------------------------------------------------------------*/\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar diffChange_1 = require(\"./diffChange\");\n\nfunction createStringSequence(a) {\n  return {\n    getLength: function getLength() {\n      return a.length;\n    },\n    getElementAtIndex: function getElementAtIndex(pos) {\n      return a.charCodeAt(pos);\n    }\n  };\n}\n\nfunction stringDiff(original, modified, pretty) {\n  return new LcsDiff(createStringSequence(original), createStringSequence(modified)).ComputeDiff(pretty);\n}\n\nexports.stringDiff = stringDiff; //\n// The code below has been ported from a C# implementation in VS\n//\n\nvar Debug =\n/** @class */\nfunction () {\n  function Debug() {}\n\n  Debug.Assert = function (condition, message) {\n    if (!condition) {\n      throw new Error(message);\n    }\n  };\n\n  return Debug;\n}();\n\nexports.Debug = Debug;\n\nvar MyArray =\n/** @class */\nfunction () {\n  function MyArray() {}\n  /**\r\n   * Copies a range of elements from an Array starting at the specified source index and pastes\r\n   * them to another Array starting at the specified destination index. The length and the indexes\r\n   * are specified as 64-bit integers.\r\n   * sourceArray:\r\n   *\t\tThe Array that contains the data to copy.\r\n   * sourceIndex:\r\n   *\t\tA 64-bit integer that represents the index in the sourceArray at which copying begins.\r\n   * destinationArray:\r\n   *\t\tThe Array that receives the data.\r\n   * destinationIndex:\r\n   *\t\tA 64-bit integer that represents the index in the destinationArray at which storing begins.\r\n   * length:\r\n   *\t\tA 64-bit integer that represents the number of elements to copy.\r\n   */\n\n\n  MyArray.Copy = function (sourceArray, sourceIndex, destinationArray, destinationIndex, length) {\n    for (var i = 0; i < length; i++) {\n      destinationArray[destinationIndex + i] = sourceArray[sourceIndex + i];\n    }\n  };\n\n  return MyArray;\n}();\n\nexports.MyArray = MyArray; //*****************************************************************************\n// LcsDiff.cs\n//\n// An implementation of the difference algorithm described in\n// \"An O(ND) Difference Algorithm and its variations\" by Eugene W. Myers\n//\n// Copyright (C) 2008 Microsoft Corporation @minifier_do_not_preserve\n//*****************************************************************************\n// Our total memory usage for storing history is (worst-case):\n// 2 * [(MaxDifferencesHistory + 1) * (MaxDifferencesHistory + 1) - 1] * sizeof(int)\n// 2 * [1448*1448 - 1] * 4 = 16773624 = 16MB\n\nvar MaxDifferencesHistory = 1447; //let MaxDifferencesHistory = 100;\n\n/**\r\n * A utility class which helps to create the set of DiffChanges from\r\n * a difference operation. This class accepts original DiffElements and\r\n * modified DiffElements that are involved in a particular change. The\r\n * MarktNextChange() method can be called to mark the separation between\r\n * distinct changes. At the end, the Changes property can be called to retrieve\r\n * the constructed changes.\r\n */\n\nvar DiffChangeHelper =\n/** @class */\nfunction () {\n  /**\r\n   * Constructs a new DiffChangeHelper for the given DiffSequences.\r\n   */\n  function DiffChangeHelper() {\n    this.m_changes = [];\n    this.m_originalStart = Number.MAX_VALUE;\n    this.m_modifiedStart = Number.MAX_VALUE;\n    this.m_originalCount = 0;\n    this.m_modifiedCount = 0;\n  }\n  /**\r\n   * Marks the beginning of the next change in the set of differences.\r\n   */\n\n\n  DiffChangeHelper.prototype.MarkNextChange = function () {\n    // Only add to the list if there is something to add\n    if (this.m_originalCount > 0 || this.m_modifiedCount > 0) {\n      // Add the new change to our list\n      this.m_changes.push(new diffChange_1.DiffChange(this.m_originalStart, this.m_originalCount, this.m_modifiedStart, this.m_modifiedCount));\n    } // Reset for the next change\n\n\n    this.m_originalCount = 0;\n    this.m_modifiedCount = 0;\n    this.m_originalStart = Number.MAX_VALUE;\n    this.m_modifiedStart = Number.MAX_VALUE;\n  };\n  /**\r\n   * Adds the original element at the given position to the elements\r\n   * affected by the current change. The modified index gives context\r\n   * to the change position with respect to the original sequence.\r\n   * @param originalIndex The index of the original element to add.\r\n   * @param modifiedIndex The index of the modified element that provides corresponding position in the modified sequence.\r\n   */\n\n\n  DiffChangeHelper.prototype.AddOriginalElement = function (originalIndex, modifiedIndex) {\n    // The 'true' start index is the smallest of the ones we've seen\n    this.m_originalStart = Math.min(this.m_originalStart, originalIndex);\n    this.m_modifiedStart = Math.min(this.m_modifiedStart, modifiedIndex);\n    this.m_originalCount++;\n  };\n  /**\r\n   * Adds the modified element at the given position to the elements\r\n   * affected by the current change. The original index gives context\r\n   * to the change position with respect to the modified sequence.\r\n   * @param originalIndex The index of the original element that provides corresponding position in the original sequence.\r\n   * @param modifiedIndex The index of the modified element to add.\r\n   */\n\n\n  DiffChangeHelper.prototype.AddModifiedElement = function (originalIndex, modifiedIndex) {\n    // The 'true' start index is the smallest of the ones we've seen\n    this.m_originalStart = Math.min(this.m_originalStart, originalIndex);\n    this.m_modifiedStart = Math.min(this.m_modifiedStart, modifiedIndex);\n    this.m_modifiedCount++;\n  };\n  /**\r\n   * Retrieves all of the changes marked by the class.\r\n   */\n\n\n  DiffChangeHelper.prototype.getChanges = function () {\n    if (this.m_originalCount > 0 || this.m_modifiedCount > 0) {\n      // Finish up on whatever is left\n      this.MarkNextChange();\n    }\n\n    return this.m_changes;\n  };\n  /**\r\n   * Retrieves all of the changes marked by the class in the reverse order\r\n   */\n\n\n  DiffChangeHelper.prototype.getReverseChanges = function () {\n    if (this.m_originalCount > 0 || this.m_modifiedCount > 0) {\n      // Finish up on whatever is left\n      this.MarkNextChange();\n    }\n\n    this.m_changes.reverse();\n    return this.m_changes;\n  };\n\n  return DiffChangeHelper;\n}();\n/**\r\n * An implementation of the difference algorithm described in\r\n * \"An O(ND) Difference Algorithm and its variations\" by Eugene W. Myers\r\n */\n\n\nvar LcsDiff =\n/** @class */\nfunction () {\n  /**\r\n   * Constructs the DiffFinder\r\n   */\n  function LcsDiff(originalSequence, newSequence, continueProcessingPredicate) {\n    if (continueProcessingPredicate === void 0) {\n      continueProcessingPredicate = null;\n    }\n\n    this.OriginalSequence = originalSequence;\n    this.ModifiedSequence = newSequence;\n    this.ContinueProcessingPredicate = continueProcessingPredicate;\n    this.m_forwardHistory = [];\n    this.m_reverseHistory = [];\n  }\n\n  LcsDiff.prototype.ElementsAreEqual = function (originalIndex, newIndex) {\n    return this.OriginalSequence.getElementAtIndex(originalIndex) === this.ModifiedSequence.getElementAtIndex(newIndex);\n  };\n\n  LcsDiff.prototype.OriginalElementsAreEqual = function (index1, index2) {\n    return this.OriginalSequence.getElementAtIndex(index1) === this.OriginalSequence.getElementAtIndex(index2);\n  };\n\n  LcsDiff.prototype.ModifiedElementsAreEqual = function (index1, index2) {\n    return this.ModifiedSequence.getElementAtIndex(index1) === this.ModifiedSequence.getElementAtIndex(index2);\n  };\n\n  LcsDiff.prototype.ComputeDiff = function (pretty) {\n    return this._ComputeDiff(0, this.OriginalSequence.getLength() - 1, 0, this.ModifiedSequence.getLength() - 1, pretty);\n  };\n  /**\r\n   * Computes the differences between the original and modified input\r\n   * sequences on the bounded range.\r\n   * @returns An array of the differences between the two input sequences.\r\n   */\n\n\n  LcsDiff.prototype._ComputeDiff = function (originalStart, originalEnd, modifiedStart, modifiedEnd, pretty) {\n    var quitEarlyArr = [false];\n    var changes = this.ComputeDiffRecursive(originalStart, originalEnd, modifiedStart, modifiedEnd, quitEarlyArr);\n\n    if (pretty) {\n      // We have to clean up the computed diff to be more intuitive\n      // but it turns out this cannot be done correctly until the entire set\n      // of diffs have been computed\n      return this.PrettifyChanges(changes);\n    }\n\n    return changes;\n  };\n  /**\r\n   * Private helper method which computes the differences on the bounded range\r\n   * recursively.\r\n   * @returns An array of the differences between the two input sequences.\r\n   */\n\n\n  LcsDiff.prototype.ComputeDiffRecursive = function (originalStart, originalEnd, modifiedStart, modifiedEnd, quitEarlyArr) {\n    quitEarlyArr[0] = false; // Find the start of the differences\n\n    while (originalStart <= originalEnd && modifiedStart <= modifiedEnd && this.ElementsAreEqual(originalStart, modifiedStart)) {\n      originalStart++;\n      modifiedStart++;\n    } // Find the end of the differences\n\n\n    while (originalEnd >= originalStart && modifiedEnd >= modifiedStart && this.ElementsAreEqual(originalEnd, modifiedEnd)) {\n      originalEnd--;\n      modifiedEnd--;\n    } // In the special case where we either have all insertions or all deletions or the sequences are identical\n\n\n    if (originalStart > originalEnd || modifiedStart > modifiedEnd) {\n      var changes = void 0;\n\n      if (modifiedStart <= modifiedEnd) {\n        Debug.Assert(originalStart === originalEnd + 1, 'originalStart should only be one more than originalEnd'); // All insertions\n\n        changes = [new diffChange_1.DiffChange(originalStart, 0, modifiedStart, modifiedEnd - modifiedStart + 1)];\n      } else if (originalStart <= originalEnd) {\n        Debug.Assert(modifiedStart === modifiedEnd + 1, 'modifiedStart should only be one more than modifiedEnd'); // All deletions\n\n        changes = [new diffChange_1.DiffChange(originalStart, originalEnd - originalStart + 1, modifiedStart, 0)];\n      } else {\n        Debug.Assert(originalStart === originalEnd + 1, 'originalStart should only be one more than originalEnd');\n        Debug.Assert(modifiedStart === modifiedEnd + 1, 'modifiedStart should only be one more than modifiedEnd'); // Identical sequences - No differences\n\n        changes = [];\n      }\n\n      return changes;\n    } // This problem can be solved using the Divide-And-Conquer technique.\n\n\n    var midOriginalArr = [0],\n        midModifiedArr = [0];\n    var result = this.ComputeRecursionPoint(originalStart, originalEnd, modifiedStart, modifiedEnd, midOriginalArr, midModifiedArr, quitEarlyArr);\n    var midOriginal = midOriginalArr[0];\n    var midModified = midModifiedArr[0];\n\n    if (result !== null) {\n      // Result is not-null when there was enough memory to compute the changes while\n      // searching for the recursion point\n      return result;\n    } else if (!quitEarlyArr[0]) {\n      // We can break the problem down recursively by finding the changes in the\n      // First Half:   (originalStart, modifiedStart) to (midOriginal, midModified)\n      // Second Half:  (midOriginal + 1, minModified + 1) to (originalEnd, modifiedEnd)\n      // NOTE: ComputeDiff() is inclusive, therefore the second range starts on the next point\n      var leftChanges = this.ComputeDiffRecursive(originalStart, midOriginal, modifiedStart, midModified, quitEarlyArr);\n      var rightChanges = [];\n\n      if (!quitEarlyArr[0]) {\n        rightChanges = this.ComputeDiffRecursive(midOriginal + 1, originalEnd, midModified + 1, modifiedEnd, quitEarlyArr);\n      } else {\n        // We did't have time to finish the first half, so we don't have time to compute this half.\n        // Consider the entire rest of the sequence different.\n        rightChanges = [new diffChange_1.DiffChange(midOriginal + 1, originalEnd - (midOriginal + 1) + 1, midModified + 1, modifiedEnd - (midModified + 1) + 1)];\n      }\n\n      return this.ConcatenateChanges(leftChanges, rightChanges);\n    } // If we hit here, we quit early, and so can't return anything meaningful\n\n\n    return [new diffChange_1.DiffChange(originalStart, originalEnd - originalStart + 1, modifiedStart, modifiedEnd - modifiedStart + 1)];\n  };\n\n  LcsDiff.prototype.WALKTRACE = function (diagonalForwardBase, diagonalForwardStart, diagonalForwardEnd, diagonalForwardOffset, diagonalReverseBase, diagonalReverseStart, diagonalReverseEnd, diagonalReverseOffset, forwardPoints, reversePoints, originalIndex, originalEnd, midOriginalArr, modifiedIndex, modifiedEnd, midModifiedArr, deltaIsEven, quitEarlyArr) {\n    var forwardChanges = null,\n        reverseChanges = null; // First, walk backward through the forward diagonals history\n\n    var changeHelper = new DiffChangeHelper();\n    var diagonalMin = diagonalForwardStart;\n    var diagonalMax = diagonalForwardEnd;\n    var diagonalRelative = midOriginalArr[0] - midModifiedArr[0] - diagonalForwardOffset;\n    var lastOriginalIndex = Number.MIN_VALUE;\n    var historyIndex = this.m_forwardHistory.length - 1;\n    var diagonal;\n\n    do {\n      // Get the diagonal index from the relative diagonal number\n      diagonal = diagonalRelative + diagonalForwardBase; // Figure out where we came from\n\n      if (diagonal === diagonalMin || diagonal < diagonalMax && forwardPoints[diagonal - 1] < forwardPoints[diagonal + 1]) {\n        // Vertical line (the element is an insert)\n        originalIndex = forwardPoints[diagonal + 1];\n        modifiedIndex = originalIndex - diagonalRelative - diagonalForwardOffset;\n\n        if (originalIndex < lastOriginalIndex) {\n          changeHelper.MarkNextChange();\n        }\n\n        lastOriginalIndex = originalIndex;\n        changeHelper.AddModifiedElement(originalIndex + 1, modifiedIndex);\n        diagonalRelative = diagonal + 1 - diagonalForwardBase; //Setup for the next iteration\n      } else {\n        // Horizontal line (the element is a deletion)\n        originalIndex = forwardPoints[diagonal - 1] + 1;\n        modifiedIndex = originalIndex - diagonalRelative - diagonalForwardOffset;\n\n        if (originalIndex < lastOriginalIndex) {\n          changeHelper.MarkNextChange();\n        }\n\n        lastOriginalIndex = originalIndex - 1;\n        changeHelper.AddOriginalElement(originalIndex, modifiedIndex + 1);\n        diagonalRelative = diagonal - 1 - diagonalForwardBase; //Setup for the next iteration\n      }\n\n      if (historyIndex >= 0) {\n        forwardPoints = this.m_forwardHistory[historyIndex];\n        diagonalForwardBase = forwardPoints[0]; //We stored this in the first spot\n\n        diagonalMin = 1;\n        diagonalMax = forwardPoints.length - 1;\n      }\n    } while (--historyIndex >= -1); // Ironically, we get the forward changes as the reverse of the\n    // order we added them since we technically added them backwards\n\n\n    forwardChanges = changeHelper.getReverseChanges();\n\n    if (quitEarlyArr[0]) {\n      // TODO: Calculate a partial from the reverse diagonals.\n      //       For now, just assume everything after the midOriginal/midModified point is a diff\n      var originalStartPoint = midOriginalArr[0] + 1;\n      var modifiedStartPoint = midModifiedArr[0] + 1;\n\n      if (forwardChanges !== null && forwardChanges.length > 0) {\n        var lastForwardChange = forwardChanges[forwardChanges.length - 1];\n        originalStartPoint = Math.max(originalStartPoint, lastForwardChange.getOriginalEnd());\n        modifiedStartPoint = Math.max(modifiedStartPoint, lastForwardChange.getModifiedEnd());\n      }\n\n      reverseChanges = [new diffChange_1.DiffChange(originalStartPoint, originalEnd - originalStartPoint + 1, modifiedStartPoint, modifiedEnd - modifiedStartPoint + 1)];\n    } else {\n      // Now walk backward through the reverse diagonals history\n      changeHelper = new DiffChangeHelper();\n      diagonalMin = diagonalReverseStart;\n      diagonalMax = diagonalReverseEnd;\n      diagonalRelative = midOriginalArr[0] - midModifiedArr[0] - diagonalReverseOffset;\n      lastOriginalIndex = Number.MAX_VALUE;\n      historyIndex = deltaIsEven ? this.m_reverseHistory.length - 1 : this.m_reverseHistory.length - 2;\n\n      do {\n        // Get the diagonal index from the relative diagonal number\n        diagonal = diagonalRelative + diagonalReverseBase; // Figure out where we came from\n\n        if (diagonal === diagonalMin || diagonal < diagonalMax && reversePoints[diagonal - 1] >= reversePoints[diagonal + 1]) {\n          // Horizontal line (the element is a deletion))\n          originalIndex = reversePoints[diagonal + 1] - 1;\n          modifiedIndex = originalIndex - diagonalRelative - diagonalReverseOffset;\n\n          if (originalIndex > lastOriginalIndex) {\n            changeHelper.MarkNextChange();\n          }\n\n          lastOriginalIndex = originalIndex + 1;\n          changeHelper.AddOriginalElement(originalIndex + 1, modifiedIndex + 1);\n          diagonalRelative = diagonal + 1 - diagonalReverseBase; //Setup for the next iteration\n        } else {\n          // Vertical line (the element is an insertion)\n          originalIndex = reversePoints[diagonal - 1];\n          modifiedIndex = originalIndex - diagonalRelative - diagonalReverseOffset;\n\n          if (originalIndex > lastOriginalIndex) {\n            changeHelper.MarkNextChange();\n          }\n\n          lastOriginalIndex = originalIndex;\n          changeHelper.AddModifiedElement(originalIndex + 1, modifiedIndex + 1);\n          diagonalRelative = diagonal - 1 - diagonalReverseBase; //Setup for the next iteration\n        }\n\n        if (historyIndex >= 0) {\n          reversePoints = this.m_reverseHistory[historyIndex];\n          diagonalReverseBase = reversePoints[0]; //We stored this in the first spot\n\n          diagonalMin = 1;\n          diagonalMax = reversePoints.length - 1;\n        }\n      } while (--historyIndex >= -1); // There are cases where the reverse history will find diffs that\n      // are correct, but not intuitive, so we need shift them.\n\n\n      reverseChanges = changeHelper.getChanges();\n    }\n\n    return this.ConcatenateChanges(forwardChanges, reverseChanges);\n  };\n  /**\r\n   * Given the range to compute the diff on, this method finds the point:\r\n   * (midOriginal, midModified)\r\n   * that exists in the middle of the LCS of the two sequences and\r\n   * is the point at which the LCS problem may be broken down recursively.\r\n   * This method will try to keep the LCS trace in memory. If the LCS recursion\r\n   * point is calculated and the full trace is available in memory, then this method\r\n   * will return the change list.\r\n   * @param originalStart The start bound of the original sequence range\r\n   * @param originalEnd The end bound of the original sequence range\r\n   * @param modifiedStart The start bound of the modified sequence range\r\n   * @param modifiedEnd The end bound of the modified sequence range\r\n   * @param midOriginal The middle point of the original sequence range\r\n   * @param midModified The middle point of the modified sequence range\r\n   * @returns The diff changes, if available, otherwise null\r\n   */\n\n\n  LcsDiff.prototype.ComputeRecursionPoint = function (originalStart, originalEnd, modifiedStart, modifiedEnd, midOriginalArr, midModifiedArr, quitEarlyArr) {\n    var originalIndex = 0,\n        modifiedIndex = 0;\n    var diagonalForwardStart = 0,\n        diagonalForwardEnd = 0;\n    var diagonalReverseStart = 0,\n        diagonalReverseEnd = 0;\n    var numDifferences; // To traverse the edit graph and produce the proper LCS, our actual\n    // start position is just outside the given boundary\n\n    originalStart--;\n    modifiedStart--; // We set these up to make the compiler happy, but they will\n    // be replaced before we return with the actual recursion point\n\n    midOriginalArr[0] = 0;\n    midModifiedArr[0] = 0; // Clear out the history\n\n    this.m_forwardHistory = [];\n    this.m_reverseHistory = []; // Each cell in the two arrays corresponds to a diagonal in the edit graph.\n    // The integer value in the cell represents the originalIndex of the furthest\n    // reaching point found so far that ends in that diagonal.\n    // The modifiedIndex can be computed mathematically from the originalIndex and the diagonal number.\n\n    var maxDifferences = originalEnd - originalStart + (modifiedEnd - modifiedStart);\n    var numDiagonals = maxDifferences + 1;\n    var forwardPoints = new Array(numDiagonals);\n    var reversePoints = new Array(numDiagonals); // diagonalForwardBase: Index into forwardPoints of the diagonal which passes through (originalStart, modifiedStart)\n    // diagonalReverseBase: Index into reversePoints of the diagonal which passes through (originalEnd, modifiedEnd)\n\n    var diagonalForwardBase = modifiedEnd - modifiedStart;\n    var diagonalReverseBase = originalEnd - originalStart; // diagonalForwardOffset: Geometric offset which allows modifiedIndex to be computed from originalIndex and the\n    //    diagonal number (relative to diagonalForwardBase)\n    // diagonalReverseOffset: Geometric offset which allows modifiedIndex to be computed from originalIndex and the\n    //    diagonal number (relative to diagonalReverseBase)\n\n    var diagonalForwardOffset = originalStart - modifiedStart;\n    var diagonalReverseOffset = originalEnd - modifiedEnd; // delta: The difference between the end diagonal and the start diagonal. This is used to relate diagonal numbers\n    //   relative to the start diagonal with diagonal numbers relative to the end diagonal.\n    // The Even/Oddn-ness of this delta is important for determining when we should check for overlap\n\n    var delta = diagonalReverseBase - diagonalForwardBase;\n    var deltaIsEven = delta % 2 === 0; // Here we set up the start and end points as the furthest points found so far\n    // in both the forward and reverse directions, respectively\n\n    forwardPoints[diagonalForwardBase] = originalStart;\n    reversePoints[diagonalReverseBase] = originalEnd; // Remember if we quit early, and thus need to do a best-effort result instead of a real result.\n\n    quitEarlyArr[0] = false; // A couple of points:\n    // --With this method, we iterate on the number of differences between the two sequences.\n    //   The more differences there actually are, the longer this will take.\n    // --Also, as the number of differences increases, we have to search on diagonals further\n    //   away from the reference diagonal (which is diagonalForwardBase for forward, diagonalReverseBase for reverse).\n    // --We extend on even diagonals (relative to the reference diagonal) only when numDifferences\n    //   is even and odd diagonals only when numDifferences is odd.\n\n    var diagonal, tempOriginalIndex;\n\n    for (numDifferences = 1; numDifferences <= maxDifferences / 2 + 1; numDifferences++) {\n      var furthestOriginalIndex = 0;\n      var furthestModifiedIndex = 0; // Run the algorithm in the forward direction\n\n      diagonalForwardStart = this.ClipDiagonalBound(diagonalForwardBase - numDifferences, numDifferences, diagonalForwardBase, numDiagonals);\n      diagonalForwardEnd = this.ClipDiagonalBound(diagonalForwardBase + numDifferences, numDifferences, diagonalForwardBase, numDiagonals);\n\n      for (diagonal = diagonalForwardStart; diagonal <= diagonalForwardEnd; diagonal += 2) {\n        // STEP 1: We extend the furthest reaching point in the present diagonal\n        // by looking at the diagonals above and below and picking the one whose point\n        // is further away from the start point (originalStart, modifiedStart)\n        if (diagonal === diagonalForwardStart || diagonal < diagonalForwardEnd && forwardPoints[diagonal - 1] < forwardPoints[diagonal + 1]) {\n          originalIndex = forwardPoints[diagonal + 1];\n        } else {\n          originalIndex = forwardPoints[diagonal - 1] + 1;\n        }\n\n        modifiedIndex = originalIndex - (diagonal - diagonalForwardBase) - diagonalForwardOffset; // Save the current originalIndex so we can test for false overlap in step 3\n\n        tempOriginalIndex = originalIndex; // STEP 2: We can continue to extend the furthest reaching point in the present diagonal\n        // so long as the elements are equal.\n\n        while (originalIndex < originalEnd && modifiedIndex < modifiedEnd && this.ElementsAreEqual(originalIndex + 1, modifiedIndex + 1)) {\n          originalIndex++;\n          modifiedIndex++;\n        }\n\n        forwardPoints[diagonal] = originalIndex;\n\n        if (originalIndex + modifiedIndex > furthestOriginalIndex + furthestModifiedIndex) {\n          furthestOriginalIndex = originalIndex;\n          furthestModifiedIndex = modifiedIndex;\n        } // STEP 3: If delta is odd (overlap first happens on forward when delta is odd)\n        // and diagonal is in the range of reverse diagonals computed for numDifferences-1\n        // (the previous iteration; we haven't computed reverse diagonals for numDifferences yet)\n        // then check for overlap.\n\n\n        if (!deltaIsEven && Math.abs(diagonal - diagonalReverseBase) <= numDifferences - 1) {\n          if (originalIndex >= reversePoints[diagonal]) {\n            midOriginalArr[0] = originalIndex;\n            midModifiedArr[0] = modifiedIndex;\n\n            if (tempOriginalIndex <= reversePoints[diagonal] && MaxDifferencesHistory > 0 && numDifferences <= MaxDifferencesHistory + 1) {\n              // BINGO! We overlapped, and we have the full trace in memory!\n              return this.WALKTRACE(diagonalForwardBase, diagonalForwardStart, diagonalForwardEnd, diagonalForwardOffset, diagonalReverseBase, diagonalReverseStart, diagonalReverseEnd, diagonalReverseOffset, forwardPoints, reversePoints, originalIndex, originalEnd, midOriginalArr, modifiedIndex, modifiedEnd, midModifiedArr, deltaIsEven, quitEarlyArr);\n            } else {\n              // Either false overlap, or we didn't have enough memory for the full trace\n              // Just return the recursion point\n              return null;\n            }\n          }\n        }\n      } // Check to see if we should be quitting early, before moving on to the next iteration.\n\n\n      var matchLengthOfLongest = (furthestOriginalIndex - originalStart + (furthestModifiedIndex - modifiedStart) - numDifferences) / 2;\n\n      if (this.ContinueProcessingPredicate !== null && !this.ContinueProcessingPredicate(furthestOriginalIndex, this.OriginalSequence, matchLengthOfLongest)) {\n        // We can't finish, so skip ahead to generating a result from what we have.\n        quitEarlyArr[0] = true; // Use the furthest distance we got in the forward direction.\n\n        midOriginalArr[0] = furthestOriginalIndex;\n        midModifiedArr[0] = furthestModifiedIndex;\n\n        if (matchLengthOfLongest > 0 && MaxDifferencesHistory > 0 && numDifferences <= MaxDifferencesHistory + 1) {\n          // Enough of the history is in memory to walk it backwards\n          return this.WALKTRACE(diagonalForwardBase, diagonalForwardStart, diagonalForwardEnd, diagonalForwardOffset, diagonalReverseBase, diagonalReverseStart, diagonalReverseEnd, diagonalReverseOffset, forwardPoints, reversePoints, originalIndex, originalEnd, midOriginalArr, modifiedIndex, modifiedEnd, midModifiedArr, deltaIsEven, quitEarlyArr);\n        } else {\n          // We didn't actually remember enough of the history.\n          //Since we are quiting the diff early, we need to shift back the originalStart and modified start\n          //back into the boundary limits since we decremented their value above beyond the boundary limit.\n          originalStart++;\n          modifiedStart++;\n          return [new diffChange_1.DiffChange(originalStart, originalEnd - originalStart + 1, modifiedStart, modifiedEnd - modifiedStart + 1)];\n        }\n      } // Run the algorithm in the reverse direction\n\n\n      diagonalReverseStart = this.ClipDiagonalBound(diagonalReverseBase - numDifferences, numDifferences, diagonalReverseBase, numDiagonals);\n      diagonalReverseEnd = this.ClipDiagonalBound(diagonalReverseBase + numDifferences, numDifferences, diagonalReverseBase, numDiagonals);\n\n      for (diagonal = diagonalReverseStart; diagonal <= diagonalReverseEnd; diagonal += 2) {\n        // STEP 1: We extend the furthest reaching point in the present diagonal\n        // by looking at the diagonals above and below and picking the one whose point\n        // is further away from the start point (originalEnd, modifiedEnd)\n        if (diagonal === diagonalReverseStart || diagonal < diagonalReverseEnd && reversePoints[diagonal - 1] >= reversePoints[diagonal + 1]) {\n          originalIndex = reversePoints[diagonal + 1] - 1;\n        } else {\n          originalIndex = reversePoints[diagonal - 1];\n        }\n\n        modifiedIndex = originalIndex - (diagonal - diagonalReverseBase) - diagonalReverseOffset; // Save the current originalIndex so we can test for false overlap\n\n        tempOriginalIndex = originalIndex; // STEP 2: We can continue to extend the furthest reaching point in the present diagonal\n        // as long as the elements are equal.\n\n        while (originalIndex > originalStart && modifiedIndex > modifiedStart && this.ElementsAreEqual(originalIndex, modifiedIndex)) {\n          originalIndex--;\n          modifiedIndex--;\n        }\n\n        reversePoints[diagonal] = originalIndex; // STEP 4: If delta is even (overlap first happens on reverse when delta is even)\n        // and diagonal is in the range of forward diagonals computed for numDifferences\n        // then check for overlap.\n\n        if (deltaIsEven && Math.abs(diagonal - diagonalForwardBase) <= numDifferences) {\n          if (originalIndex <= forwardPoints[diagonal]) {\n            midOriginalArr[0] = originalIndex;\n            midModifiedArr[0] = modifiedIndex;\n\n            if (tempOriginalIndex >= forwardPoints[diagonal] && MaxDifferencesHistory > 0 && numDifferences <= MaxDifferencesHistory + 1) {\n              // BINGO! We overlapped, and we have the full trace in memory!\n              return this.WALKTRACE(diagonalForwardBase, diagonalForwardStart, diagonalForwardEnd, diagonalForwardOffset, diagonalReverseBase, diagonalReverseStart, diagonalReverseEnd, diagonalReverseOffset, forwardPoints, reversePoints, originalIndex, originalEnd, midOriginalArr, modifiedIndex, modifiedEnd, midModifiedArr, deltaIsEven, quitEarlyArr);\n            } else {\n              // Either false overlap, or we didn't have enough memory for the full trace\n              // Just return the recursion point\n              return null;\n            }\n          }\n        }\n      } // Save current vectors to history before the next iteration\n\n\n      if (numDifferences <= MaxDifferencesHistory) {\n        // We are allocating space for one extra int, which we fill with\n        // the index of the diagonal base index\n        var temp = new Array(diagonalForwardEnd - diagonalForwardStart + 2);\n        temp[0] = diagonalForwardBase - diagonalForwardStart + 1;\n        MyArray.Copy(forwardPoints, diagonalForwardStart, temp, 1, diagonalForwardEnd - diagonalForwardStart + 1);\n        this.m_forwardHistory.push(temp);\n        temp = new Array(diagonalReverseEnd - diagonalReverseStart + 2);\n        temp[0] = diagonalReverseBase - diagonalReverseStart + 1;\n        MyArray.Copy(reversePoints, diagonalReverseStart, temp, 1, diagonalReverseEnd - diagonalReverseStart + 1);\n        this.m_reverseHistory.push(temp);\n      }\n    } // If we got here, then we have the full trace in history. We just have to convert it to a change list\n    // NOTE: This part is a bit messy\n\n\n    return this.WALKTRACE(diagonalForwardBase, diagonalForwardStart, diagonalForwardEnd, diagonalForwardOffset, diagonalReverseBase, diagonalReverseStart, diagonalReverseEnd, diagonalReverseOffset, forwardPoints, reversePoints, originalIndex, originalEnd, midOriginalArr, modifiedIndex, modifiedEnd, midModifiedArr, deltaIsEven, quitEarlyArr);\n  };\n  /**\r\n   * Shifts the given changes to provide a more intuitive diff.\r\n   * While the first element in a diff matches the first element after the diff,\r\n   * we shift the diff down.\r\n   *\r\n   * @param changes The list of changes to shift\r\n   * @returns The shifted changes\r\n   */\n\n\n  LcsDiff.prototype.PrettifyChanges = function (changes) {\n    // Shift all the changes down first\n    for (var i = 0; i < changes.length; i++) {\n      var change = changes[i];\n      var originalStop = i < changes.length - 1 ? changes[i + 1].originalStart : this.OriginalSequence.getLength();\n      var modifiedStop = i < changes.length - 1 ? changes[i + 1].modifiedStart : this.ModifiedSequence.getLength();\n      var checkOriginal = change.originalLength > 0;\n      var checkModified = change.modifiedLength > 0;\n\n      while (change.originalStart + change.originalLength < originalStop && change.modifiedStart + change.modifiedLength < modifiedStop && (!checkOriginal || this.OriginalElementsAreEqual(change.originalStart, change.originalStart + change.originalLength)) && (!checkModified || this.ModifiedElementsAreEqual(change.modifiedStart, change.modifiedStart + change.modifiedLength))) {\n        change.originalStart++;\n        change.modifiedStart++;\n      }\n\n      var mergedChangeArr = [null];\n\n      if (i < changes.length - 1 && this.ChangesOverlap(changes[i], changes[i + 1], mergedChangeArr)) {\n        changes[i] = mergedChangeArr[0];\n        changes.splice(i + 1, 1);\n        i--;\n        continue;\n      }\n    } // Shift changes back up until we hit empty or whitespace-only lines\n\n\n    for (var i = changes.length - 1; i >= 0; i--) {\n      var change = changes[i];\n      var originalStop = 0;\n      var modifiedStop = 0;\n\n      if (i > 0) {\n        var prevChange = changes[i - 1];\n\n        if (prevChange.originalLength > 0) {\n          originalStop = prevChange.originalStart + prevChange.originalLength;\n        }\n\n        if (prevChange.modifiedLength > 0) {\n          modifiedStop = prevChange.modifiedStart + prevChange.modifiedLength;\n        }\n      }\n\n      var checkOriginal = change.originalLength > 0;\n      var checkModified = change.modifiedLength > 0;\n      var bestDelta = 0;\n\n      var bestScore = this._boundaryScore(change.originalStart, change.originalLength, change.modifiedStart, change.modifiedLength);\n\n      for (var delta = 1;; delta++) {\n        var originalStart = change.originalStart - delta;\n        var modifiedStart = change.modifiedStart - delta;\n\n        if (originalStart < originalStop || modifiedStart < modifiedStop) {\n          break;\n        }\n\n        if (checkOriginal && !this.OriginalElementsAreEqual(originalStart, originalStart + change.originalLength)) {\n          break;\n        }\n\n        if (checkModified && !this.ModifiedElementsAreEqual(modifiedStart, modifiedStart + change.modifiedLength)) {\n          break;\n        }\n\n        var score = this._boundaryScore(originalStart, change.originalLength, modifiedStart, change.modifiedLength);\n\n        if (score > bestScore) {\n          bestScore = score;\n          bestDelta = delta;\n        }\n      }\n\n      change.originalStart -= bestDelta;\n      change.modifiedStart -= bestDelta;\n    }\n\n    return changes;\n  };\n\n  LcsDiff.prototype._OriginalIsBoundary = function (index) {\n    if (index <= 0 || index >= this.OriginalSequence.getLength() - 1) {\n      return true;\n    }\n\n    var element = this.OriginalSequence.getElementAtIndex(index);\n    return typeof element === 'string' && /^\\s*$/.test(element);\n  };\n\n  LcsDiff.prototype._OriginalRegionIsBoundary = function (originalStart, originalLength) {\n    if (this._OriginalIsBoundary(originalStart) || this._OriginalIsBoundary(originalStart - 1)) {\n      return true;\n    }\n\n    if (originalLength > 0) {\n      var originalEnd = originalStart + originalLength;\n\n      if (this._OriginalIsBoundary(originalEnd - 1) || this._OriginalIsBoundary(originalEnd)) {\n        return true;\n      }\n    }\n\n    return false;\n  };\n\n  LcsDiff.prototype._ModifiedIsBoundary = function (index) {\n    if (index <= 0 || index >= this.ModifiedSequence.getLength() - 1) {\n      return true;\n    }\n\n    var element = this.ModifiedSequence.getElementAtIndex(index);\n    return typeof element === 'string' && /^\\s*$/.test(element);\n  };\n\n  LcsDiff.prototype._ModifiedRegionIsBoundary = function (modifiedStart, modifiedLength) {\n    if (this._ModifiedIsBoundary(modifiedStart) || this._ModifiedIsBoundary(modifiedStart - 1)) {\n      return true;\n    }\n\n    if (modifiedLength > 0) {\n      var modifiedEnd = modifiedStart + modifiedLength;\n\n      if (this._ModifiedIsBoundary(modifiedEnd - 1) || this._ModifiedIsBoundary(modifiedEnd)) {\n        return true;\n      }\n    }\n\n    return false;\n  };\n\n  LcsDiff.prototype._boundaryScore = function (originalStart, originalLength, modifiedStart, modifiedLength) {\n    var originalScore = this._OriginalRegionIsBoundary(originalStart, originalLength) ? 1 : 0;\n    var modifiedScore = this._ModifiedRegionIsBoundary(modifiedStart, modifiedLength) ? 1 : 0;\n    return originalScore + modifiedScore;\n  };\n  /**\r\n   * Concatenates the two input DiffChange lists and returns the resulting\r\n   * list.\r\n   * @param The left changes\r\n   * @param The right changes\r\n   * @returns The concatenated list\r\n   */\n\n\n  LcsDiff.prototype.ConcatenateChanges = function (left, right) {\n    var mergedChangeArr = [];\n\n    if (left.length === 0 || right.length === 0) {\n      return right.length > 0 ? right : left;\n    } else if (this.ChangesOverlap(left[left.length - 1], right[0], mergedChangeArr)) {\n      // Since we break the problem down recursively, it is possible that we\n      // might recurse in the middle of a change thereby splitting it into\n      // two changes. Here in the combining stage, we detect and fuse those\n      // changes back together\n      var result = new Array(left.length + right.length - 1);\n      MyArray.Copy(left, 0, result, 0, left.length - 1);\n      result[left.length - 1] = mergedChangeArr[0];\n      MyArray.Copy(right, 1, result, left.length, right.length - 1);\n      return result;\n    } else {\n      var result = new Array(left.length + right.length);\n      MyArray.Copy(left, 0, result, 0, left.length);\n      MyArray.Copy(right, 0, result, left.length, right.length);\n      return result;\n    }\n  };\n  /**\r\n   * Returns true if the two changes overlap and can be merged into a single\r\n   * change\r\n   * @param left The left change\r\n   * @param right The right change\r\n   * @param mergedChange The merged change if the two overlap, null otherwise\r\n   * @returns True if the two changes overlap\r\n   */\n\n\n  LcsDiff.prototype.ChangesOverlap = function (left, right, mergedChangeArr) {\n    Debug.Assert(left.originalStart <= right.originalStart, 'Left change is not less than or equal to right change');\n    Debug.Assert(left.modifiedStart <= right.modifiedStart, 'Left change is not less than or equal to right change');\n\n    if (left.originalStart + left.originalLength >= right.originalStart || left.modifiedStart + left.modifiedLength >= right.modifiedStart) {\n      var originalStart = left.originalStart;\n      var originalLength = left.originalLength;\n      var modifiedStart = left.modifiedStart;\n      var modifiedLength = left.modifiedLength;\n\n      if (left.originalStart + left.originalLength >= right.originalStart) {\n        originalLength = right.originalStart + right.originalLength - left.originalStart;\n      }\n\n      if (left.modifiedStart + left.modifiedLength >= right.modifiedStart) {\n        modifiedLength = right.modifiedStart + right.modifiedLength - left.modifiedStart;\n      }\n\n      mergedChangeArr[0] = new diffChange_1.DiffChange(originalStart, originalLength, modifiedStart, modifiedLength);\n      return true;\n    } else {\n      mergedChangeArr[0] = null;\n      return false;\n    }\n  };\n  /**\r\n   * Helper method used to clip a diagonal index to the range of valid\r\n   * diagonals. This also decides whether or not the diagonal index,\r\n   * if it exceeds the boundary, should be clipped to the boundary or clipped\r\n   * one inside the boundary depending on the Even/Odd status of the boundary\r\n   * and numDifferences.\r\n   * @param diagonal The index of the diagonal to clip.\r\n   * @param numDifferences The current number of differences being iterated upon.\r\n   * @param diagonalBaseIndex The base reference diagonal.\r\n   * @param numDiagonals The total number of diagonals.\r\n   * @returns The clipped diagonal index.\r\n   */\n\n\n  LcsDiff.prototype.ClipDiagonalBound = function (diagonal, numDifferences, diagonalBaseIndex, numDiagonals) {\n    if (diagonal >= 0 && diagonal < numDiagonals) {\n      // Nothing to clip, its in range\n      return diagonal;\n    } // diagonalsBelow: The number of diagonals below the reference diagonal\n    // diagonalsAbove: The number of diagonals above the reference diagonal\n\n\n    var diagonalsBelow = diagonalBaseIndex;\n    var diagonalsAbove = numDiagonals - diagonalBaseIndex - 1;\n    var diffEven = numDifferences % 2 === 0;\n\n    if (diagonal < 0) {\n      var lowerBoundEven = diagonalsBelow % 2 === 0;\n      return diffEven === lowerBoundEven ? 0 : 1;\n    } else {\n      var upperBoundEven = diagonalsAbove % 2 === 0;\n      return diffEven === upperBoundEven ? numDiagonals - 1 : numDiagonals - 2;\n    }\n  };\n\n  return LcsDiff;\n}();\n\nexports.LcsDiff = LcsDiff;","import { PaymentMethodCreateParams, SetupIntent } from '@stripe/stripe-js';\r\nimport { PaymentProviderSavedPaymentMethodClientSetupToken, PaymentProviderSavedPaymentMethodClientToken } from '../../../common/types';\r\n\r\nexport type StripeCustomerBillingDetails = PaymentMethodCreateParams.BillingDetails;\r\n\r\nexport type StripePaymentClientSetupToken = {\r\n    clientSecret: string;\r\n    customerBillingDetails: StripeCustomerBillingDetails;\r\n};\r\n\r\nexport const stripeEncodeClientSetupToken = (params: StripePaymentClientSetupToken): PaymentProviderSavedPaymentMethodClientSetupToken => {\r\n    return params as unknown as PaymentProviderSavedPaymentMethodClientSetupToken;\r\n};\r\nexport const stripeDecodeClientSetupToken = (params: PaymentProviderSavedPaymentMethodClientSetupToken): StripePaymentClientSetupToken => {\r\n    return params as unknown as StripePaymentClientSetupToken;\r\n};\r\n\r\nexport type StripePaymentClientToken = {\r\n    setupIntent: SetupIntent;\r\n};\r\n\r\nexport const stripeEncodeClientToken = (params: StripePaymentClientToken): PaymentProviderSavedPaymentMethodClientToken => {\r\n    return params as unknown as PaymentProviderSavedPaymentMethodClientToken;\r\n};\r\nexport const stripeDecodeClientToken = (params: PaymentProviderSavedPaymentMethodClientToken): StripePaymentClientToken => {\r\n    return params as unknown as StripePaymentClientToken;\r\n};\r\n","/* eslint-disable react/no-array-index-key */\r\nimport React, { useEffect, useState } from 'react';\r\nimport { Text, TouchableOpacity, View } from 'react-native-lite';\r\nimport { LessonData, LessonExperiment, LessonProjectState, SetProjectState } from '../lesson-types';\r\nimport { lessonExperiments_createReplacementProjectState } from '../replacements';\r\nimport { LessonProjectFilesEditor } from './lesson-file-editor';\r\nimport { LessonProjectStatePreview } from './lesson-render-view';\r\n\r\nconst styles = {\r\n    sectionHeaderText: {\r\n        margin: 8,\r\n        fontSize: 18,\r\n        color: `#FFFF88`,\r\n        whiteSpace: `pre-wrap`,\r\n    },\r\n    sectionHeader2Text: {\r\n        margin: 8,\r\n        fontSize: 16,\r\n        color: `#FFFF88`,\r\n        whiteSpace: `pre-wrap`,\r\n    },\r\n    infoText: {\r\n        margin: 8,\r\n        fontSize: 12,\r\n        whiteSpace: `pre-wrap`,\r\n    },\r\n    buttonView: {\r\n        margin: 8,\r\n        padding: 4,\r\n        border: `solid 1px #888888`,\r\n    },\r\n    buttonText: {\r\n        color: `#88FF88`,\r\n    },\r\n} as const;\r\nexport const LessonView_PreviewResult = ({ data, onDone, setProjectState }: { data: LessonData, onDone?: () => void, setProjectState: SetProjectState }) => {\r\n\r\n    const [isDone, setIsDone] = useState(false);\r\n\r\n    return (\r\n        <>\r\n            <Text style={styles.sectionHeaderText}>{`${data.title} - Preview the Result ${isDone ? `` : ``}`}</Text>\r\n            <View style={{ flexDirection: `row`, alignItems: `center` }}>\r\n                <Text style={styles.infoText}>{`${``} Preview the result below`}</Text>\r\n                <View style={{ flex: 1 }} />\r\n                {onDone && (\r\n                    <TouchableOpacity onPress={() => onDone?.()}>\r\n                        <View style={styles.buttonView}>\r\n                            <Text style={styles.buttonText}>Done</Text>\r\n                        </View>\r\n                    </TouchableOpacity>\r\n                )}\r\n            </View>\r\n            <Text style={styles.sectionHeader2Text}>Preview</Text>\r\n            <LessonProjectStatePreview projectState={data.projectState} setProjectState={setProjectState} />\r\n            <Text style={styles.sectionHeader2Text}>Code</Text>\r\n            <LessonProjectFilesEditor\r\n                projectData={{\r\n                    projectState: data.projectState,\r\n                    focus: data.focus,\r\n                }}\r\n                fileEditorMode_focus='display'\r\n                fileEditorMode_noFocus='display'\r\n                projectEditorMode='display'\r\n                onTaskDone={() => { setIsDone(true); onDone?.(); }}\r\n                lessonData={data}\r\n            />\r\n        </>\r\n    );\r\n};\r\n\r\nexport const LessonView_ConstructCode = ({ data, onDone }: { data: LessonData, onDone?: () => void }) => {\r\n\r\n    const [isDone, setIsDone] = useState(false);\r\n\r\n    return (\r\n        <>\r\n            <Text style={styles.sectionHeaderText}>{`${data.title} - Construct the Code ${isDone ? `` : ``}`}</Text>\r\n            <Text style={styles.infoText}>{` ${data.objective}`}</Text>\r\n            <Text style={styles.infoText}>{` ${data.explanation}`}</Text>\r\n            <Text style={styles.infoText}>{`${isDone ? `` : ``} ${data.task}`}</Text>\r\n            <LessonProjectFilesEditor\r\n                projectData={{\r\n                    projectState: data.projectState,\r\n                    focus: data.focus,\r\n                }}\r\n                fileEditorMode_focus='construct-code'\r\n                fileEditorMode_noFocus='display'\r\n                projectEditorMode='display'\r\n                onTaskDone={() => { setIsDone(true); onDone?.(); }}\r\n                lessonData={data}\r\n            />\r\n        </>\r\n    );\r\n};\r\n\r\nexport const LessonView_UnderstandCode = ({ data, onDone }: { data: LessonData, onDone?: () => void }) => {\r\n\r\n    const [isDone, setIsDone] = useState(false);\r\n\r\n    return (\r\n        <>\r\n            <Text style={styles.sectionHeaderText}>{`${data.title} - Understand the Code ${isDone ? `` : ``}`}</Text>\r\n            <View style={{ flexDirection: `row`, alignItems: `center` }}>\r\n                <Text style={styles.infoText}>{`${``} Preview the result below`}</Text>\r\n                <View style={{ flex: 1 }} />\r\n                {isDone && (\r\n                    <TouchableOpacity onPress={() => onDone?.()}>\r\n                        <View style={styles.buttonView}>\r\n                            <Text style={styles.buttonText}>Done</Text>\r\n                        </View>\r\n                    </TouchableOpacity>\r\n                )}\r\n            </View>\r\n            <LessonProjectFilesEditor\r\n                projectData={{\r\n                    projectState: data.projectState,\r\n                    focus: data.focus,\r\n                }}\r\n                fileEditorMode_focus='understand-code'\r\n                fileEditorMode_noFocus='display'\r\n                projectEditorMode='display'\r\n                onTaskDone={() => setIsDone(true)}\r\n                lessonData={data}\r\n            />\r\n        </>\r\n    );\r\n};\r\n\r\nconst experimentStyles = {\r\n    instructionsText: {\r\n        marginLeft: 16,\r\n        fontSize: 16,\r\n        color: `#88FF88`,\r\n    },\r\n    experimentView: {\r\n        padding: 16,\r\n        justifyContent: `flex-start`,\r\n    },\r\n    experimentItemRow: {\r\n        flexDirection: `row`,\r\n        alignItems: `center`,\r\n    },\r\n    experimentItemView: {\r\n        padding: 4,\r\n        // border: `solid 1px #888888`,\r\n        // borderLeft: `solid 4px #EEEEEE`,\r\n    },\r\n    experimentItemView_active: {\r\n        padding: 4,\r\n        border: `solid 1px #FFFF88`,\r\n        borderLeft: `solid 4px #FFFF88`,\r\n    },\r\n    experimentItemText: {\r\n        color: `#FFFF88`,\r\n        whiteSpace: `pre-wrap`,\r\n    },\r\n} as const;\r\nexport const LessonView_ExperimentCode = ({ data, onDone, setProjectState }: { data: LessonData, onDone?: () => void, setProjectState: SetProjectState }) => {\r\n\r\n    const [modifiedProjectState, setModifiedProjectState] = useState(data.projectState);\r\n    const [activeExperiment, setActiveExperiment] = useState(null as null | LessonExperiment);\r\n    const [activeFocus, setActiveFocus] = useState(data.focus);\r\n\r\n    const changeExperiment = (value: null | LessonExperiment) => {\r\n        setActiveExperiment(value);\r\n        if (!value) {\r\n            setModifiedProjectState(data.projectState);\r\n            setActiveFocus(data.focus);\r\n            return;\r\n        }\r\n        setModifiedProjectState(s => (lessonExperiments_createReplacementProjectState(data.projectState, value.replacements)));\r\n\r\n        // Focus on change area:\r\n        const focusReplacements = value.replacements.filter(x => x.selection.filePath === data.focus.filePath);\r\n        const minIndex = Math.min(...focusReplacements.map(x => x.selection.index));\r\n        const maxEndIndex = Math.max(...focusReplacements.map(x => x.selection.index + x.selection.length));\r\n        const lengthDeltas = focusReplacements.map(x => -x.selection.length + x.content.length);\r\n        // eslint-disable-next-line unicorn/no-reduce\r\n        const lengthDelta = lengthDeltas.reduce((out, x) => { out += x; return out; }, 0);\r\n        console.log(`LessonView_ExperimentCode`, { minIndex, maxEndIndex, lengthDeltas, lengthDelta, focusReplacements });\r\n        setActiveFocus({ ...data.focus, index: minIndex, length: maxEndIndex - minIndex + lengthDelta });\r\n    };\r\n\r\n    useEffect(() => {\r\n        changeExperiment(null);\r\n    }, [data.projectState]);\r\n\r\n    return (\r\n        <>\r\n            <Text style={styles.sectionHeaderText}>{`${data.title} - Experiment with the Code`}</Text>\r\n            <Text style={experimentStyles.instructionsText}>Select an experiment below and view the result</Text>\r\n            <View style={experimentStyles.experimentView}>\r\n                <TouchableOpacity onPress={() => changeExperiment(null)}>\r\n                    <View style={experimentStyles.experimentItemRow}>\r\n                        <View style={styles.buttonView}>\r\n                            <Text style={styles.buttonText}>View</Text>\r\n                        </View>\r\n                        <View style={activeExperiment === null ? experimentStyles.experimentItemView_active : experimentStyles.experimentItemView}>\r\n                            <Text style={experimentStyles.experimentItemText}>Completed Code</Text>\r\n                        </View>\r\n                    </View>\r\n                </TouchableOpacity>\r\n                {data.experiments.map((x, i) => (\r\n                    <TouchableOpacity key={`${i}`} onPress={() => changeExperiment(x)}>\r\n                        <View style={experimentStyles.experimentItemRow}>\r\n                            <View style={styles.buttonView}>\r\n                                <Text style={styles.buttonText}>View</Text>\r\n                            </View>\r\n                            <View style={x === activeExperiment ? experimentStyles.experimentItemView_active : experimentStyles.experimentItemView}>\r\n                                <Text style={experimentStyles.experimentItemText}>{` ${x.comment ?? `Experiment ${i}`}`}</Text>\r\n                            </View>\r\n                        </View>\r\n                    </TouchableOpacity>\r\n                ))}\r\n                {onDone && (\r\n                    <TouchableOpacity onPress={() => onDone?.()}>\r\n                        <View style={experimentStyles.experimentItemRow}>\r\n                            <View style={styles.buttonView}>\r\n                                <Text style={styles.buttonText}>Done</Text>\r\n                            </View>\r\n                            <View style={experimentStyles.experimentItemView}>\r\n                                <Text style={experimentStyles.experimentItemText}> Go to next step</Text>\r\n                            </View>\r\n                        </View>\r\n                    </TouchableOpacity>\r\n                )}\r\n            </View>\r\n            <LessonProjectFilesEditor\r\n                key={modifiedProjectState.filesHashCode}\r\n                projectData={{\r\n                    projectState: modifiedProjectState,\r\n                    focus: activeFocus,\r\n                }}\r\n                fileEditorMode_focus='display'\r\n                fileEditorMode_noFocus='display'\r\n                projectEditorMode='display'\r\n                onTaskDone={() => { }}\r\n                lessonData={data}\r\n            />\r\n            {/* {activeExperiment && activeExperiment.replacements.map(x => (\r\n                <View key={x.selection.filePath + x.selection.index} >\r\n                    <View style={{ flexDirection: `row` }}>\r\n                        <Text style={{ minWidth: 80 }}>File</Text>\r\n                        <Text style={{ marginLeft: 4, background: `#111111` }}>{`${x.selection.filePath}`}</Text>\r\n                    </View>\r\n                    <View style={{ flexDirection: `row` }}>\r\n                        <Text style={{ minWidth: 80 }}>Match</Text>\r\n                        <Text style={{ marginLeft: 4, background: `#111111`, color: `#FF8888`, textDecoration: `line-through` }}>{`${data.projectState.files.find(f => f.path === x.selection.filePath)?.content.substr(x.selection.index, x.selection.length)}`}</Text>\r\n                    </View>\r\n                    <View style={{ flexDirection: `row` }}>\r\n                        <Text style={{ minWidth: 80 }}>Replace</Text>\r\n                        <Text style={{ marginLeft: 4, background: `#111111`, color: `#8888FF` }}>{`${x.content}`}</Text>\r\n                    </View>\r\n                </View>\r\n            ))} */}\r\n            <LessonProjectStatePreview projectState={modifiedProjectState} setProjectState={setProjectState} />\r\n        </>\r\n    );\r\n};\r\n","(function (Prism) {\n  var typescript = Prism.util.clone(Prism.languages.typescript);\n  Prism.languages.tsx = Prism.languages.extend('jsx', typescript); // This will prevent collisions between TSX tags and TS generic types.\n  // Idea by https://github.com/karlhorky\n  // Discussion: https://github.com/PrismJS/prism/issues/2594#issuecomment-710666928\n\n  var tag = Prism.languages.tsx.tag;\n  tag.pattern = RegExp(/(^|[^\\w$]|(?=<\\/))/.source + '(?:' + tag.pattern.source + ')', tag.pattern.flags);\n  tag.lookbehind = true;\n})(Prism);","\"use strict\"; // Updated from commit 428eac3 - vscode/src/vs/base/common/strings.ts\n\n/*---------------------------------------------------------------------------------------------\r\n *  Copyright (c) Microsoft Corporation. All rights reserved.\r\n *  Licensed under the MIT License. See License.txt in the project root for license information.\r\n *--------------------------------------------------------------------------------------------*/\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n/**\r\n * Returns first index of the string that is not whitespace.\r\n * If string is empty or contains only whitespaces, returns -1\r\n */\n\nfunction firstNonWhitespaceIndex(str) {\n  for (var i = 0, len = str.length; i < len; i++) {\n    var chCode = str.charCodeAt(i);\n\n    if (chCode !== 32\n    /* Space */\n    && chCode !== 9\n    /* Tab */\n    ) {\n        return i;\n      }\n  }\n\n  return -1;\n}\n\nexports.firstNonWhitespaceIndex = firstNonWhitespaceIndex;\n/**\r\n * Returns last index of the string that is not whitespace.\r\n * If string is empty or contains only whitespaces, returns -1\r\n */\n\nfunction lastNonWhitespaceIndex(str, startIndex) {\n  if (startIndex === void 0) {\n    startIndex = str.length - 1;\n  }\n\n  for (var i = startIndex; i >= 0; i--) {\n    var chCode = str.charCodeAt(i);\n\n    if (chCode !== 32\n    /* Space */\n    && chCode !== 9\n    /* Tab */\n    ) {\n        return i;\n      }\n  }\n\n  return -1;\n}\n\nexports.lastNonWhitespaceIndex = lastNonWhitespaceIndex;","export const doodleStoragePaths = {\r\n    doodleSummary: `doodle/summary`,\r\n    doodleDrawingsPrefix: `doodle/drawings`,\r\n    doodlePartyDrawingsPrefix: `doodle/party/drawings`,\r\n    doodleVotesPrefix: `doodle/votes`,\r\n} as const;\r\n","export var IconsManifest = [{\n  \"id\": \"fa\",\n  \"name\": \"Font Awesome\",\n  \"projectUrl\": \"https://fontawesome.com/\",\n  \"license\": \"CC BY 4.0 License\",\n  \"licenseUrl\": \"https://creativecommons.org/licenses/by/4.0/\"\n}, {\n  \"id\": \"io\",\n  \"name\": \"Ionicons\",\n  \"projectUrl\": \"https://ionicons.com/\",\n  \"license\": \"MIT\",\n  \"licenseUrl\": \"https://github.com/ionic-team/ionicons/blob/master/LICENSE\"\n}, {\n  \"id\": \"md\",\n  \"name\": \"Material Design icons\",\n  \"projectUrl\": \"http://google.github.io/material-design-icons/\",\n  \"license\": \"Apache License Version 2.0\",\n  \"licenseUrl\": \"https://github.com/google/material-design-icons/blob/master/LICENSE\"\n}, {\n  \"id\": \"ti\",\n  \"name\": \"Typicons\",\n  \"projectUrl\": \"http://s-ings.com/typicons/\",\n  \"license\": \"CC BY-SA 3.0\",\n  \"licenseUrl\": \"https://creativecommons.org/licenses/by-sa/3.0/\"\n}, {\n  \"id\": \"go\",\n  \"name\": \"Github Octicons icons\",\n  \"projectUrl\": \"https://octicons.github.com/\",\n  \"license\": \"MIT\",\n  \"licenseUrl\": \"https://github.com/primer/octicons/blob/master/LICENSE\"\n}, {\n  \"id\": \"fi\",\n  \"name\": \"Feather\",\n  \"projectUrl\": \"https://feathericons.com/\",\n  \"license\": \"MIT\",\n  \"licenseUrl\": \"https://github.com/feathericons/feather/blob/master/LICENSE\"\n}, {\n  \"id\": \"gi\",\n  \"name\": \"Game Icons\",\n  \"projectUrl\": \"https://game-icons.net/\",\n  \"license\": \"CC BY 3.0\",\n  \"licenseUrl\": \"https://creativecommons.org/licenses/by/3.0/\"\n}, {\n  \"id\": \"wi\",\n  \"name\": \"Weather Icons\",\n  \"projectUrl\": \"https://erikflowers.github.io/weather-icons/\",\n  \"license\": \"SIL OFL 1.1\",\n  \"licenseUrl\": \"http://scripts.sil.org/OFL\"\n}, {\n  \"id\": \"di\",\n  \"name\": \"Devicons\",\n  \"projectUrl\": \"https://vorillaz.github.io/devicons/\",\n  \"license\": \"MIT\",\n  \"licenseUrl\": \"https://opensource.org/licenses/MIT\"\n}, {\n  \"id\": \"ai\",\n  \"name\": \"Ant Design Icons\",\n  \"projectUrl\": \"https://github.com/ant-design/ant-design-icons\",\n  \"license\": \"MIT\",\n  \"licenseUrl\": \"https://opensource.org/licenses/MIT\"\n}, {\n  \"id\": \"bs\",\n  \"name\": \"Bootstrap Icons\",\n  \"projectUrl\": \"https://github.com/twbs/icons\",\n  \"license\": \"MIT\",\n  \"licenseUrl\": \"https://opensource.org/licenses/MIT\"\n}, {\n  \"id\": \"ri\",\n  \"name\": \"Remix Icon\",\n  \"projectUrl\": \"https://github.com/Remix-Design/RemixIcon\",\n  \"license\": \"Apache License Version 2.0\",\n  \"licenseUrl\": \"http://www.apache.org/licenses/\"\n}, {\n  \"id\": \"fc\",\n  \"name\": \"Flat Color Icons\",\n  \"projectUrl\": \"https://github.com/icons8/flat-color-icons\",\n  \"license\": \"MIT\",\n  \"licenseUrl\": \"https://opensource.org/licenses/MIT\"\n}, {\n  \"id\": \"gr\",\n  \"name\": \"Grommet-Icons\",\n  \"projectUrl\": \"https://github.com/grommet/grommet-icons\",\n  \"license\": \"Apache License Version 2.0\",\n  \"licenseUrl\": \"http://www.apache.org/licenses/\"\n}, {\n  \"id\": \"hi\",\n  \"name\": \"Heroicons\",\n  \"projectUrl\": \"https://github.com/refactoringui/heroicons\",\n  \"license\": \"MIT\",\n  \"licenseUrl\": \"https://opensource.org/licenses/MIT\"\n}, {\n  \"id\": \"si\",\n  \"name\": \"Simple Icons\",\n  \"projectUrl\": \"https://simpleicons.org/\",\n  \"license\": \"CC0 1.0 Universal\",\n  \"licenseUrl\": \"https://creativecommons.org/publicdomain/zero/1.0/\"\n}, {\n  \"id\": \"im\",\n  \"name\": \"IcoMoon Free\",\n  \"projectUrl\": \"https://github.com/Keyamoon/IcoMoon-Free\",\n  \"license\": \"CC BY 4.0 License\"\n}, {\n  \"id\": \"bi\",\n  \"name\": \"BoxIcons\",\n  \"projectUrl\": \"https://github.com/atisawd/boxicons\",\n  \"license\": \"CC BY 4.0 License\"\n}, {\n  \"id\": \"cg\",\n  \"name\": \"css.gg\",\n  \"projectUrl\": \"https://github.com/astrit/css.gg\",\n  \"license\": \"MIT\",\n  \"licenseUrl\": \"https://opensource.org/licenses/MIT\"\n}, {\n  \"id\": \"vsc\",\n  \"name\": \"VS Code Icons\",\n  \"projectUrl\": \"https://github.com/microsoft/vscode-codicons\",\n  \"license\": \"CC BY 4.0\",\n  \"licenseUrl\": \"https://creativecommons.org/licenses/by/4.0/\"\n}];","import * as React from 'react';\nexport var DefaultContext = {\n  color: undefined,\n  size: undefined,\n  className: undefined,\n  style: undefined,\n  attr: undefined\n};\nexport var IconContext = React.createContext && React.createContext(DefaultContext);","var __assign = this && this.__assign || function () {\n  __assign = Object.assign || function (t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n      s = arguments[i];\n\n      for (var p in s) {\n        if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n      }\n    }\n\n    return t;\n  };\n\n  return __assign.apply(this, arguments);\n};\n\nvar __rest = this && this.__rest || function (s, e) {\n  var t = {};\n\n  for (var p in s) {\n    if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0) t[p] = s[p];\n  }\n\n  if (s != null && typeof Object.getOwnPropertySymbols === \"function\") for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\n    if (e.indexOf(p[i]) < 0) t[p[i]] = s[p[i]];\n  }\n  return t;\n};\n\nimport * as React from 'react';\nimport { IconContext, DefaultContext } from './iconContext';\n\nfunction Tree2Element(tree) {\n  return tree && tree.map(function (node, i) {\n    return React.createElement(node.tag, __assign({\n      key: i\n    }, node.attr), Tree2Element(node.child));\n  });\n}\n\nexport function GenIcon(data) {\n  return function (props) {\n    return React.createElement(IconBase, __assign({\n      attr: __assign({}, data.attr)\n    }, props), Tree2Element(data.child));\n  };\n}\nexport function IconBase(props) {\n  var elem = function elem(conf) {\n    var computedSize = props.size || conf.size || \"1em\";\n    var className;\n    if (conf.className) className = conf.className;\n    if (props.className) className = (className ? className + ' ' : '') + props.className;\n\n    var attr = props.attr,\n        title = props.title,\n        svgProps = __rest(props, [\"attr\", \"title\"]);\n\n    return React.createElement(\"svg\", __assign({\n      stroke: \"currentColor\",\n      fill: \"currentColor\",\n      strokeWidth: \"0\"\n    }, conf.attr, attr, svgProps, {\n      className: className,\n      style: __assign({\n        color: props.color || conf.color\n      }, conf.style, props.style),\n      height: computedSize,\n      width: computedSize,\n      xmlns: \"http://www.w3.org/2000/svg\"\n    }), title && React.createElement(\"title\", null, title), props.children);\n  };\n\n  return IconContext !== undefined ? React.createElement(IconContext.Consumer, null, function (conf) {\n    return elem(conf);\n  }) : elem(DefaultContext);\n}","import { webRequest } from 'utils/web-request';\r\nimport { UploadApi, UploadApiEndpointName, UploadApiRequestData } from './types';\r\n\r\nexport const createUploadApiWebClient = (config: { uploadApiUrl: string }): UploadApi => {\r\n\r\n    async function apiRequest<T>(endpoint: UploadApiEndpointName, data: unknown): Promise<T> {\r\n        const url = `${config.uploadApiUrl}/${endpoint}`;\r\n\r\n        const requestData: UploadApiRequestData = {\r\n            endpoint,\r\n            data,\r\n        };\r\n\r\n        const resultObj = (await webRequest(url, requestData)) as { data: T };\r\n\r\n        return resultObj.data;\r\n    };\r\n\r\n    const api: UploadApi = {\r\n        createUploadUrl: (data) => apiRequest(`createUploadUrl`, data),\r\n        renewUploadUrl: (data) => apiRequest(`renewUploadUrl`, data),\r\n    };\r\n\r\n    return api;\r\n};\r\n","import { Platform } from 'react-native-lite';\r\n\r\nexport const createSpeechService = (): {\r\n    speak: (text: string, languange?: string) => void;\r\n    getVoicesForLanguange: (languange: string) => { voice: SpeechSynthesisVoice, isSelected: boolean }[];\r\n    setVoiceForLanguange: (languange: string, voice: SpeechSynthesisVoice) => void;\r\n} => {\r\n    if (Platform.OS !== `web`) {\r\n        return {\r\n            speak: () => { },\r\n            getVoicesForLanguange: () => [],\r\n            setVoiceForLanguange: () => { },\r\n        };\r\n    }\r\n\r\n    const synth = window.speechSynthesis;\r\n\r\n    const selectedVoices = {} as { [languange: string]: SpeechSynthesisVoice };\r\n\r\n    const speak = (text: string, languange?: string) => {\r\n        const voiceLang = selectedVoices[languange ?? `en`] ?? null;\r\n\r\n        try {\r\n            const u = new SpeechSynthesisUtterance(text);\r\n            u.voice = voiceLang;\r\n            synth.speak(u);\r\n        } catch {\r\n            // Ignore\r\n        }\r\n    };\r\n\r\n    return {\r\n        speak,\r\n        getVoicesForLanguange: (languange) => {\r\n            const voices = synth.getVoices();\r\n            console.log(`voices`, { voices });\r\n            const v = voices.filter(x => x.lang.startsWith(languange)).map(x => ({\r\n                voice: x,\r\n                isSelected: selectedVoices[languange] === x,\r\n            }));\r\n            return v;\r\n        },\r\n        setVoiceForLanguange: (language, voice) => {\r\n            selectedVoices[language] = voice;\r\n        },\r\n    };\r\n};\r\n\r\nexport type SpeechService = ReturnType<typeof createSpeechService>;\r\n","import React, { } from 'react';\r\nimport { Text, TouchableOpacity } from 'react-native-lite';\r\nimport { theme, ThemeTextStyle, ThemeViewStyle, extractViewStyle, extractTextStyle } from 'themes/theme';\r\n\r\nexport const Button = (props: { style?: ThemeTextStyle & ThemeViewStyle, styleAlt?: boolean, children: string, onPress: () => void }) => {\r\n    const s = props.style ?? (props.styleAlt ? theme.button_formAction_alt : theme.button_formAction);\r\n    return (\r\n        <TouchableOpacity style={extractViewStyle(s)} onPress={props.onPress}>\r\n            <Text style={extractTextStyle(s)}>{props.children}</Text>\r\n        </TouchableOpacity>\r\n    );\r\n};\r\n","import React, { } from 'react';\r\nimport { View, Text } from 'react-native-lite';\r\nimport { theme } from 'themes/theme';\r\nimport { Loading, LoadingInline } from './loading';\r\nimport { ErrorBox, ErrorMessage } from './error-box';\r\nimport { Input_Text, Input_Username, Input_Password, Input_Phone, Input_Email, Input_Currency } from './inputs';\r\nimport { Button } from './button';\r\n\r\ntype PropsOf<T> = T extends (props: infer P) => JSX.Element ? P : never;\r\n\r\nexport const C = {\r\n    Loading,\r\n    LoadingInline,\r\n    ErrorBox,\r\n    ErrorMessage,\r\n    View_Panel: (props: PropsOf<typeof View>) => (<View style={theme.view_panel} {...props} />),\r\n    View_Form: (props: PropsOf<typeof View>) => (<View style={theme.view_form} {...props} />),\r\n    View_FormFields: (props: PropsOf<typeof View>) => (<View style={theme.view_formFields} {...props} />),\r\n    View_FieldRow: (props: PropsOf<typeof View>) => (<View style={theme.view_fieldRow} {...props} />),\r\n    View_FormActionRow: (props: PropsOf<typeof View>) => (<View style={theme.view_formActionRow} {...props} />),\r\n    Text_FormTitle: (props: PropsOf<typeof Text>) => (<Text style={theme.text_formTitle} {...props} />),\r\n    Text_FieldLabel: (props: PropsOf<typeof Text>) => (<Text style={theme.text_fieldLabel} numberOfLines={1} {...props} />),\r\n    Button_FieldInline: (props: PropsOf<typeof Button>) => (<Button style={props.styleAlt ? theme.button_fieldInline_alt : theme.button_fieldInline} {...props} />),\r\n    Button_FormAction: (props: PropsOf<typeof Button>) => (<Button style={props.styleAlt ? theme.button_formAction_alt : theme.button_formAction} {...props} />),\r\n    Input_Text,\r\n    Input_Username,\r\n    Input_Password,\r\n    Input_Phone,\r\n    Input_Email,\r\n    Input_Currency,\r\n};\r\n","import React, { useState } from 'react';\r\nimport { TextInput, View, TouchableOpacity } from 'react-native-lite';\r\nimport { theme, ThemeTextStyle } from 'themes/theme';\r\nimport { PhoneNumber, toStandardPhoneNumber, formatPhoneNumber_UsaCanada } from 'utils/phone-number';\r\nimport { EmailAddress, toEmailAddress } from 'utils/email-address';\r\nimport { Icon } from './icon';\r\nimport { IconKind } from './icon-kind';\r\n\r\nexport const Input_Text = (props: { style?: ThemeTextStyle, value: string, onChange: (value: string) => void, onSubmit?: () => void, placeholder?: string, editable?: boolean, onFocus?: () => void, onBlur?: () => void }) => {\r\n    return (\r\n        <TextInput style={props.style ?? theme.input_fieldEntry}\r\n            keyboardType='default'\r\n            autoCompleteType='off'\r\n            placeholder={props.placeholder}\r\n            editable={props.editable}\r\n            value={`${props.value}`}\r\n            onChange={(x) => props.onChange(x)}\r\n            onSubmitEditing={props.onSubmit}\r\n            onFocus={props.onFocus}\r\n            onBlur={props.onBlur}\r\n        />\r\n    );\r\n};\r\n\r\nexport const Input_Username = (props: { style?: ThemeTextStyle, value: string, onChange: (value: string) => void, onSubmit?: () => void, placeholder?: string, editable?: boolean }) => {\r\n    return (\r\n        <TextInput style={props.style ?? theme.input_fieldEntry}\r\n            keyboardType='default'\r\n            autoCompleteType='username'\r\n            placeholder={props.placeholder}\r\n            editable={props.editable}\r\n            value={`${props.value}`}\r\n            onChange={(x) => props.onChange(x)}\r\n            onSubmitEditing={props.onSubmit}\r\n        />\r\n    );\r\n};\r\n\r\nexport const Input_Password = (props: { style?: ThemeTextStyle, value: string, onChange: (value: string) => void, onSubmit?: () => void, onBlur?: () => void, placeholder?: string, editable?: boolean }) => {\r\n\r\n    const [showPassword, setShowPassword] = useState(false);\r\n\r\n    const inputStyle = props.style ?? theme.input_fieldEntry;\r\n    const { marginRight } = inputStyle;\r\n    return (\r\n        <View style={{ flexDirection: `row`, alignItems: `center` }}>\r\n            <TextInput style={{ ...inputStyle, marginRight: 0 }}\r\n                keyboardType='default'\r\n                autoCompleteType='password'\r\n                secureTextEntry={!showPassword}\r\n                placeholder={props.placeholder}\r\n                editable={props.editable}\r\n                value={`${props.value}`}\r\n                onChange={(x) => props.onChange(x)}\r\n                onSubmitEditing={props.onSubmit}\r\n                onBlur={props.onBlur}\r\n            />\r\n            <TouchableOpacity onPress={() => setShowPassword(s => !s)} style={{ outlineColor: theme.icon.outlineColor }}>\r\n                <View style={{ paddingLeft: 4, paddingRight: 4, marginRight }}>\r\n                    <Icon style={theme.icon} kind={showPassword ? IconKind.eye : IconKind.eyeSlash} />\r\n                </View>\r\n            </TouchableOpacity>\r\n        </View>\r\n    );\r\n};\r\n\r\nexport type Currency = number;// & { __type: 'currency' };\r\nexport const Input_Currency = (props: { style?: ThemeTextStyle, value: Currency, onChange: (value: Currency) => void, onSubmit?: () => void, placeholder?: string, editable?: boolean }) => {\r\n    return (\r\n        <TextInput style={props.style ?? theme.input_fieldEntry}\r\n            keyboardType='numeric'\r\n            autoCompleteType='off'\r\n            placeholder={props.placeholder}\r\n            editable={props.editable}\r\n            value={`${props.value}`}\r\n            onChange={(x) => props.onChange(Number.parseFloat(x) || 0)}\r\n            onSubmitEditing={props.onSubmit}\r\n        />\r\n    );\r\n};\r\n\r\nexport const Input_Phone = (props: { style?: ThemeTextStyle, value: PhoneNumber, onChange: (value: PhoneNumber) => void, onSubmit?: () => void, placeholder?: string, editable?: boolean }) => {\r\n\r\n    const [valueActual, setValueActual] = useState(formatPhoneNumber_UsaCanada(props.value));\r\n    const changeValueActual = (v: string) => {\r\n        setValueActual(formatPhoneNumber_UsaCanada(v));\r\n        props.onChange(toStandardPhoneNumber(v));\r\n    };\r\n    return (\r\n        <TextInput style={props.style ?? theme.input_fieldEntry}\r\n            keyboardType='phone-pad'\r\n            autoCompleteType='tel'\r\n            placeholder={props.placeholder}\r\n            editable={props.editable}\r\n            value={valueActual}\r\n            onChange={changeValueActual}\r\n            onSubmitEditing={props.onSubmit}\r\n        />\r\n    );\r\n};\r\n\r\n\r\nexport const Input_Email = (props: { style?: ThemeTextStyle, value: EmailAddress, onChange: (value: EmailAddress) => void, onSubmit?: () => void, placeholder?: string, editable?: boolean }) => {\r\n\r\n    const [valueActual, setValueActual] = useState(toEmailAddress(props.value));\r\n    const changeValueActual = (v: string) => {\r\n        setValueActual(toEmailAddress(v));\r\n        props.onChange(toEmailAddress(v));\r\n    };\r\n    return (\r\n        <TextInput style={props.style ?? theme.input_fieldEntry}\r\n            keyboardType='email-address'\r\n            autoCompleteType='email'\r\n            placeholder={props.placeholder}\r\n            editable={props.editable}\r\n            value={valueActual}\r\n            onChange={changeValueActual}\r\n            onSubmitEditing={props.onSubmit}\r\n        />\r\n    );\r\n};\r\n","import { scaleByPixelRatio, Vector2 } from './utils';\r\n\r\nexport type EventProvider = {\r\n    windowAddEventListener: Window['addEventListener'];\r\n    canvasAddEventListener: HTMLCanvasElement['addEventListener'];\r\n    tools: {\r\n        getMouseGamePosition: (e: MouseEvent) => Vector2;\r\n        getTouchPositions: (e: TouchEvent) => Vector2[];\r\n    };\r\n    destroy: () => void;\r\n};\r\n\r\nexport const createEventProvider = (canvas: HTMLCanvasElement): EventProvider => {\r\n    const windowSubs = [] as { name: string, handler: () => void }[];\r\n    const windowAddEventListener = ((name: string, handler: () => void, options?: boolean | AddEventListenerOptions) => {\r\n        windowSubs.push({ name, handler });\r\n        return window.addEventListener(name, handler, options);\r\n    }) as typeof window.addEventListener;\r\n    const windowEventListenersDestroy = () => {\r\n        windowSubs.forEach(({ name, handler }) => {\r\n            window.removeEventListener(name, handler);\r\n        });\r\n    };\r\n    const canvasSubs = [] as { name: string, handler: () => void }[];\r\n    const canvasAddEventListener = ((name: string, handler: () => void, options: boolean | AddEventListenerOptions) => {\r\n        if (!canvas) { return null; }\r\n\r\n        canvasSubs.push({ name, handler });\r\n        return canvas.addEventListener(name, handler, options);\r\n    }) as HTMLCanvasElement['addEventListener'];\r\n    const canvasEventListenersDestroy = () => {\r\n        canvasSubs.forEach(({ name, handler }) => {\r\n            canvas.removeEventListener(name, handler);\r\n        });\r\n    };\r\n\r\n    const clientToGamePosition = (item: { clientX: number, clientY: number }, rectCached?: DOMRect) => {\r\n        const rect = rectCached ?? canvas.getBoundingClientRect();\r\n        const canvasPos = {\r\n            x: item.clientX - rect.left,\r\n            y: item.clientY - rect.top,\r\n        };\r\n\r\n        const gamePos = {\r\n            x: scaleByPixelRatio(canvasPos.x) / canvas.width,\r\n            y: 1 - (scaleByPixelRatio(canvasPos.y) / canvas.height),\r\n        };\r\n        return gamePos;\r\n    };\r\n\r\n    return {\r\n        windowAddEventListener,\r\n        canvasAddEventListener,\r\n        tools: {\r\n            getMouseGamePosition: (e) => clientToGamePosition(e),\r\n            getTouchPositions: (e) => {\r\n                const rect = canvas.getBoundingClientRect();\r\n                const pos = [] as Vector2[];\r\n                const { touches } = e;\r\n                for (let i = 0; i < touches.length; i++) {\r\n                    const touch = touches.item(i);\r\n                    if (!touch) { continue; }\r\n\r\n                    pos.push(clientToGamePosition(touch, rect));\r\n                }\r\n                return pos;\r\n            },\r\n        },\r\n        destroy: () => {\r\n            windowEventListenersDestroy();\r\n            canvasEventListenersDestroy();\r\n        },\r\n    };\r\n};\r\n","import dayjs from 'dayjs';\r\nimport localizedFormat from 'dayjs/plugin/localizedFormat';\r\nimport relativeTime from 'dayjs/plugin/relativeTime';\r\n\r\ndayjs.extend(localizedFormat);\r\ndayjs.extend(relativeTime);\r\n\r\nexport const formatDate = (date: Date | number | string) => {\r\n    return dayjs(date).format(`L`);\r\n};\r\n\r\nexport const formatDate_FromNow = (date: Date | number | string) => {\r\n    return dayjs(date).fromNow();\r\n};\r\n","\"use strict\"; // Updated from commit d4edb9a - vscode/src/vs/base/common/diff/diffChange.ts\n\n/*---------------------------------------------------------------------------------------------\r\n *  Copyright (c) Microsoft Corporation. All rights reserved.\r\n *  Licensed under the MIT License. See License.txt in the project root for license information.\r\n *--------------------------------------------------------------------------------------------*/\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n/**\r\n * Represents information about a specific difference between two sequences.\r\n */\n\nvar DiffChange =\n/** @class */\nfunction () {\n  /**\r\n   * Constructs a new DiffChange with the given sequence information\r\n   * and content.\r\n   */\n  function DiffChange(originalStart, originalLength, modifiedStart, modifiedLength) {\n    //Debug.Assert(originalLength > 0 || modifiedLength > 0, \"originalLength and modifiedLength cannot both be <= 0\");\n    this.originalStart = originalStart;\n    this.originalLength = originalLength;\n    this.modifiedStart = modifiedStart;\n    this.modifiedLength = modifiedLength;\n  }\n  /**\r\n   * The end point (exclusive) of the change in the original sequence.\r\n   */\n\n\n  DiffChange.prototype.getOriginalEnd = function () {\n    return this.originalStart + this.originalLength;\n  };\n  /**\r\n   * The end point (exclusive) of the change in the modified sequence.\r\n   */\n\n\n  DiffChange.prototype.getModifiedEnd = function () {\n    return this.modifiedStart + this.modifiedLength;\n  };\n\n  return DiffChange;\n}();\n\nexports.DiffChange = DiffChange;","export async function delay(timeout: number): Promise<void> {\r\n    return await new Promise((resolve) => {\r\n        setTimeout(resolve, timeout);\r\n    });\r\n}\r\n","var g;\n\n// This works in non-strict mode\ng = (function() {\n\treturn this;\n})();\n\ntry {\n\t// This works if eval is allowed (see CSP)\n\tg = g || new Function(\"return this\")();\n} catch (e) {\n\t// This works if the window reference is available\n\tif (typeof window === \"object\") g = window;\n}\n\n// g can still be undefined, but nothing to do about it...\n// We return undefined, instead of nothing here, so it's\n// easier to handle this case. if(!global) { ...}\n\nmodule.exports = g;\n","export type ColorRgb = { r: number, g: number, b: number };\r\nexport type Vector2 = { x: number, y: number };\r\nexport type Size2 = { width: number, height: number };\r\nexport type Rect2 = { position: Vector2, size: Vector2 };\r\n\r\nexport const Vector2 = {\r\n    add: (a: Vector2, b: Vector2) => {\r\n        return {\r\n            x: a.x + b.x,\r\n            y: a.y + b.y,\r\n        };\r\n    },\r\n    subtract: (a: Vector2, b: Vector2) => {\r\n        return {\r\n            x: a.x - b.x,\r\n            y: a.y - b.y,\r\n        };\r\n    },\r\n    divide: (a: Vector2, b: Vector2) => {\r\n        return {\r\n            x: a.x / b.x,\r\n            y: a.y / b.y,\r\n        };\r\n    },\r\n    scale: (a: number, b: Vector2) => {\r\n        return {\r\n            x: a * b.x,\r\n            y: a * b.y,\r\n        };\r\n    },\r\n    lengthSq: (a: Vector2) => {\r\n        return a.x * a.x + a.y * a.y;\r\n    },\r\n    distanceSq: (a: Vector2, b: Vector2) => {\r\n        return Vector2.lengthSq(Vector2.subtract(a,b));\r\n    },\r\n    equal: (a: Vector2, b: Vector2, margin = 0.0001) => {\r\n        return Vector2.distanceSq(a,b) <= margin;\r\n    },\r\n};\r\n\r\nexport const Rect2 = {\r\n    collidesRectangle: (a: Rect2, b: Rect2, sizeRatio = 1) => {\r\n        return Math.abs(a.position.x - b.position.x) < sizeRatio * 0.5 * (a.size.x + b.size.x)\r\n            && Math.abs(a.position.y - b.position.y) < sizeRatio * 0.5 * (a.size.y + b.size.y);\r\n    },\r\n};\r\n\r\nexport function scaleByPixelRatio(input: number) {\r\n    const pixelRatio = window.devicePixelRatio || 1;\r\n    return Math.floor(input * pixelRatio);\r\n}\r\n","import React from 'react';\r\nimport { ThemeIconStyle, theme } from 'themes/theme';\r\nimport { MdMenu, MdArrowBack, MdCheckBoxOutlineBlank, MdErrorOutline, MdContentCopy, MdDashboard } from 'react-icons/md';\r\nimport { FiChevronRight, FiChevronDown } from 'react-icons/fi';\r\nimport { FaRedo, FaPlus, FaMinus, FaEye, FaEyeSlash, FaCheck, FaCheckSquare, FaSquare } from 'react-icons/fa';\r\nimport { View } from 'react-native-lite';\r\nimport { IconKind } from './icon-kind';\r\n\r\nfunction getIcon(kind: IconKind) {\r\n    switch (kind) {\r\n        case IconKind.menu: return { name: `menu`, component: MdMenu };\r\n        case IconKind.back: return { name: `arrow-back`, component: MdArrowBack };\r\n        case IconKind.error: return { name: `error-outline`, component: MdErrorOutline };\r\n        case IconKind.expanded: return { name: `chevron-down`, component: FiChevronDown };\r\n        case IconKind.collapsed: return { name: `chevron-right`, component: FiChevronRight };\r\n        case IconKind.copy: return { name: `content-copy`, component: MdContentCopy };\r\n        case IconKind.retry: return { name: `reload`, component: FaRedo };\r\n        case IconKind.dashboard: return { name: `dashboard`, component: MdDashboard };\r\n        case IconKind.add: return { name: `plus`, component: FaPlus };\r\n        case IconKind.remove: return { name: `minus`, component: FaMinus };\r\n        case IconKind.eye: return { name: `eye`, component: FaEye };\r\n        case IconKind.eyeSlash: return { name: `eye-slash`, component: FaEyeSlash };\r\n        case IconKind.checkChecked: return { name: `checked`, component: FaCheckSquare };\r\n        case IconKind.checkUnchecked: return { name: `unchecked`, component: FaSquare };\r\n\r\n        // case IconKind.Account: return { name: `account-circle`, component: MaterialIcons };\r\n        // case IconKind.Message: return { name: `message`, component: MaterialIcons };\r\n        // case IconKind.Subscription: return { name: `ticket-account`, component: MaterialCommunityIcons };\r\n        // case IconKind.Campaigns: return { name: `calendar-multiselect`, component: MaterialCommunityIcons };\r\n        // case IconKind.Contacts: return { name: `contacts`, component: MaterialIcons };\r\n        // case IconKind.Keywords: return { name: `key-variant`, component: MaterialCommunityIcons };\r\n        // case IconKind.Resources: return { name: `collections-bookmark`, component: MaterialIcons };\r\n        // case IconKind.Admin: return { name: `settings`, component: MaterialIcons };\r\n        // case IconKind.Solutions: return { name: '', component: FontAwesome };\r\n        // case IconKind.Texting: return { name: '', component: FontAwesome };\r\n        // case IconKind.Pricing: return { name: '', component: FontAwesome };\r\n        // case IconKind.Download: return { name: '', component: FontAwesome };\r\n\r\n        default:\r\n            return { name: `unknown`, component: MdCheckBoxOutlineBlank };\r\n    }\r\n}\r\n\r\nexport const Icon = (props: { kind: IconKind, style?: ThemeIconStyle }) => {\r\n    const icon = getIcon(props.kind);\r\n    const IconComponent = icon.component;\r\n    const size = props.style?.size ?? theme.icon.size ?? theme.sizes.fontSize;\r\n    return (\r\n        <View style={{ width: size, height: size }}>\r\n            <IconComponent name={icon.name} size={size} color={props.style?.color ?? theme.icon.color} />\r\n        </View>\r\n    );\r\n};\r\n","/* eslint-disable @typescript-eslint/no-unused-vars */\r\nexport type ThemeViewStyle = {\r\n    display?: 'flex' | 'block' | 'inline';\r\n    flexDirection?: 'row' | 'column' | 'row-reverse' | 'column-reverse';\r\n    flexWrap?: 'wrap' | 'nowrap';\r\n    flex?: number;\r\n    justifyContent?: 'flex-start' | 'center' | 'flex-end' | 'space-around' | 'space-between';\r\n    alignItems?: 'flex-start' | 'center' | 'flex-end';\r\n    alignSelf?: 'center' | 'stretch' | 'flex-start' | 'flex-end';\r\n    overflow?: 'visible' | 'hidden' | 'auto';\r\n\r\n    background?: string;\r\n\r\n    margin?: number;\r\n    marginLeft?: number;\r\n    marginRight?: number;\r\n    marginTop?: number;\r\n    marginBottom?: number;\r\n    padding?: number;\r\n    paddingRight?: number;\r\n    paddingLeft?: number;\r\n    paddingTop?: number;\r\n    paddingBottom?: number;\r\n\r\n    width?: number;\r\n    minWidth?: number;\r\n    maxWidth?: number;\r\n    height?: number;\r\n\r\n    borderWidth?: number;\r\n    borderLeftWidth?: number;\r\n    borderRightWidth?: number;\r\n    borderTopWidth?: number;\r\n    borderBottomWidth?: number;\r\n\r\n    borderColor?: string;\r\n    borderLeftColor?: string;\r\n    borderRightColor?: string;\r\n    borderTopColor?: string;\r\n    borderBottomColor?: string;\r\n\r\n\r\n    borderRadius?: number;\r\n    borderStyle?: 'solid';\r\n    outlineColor?: string;\r\n    outline?: `none`;\r\n\r\n    transform?: string;\r\n\r\n    opacity?: number;\r\n\r\n    position?: 'absolute' | 'relative' | 'fixed';\r\n    top?: number;\r\n    bottom?: number;\r\n    left?: number;\r\n    right?: number;\r\n    zIndex?: number;\r\n};\r\nexport type ThemeTextStyle = {\r\n    margin?: number;\r\n    marginLeft?: number;\r\n    marginRight?: number;\r\n    marginTop?: number;\r\n    marginBottom?: number;\r\n    padding?: number;\r\n    paddingRight?: number;\r\n    paddingLeft?: number;\r\n    paddingTop?: number;\r\n    paddingBottom?: number;\r\n\r\n    color?: string;\r\n    background?: string;\r\n\r\n    fontFamily?: string;\r\n    fontSize?: number;\r\n    fontWeight?: 'normal' | 'bold' | 'lighter';\r\n    lineHeight?: string;\r\n    whiteSpace?: 'normal' | 'nowrap' | 'pre' | 'pre-wrap';\r\n    minWidth?: number;\r\n\r\n    textDecoration?: `line-through`;\r\n\r\n    outlineColor?: string;\r\n    userSelect?: `none`;\r\n};\r\nexport type ThemeIconStyle = {\r\n    color?: string;\r\n    size?: number;\r\n    outlineColor?: string;\r\n};\r\n\r\nexport const extractViewStyle = (style: ThemeViewStyle & ThemeTextStyle): ThemeViewStyle => {\r\n    return {\r\n        display: style.display,\r\n        flexDirection: style.flexDirection,\r\n        flex: style.flex,\r\n        justifyContent: style.justifyContent,\r\n        alignItems: style.alignItems,\r\n        overflow: style.overflow,\r\n\r\n        background: style.background,\r\n\r\n        margin: style.margin,\r\n        marginLeft: style.margin ?? style.marginLeft,\r\n        marginRight: style.margin ?? style.marginRight,\r\n        marginTop: style.margin ?? style.marginTop,\r\n        marginBottom: style.margin ?? style.marginBottom,\r\n        padding: style.padding,\r\n        paddingRight: style.padding ?? style.paddingRight,\r\n        paddingLeft: style.padding ?? style.paddingLeft,\r\n        paddingTop: style.padding ?? style.paddingTop,\r\n        paddingBottom: style.padding ?? style.paddingBottom,\r\n\r\n        width: style.width,\r\n        minWidth: style.minWidth,\r\n        maxWidth: style.maxWidth,\r\n        height: style.height,\r\n\r\n        borderWidth: style.borderWidth,\r\n        borderRadius: style.borderRadius,\r\n        borderColor: style.borderColor,\r\n        borderStyle: style.borderStyle,\r\n\r\n        outlineColor: style.outlineColor,\r\n    };\r\n};\r\nexport const extractTextStyle = (style: ThemeViewStyle & ThemeTextStyle): ThemeTextStyle => {\r\n    return {\r\n        // padding: style.padding,\r\n        color: style.color,\r\n\r\n        fontFamily: style.fontFamily,\r\n        fontSize: style.fontSize,\r\n        fontWeight: style.fontWeight,\r\n        lineHeight: style.lineHeight,\r\n        // whiteSpace: style.whiteSpace,\r\n\r\n        outlineColor: style.outlineColor,\r\n    };\r\n};\r\n\r\nexport const basicThemeColors = {\r\n    text: `#333333`,\r\n    text_header: `#333333`,\r\n    text_button: `#333333`,\r\n    text_error: `#333333`,\r\n    text_errorMessage: `#ff3333`,\r\n    border: `#cccccc`,\r\n    border_minor: `#cccccc`,\r\n    border_input: `#cccccc`,\r\n    outline: `#888888`,\r\n    background: `#ffffff`,\r\n    background_field: `#dddddd`,\r\n    background_button: `#eeeeee`,\r\n    background_error: `#ffcccc`,\r\n    loader: `#3333ff`,\r\n    icon: `#3333ff`,\r\n};\r\nexport type RectSize = { all?: number, left?: number, right?: number, top?: number, bottom?: number };\r\nconst getBorderSizes = (size: RectSize) => {\r\n    return {\r\n        borderWidth: size.all,\r\n        borderLeftWidth: size.left ?? size.all,\r\n        borderRightWidth: size.right ?? size.all,\r\n        borderTopWidth: size.top ?? size.all,\r\n        borderBottomWidth: size.bottom ?? size.all,\r\n    };\r\n};\r\n\r\nexport const basicThemeSizes = {\r\n    textPadding: 4,\r\n    borderWidth: { all: 1 } as RectSize,\r\n    borderWidth_minor: { all: 1 } as RectSize,\r\n    borderWidth_input: { all: 1 } as RectSize,\r\n    borderRadius: 4,\r\n    sectionGap: 16,\r\n    elementGap: 8,\r\n    rowGap: 4,\r\n    rowPadding: 4,\r\n\r\n    fontSize: 14,\r\n    fontSize_input: 16,\r\n    fontSize_button: 14,\r\n    fontSize_header: 16,\r\n\r\n    lineHeight: `18px`,\r\n\r\n    minWidth_label: 120,\r\n    minWidth_input: 120,\r\n    minWidth_button: 120,\r\n\r\n    icon: 14,\r\n};\r\n\r\nexport const basicFont = {\r\n    fontFamily: `\"Trebuchet MS\", Helvetica, Roboto, sans-serif`,\r\n    fontWeight_normal: `normal` as 'normal' | 'bold',\r\n    fontWeight_button: `bold` as 'normal' | 'bold',\r\n    fontWeight_header: `bold` as 'normal' | 'bold',\r\n};\r\n\r\nexport type ThemeColors = typeof basicThemeColors;\r\nexport type ThemeSizes = typeof basicThemeSizes;\r\nexport type ThemeFont = typeof basicFont;\r\n\r\nconst createTheme = (colors: ThemeColors, sizes: ThemeSizes, font: ThemeFont) => {\r\n\r\n    const borderProps = {\r\n        ...getBorderSizes(sizes.borderWidth),\r\n\r\n        borderRadius: sizes.borderRadius,\r\n        borderColor: colors.border,\r\n        borderStyle: `solid`,\r\n        outlineColor: colors.outline,\r\n    } as const;\r\n\r\n    const borderProps_minor = {\r\n        ...getBorderSizes(sizes.borderWidth_minor),\r\n\r\n        borderRadius: sizes.borderRadius,\r\n        borderColor: colors.border_minor,\r\n        borderStyle: `solid`,\r\n        outlineColor: colors.outline,\r\n    } as const;\r\n\r\n    const borderProps_input = {\r\n        ...getBorderSizes(sizes.borderWidth_input),\r\n\r\n        borderRadius: sizes.borderRadius,\r\n        borderColor: colors.border_input,\r\n        borderStyle: `solid`,\r\n        outlineColor: colors.outline,\r\n    } as const;\r\n\r\n    let sView: ThemeViewStyle = {};\r\n    let sText: ThemeTextStyle = {};\r\n    let sIcon: ThemeIconStyle = {};\r\n    let sTextView: ThemeTextStyle & ThemeViewStyle = {};\r\n\r\n    const theme = {\r\n        colors,\r\n        sizes,\r\n        font,\r\n\r\n        view_panel: sView = {\r\n            background: colors.background,\r\n            padding: sizes.elementGap,\r\n        },\r\n        view_form: sView = {\r\n            ...borderProps,\r\n            marginBottom: sizes.sectionGap,\r\n            padding: sizes.elementGap,\r\n            // background: colors.background_field,\r\n        },\r\n        text_formTitle: sText = {\r\n            padding: sizes.textPadding,\r\n            color: colors.text_header,\r\n            fontSize: sizes.fontSize_header,\r\n            fontFamily: font.fontFamily,\r\n            fontWeight: font.fontWeight_header,\r\n        },\r\n        view_formFields: sView = {\r\n            // ...borderProps,\r\n            ...borderProps_minor,\r\n            // padding: sizes.elementGap,\r\n            marginBottom: sizes.rowGap,\r\n            background: colors.background_field,\r\n            // alignItems: `center`,\r\n        },\r\n        view_fieldRow: sView = {\r\n            // ...borderProps,\r\n            // ...borderProps_minor,\r\n            // marginBottom: sizes.rowGap,\r\n            // padding: sizes.rowPadding,\r\n            marginLeft: sizes.rowPadding,\r\n            // background: colors.background_field,\r\n            display: `flex`,\r\n            flexDirection: `row`,\r\n\r\n            alignItems: `center`,\r\n            flexWrap: `wrap`,\r\n        },\r\n        text_fieldLabel: sText = {\r\n            padding: sizes.textPadding,\r\n            color: colors.text,\r\n            fontSize: sizes.fontSize,\r\n            fontWeight: font.fontWeight_normal,\r\n            minWidth: sizes.minWidth_label,\r\n            //  whiteSpace: `nowrap`,\r\n        },\r\n        input_fieldEntry: sText = {\r\n            ...borderProps_input,\r\n            marginBottom: sizes.rowGap,\r\n            marginRight: sizes.rowGap,\r\n            padding: sizes.textPadding,\r\n            color: colors.text,\r\n            fontSize: sizes.fontSize_input,\r\n            fontWeight: font.fontWeight_normal,\r\n            lineHeight: sizes.lineHeight,\r\n            minWidth: sizes.minWidth_input,\r\n        },\r\n        button_fieldInline: sTextView = {\r\n            ...borderProps,\r\n            // marginLeft: sizes.elementGap,\r\n            marginBottom: sizes.rowGap,\r\n            marginRight: sizes.rowGap,\r\n            padding: sizes.textPadding,\r\n            background: colors.background_button,\r\n            color: colors.text_button,\r\n            fontSize: sizes.fontSize_button,\r\n            fontWeight: font.fontWeight_button,\r\n            lineHeight: sizes.lineHeight,\r\n            display: `flex`,\r\n            minWidth: sizes.minWidth_button,\r\n        },\r\n        button_fieldInline_alt: sTextView = {\r\n            ...sTextView,\r\n            background: colors.text_button,\r\n            color: colors.background_button,\r\n            borderColor: colors.background_button,\r\n        },\r\n        view_formActionRow: sView = {\r\n            display: `flex`,\r\n            flexDirection: `row`,\r\n            justifyContent: `flex-end`,\r\n            marginBottom: sizes.elementGap,\r\n        },\r\n        button_formAction: sTextView = {\r\n            ...borderProps,\r\n            marginLeft: sizes.elementGap,\r\n            padding: sizes.textPadding,\r\n            background: colors.background_button,\r\n            color: colors.text_button,\r\n            fontSize: sizes.fontSize_button,\r\n            fontWeight: font.fontWeight_button,\r\n            lineHeight: sizes.lineHeight,\r\n            minWidth: sizes.minWidth_button,\r\n        },\r\n        button_formAction_alt: sTextView = {\r\n            ...sTextView,\r\n            background: colors.text_button,\r\n            color: colors.background_button,\r\n            borderColor: colors.background_button,\r\n        },\r\n\r\n        view_error: sView = {\r\n            ...borderProps,\r\n            marginBottom: sizes.sectionGap,\r\n            padding: sizes.rowPadding,\r\n            background: colors.background_error,\r\n        },\r\n        text_error: sText = {\r\n            padding: sizes.textPadding,\r\n            color: colors.text_error,\r\n            fontSize: sizes.fontSize,\r\n            fontFamily: font.fontFamily,\r\n            fontWeight: font.fontWeight_button,\r\n        },\r\n        text_errorMessage: sText = {\r\n            padding: sizes.textPadding,\r\n            color: colors.text_errorMessage,\r\n            fontSize: sizes.fontSize,\r\n            fontFamily: font.fontFamily,\r\n            fontWeight: font.fontWeight_button,\r\n        },\r\n\r\n        icon: sIcon = {\r\n            size: sizes.icon,\r\n            color: colors.icon,\r\n            outlineColor: colors.outline,\r\n        },\r\n        icon_errorMessage: sIcon = {\r\n            size: sizes.icon,\r\n            color: colors.text_errorMessage,\r\n            outlineColor: colors.outline,\r\n        },\r\n    } as const;\r\n\r\n    return theme;\r\n};\r\n\r\nexport const purpleColors = {\r\n    purple: `#863d8f`,\r\n    purpleLite: `#a75da7`,\r\n    purpleBackgroundLite: `#ddbfdd`,\r\n    blue: `#3baccf`,\r\n    gray: `#656364`,\r\n    lightGray: `#f8f6f7`,\r\n    lightBackgroundGray: `#e8e6e7`,\r\n    borderGray: `#d7c7d7`,\r\n    headerWhite: `#ffffff`,\r\n    headerGray: `#cecece`,\r\n    menuWhite: `#ffffff`,\r\n    bodyWhite: `#ffffff`,\r\n    buttonGray: `#a0a1a5`,\r\n    buttonWhite: `#e2e3e9`,\r\n    headingGray: `#f8f6f7`,\r\n    cardLightGray: `#f8f8f8`,\r\n    textWhite: `#ffffff`,\r\n    textBlack: `#2b2b2b`,\r\n    textGray: `#696768`,\r\n\r\n    // New Colors\r\n    warnRed: `#C56364`,\r\n    errorRed: `#C56364`,\r\n    deleteRed: `#C56364`,\r\n    changedYellow: `#F5F5C5`,\r\n};\r\n\r\nexport const purpleThemeColors: typeof basicThemeColors = {\r\n    ...basicThemeColors,\r\n    text: `#2b2b2b`,\r\n    text_header: `#863d8f`,\r\n    text_button: `#ffffff`,\r\n    // text_error: `#ffffff`,\r\n    border: `#863d8f`,\r\n    border_minor: `#863d8f`,\r\n    // border_minor: `#aaaaaa`,\r\n    border_input: `#aaaaaa`,\r\n    background: `#ffffff`,\r\n    background_field: `#dddddd`,\r\n    background_button: `#863d8f`,\r\n    // background_error: `#C56364`,\r\n    loader: `#863d8f`,\r\n    icon: `#863d8f`,\r\n};\r\n\r\nexport const purpleSizes: typeof basicThemeSizes = {\r\n    ...basicThemeSizes,\r\n    borderWidth: { all: 1, bottom: 4 },\r\n    borderWidth_minor: { all: 0, bottom: 1 },\r\n};\r\n\r\nexport const vscodeThemeColors = {\r\n    colors: {\r\n        text: `#569CD6`,\r\n        border: `#6796E6`,\r\n        background: `#1e1e1e`,\r\n        background_field: `#2e2e2e`,\r\n    },\r\n};\r\n\r\n// eslint-disable-next-line import/no-mutable-exports\r\nexport let theme = createTheme(basicThemeColors, basicThemeSizes, basicFont);\r\n// eslint-disable-next-line import/no-mutable-exports\r\n// export let theme = createTheme(purpleThemeColors, purpleSizes, basicFont);\r\n\r\nexport const setTheme = (colors: ThemeColors, sizes: ThemeSizes, font: ThemeFont) => {\r\n    theme = createTheme(purpleThemeColors, basicThemeSizes, basicFont);\r\n};\r\n","/* eslint-disable unicorn/filename-case */\r\n\r\n// WebGl Context ---\r\nexport function getWebGLSystem(canvas: HTMLCanvasElement): null | {\r\n    gl: WebGL2RenderingContext | WebGLRenderingContext;\r\n    ext: {\r\n        formatRGBA: SupportedFormat;\r\n        formatRG: SupportedFormat;\r\n        formatR: SupportedFormat;\r\n        halfFloatTexType: number;\r\n        supportLinearFiltering: null | OES_texture_float_linear | OES_texture_half_float_linear;\r\n    };\r\n} {\r\n    const params = { alpha: true, depth: false, stencil: false, antialias: false, preserveDrawingBuffer: false };\r\n\r\n    const gl2 = canvas.getContext(`webgl2`, params) as null | WebGL2RenderingContext;\r\n    if (gl2) {\r\n        const gl = gl2;\r\n        gl.getExtension(`EXT_color_buffer_float`);\r\n        const supportLinearFiltering = gl.getExtension(`OES_texture_float_linear`);\r\n        const halfFloatTexType = gl.HALF_FLOAT;\r\n        gl.clearColor(0, 0, 0, 1);\r\n\r\n        // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\r\n        const formatRGBA = getSupportedFormat(gl, gl.RGBA16F, gl.RGBA, halfFloatTexType);\r\n        const formatRG = getSupportedFormat(gl, gl.RG16F, gl.RG, halfFloatTexType);\r\n        const formatR = getSupportedFormat(gl, gl.R16F, gl.RED, halfFloatTexType);\r\n\r\n        return {\r\n            gl,\r\n            ext: {\r\n                formatRGBA,\r\n                formatRG,\r\n                formatR,\r\n                halfFloatTexType,\r\n                supportLinearFiltering,\r\n            },\r\n        };\r\n    }\r\n\r\n    const gl1 = (canvas.getContext(`webgl`, params) || canvas.getContext(`experimental-webgl`, params)) as null | WebGLRenderingContext;\r\n    if (!gl1) { return null; }\r\n\r\n    const gl = gl1;\r\n\r\n    const halfFloat = gl.getExtension(`OES_texture_half_float`) as OES_texture_half_float;\r\n    const supportLinearFiltering = gl.getExtension(`OES_texture_half_float_linear`);\r\n\r\n    gl.clearColor(0, 0, 0, 1);\r\n\r\n    const halfFloatTexType = halfFloat.HALF_FLOAT_OES;\r\n    // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\r\n    const formatRGBA = getSupportedFormat(gl, gl.RGBA, gl.RGBA, halfFloatTexType);\r\n    const formatRG = getSupportedFormat(gl, gl.RGBA, gl.RGBA, halfFloatTexType);\r\n    const formatR = getSupportedFormat(gl, gl.RGBA, gl.RGBA, halfFloatTexType);\r\n\r\n    return {\r\n        gl,\r\n        ext: {\r\n            formatRGBA,\r\n            formatRG,\r\n            formatR,\r\n            halfFloatTexType,\r\n            supportLinearFiltering,\r\n        },\r\n    };\r\n}\r\nexport type WebGlSystem = NonNullable<ReturnType<typeof getWebGLSystem>>;\r\n\r\ntype SupportedFormat = {\r\n    internalFormat: number;\r\n    format: number;\r\n};\r\nfunction getSupportedFormat(gl: WebGL2RenderingContext | WebGLRenderingContext, internalFormat: number, format: number, type: number): SupportedFormat {\r\n    if (!supportRenderTextureFormat(gl, internalFormat, format, type)) {\r\n        const gl2 = gl as WebGL2RenderingContext;\r\n        switch (internalFormat) {\r\n            case gl2.R16F:\r\n                return getSupportedFormat(gl, gl2.RG16F, gl2.RG, type);\r\n            case gl2.RG16F:\r\n                return getSupportedFormat(gl, gl2.RGBA16F, gl2.RGBA, type);\r\n            default:\r\n                throw new Error(`Unknown Render Format`);\r\n            // return null;\r\n        }\r\n    }\r\n\r\n    return {\r\n        internalFormat,\r\n        format,\r\n    };\r\n}\r\n\r\nfunction supportRenderTextureFormat(gl: WebGL2RenderingContext | WebGLRenderingContext, internalFormat: number, format: number, type: number) {\r\n    const texture = gl.createTexture();\r\n    gl.bindTexture(gl.TEXTURE_2D, texture);\r\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.NEAREST);\r\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.NEAREST);\r\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\r\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\r\n    gl.texImage2D(gl.TEXTURE_2D, 0, internalFormat, 4, 4, 0, format, type, null);\r\n\r\n    const fbo = gl.createFramebuffer();\r\n    gl.bindFramebuffer(gl.FRAMEBUFFER, fbo);\r\n    gl.framebufferTexture2D(gl.FRAMEBUFFER, gl.COLOR_ATTACHMENT0, gl.TEXTURE_2D, texture, 0);\r\n\r\n    const status = gl.checkFramebufferStatus(gl.FRAMEBUFFER);\r\n    return status === gl.FRAMEBUFFER_COMPLETE;\r\n}\r\n","/**\n * dat-gui JavaScript Controller Library\n * http://code.google.com/p/dat-gui\n *\n * Copyright 2011 Data Arts Team, Google Creative Lab\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n */\nfunction ___$insertStyle(css) {\n  if (!css) {\n    return;\n  }\n\n  if (typeof window === 'undefined') {\n    return;\n  }\n\n  var style = document.createElement('style');\n  style.setAttribute('type', 'text/css');\n  style.innerHTML = css;\n  document.head.appendChild(style);\n  return css;\n}\n\nfunction colorToString(color, forceCSSHex) {\n  var colorFormat = color.__state.conversionName.toString();\n\n  var r = Math.round(color.r);\n  var g = Math.round(color.g);\n  var b = Math.round(color.b);\n  var a = color.a;\n  var h = Math.round(color.h);\n  var s = color.s.toFixed(1);\n  var v = color.v.toFixed(1);\n\n  if (forceCSSHex || colorFormat === 'THREE_CHAR_HEX' || colorFormat === 'SIX_CHAR_HEX') {\n    var str = color.hex.toString(16);\n\n    while (str.length < 6) {\n      str = '0' + str;\n    }\n\n    return '#' + str;\n  } else if (colorFormat === 'CSS_RGB') {\n    return 'rgb(' + r + ',' + g + ',' + b + ')';\n  } else if (colorFormat === 'CSS_RGBA') {\n    return 'rgba(' + r + ',' + g + ',' + b + ',' + a + ')';\n  } else if (colorFormat === 'HEX') {\n    return '0x' + color.hex.toString(16);\n  } else if (colorFormat === 'RGB_ARRAY') {\n    return '[' + r + ',' + g + ',' + b + ']';\n  } else if (colorFormat === 'RGBA_ARRAY') {\n    return '[' + r + ',' + g + ',' + b + ',' + a + ']';\n  } else if (colorFormat === 'RGB_OBJ') {\n    return '{r:' + r + ',g:' + g + ',b:' + b + '}';\n  } else if (colorFormat === 'RGBA_OBJ') {\n    return '{r:' + r + ',g:' + g + ',b:' + b + ',a:' + a + '}';\n  } else if (colorFormat === 'HSV_OBJ') {\n    return '{h:' + h + ',s:' + s + ',v:' + v + '}';\n  } else if (colorFormat === 'HSVA_OBJ') {\n    return '{h:' + h + ',s:' + s + ',v:' + v + ',a:' + a + '}';\n  }\n\n  return 'unknown format';\n}\n\nvar ARR_EACH = Array.prototype.forEach;\nvar ARR_SLICE = Array.prototype.slice;\nvar Common = {\n  BREAK: {},\n  extend: function extend(target) {\n    this.each(ARR_SLICE.call(arguments, 1), function (obj) {\n      var keys = this.isObject(obj) ? Object.keys(obj) : [];\n      keys.forEach(function (key) {\n        if (!this.isUndefined(obj[key])) {\n          target[key] = obj[key];\n        }\n      }.bind(this));\n    }, this);\n    return target;\n  },\n  defaults: function defaults(target) {\n    this.each(ARR_SLICE.call(arguments, 1), function (obj) {\n      var keys = this.isObject(obj) ? Object.keys(obj) : [];\n      keys.forEach(function (key) {\n        if (this.isUndefined(target[key])) {\n          target[key] = obj[key];\n        }\n      }.bind(this));\n    }, this);\n    return target;\n  },\n  compose: function compose() {\n    var toCall = ARR_SLICE.call(arguments);\n    return function () {\n      var args = ARR_SLICE.call(arguments);\n\n      for (var i = toCall.length - 1; i >= 0; i--) {\n        args = [toCall[i].apply(this, args)];\n      }\n\n      return args[0];\n    };\n  },\n  each: function each(obj, itr, scope) {\n    if (!obj) {\n      return;\n    }\n\n    if (ARR_EACH && obj.forEach && obj.forEach === ARR_EACH) {\n      obj.forEach(itr, scope);\n    } else if (obj.length === obj.length + 0) {\n      var key = void 0;\n      var l = void 0;\n\n      for (key = 0, l = obj.length; key < l; key++) {\n        if (key in obj && itr.call(scope, obj[key], key) === this.BREAK) {\n          return;\n        }\n      }\n    } else {\n      for (var _key in obj) {\n        if (itr.call(scope, obj[_key], _key) === this.BREAK) {\n          return;\n        }\n      }\n    }\n  },\n  defer: function defer(fnc) {\n    setTimeout(fnc, 0);\n  },\n  debounce: function debounce(func, threshold, callImmediately) {\n    var timeout = void 0;\n    return function () {\n      var obj = this;\n      var args = arguments;\n\n      function delayed() {\n        timeout = null;\n        if (!callImmediately) func.apply(obj, args);\n      }\n\n      var callNow = callImmediately || !timeout;\n      clearTimeout(timeout);\n      timeout = setTimeout(delayed, threshold);\n\n      if (callNow) {\n        func.apply(obj, args);\n      }\n    };\n  },\n  toArray: function toArray(obj) {\n    if (obj.toArray) return obj.toArray();\n    return ARR_SLICE.call(obj);\n  },\n  isUndefined: function isUndefined(obj) {\n    return obj === undefined;\n  },\n  isNull: function isNull(obj) {\n    return obj === null;\n  },\n  isNaN: function (_isNaN) {\n    function isNaN(_x) {\n      return _isNaN.apply(this, arguments);\n    }\n\n    isNaN.toString = function () {\n      return _isNaN.toString();\n    };\n\n    return isNaN;\n  }(function (obj) {\n    return isNaN(obj);\n  }),\n  isArray: Array.isArray || function (obj) {\n    return obj.constructor === Array;\n  },\n  isObject: function isObject(obj) {\n    return obj === Object(obj);\n  },\n  isNumber: function isNumber(obj) {\n    return obj === obj + 0;\n  },\n  isString: function isString(obj) {\n    return obj === obj + '';\n  },\n  isBoolean: function isBoolean(obj) {\n    return obj === false || obj === true;\n  },\n  isFunction: function isFunction(obj) {\n    return obj instanceof Function;\n  }\n};\nvar INTERPRETATIONS = [{\n  litmus: Common.isString,\n  conversions: {\n    THREE_CHAR_HEX: {\n      read: function read(original) {\n        var test = original.match(/^#([A-F0-9])([A-F0-9])([A-F0-9])$/i);\n\n        if (test === null) {\n          return false;\n        }\n\n        return {\n          space: 'HEX',\n          hex: parseInt('0x' + test[1].toString() + test[1].toString() + test[2].toString() + test[2].toString() + test[3].toString() + test[3].toString(), 0)\n        };\n      },\n      write: colorToString\n    },\n    SIX_CHAR_HEX: {\n      read: function read(original) {\n        var test = original.match(/^#([A-F0-9]{6})$/i);\n\n        if (test === null) {\n          return false;\n        }\n\n        return {\n          space: 'HEX',\n          hex: parseInt('0x' + test[1].toString(), 0)\n        };\n      },\n      write: colorToString\n    },\n    CSS_RGB: {\n      read: function read(original) {\n        var test = original.match(/^rgb\\(\\s*(.+)\\s*,\\s*(.+)\\s*,\\s*(.+)\\s*\\)/);\n\n        if (test === null) {\n          return false;\n        }\n\n        return {\n          space: 'RGB',\n          r: parseFloat(test[1]),\n          g: parseFloat(test[2]),\n          b: parseFloat(test[3])\n        };\n      },\n      write: colorToString\n    },\n    CSS_RGBA: {\n      read: function read(original) {\n        var test = original.match(/^rgba\\(\\s*(.+)\\s*,\\s*(.+)\\s*,\\s*(.+)\\s*,\\s*(.+)\\s*\\)/);\n\n        if (test === null) {\n          return false;\n        }\n\n        return {\n          space: 'RGB',\n          r: parseFloat(test[1]),\n          g: parseFloat(test[2]),\n          b: parseFloat(test[3]),\n          a: parseFloat(test[4])\n        };\n      },\n      write: colorToString\n    }\n  }\n}, {\n  litmus: Common.isNumber,\n  conversions: {\n    HEX: {\n      read: function read(original) {\n        return {\n          space: 'HEX',\n          hex: original,\n          conversionName: 'HEX'\n        };\n      },\n      write: function write(color) {\n        return color.hex;\n      }\n    }\n  }\n}, {\n  litmus: Common.isArray,\n  conversions: {\n    RGB_ARRAY: {\n      read: function read(original) {\n        if (original.length !== 3) {\n          return false;\n        }\n\n        return {\n          space: 'RGB',\n          r: original[0],\n          g: original[1],\n          b: original[2]\n        };\n      },\n      write: function write(color) {\n        return [color.r, color.g, color.b];\n      }\n    },\n    RGBA_ARRAY: {\n      read: function read(original) {\n        if (original.length !== 4) return false;\n        return {\n          space: 'RGB',\n          r: original[0],\n          g: original[1],\n          b: original[2],\n          a: original[3]\n        };\n      },\n      write: function write(color) {\n        return [color.r, color.g, color.b, color.a];\n      }\n    }\n  }\n}, {\n  litmus: Common.isObject,\n  conversions: {\n    RGBA_OBJ: {\n      read: function read(original) {\n        if (Common.isNumber(original.r) && Common.isNumber(original.g) && Common.isNumber(original.b) && Common.isNumber(original.a)) {\n          return {\n            space: 'RGB',\n            r: original.r,\n            g: original.g,\n            b: original.b,\n            a: original.a\n          };\n        }\n\n        return false;\n      },\n      write: function write(color) {\n        return {\n          r: color.r,\n          g: color.g,\n          b: color.b,\n          a: color.a\n        };\n      }\n    },\n    RGB_OBJ: {\n      read: function read(original) {\n        if (Common.isNumber(original.r) && Common.isNumber(original.g) && Common.isNumber(original.b)) {\n          return {\n            space: 'RGB',\n            r: original.r,\n            g: original.g,\n            b: original.b\n          };\n        }\n\n        return false;\n      },\n      write: function write(color) {\n        return {\n          r: color.r,\n          g: color.g,\n          b: color.b\n        };\n      }\n    },\n    HSVA_OBJ: {\n      read: function read(original) {\n        if (Common.isNumber(original.h) && Common.isNumber(original.s) && Common.isNumber(original.v) && Common.isNumber(original.a)) {\n          return {\n            space: 'HSV',\n            h: original.h,\n            s: original.s,\n            v: original.v,\n            a: original.a\n          };\n        }\n\n        return false;\n      },\n      write: function write(color) {\n        return {\n          h: color.h,\n          s: color.s,\n          v: color.v,\n          a: color.a\n        };\n      }\n    },\n    HSV_OBJ: {\n      read: function read(original) {\n        if (Common.isNumber(original.h) && Common.isNumber(original.s) && Common.isNumber(original.v)) {\n          return {\n            space: 'HSV',\n            h: original.h,\n            s: original.s,\n            v: original.v\n          };\n        }\n\n        return false;\n      },\n      write: function write(color) {\n        return {\n          h: color.h,\n          s: color.s,\n          v: color.v\n        };\n      }\n    }\n  }\n}];\nvar result = void 0;\nvar toReturn = void 0;\n\nvar interpret = function interpret() {\n  toReturn = false;\n  var original = arguments.length > 1 ? Common.toArray(arguments) : arguments[0];\n  Common.each(INTERPRETATIONS, function (family) {\n    if (family.litmus(original)) {\n      Common.each(family.conversions, function (conversion, conversionName) {\n        result = conversion.read(original);\n\n        if (toReturn === false && result !== false) {\n          toReturn = result;\n          result.conversionName = conversionName;\n          result.conversion = conversion;\n          return Common.BREAK;\n        }\n      });\n      return Common.BREAK;\n    }\n  });\n  return toReturn;\n};\n\nvar tmpComponent = void 0;\nvar ColorMath = {\n  hsv_to_rgb: function hsv_to_rgb(h, s, v) {\n    var hi = Math.floor(h / 60) % 6;\n    var f = h / 60 - Math.floor(h / 60);\n    var p = v * (1.0 - s);\n    var q = v * (1.0 - f * s);\n    var t = v * (1.0 - (1.0 - f) * s);\n    var c = [[v, t, p], [q, v, p], [p, v, t], [p, q, v], [t, p, v], [v, p, q]][hi];\n    return {\n      r: c[0] * 255,\n      g: c[1] * 255,\n      b: c[2] * 255\n    };\n  },\n  rgb_to_hsv: function rgb_to_hsv(r, g, b) {\n    var min = Math.min(r, g, b);\n    var max = Math.max(r, g, b);\n    var delta = max - min;\n    var h = void 0;\n    var s = void 0;\n\n    if (max !== 0) {\n      s = delta / max;\n    } else {\n      return {\n        h: NaN,\n        s: 0,\n        v: 0\n      };\n    }\n\n    if (r === max) {\n      h = (g - b) / delta;\n    } else if (g === max) {\n      h = 2 + (b - r) / delta;\n    } else {\n      h = 4 + (r - g) / delta;\n    }\n\n    h /= 6;\n\n    if (h < 0) {\n      h += 1;\n    }\n\n    return {\n      h: h * 360,\n      s: s,\n      v: max / 255\n    };\n  },\n  rgb_to_hex: function rgb_to_hex(r, g, b) {\n    var hex = this.hex_with_component(0, 2, r);\n    hex = this.hex_with_component(hex, 1, g);\n    hex = this.hex_with_component(hex, 0, b);\n    return hex;\n  },\n  component_from_hex: function component_from_hex(hex, componentIndex) {\n    return hex >> componentIndex * 8 & 0xFF;\n  },\n  hex_with_component: function hex_with_component(hex, componentIndex, value) {\n    return value << (tmpComponent = componentIndex * 8) | hex & ~(0xFF << tmpComponent);\n  }\n};\n\nvar _typeof = typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\" ? function (obj) {\n  return typeof obj;\n} : function (obj) {\n  return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj;\n};\n\nvar classCallCheck = function classCallCheck(instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n};\n\nvar createClass = function () {\n  function defineProperties(target, props) {\n    for (var i = 0; i < props.length; i++) {\n      var descriptor = props[i];\n      descriptor.enumerable = descriptor.enumerable || false;\n      descriptor.configurable = true;\n      if (\"value\" in descriptor) descriptor.writable = true;\n      Object.defineProperty(target, descriptor.key, descriptor);\n    }\n  }\n\n  return function (Constructor, protoProps, staticProps) {\n    if (protoProps) defineProperties(Constructor.prototype, protoProps);\n    if (staticProps) defineProperties(Constructor, staticProps);\n    return Constructor;\n  };\n}();\n\nvar get = function get(object, property, receiver) {\n  if (object === null) object = Function.prototype;\n  var desc = Object.getOwnPropertyDescriptor(object, property);\n\n  if (desc === undefined) {\n    var parent = Object.getPrototypeOf(object);\n\n    if (parent === null) {\n      return undefined;\n    } else {\n      return get(parent, property, receiver);\n    }\n  } else if (\"value\" in desc) {\n    return desc.value;\n  } else {\n    var getter = desc.get;\n\n    if (getter === undefined) {\n      return undefined;\n    }\n\n    return getter.call(receiver);\n  }\n};\n\nvar inherits = function inherits(subClass, superClass) {\n  if (typeof superClass !== \"function\" && superClass !== null) {\n    throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass);\n  }\n\n  subClass.prototype = Object.create(superClass && superClass.prototype, {\n    constructor: {\n      value: subClass,\n      enumerable: false,\n      writable: true,\n      configurable: true\n    }\n  });\n  if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass;\n};\n\nvar possibleConstructorReturn = function possibleConstructorReturn(self, call) {\n  if (!self) {\n    throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");\n  }\n\n  return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self;\n};\n\nvar Color = function () {\n  function Color() {\n    classCallCheck(this, Color);\n    this.__state = interpret.apply(this, arguments);\n\n    if (this.__state === false) {\n      throw new Error('Failed to interpret color arguments');\n    }\n\n    this.__state.a = this.__state.a || 1;\n  }\n\n  createClass(Color, [{\n    key: 'toString',\n    value: function toString() {\n      return colorToString(this);\n    }\n  }, {\n    key: 'toHexString',\n    value: function toHexString() {\n      return colorToString(this, true);\n    }\n  }, {\n    key: 'toOriginal',\n    value: function toOriginal() {\n      return this.__state.conversion.write(this);\n    }\n  }]);\n  return Color;\n}();\n\nfunction defineRGBComponent(target, component, componentHexIndex) {\n  Object.defineProperty(target, component, {\n    get: function get$$1() {\n      if (this.__state.space === 'RGB') {\n        return this.__state[component];\n      }\n\n      Color.recalculateRGB(this, component, componentHexIndex);\n      return this.__state[component];\n    },\n    set: function set$$1(v) {\n      if (this.__state.space !== 'RGB') {\n        Color.recalculateRGB(this, component, componentHexIndex);\n        this.__state.space = 'RGB';\n      }\n\n      this.__state[component] = v;\n    }\n  });\n}\n\nfunction defineHSVComponent(target, component) {\n  Object.defineProperty(target, component, {\n    get: function get$$1() {\n      if (this.__state.space === 'HSV') {\n        return this.__state[component];\n      }\n\n      Color.recalculateHSV(this);\n      return this.__state[component];\n    },\n    set: function set$$1(v) {\n      if (this.__state.space !== 'HSV') {\n        Color.recalculateHSV(this);\n        this.__state.space = 'HSV';\n      }\n\n      this.__state[component] = v;\n    }\n  });\n}\n\nColor.recalculateRGB = function (color, component, componentHexIndex) {\n  if (color.__state.space === 'HEX') {\n    color.__state[component] = ColorMath.component_from_hex(color.__state.hex, componentHexIndex);\n  } else if (color.__state.space === 'HSV') {\n    Common.extend(color.__state, ColorMath.hsv_to_rgb(color.__state.h, color.__state.s, color.__state.v));\n  } else {\n    throw new Error('Corrupted color state');\n  }\n};\n\nColor.recalculateHSV = function (color) {\n  var result = ColorMath.rgb_to_hsv(color.r, color.g, color.b);\n  Common.extend(color.__state, {\n    s: result.s,\n    v: result.v\n  });\n\n  if (!Common.isNaN(result.h)) {\n    color.__state.h = result.h;\n  } else if (Common.isUndefined(color.__state.h)) {\n    color.__state.h = 0;\n  }\n};\n\nColor.COMPONENTS = ['r', 'g', 'b', 'h', 's', 'v', 'hex', 'a'];\ndefineRGBComponent(Color.prototype, 'r', 2);\ndefineRGBComponent(Color.prototype, 'g', 1);\ndefineRGBComponent(Color.prototype, 'b', 0);\ndefineHSVComponent(Color.prototype, 'h');\ndefineHSVComponent(Color.prototype, 's');\ndefineHSVComponent(Color.prototype, 'v');\nObject.defineProperty(Color.prototype, 'a', {\n  get: function get$$1() {\n    return this.__state.a;\n  },\n  set: function set$$1(v) {\n    this.__state.a = v;\n  }\n});\nObject.defineProperty(Color.prototype, 'hex', {\n  get: function get$$1() {\n    if (this.__state.space !== 'HEX') {\n      this.__state.hex = ColorMath.rgb_to_hex(this.r, this.g, this.b);\n      this.__state.space = 'HEX';\n    }\n\n    return this.__state.hex;\n  },\n  set: function set$$1(v) {\n    this.__state.space = 'HEX';\n    this.__state.hex = v;\n  }\n});\n\nvar Controller = function () {\n  function Controller(object, property) {\n    classCallCheck(this, Controller);\n    this.initialValue = object[property];\n    this.domElement = document.createElement('div');\n    this.object = object;\n    this.property = property;\n    this.__onChange = undefined;\n    this.__onFinishChange = undefined;\n  }\n\n  createClass(Controller, [{\n    key: 'onChange',\n    value: function onChange(fnc) {\n      this.__onChange = fnc;\n      return this;\n    }\n  }, {\n    key: 'onFinishChange',\n    value: function onFinishChange(fnc) {\n      this.__onFinishChange = fnc;\n      return this;\n    }\n  }, {\n    key: 'setValue',\n    value: function setValue(newValue) {\n      this.object[this.property] = newValue;\n\n      if (this.__onChange) {\n        this.__onChange.call(this, newValue);\n      }\n\n      this.updateDisplay();\n      return this;\n    }\n  }, {\n    key: 'getValue',\n    value: function getValue() {\n      return this.object[this.property];\n    }\n  }, {\n    key: 'updateDisplay',\n    value: function updateDisplay() {\n      return this;\n    }\n  }, {\n    key: 'isModified',\n    value: function isModified() {\n      return this.initialValue !== this.getValue();\n    }\n  }]);\n  return Controller;\n}();\n\nvar EVENT_MAP = {\n  HTMLEvents: ['change'],\n  MouseEvents: ['click', 'mousemove', 'mousedown', 'mouseup', 'mouseover'],\n  KeyboardEvents: ['keydown']\n};\nvar EVENT_MAP_INV = {};\nCommon.each(EVENT_MAP, function (v, k) {\n  Common.each(v, function (e) {\n    EVENT_MAP_INV[e] = k;\n  });\n});\nvar CSS_VALUE_PIXELS = /(\\d+(\\.\\d+)?)px/;\n\nfunction cssValueToPixels(val) {\n  if (val === '0' || Common.isUndefined(val)) {\n    return 0;\n  }\n\n  var match = val.match(CSS_VALUE_PIXELS);\n\n  if (!Common.isNull(match)) {\n    return parseFloat(match[1]);\n  }\n\n  return 0;\n}\n\nvar dom = {\n  makeSelectable: function makeSelectable(elem, selectable) {\n    if (elem === undefined || elem.style === undefined) return;\n    elem.onselectstart = selectable ? function () {\n      return false;\n    } : function () {};\n    elem.style.MozUserSelect = selectable ? 'auto' : 'none';\n    elem.style.KhtmlUserSelect = selectable ? 'auto' : 'none';\n    elem.unselectable = selectable ? 'on' : 'off';\n  },\n  makeFullscreen: function makeFullscreen(elem, hor, vert) {\n    var vertical = vert;\n    var horizontal = hor;\n\n    if (Common.isUndefined(horizontal)) {\n      horizontal = true;\n    }\n\n    if (Common.isUndefined(vertical)) {\n      vertical = true;\n    }\n\n    elem.style.position = 'absolute';\n\n    if (horizontal) {\n      elem.style.left = 0;\n      elem.style.right = 0;\n    }\n\n    if (vertical) {\n      elem.style.top = 0;\n      elem.style.bottom = 0;\n    }\n  },\n  fakeEvent: function fakeEvent(elem, eventType, pars, aux) {\n    var params = pars || {};\n    var className = EVENT_MAP_INV[eventType];\n\n    if (!className) {\n      throw new Error('Event type ' + eventType + ' not supported.');\n    }\n\n    var evt = document.createEvent(className);\n\n    switch (className) {\n      case 'MouseEvents':\n        {\n          var clientX = params.x || params.clientX || 0;\n          var clientY = params.y || params.clientY || 0;\n          evt.initMouseEvent(eventType, params.bubbles || false, params.cancelable || true, window, params.clickCount || 1, 0, 0, clientX, clientY, false, false, false, false, 0, null);\n          break;\n        }\n\n      case 'KeyboardEvents':\n        {\n          var init = evt.initKeyboardEvent || evt.initKeyEvent;\n          Common.defaults(params, {\n            cancelable: true,\n            ctrlKey: false,\n            altKey: false,\n            shiftKey: false,\n            metaKey: false,\n            keyCode: undefined,\n            charCode: undefined\n          });\n          init(eventType, params.bubbles || false, params.cancelable, window, params.ctrlKey, params.altKey, params.shiftKey, params.metaKey, params.keyCode, params.charCode);\n          break;\n        }\n\n      default:\n        {\n          evt.initEvent(eventType, params.bubbles || false, params.cancelable || true);\n          break;\n        }\n    }\n\n    Common.defaults(evt, aux);\n    elem.dispatchEvent(evt);\n  },\n  bind: function bind(elem, event, func, newBool) {\n    var bool = newBool || false;\n\n    if (elem.addEventListener) {\n      elem.addEventListener(event, func, bool);\n    } else if (elem.attachEvent) {\n      elem.attachEvent('on' + event, func);\n    }\n\n    return dom;\n  },\n  unbind: function unbind(elem, event, func, newBool) {\n    var bool = newBool || false;\n\n    if (elem.removeEventListener) {\n      elem.removeEventListener(event, func, bool);\n    } else if (elem.detachEvent) {\n      elem.detachEvent('on' + event, func);\n    }\n\n    return dom;\n  },\n  addClass: function addClass(elem, className) {\n    if (elem.className === undefined) {\n      elem.className = className;\n    } else if (elem.className !== className) {\n      var classes = elem.className.split(/ +/);\n\n      if (classes.indexOf(className) === -1) {\n        classes.push(className);\n        elem.className = classes.join(' ').replace(/^\\s+/, '').replace(/\\s+$/, '');\n      }\n    }\n\n    return dom;\n  },\n  removeClass: function removeClass(elem, className) {\n    if (className) {\n      if (elem.className === className) {\n        elem.removeAttribute('class');\n      } else {\n        var classes = elem.className.split(/ +/);\n        var index = classes.indexOf(className);\n\n        if (index !== -1) {\n          classes.splice(index, 1);\n          elem.className = classes.join(' ');\n        }\n      }\n    } else {\n      elem.className = undefined;\n    }\n\n    return dom;\n  },\n  hasClass: function hasClass(elem, className) {\n    return new RegExp('(?:^|\\\\s+)' + className + '(?:\\\\s+|$)').test(elem.className) || false;\n  },\n  getWidth: function getWidth(elem) {\n    var style = getComputedStyle(elem);\n    return cssValueToPixels(style['border-left-width']) + cssValueToPixels(style['border-right-width']) + cssValueToPixels(style['padding-left']) + cssValueToPixels(style['padding-right']) + cssValueToPixels(style.width);\n  },\n  getHeight: function getHeight(elem) {\n    var style = getComputedStyle(elem);\n    return cssValueToPixels(style['border-top-width']) + cssValueToPixels(style['border-bottom-width']) + cssValueToPixels(style['padding-top']) + cssValueToPixels(style['padding-bottom']) + cssValueToPixels(style.height);\n  },\n  getOffset: function getOffset(el) {\n    var elem = el;\n    var offset = {\n      left: 0,\n      top: 0\n    };\n\n    if (elem.offsetParent) {\n      do {\n        offset.left += elem.offsetLeft;\n        offset.top += elem.offsetTop;\n        elem = elem.offsetParent;\n      } while (elem);\n    }\n\n    return offset;\n  },\n  isActive: function isActive(elem) {\n    return elem === document.activeElement && (elem.type || elem.href);\n  }\n};\n\nvar BooleanController = function (_Controller) {\n  inherits(BooleanController, _Controller);\n\n  function BooleanController(object, property) {\n    classCallCheck(this, BooleanController);\n\n    var _this2 = possibleConstructorReturn(this, (BooleanController.__proto__ || Object.getPrototypeOf(BooleanController)).call(this, object, property));\n\n    var _this = _this2;\n    _this2.__prev = _this2.getValue();\n    _this2.__checkbox = document.createElement('input');\n\n    _this2.__checkbox.setAttribute('type', 'checkbox');\n\n    function onChange() {\n      _this.setValue(!_this.__prev);\n    }\n\n    dom.bind(_this2.__checkbox, 'change', onChange, false);\n\n    _this2.domElement.appendChild(_this2.__checkbox);\n\n    _this2.updateDisplay();\n\n    return _this2;\n  }\n\n  createClass(BooleanController, [{\n    key: 'setValue',\n    value: function setValue(v) {\n      var toReturn = get(BooleanController.prototype.__proto__ || Object.getPrototypeOf(BooleanController.prototype), 'setValue', this).call(this, v);\n\n      if (this.__onFinishChange) {\n        this.__onFinishChange.call(this, this.getValue());\n      }\n\n      this.__prev = this.getValue();\n      return toReturn;\n    }\n  }, {\n    key: 'updateDisplay',\n    value: function updateDisplay() {\n      if (this.getValue() === true) {\n        this.__checkbox.setAttribute('checked', 'checked');\n\n        this.__checkbox.checked = true;\n        this.__prev = true;\n      } else {\n        this.__checkbox.checked = false;\n        this.__prev = false;\n      }\n\n      return get(BooleanController.prototype.__proto__ || Object.getPrototypeOf(BooleanController.prototype), 'updateDisplay', this).call(this);\n    }\n  }]);\n  return BooleanController;\n}(Controller);\n\nvar OptionController = function (_Controller) {\n  inherits(OptionController, _Controller);\n\n  function OptionController(object, property, opts) {\n    classCallCheck(this, OptionController);\n\n    var _this2 = possibleConstructorReturn(this, (OptionController.__proto__ || Object.getPrototypeOf(OptionController)).call(this, object, property));\n\n    var options = opts;\n    var _this = _this2;\n    _this2.__select = document.createElement('select');\n\n    if (Common.isArray(options)) {\n      var map = {};\n      Common.each(options, function (element) {\n        map[element] = element;\n      });\n      options = map;\n    }\n\n    Common.each(options, function (value, key) {\n      var opt = document.createElement('option');\n      opt.innerHTML = key;\n      opt.setAttribute('value', value);\n\n      _this.__select.appendChild(opt);\n    });\n\n    _this2.updateDisplay();\n\n    dom.bind(_this2.__select, 'change', function () {\n      var desiredValue = this.options[this.selectedIndex].value;\n\n      _this.setValue(desiredValue);\n    });\n\n    _this2.domElement.appendChild(_this2.__select);\n\n    return _this2;\n  }\n\n  createClass(OptionController, [{\n    key: 'setValue',\n    value: function setValue(v) {\n      var toReturn = get(OptionController.prototype.__proto__ || Object.getPrototypeOf(OptionController.prototype), 'setValue', this).call(this, v);\n\n      if (this.__onFinishChange) {\n        this.__onFinishChange.call(this, this.getValue());\n      }\n\n      return toReturn;\n    }\n  }, {\n    key: 'updateDisplay',\n    value: function updateDisplay() {\n      if (dom.isActive(this.__select)) return this;\n      this.__select.value = this.getValue();\n      return get(OptionController.prototype.__proto__ || Object.getPrototypeOf(OptionController.prototype), 'updateDisplay', this).call(this);\n    }\n  }]);\n  return OptionController;\n}(Controller);\n\nvar StringController = function (_Controller) {\n  inherits(StringController, _Controller);\n\n  function StringController(object, property) {\n    classCallCheck(this, StringController);\n\n    var _this2 = possibleConstructorReturn(this, (StringController.__proto__ || Object.getPrototypeOf(StringController)).call(this, object, property));\n\n    var _this = _this2;\n\n    function onChange() {\n      _this.setValue(_this.__input.value);\n    }\n\n    function onBlur() {\n      if (_this.__onFinishChange) {\n        _this.__onFinishChange.call(_this, _this.getValue());\n      }\n    }\n\n    _this2.__input = document.createElement('input');\n\n    _this2.__input.setAttribute('type', 'text');\n\n    dom.bind(_this2.__input, 'keyup', onChange);\n    dom.bind(_this2.__input, 'change', onChange);\n    dom.bind(_this2.__input, 'blur', onBlur);\n    dom.bind(_this2.__input, 'keydown', function (e) {\n      if (e.keyCode === 13) {\n        this.blur();\n      }\n    });\n\n    _this2.updateDisplay();\n\n    _this2.domElement.appendChild(_this2.__input);\n\n    return _this2;\n  }\n\n  createClass(StringController, [{\n    key: 'updateDisplay',\n    value: function updateDisplay() {\n      if (!dom.isActive(this.__input)) {\n        this.__input.value = this.getValue();\n      }\n\n      return get(StringController.prototype.__proto__ || Object.getPrototypeOf(StringController.prototype), 'updateDisplay', this).call(this);\n    }\n  }]);\n  return StringController;\n}(Controller);\n\nfunction numDecimals(x) {\n  var _x = x.toString();\n\n  if (_x.indexOf('.') > -1) {\n    return _x.length - _x.indexOf('.') - 1;\n  }\n\n  return 0;\n}\n\nvar NumberController = function (_Controller) {\n  inherits(NumberController, _Controller);\n\n  function NumberController(object, property, params) {\n    classCallCheck(this, NumberController);\n\n    var _this = possibleConstructorReturn(this, (NumberController.__proto__ || Object.getPrototypeOf(NumberController)).call(this, object, property));\n\n    var _params = params || {};\n\n    _this.__min = _params.min;\n    _this.__max = _params.max;\n    _this.__step = _params.step;\n\n    if (Common.isUndefined(_this.__step)) {\n      if (_this.initialValue === 0) {\n        _this.__impliedStep = 1;\n      } else {\n        _this.__impliedStep = Math.pow(10, Math.floor(Math.log(Math.abs(_this.initialValue)) / Math.LN10)) / 10;\n      }\n    } else {\n      _this.__impliedStep = _this.__step;\n    }\n\n    _this.__precision = numDecimals(_this.__impliedStep);\n    return _this;\n  }\n\n  createClass(NumberController, [{\n    key: 'setValue',\n    value: function setValue(v) {\n      var _v = v;\n\n      if (this.__min !== undefined && _v < this.__min) {\n        _v = this.__min;\n      } else if (this.__max !== undefined && _v > this.__max) {\n        _v = this.__max;\n      }\n\n      if (this.__step !== undefined && _v % this.__step !== 0) {\n        _v = Math.round(_v / this.__step) * this.__step;\n      }\n\n      return get(NumberController.prototype.__proto__ || Object.getPrototypeOf(NumberController.prototype), 'setValue', this).call(this, _v);\n    }\n  }, {\n    key: 'min',\n    value: function min(minValue) {\n      this.__min = minValue;\n      return this;\n    }\n  }, {\n    key: 'max',\n    value: function max(maxValue) {\n      this.__max = maxValue;\n      return this;\n    }\n  }, {\n    key: 'step',\n    value: function step(stepValue) {\n      this.__step = stepValue;\n      this.__impliedStep = stepValue;\n      this.__precision = numDecimals(stepValue);\n      return this;\n    }\n  }]);\n  return NumberController;\n}(Controller);\n\nfunction roundToDecimal(value, decimals) {\n  var tenTo = Math.pow(10, decimals);\n  return Math.round(value * tenTo) / tenTo;\n}\n\nvar NumberControllerBox = function (_NumberController) {\n  inherits(NumberControllerBox, _NumberController);\n\n  function NumberControllerBox(object, property, params) {\n    classCallCheck(this, NumberControllerBox);\n\n    var _this2 = possibleConstructorReturn(this, (NumberControllerBox.__proto__ || Object.getPrototypeOf(NumberControllerBox)).call(this, object, property, params));\n\n    _this2.__truncationSuspended = false;\n    var _this = _this2;\n    var prevY = void 0;\n\n    function onChange() {\n      var attempted = parseFloat(_this.__input.value);\n\n      if (!Common.isNaN(attempted)) {\n        _this.setValue(attempted);\n      }\n    }\n\n    function onFinish() {\n      if (_this.__onFinishChange) {\n        _this.__onFinishChange.call(_this, _this.getValue());\n      }\n    }\n\n    function onBlur() {\n      onFinish();\n    }\n\n    function onMouseDrag(e) {\n      var diff = prevY - e.clientY;\n\n      _this.setValue(_this.getValue() + diff * _this.__impliedStep);\n\n      prevY = e.clientY;\n    }\n\n    function onMouseUp() {\n      dom.unbind(window, 'mousemove', onMouseDrag);\n      dom.unbind(window, 'mouseup', onMouseUp);\n      onFinish();\n    }\n\n    function onMouseDown(e) {\n      dom.bind(window, 'mousemove', onMouseDrag);\n      dom.bind(window, 'mouseup', onMouseUp);\n      prevY = e.clientY;\n    }\n\n    _this2.__input = document.createElement('input');\n\n    _this2.__input.setAttribute('type', 'text');\n\n    dom.bind(_this2.__input, 'change', onChange);\n    dom.bind(_this2.__input, 'blur', onBlur);\n    dom.bind(_this2.__input, 'mousedown', onMouseDown);\n    dom.bind(_this2.__input, 'keydown', function (e) {\n      if (e.keyCode === 13) {\n        _this.__truncationSuspended = true;\n        this.blur();\n        _this.__truncationSuspended = false;\n        onFinish();\n      }\n    });\n\n    _this2.updateDisplay();\n\n    _this2.domElement.appendChild(_this2.__input);\n\n    return _this2;\n  }\n\n  createClass(NumberControllerBox, [{\n    key: 'updateDisplay',\n    value: function updateDisplay() {\n      this.__input.value = this.__truncationSuspended ? this.getValue() : roundToDecimal(this.getValue(), this.__precision);\n      return get(NumberControllerBox.prototype.__proto__ || Object.getPrototypeOf(NumberControllerBox.prototype), 'updateDisplay', this).call(this);\n    }\n  }]);\n  return NumberControllerBox;\n}(NumberController);\n\nfunction map(v, i1, i2, o1, o2) {\n  return o1 + (o2 - o1) * ((v - i1) / (i2 - i1));\n}\n\nvar NumberControllerSlider = function (_NumberController) {\n  inherits(NumberControllerSlider, _NumberController);\n\n  function NumberControllerSlider(object, property, min, max, step) {\n    classCallCheck(this, NumberControllerSlider);\n\n    var _this2 = possibleConstructorReturn(this, (NumberControllerSlider.__proto__ || Object.getPrototypeOf(NumberControllerSlider)).call(this, object, property, {\n      min: min,\n      max: max,\n      step: step\n    }));\n\n    var _this = _this2;\n    _this2.__background = document.createElement('div');\n    _this2.__foreground = document.createElement('div');\n    dom.bind(_this2.__background, 'mousedown', onMouseDown);\n    dom.bind(_this2.__background, 'touchstart', onTouchStart);\n    dom.addClass(_this2.__background, 'slider');\n    dom.addClass(_this2.__foreground, 'slider-fg');\n\n    function onMouseDown(e) {\n      document.activeElement.blur();\n      dom.bind(window, 'mousemove', onMouseDrag);\n      dom.bind(window, 'mouseup', onMouseUp);\n      onMouseDrag(e);\n    }\n\n    function onMouseDrag(e) {\n      e.preventDefault();\n\n      var bgRect = _this.__background.getBoundingClientRect();\n\n      _this.setValue(map(e.clientX, bgRect.left, bgRect.right, _this.__min, _this.__max));\n\n      return false;\n    }\n\n    function onMouseUp() {\n      dom.unbind(window, 'mousemove', onMouseDrag);\n      dom.unbind(window, 'mouseup', onMouseUp);\n\n      if (_this.__onFinishChange) {\n        _this.__onFinishChange.call(_this, _this.getValue());\n      }\n    }\n\n    function onTouchStart(e) {\n      if (e.touches.length !== 1) {\n        return;\n      }\n\n      dom.bind(window, 'touchmove', onTouchMove);\n      dom.bind(window, 'touchend', onTouchEnd);\n      onTouchMove(e);\n    }\n\n    function onTouchMove(e) {\n      var clientX = e.touches[0].clientX;\n\n      var bgRect = _this.__background.getBoundingClientRect();\n\n      _this.setValue(map(clientX, bgRect.left, bgRect.right, _this.__min, _this.__max));\n    }\n\n    function onTouchEnd() {\n      dom.unbind(window, 'touchmove', onTouchMove);\n      dom.unbind(window, 'touchend', onTouchEnd);\n\n      if (_this.__onFinishChange) {\n        _this.__onFinishChange.call(_this, _this.getValue());\n      }\n    }\n\n    _this2.updateDisplay();\n\n    _this2.__background.appendChild(_this2.__foreground);\n\n    _this2.domElement.appendChild(_this2.__background);\n\n    return _this2;\n  }\n\n  createClass(NumberControllerSlider, [{\n    key: 'updateDisplay',\n    value: function updateDisplay() {\n      var pct = (this.getValue() - this.__min) / (this.__max - this.__min);\n\n      this.__foreground.style.width = pct * 100 + '%';\n      return get(NumberControllerSlider.prototype.__proto__ || Object.getPrototypeOf(NumberControllerSlider.prototype), 'updateDisplay', this).call(this);\n    }\n  }]);\n  return NumberControllerSlider;\n}(NumberController);\n\nvar FunctionController = function (_Controller) {\n  inherits(FunctionController, _Controller);\n\n  function FunctionController(object, property, text) {\n    classCallCheck(this, FunctionController);\n\n    var _this2 = possibleConstructorReturn(this, (FunctionController.__proto__ || Object.getPrototypeOf(FunctionController)).call(this, object, property));\n\n    var _this = _this2;\n    _this2.__button = document.createElement('div');\n    _this2.__button.innerHTML = text === undefined ? 'Fire' : text;\n    dom.bind(_this2.__button, 'click', function (e) {\n      e.preventDefault();\n\n      _this.fire();\n\n      return false;\n    });\n    dom.addClass(_this2.__button, 'button');\n\n    _this2.domElement.appendChild(_this2.__button);\n\n    return _this2;\n  }\n\n  createClass(FunctionController, [{\n    key: 'fire',\n    value: function fire() {\n      if (this.__onChange) {\n        this.__onChange.call(this);\n      }\n\n      this.getValue().call(this.object);\n\n      if (this.__onFinishChange) {\n        this.__onFinishChange.call(this, this.getValue());\n      }\n    }\n  }]);\n  return FunctionController;\n}(Controller);\n\nvar ColorController = function (_Controller) {\n  inherits(ColorController, _Controller);\n\n  function ColorController(object, property) {\n    classCallCheck(this, ColorController);\n\n    var _this2 = possibleConstructorReturn(this, (ColorController.__proto__ || Object.getPrototypeOf(ColorController)).call(this, object, property));\n\n    _this2.__color = new Color(_this2.getValue());\n    _this2.__temp = new Color(0);\n    var _this = _this2;\n    _this2.domElement = document.createElement('div');\n    dom.makeSelectable(_this2.domElement, false);\n    _this2.__selector = document.createElement('div');\n    _this2.__selector.className = 'selector';\n    _this2.__saturation_field = document.createElement('div');\n    _this2.__saturation_field.className = 'saturation-field';\n    _this2.__field_knob = document.createElement('div');\n    _this2.__field_knob.className = 'field-knob';\n    _this2.__field_knob_border = '2px solid ';\n    _this2.__hue_knob = document.createElement('div');\n    _this2.__hue_knob.className = 'hue-knob';\n    _this2.__hue_field = document.createElement('div');\n    _this2.__hue_field.className = 'hue-field';\n    _this2.__input = document.createElement('input');\n    _this2.__input.type = 'text';\n    _this2.__input_textShadow = '0 1px 1px ';\n    dom.bind(_this2.__input, 'keydown', function (e) {\n      if (e.keyCode === 13) {\n        onBlur.call(this);\n      }\n    });\n    dom.bind(_this2.__input, 'blur', onBlur);\n    dom.bind(_this2.__selector, 'mousedown', function () {\n      dom.addClass(this, 'drag').bind(window, 'mouseup', function () {\n        dom.removeClass(_this.__selector, 'drag');\n      });\n    });\n    dom.bind(_this2.__selector, 'touchstart', function () {\n      dom.addClass(this, 'drag').bind(window, 'touchend', function () {\n        dom.removeClass(_this.__selector, 'drag');\n      });\n    });\n    var valueField = document.createElement('div');\n    Common.extend(_this2.__selector.style, {\n      width: '122px',\n      height: '102px',\n      padding: '3px',\n      backgroundColor: '#222',\n      boxShadow: '0px 1px 3px rgba(0,0,0,0.3)'\n    });\n    Common.extend(_this2.__field_knob.style, {\n      position: 'absolute',\n      width: '12px',\n      height: '12px',\n      border: _this2.__field_knob_border + (_this2.__color.v < 0.5 ? '#fff' : '#000'),\n      boxShadow: '0px 1px 3px rgba(0,0,0,0.5)',\n      borderRadius: '12px',\n      zIndex: 1\n    });\n    Common.extend(_this2.__hue_knob.style, {\n      position: 'absolute',\n      width: '15px',\n      height: '2px',\n      borderRight: '4px solid #fff',\n      zIndex: 1\n    });\n    Common.extend(_this2.__saturation_field.style, {\n      width: '100px',\n      height: '100px',\n      border: '1px solid #555',\n      marginRight: '3px',\n      display: 'inline-block',\n      cursor: 'pointer'\n    });\n    Common.extend(valueField.style, {\n      width: '100%',\n      height: '100%',\n      background: 'none'\n    });\n    linearGradient(valueField, 'top', 'rgba(0,0,0,0)', '#000');\n    Common.extend(_this2.__hue_field.style, {\n      width: '15px',\n      height: '100px',\n      border: '1px solid #555',\n      cursor: 'ns-resize',\n      position: 'absolute',\n      top: '3px',\n      right: '3px'\n    });\n    hueGradient(_this2.__hue_field);\n    Common.extend(_this2.__input.style, {\n      outline: 'none',\n      textAlign: 'center',\n      color: '#fff',\n      border: 0,\n      fontWeight: 'bold',\n      textShadow: _this2.__input_textShadow + 'rgba(0,0,0,0.7)'\n    });\n    dom.bind(_this2.__saturation_field, 'mousedown', fieldDown);\n    dom.bind(_this2.__saturation_field, 'touchstart', fieldDown);\n    dom.bind(_this2.__field_knob, 'mousedown', fieldDown);\n    dom.bind(_this2.__field_knob, 'touchstart', fieldDown);\n    dom.bind(_this2.__hue_field, 'mousedown', fieldDownH);\n    dom.bind(_this2.__hue_field, 'touchstart', fieldDownH);\n\n    function fieldDown(e) {\n      setSV(e);\n      dom.bind(window, 'mousemove', setSV);\n      dom.bind(window, 'touchmove', setSV);\n      dom.bind(window, 'mouseup', fieldUpSV);\n      dom.bind(window, 'touchend', fieldUpSV);\n    }\n\n    function fieldDownH(e) {\n      setH(e);\n      dom.bind(window, 'mousemove', setH);\n      dom.bind(window, 'touchmove', setH);\n      dom.bind(window, 'mouseup', fieldUpH);\n      dom.bind(window, 'touchend', fieldUpH);\n    }\n\n    function fieldUpSV() {\n      dom.unbind(window, 'mousemove', setSV);\n      dom.unbind(window, 'touchmove', setSV);\n      dom.unbind(window, 'mouseup', fieldUpSV);\n      dom.unbind(window, 'touchend', fieldUpSV);\n      onFinish();\n    }\n\n    function fieldUpH() {\n      dom.unbind(window, 'mousemove', setH);\n      dom.unbind(window, 'touchmove', setH);\n      dom.unbind(window, 'mouseup', fieldUpH);\n      dom.unbind(window, 'touchend', fieldUpH);\n      onFinish();\n    }\n\n    function onBlur() {\n      var i = interpret(this.value);\n\n      if (i !== false) {\n        _this.__color.__state = i;\n\n        _this.setValue(_this.__color.toOriginal());\n      } else {\n        this.value = _this.__color.toString();\n      }\n    }\n\n    function onFinish() {\n      if (_this.__onFinishChange) {\n        _this.__onFinishChange.call(_this, _this.__color.toOriginal());\n      }\n    }\n\n    _this2.__saturation_field.appendChild(valueField);\n\n    _this2.__selector.appendChild(_this2.__field_knob);\n\n    _this2.__selector.appendChild(_this2.__saturation_field);\n\n    _this2.__selector.appendChild(_this2.__hue_field);\n\n    _this2.__hue_field.appendChild(_this2.__hue_knob);\n\n    _this2.domElement.appendChild(_this2.__input);\n\n    _this2.domElement.appendChild(_this2.__selector);\n\n    _this2.updateDisplay();\n\n    function setSV(e) {\n      if (e.type.indexOf('touch') === -1) {\n        e.preventDefault();\n      }\n\n      var fieldRect = _this.__saturation_field.getBoundingClientRect();\n\n      var _ref = e.touches && e.touches[0] || e,\n          clientX = _ref.clientX,\n          clientY = _ref.clientY;\n\n      var s = (clientX - fieldRect.left) / (fieldRect.right - fieldRect.left);\n      var v = 1 - (clientY - fieldRect.top) / (fieldRect.bottom - fieldRect.top);\n\n      if (v > 1) {\n        v = 1;\n      } else if (v < 0) {\n        v = 0;\n      }\n\n      if (s > 1) {\n        s = 1;\n      } else if (s < 0) {\n        s = 0;\n      }\n\n      _this.__color.v = v;\n      _this.__color.s = s;\n\n      _this.setValue(_this.__color.toOriginal());\n\n      return false;\n    }\n\n    function setH(e) {\n      if (e.type.indexOf('touch') === -1) {\n        e.preventDefault();\n      }\n\n      var fieldRect = _this.__hue_field.getBoundingClientRect();\n\n      var _ref2 = e.touches && e.touches[0] || e,\n          clientY = _ref2.clientY;\n\n      var h = 1 - (clientY - fieldRect.top) / (fieldRect.bottom - fieldRect.top);\n\n      if (h > 1) {\n        h = 1;\n      } else if (h < 0) {\n        h = 0;\n      }\n\n      _this.__color.h = h * 360;\n\n      _this.setValue(_this.__color.toOriginal());\n\n      return false;\n    }\n\n    return _this2;\n  }\n\n  createClass(ColorController, [{\n    key: 'updateDisplay',\n    value: function updateDisplay() {\n      var i = interpret(this.getValue());\n\n      if (i !== false) {\n        var mismatch = false;\n        Common.each(Color.COMPONENTS, function (component) {\n          if (!Common.isUndefined(i[component]) && !Common.isUndefined(this.__color.__state[component]) && i[component] !== this.__color.__state[component]) {\n            mismatch = true;\n            return {};\n          }\n        }, this);\n\n        if (mismatch) {\n          Common.extend(this.__color.__state, i);\n        }\n      }\n\n      Common.extend(this.__temp.__state, this.__color.__state);\n      this.__temp.a = 1;\n      var flip = this.__color.v < 0.5 || this.__color.s > 0.5 ? 255 : 0;\n\n      var _flip = 255 - flip;\n\n      Common.extend(this.__field_knob.style, {\n        marginLeft: 100 * this.__color.s - 7 + 'px',\n        marginTop: 100 * (1 - this.__color.v) - 7 + 'px',\n        backgroundColor: this.__temp.toHexString(),\n        border: this.__field_knob_border + 'rgb(' + flip + ',' + flip + ',' + flip + ')'\n      });\n      this.__hue_knob.style.marginTop = (1 - this.__color.h / 360) * 100 + 'px';\n      this.__temp.s = 1;\n      this.__temp.v = 1;\n      linearGradient(this.__saturation_field, 'left', '#fff', this.__temp.toHexString());\n      this.__input.value = this.__color.toString();\n      Common.extend(this.__input.style, {\n        backgroundColor: this.__color.toHexString(),\n        color: 'rgb(' + flip + ',' + flip + ',' + flip + ')',\n        textShadow: this.__input_textShadow + 'rgba(' + _flip + ',' + _flip + ',' + _flip + ',.7)'\n      });\n    }\n  }]);\n  return ColorController;\n}(Controller);\n\nvar vendors = ['-moz-', '-o-', '-webkit-', '-ms-', ''];\n\nfunction linearGradient(elem, x, a, b) {\n  elem.style.background = '';\n  Common.each(vendors, function (vendor) {\n    elem.style.cssText += 'background: ' + vendor + 'linear-gradient(' + x + ', ' + a + ' 0%, ' + b + ' 100%); ';\n  });\n}\n\nfunction hueGradient(elem) {\n  elem.style.background = '';\n  elem.style.cssText += 'background: -moz-linear-gradient(top,  #ff0000 0%, #ff00ff 17%, #0000ff 34%, #00ffff 50%, #00ff00 67%, #ffff00 84%, #ff0000 100%);';\n  elem.style.cssText += 'background: -webkit-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);';\n  elem.style.cssText += 'background: -o-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);';\n  elem.style.cssText += 'background: -ms-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);';\n  elem.style.cssText += 'background: linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);';\n}\n\nvar css = {\n  load: function load(url, indoc) {\n    var doc = indoc || document;\n    var link = doc.createElement('link');\n    link.type = 'text/css';\n    link.rel = 'stylesheet';\n    link.href = url;\n    doc.getElementsByTagName('head')[0].appendChild(link);\n  },\n  inject: function inject(cssContent, indoc) {\n    var doc = indoc || document;\n    var injected = document.createElement('style');\n    injected.type = 'text/css';\n    injected.innerHTML = cssContent;\n    var head = doc.getElementsByTagName('head')[0];\n\n    try {\n      head.appendChild(injected);\n    } catch (e) {}\n  }\n};\nvar saveDialogContents = \"<div id=\\\"dg-save\\\" class=\\\"dg dialogue\\\">\\n\\n  Here's the new load parameter for your <code>GUI</code>'s constructor:\\n\\n  <textarea id=\\\"dg-new-constructor\\\"></textarea>\\n\\n  <div id=\\\"dg-save-locally\\\">\\n\\n    <input id=\\\"dg-local-storage\\\" type=\\\"checkbox\\\"/> Automatically save\\n    values to <code>localStorage</code> on exit.\\n\\n    <div id=\\\"dg-local-explain\\\">The values saved to <code>localStorage</code> will\\n      override those passed to <code>dat.GUI</code>'s constructor. This makes it\\n      easier to work incrementally, but <code>localStorage</code> is fragile,\\n      and your friends may not see the same values you do.\\n\\n    </div>\\n\\n  </div>\\n\\n</div>\";\n\nvar ControllerFactory = function ControllerFactory(object, property) {\n  var initialValue = object[property];\n\n  if (Common.isArray(arguments[2]) || Common.isObject(arguments[2])) {\n    return new OptionController(object, property, arguments[2]);\n  }\n\n  if (Common.isNumber(initialValue)) {\n    if (Common.isNumber(arguments[2]) && Common.isNumber(arguments[3])) {\n      if (Common.isNumber(arguments[4])) {\n        return new NumberControllerSlider(object, property, arguments[2], arguments[3], arguments[4]);\n      }\n\n      return new NumberControllerSlider(object, property, arguments[2], arguments[3]);\n    }\n\n    if (Common.isNumber(arguments[4])) {\n      return new NumberControllerBox(object, property, {\n        min: arguments[2],\n        max: arguments[3],\n        step: arguments[4]\n      });\n    }\n\n    return new NumberControllerBox(object, property, {\n      min: arguments[2],\n      max: arguments[3]\n    });\n  }\n\n  if (Common.isString(initialValue)) {\n    return new StringController(object, property);\n  }\n\n  if (Common.isFunction(initialValue)) {\n    return new FunctionController(object, property, '');\n  }\n\n  if (Common.isBoolean(initialValue)) {\n    return new BooleanController(object, property);\n  }\n\n  return null;\n};\n\nfunction requestAnimationFrame(callback) {\n  setTimeout(callback, 1000 / 60);\n}\n\nvar requestAnimationFrame$1 = window.requestAnimationFrame || window.webkitRequestAnimationFrame || window.mozRequestAnimationFrame || window.oRequestAnimationFrame || window.msRequestAnimationFrame || requestAnimationFrame;\n\nvar CenteredDiv = function () {\n  function CenteredDiv() {\n    classCallCheck(this, CenteredDiv);\n    this.backgroundElement = document.createElement('div');\n    Common.extend(this.backgroundElement.style, {\n      backgroundColor: 'rgba(0,0,0,0.8)',\n      top: 0,\n      left: 0,\n      display: 'none',\n      zIndex: '1000',\n      opacity: 0,\n      WebkitTransition: 'opacity 0.2s linear',\n      transition: 'opacity 0.2s linear'\n    });\n    dom.makeFullscreen(this.backgroundElement);\n    this.backgroundElement.style.position = 'fixed';\n    this.domElement = document.createElement('div');\n    Common.extend(this.domElement.style, {\n      position: 'fixed',\n      display: 'none',\n      zIndex: '1001',\n      opacity: 0,\n      WebkitTransition: '-webkit-transform 0.2s ease-out, opacity 0.2s linear',\n      transition: 'transform 0.2s ease-out, opacity 0.2s linear'\n    });\n    document.body.appendChild(this.backgroundElement);\n    document.body.appendChild(this.domElement);\n\n    var _this = this;\n\n    dom.bind(this.backgroundElement, 'click', function () {\n      _this.hide();\n    });\n  }\n\n  createClass(CenteredDiv, [{\n    key: 'show',\n    value: function show() {\n      var _this = this;\n\n      this.backgroundElement.style.display = 'block';\n      this.domElement.style.display = 'block';\n      this.domElement.style.opacity = 0;\n      this.domElement.style.webkitTransform = 'scale(1.1)';\n      this.layout();\n      Common.defer(function () {\n        _this.backgroundElement.style.opacity = 1;\n        _this.domElement.style.opacity = 1;\n        _this.domElement.style.webkitTransform = 'scale(1)';\n      });\n    }\n  }, {\n    key: 'hide',\n    value: function hide() {\n      var _this = this;\n\n      var hide = function hide() {\n        _this.domElement.style.display = 'none';\n        _this.backgroundElement.style.display = 'none';\n        dom.unbind(_this.domElement, 'webkitTransitionEnd', hide);\n        dom.unbind(_this.domElement, 'transitionend', hide);\n        dom.unbind(_this.domElement, 'oTransitionEnd', hide);\n      };\n\n      dom.bind(this.domElement, 'webkitTransitionEnd', hide);\n      dom.bind(this.domElement, 'transitionend', hide);\n      dom.bind(this.domElement, 'oTransitionEnd', hide);\n      this.backgroundElement.style.opacity = 0;\n      this.domElement.style.opacity = 0;\n      this.domElement.style.webkitTransform = 'scale(1.1)';\n    }\n  }, {\n    key: 'layout',\n    value: function layout() {\n      this.domElement.style.left = window.innerWidth / 2 - dom.getWidth(this.domElement) / 2 + 'px';\n      this.domElement.style.top = window.innerHeight / 2 - dom.getHeight(this.domElement) / 2 + 'px';\n    }\n  }]);\n  return CenteredDiv;\n}();\n\nvar styleSheet = ___$insertStyle(\".dg ul{list-style:none;margin:0;padding:0;width:100%;clear:both}.dg.ac{position:fixed;top:0;left:0;right:0;height:0;z-index:0}.dg:not(.ac) .main{overflow:hidden}.dg.main{-webkit-transition:opacity .1s linear;-o-transition:opacity .1s linear;-moz-transition:opacity .1s linear;transition:opacity .1s linear}.dg.main.taller-than-window{overflow-y:auto}.dg.main.taller-than-window .close-button{opacity:1;margin-top:-1px;border-top:1px solid #2c2c2c}.dg.main ul.closed .close-button{opacity:1 !important}.dg.main:hover .close-button,.dg.main .close-button.drag{opacity:1}.dg.main .close-button{-webkit-transition:opacity .1s linear;-o-transition:opacity .1s linear;-moz-transition:opacity .1s linear;transition:opacity .1s linear;border:0;line-height:19px;height:20px;cursor:pointer;text-align:center;background-color:#000}.dg.main .close-button.close-top{position:relative}.dg.main .close-button.close-bottom{position:absolute}.dg.main .close-button:hover{background-color:#111}.dg.a{float:right;margin-right:15px;overflow-y:visible}.dg.a.has-save>ul.close-top{margin-top:0}.dg.a.has-save>ul.close-bottom{margin-top:27px}.dg.a.has-save>ul.closed{margin-top:0}.dg.a .save-row{top:0;z-index:1002}.dg.a .save-row.close-top{position:relative}.dg.a .save-row.close-bottom{position:fixed}.dg li{-webkit-transition:height .1s ease-out;-o-transition:height .1s ease-out;-moz-transition:height .1s ease-out;transition:height .1s ease-out;-webkit-transition:overflow .1s linear;-o-transition:overflow .1s linear;-moz-transition:overflow .1s linear;transition:overflow .1s linear}.dg li:not(.folder){cursor:auto;height:27px;line-height:27px;padding:0 4px 0 5px}.dg li.folder{padding:0;border-left:4px solid rgba(0,0,0,0)}.dg li.title{cursor:pointer;margin-left:-4px}.dg .closed li:not(.title),.dg .closed ul li,.dg .closed ul li>*{height:0;overflow:hidden;border:0}.dg .cr{clear:both;padding-left:3px;height:27px;overflow:hidden}.dg .property-name{cursor:default;float:left;clear:left;width:40%;overflow:hidden;text-overflow:ellipsis}.dg .c{float:left;width:60%;position:relative}.dg .c input[type=text]{border:0;margin-top:4px;padding:3px;width:100%;float:right}.dg .has-slider input[type=text]{width:30%;margin-left:0}.dg .slider{float:left;width:66%;margin-left:-5px;margin-right:0;height:19px;margin-top:4px}.dg .slider-fg{height:100%}.dg .c input[type=checkbox]{margin-top:7px}.dg .c select{margin-top:5px}.dg .cr.function,.dg .cr.function .property-name,.dg .cr.function *,.dg .cr.boolean,.dg .cr.boolean *{cursor:pointer}.dg .cr.color{overflow:visible}.dg .selector{display:none;position:absolute;margin-left:-9px;margin-top:23px;z-index:10}.dg .c:hover .selector,.dg .selector.drag{display:block}.dg li.save-row{padding:0}.dg li.save-row .button{display:inline-block;padding:0px 6px}.dg.dialogue{background-color:#222;width:460px;padding:15px;font-size:13px;line-height:15px}#dg-new-constructor{padding:10px;color:#222;font-family:Monaco, monospace;font-size:10px;border:0;resize:none;box-shadow:inset 1px 1px 1px #888;word-wrap:break-word;margin:12px 0;display:block;width:440px;overflow-y:scroll;height:100px;position:relative}#dg-local-explain{display:none;font-size:11px;line-height:17px;border-radius:3px;background-color:#333;padding:8px;margin-top:10px}#dg-local-explain code{font-size:10px}#dat-gui-save-locally{display:none}.dg{color:#eee;font:11px 'Lucida Grande', sans-serif;text-shadow:0 -1px 0 #111}.dg.main::-webkit-scrollbar{width:5px;background:#1a1a1a}.dg.main::-webkit-scrollbar-corner{height:0;display:none}.dg.main::-webkit-scrollbar-thumb{border-radius:5px;background:#676767}.dg li:not(.folder){background:#1a1a1a;border-bottom:1px solid #2c2c2c}.dg li.save-row{line-height:25px;background:#dad5cb;border:0}.dg li.save-row select{margin-left:5px;width:108px}.dg li.save-row .button{margin-left:5px;margin-top:1px;border-radius:2px;font-size:9px;line-height:7px;padding:4px 4px 5px 4px;background:#c5bdad;color:#fff;text-shadow:0 1px 0 #b0a58f;box-shadow:0 -1px 0 #b0a58f;cursor:pointer}.dg li.save-row .button.gears{background:#c5bdad url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAANCAYAAAB/9ZQ7AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAQJJREFUeNpiYKAU/P//PwGIC/ApCABiBSAW+I8AClAcgKxQ4T9hoMAEUrxx2QSGN6+egDX+/vWT4e7N82AMYoPAx/evwWoYoSYbACX2s7KxCxzcsezDh3evFoDEBYTEEqycggWAzA9AuUSQQgeYPa9fPv6/YWm/Acx5IPb7ty/fw+QZblw67vDs8R0YHyQhgObx+yAJkBqmG5dPPDh1aPOGR/eugW0G4vlIoTIfyFcA+QekhhHJhPdQxbiAIguMBTQZrPD7108M6roWYDFQiIAAv6Aow/1bFwXgis+f2LUAynwoIaNcz8XNx3Dl7MEJUDGQpx9gtQ8YCueB+D26OECAAQDadt7e46D42QAAAABJRU5ErkJggg==) 2px 1px no-repeat;height:7px;width:8px}.dg li.save-row .button:hover{background-color:#bab19e;box-shadow:0 -1px 0 #b0a58f}.dg li.folder{border-bottom:0}.dg li.title{padding-left:16px;background:#000 url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlI+hKgFxoCgAOw==) 6px 10px no-repeat;cursor:pointer;border-bottom:1px solid rgba(255,255,255,0.2)}.dg .closed li.title{background-image:url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlGIWqMCbWAEAOw==)}.dg .cr.boolean{border-left:3px solid #806787}.dg .cr.color{border-left:3px solid}.dg .cr.function{border-left:3px solid #e61d5f}.dg .cr.number{border-left:3px solid #2FA1D6}.dg .cr.number input[type=text]{color:#2FA1D6}.dg .cr.string{border-left:3px solid #1ed36f}.dg .cr.string input[type=text]{color:#1ed36f}.dg .cr.function:hover,.dg .cr.boolean:hover{background:#111}.dg .c input[type=text]{background:#303030;outline:none}.dg .c input[type=text]:hover{background:#3c3c3c}.dg .c input[type=text]:focus{background:#494949;color:#fff}.dg .c .slider{background:#303030;cursor:ew-resize}.dg .c .slider-fg{background:#2FA1D6;max-width:100%}.dg .c .slider:hover{background:#3c3c3c}.dg .c .slider:hover .slider-fg{background:#44abda}\\n\");\n\ncss.inject(styleSheet);\nvar CSS_NAMESPACE = 'dg';\nvar HIDE_KEY_CODE = 72;\nvar CLOSE_BUTTON_HEIGHT = 20;\nvar DEFAULT_DEFAULT_PRESET_NAME = 'Default';\n\nvar SUPPORTS_LOCAL_STORAGE = function () {\n  try {\n    return !!window.localStorage;\n  } catch (e) {\n    return false;\n  }\n}();\n\nvar SAVE_DIALOGUE = void 0;\nvar autoPlaceVirgin = true;\nvar autoPlaceContainer = void 0;\nvar hide = false;\nvar hideableGuis = [];\n\nvar GUI = function GUI(pars) {\n  var _this = this;\n\n  var params = pars || {};\n  this.domElement = document.createElement('div');\n  this.__ul = document.createElement('ul');\n  this.domElement.appendChild(this.__ul);\n  dom.addClass(this.domElement, CSS_NAMESPACE);\n  this.__folders = {};\n  this.__controllers = [];\n  this.__rememberedObjects = [];\n  this.__rememberedObjectIndecesToControllers = [];\n  this.__listening = [];\n  params = Common.defaults(params, {\n    closeOnTop: false,\n    autoPlace: true,\n    width: GUI.DEFAULT_WIDTH\n  });\n  params = Common.defaults(params, {\n    resizable: params.autoPlace,\n    hideable: params.autoPlace\n  });\n\n  if (!Common.isUndefined(params.load)) {\n    if (params.preset) {\n      params.load.preset = params.preset;\n    }\n  } else {\n    params.load = {\n      preset: DEFAULT_DEFAULT_PRESET_NAME\n    };\n  }\n\n  if (Common.isUndefined(params.parent) && params.hideable) {\n    hideableGuis.push(this);\n  }\n\n  params.resizable = Common.isUndefined(params.parent) && params.resizable;\n\n  if (params.autoPlace && Common.isUndefined(params.scrollable)) {\n    params.scrollable = true;\n  }\n\n  var useLocalStorage = SUPPORTS_LOCAL_STORAGE && localStorage.getItem(getLocalStorageHash(this, 'isLocal')) === 'true';\n  var saveToLocalStorage = void 0;\n  var titleRow = void 0;\n  Object.defineProperties(this, {\n    parent: {\n      get: function get$$1() {\n        return params.parent;\n      }\n    },\n    scrollable: {\n      get: function get$$1() {\n        return params.scrollable;\n      }\n    },\n    autoPlace: {\n      get: function get$$1() {\n        return params.autoPlace;\n      }\n    },\n    closeOnTop: {\n      get: function get$$1() {\n        return params.closeOnTop;\n      }\n    },\n    preset: {\n      get: function get$$1() {\n        if (_this.parent) {\n          return _this.getRoot().preset;\n        }\n\n        return params.load.preset;\n      },\n      set: function set$$1(v) {\n        if (_this.parent) {\n          _this.getRoot().preset = v;\n        } else {\n          params.load.preset = v;\n        }\n\n        setPresetSelectIndex(this);\n\n        _this.revert();\n      }\n    },\n    width: {\n      get: function get$$1() {\n        return params.width;\n      },\n      set: function set$$1(v) {\n        params.width = v;\n        setWidth(_this, v);\n      }\n    },\n    name: {\n      get: function get$$1() {\n        return params.name;\n      },\n      set: function set$$1(v) {\n        params.name = v;\n\n        if (titleRow) {\n          titleRow.innerHTML = params.name;\n        }\n      }\n    },\n    closed: {\n      get: function get$$1() {\n        return params.closed;\n      },\n      set: function set$$1(v) {\n        params.closed = v;\n\n        if (params.closed) {\n          dom.addClass(_this.__ul, GUI.CLASS_CLOSED);\n        } else {\n          dom.removeClass(_this.__ul, GUI.CLASS_CLOSED);\n        }\n\n        this.onResize();\n\n        if (_this.__closeButton) {\n          _this.__closeButton.innerHTML = v ? GUI.TEXT_OPEN : GUI.TEXT_CLOSED;\n        }\n      }\n    },\n    load: {\n      get: function get$$1() {\n        return params.load;\n      }\n    },\n    useLocalStorage: {\n      get: function get$$1() {\n        return useLocalStorage;\n      },\n      set: function set$$1(bool) {\n        if (SUPPORTS_LOCAL_STORAGE) {\n          useLocalStorage = bool;\n\n          if (bool) {\n            dom.bind(window, 'unload', saveToLocalStorage);\n          } else {\n            dom.unbind(window, 'unload', saveToLocalStorage);\n          }\n\n          localStorage.setItem(getLocalStorageHash(_this, 'isLocal'), bool);\n        }\n      }\n    }\n  });\n\n  if (Common.isUndefined(params.parent)) {\n    this.closed = params.closed || false;\n    dom.addClass(this.domElement, GUI.CLASS_MAIN);\n    dom.makeSelectable(this.domElement, false);\n\n    if (SUPPORTS_LOCAL_STORAGE) {\n      if (useLocalStorage) {\n        _this.useLocalStorage = true;\n        var savedGui = localStorage.getItem(getLocalStorageHash(this, 'gui'));\n\n        if (savedGui) {\n          params.load = JSON.parse(savedGui);\n        }\n      }\n    }\n\n    this.__closeButton = document.createElement('div');\n    this.__closeButton.innerHTML = GUI.TEXT_CLOSED;\n    dom.addClass(this.__closeButton, GUI.CLASS_CLOSE_BUTTON);\n\n    if (params.closeOnTop) {\n      dom.addClass(this.__closeButton, GUI.CLASS_CLOSE_TOP);\n      this.domElement.insertBefore(this.__closeButton, this.domElement.childNodes[0]);\n    } else {\n      dom.addClass(this.__closeButton, GUI.CLASS_CLOSE_BOTTOM);\n      this.domElement.appendChild(this.__closeButton);\n    }\n\n    dom.bind(this.__closeButton, 'click', function () {\n      _this.closed = !_this.closed;\n    });\n  } else {\n    if (params.closed === undefined) {\n      params.closed = true;\n    }\n\n    var titleRowName = document.createTextNode(params.name);\n    dom.addClass(titleRowName, 'controller-name');\n    titleRow = addRow(_this, titleRowName);\n\n    var onClickTitle = function onClickTitle(e) {\n      e.preventDefault();\n      _this.closed = !_this.closed;\n      return false;\n    };\n\n    dom.addClass(this.__ul, GUI.CLASS_CLOSED);\n    dom.addClass(titleRow, 'title');\n    dom.bind(titleRow, 'click', onClickTitle);\n\n    if (!params.closed) {\n      this.closed = false;\n    }\n  }\n\n  if (params.autoPlace) {\n    if (Common.isUndefined(params.parent)) {\n      if (autoPlaceVirgin) {\n        autoPlaceContainer = document.createElement('div');\n        dom.addClass(autoPlaceContainer, CSS_NAMESPACE);\n        dom.addClass(autoPlaceContainer, GUI.CLASS_AUTO_PLACE_CONTAINER);\n        document.body.appendChild(autoPlaceContainer);\n        autoPlaceVirgin = false;\n      }\n\n      autoPlaceContainer.appendChild(this.domElement);\n      dom.addClass(this.domElement, GUI.CLASS_AUTO_PLACE);\n    }\n\n    if (!this.parent) {\n      setWidth(_this, params.width);\n    }\n  }\n\n  this.__resizeHandler = function () {\n    _this.onResizeDebounced();\n  };\n\n  dom.bind(window, 'resize', this.__resizeHandler);\n  dom.bind(this.__ul, 'webkitTransitionEnd', this.__resizeHandler);\n  dom.bind(this.__ul, 'transitionend', this.__resizeHandler);\n  dom.bind(this.__ul, 'oTransitionEnd', this.__resizeHandler);\n  this.onResize();\n\n  if (params.resizable) {\n    addResizeHandle(this);\n  }\n\n  saveToLocalStorage = function saveToLocalStorage() {\n    if (SUPPORTS_LOCAL_STORAGE && localStorage.getItem(getLocalStorageHash(_this, 'isLocal')) === 'true') {\n      localStorage.setItem(getLocalStorageHash(_this, 'gui'), JSON.stringify(_this.getSaveObject()));\n    }\n  };\n\n  this.saveToLocalStorageIfPossible = saveToLocalStorage;\n\n  function resetWidth() {\n    var root = _this.getRoot();\n\n    root.width += 1;\n    Common.defer(function () {\n      root.width -= 1;\n    });\n  }\n\n  if (!params.parent) {\n    resetWidth();\n  }\n};\n\nGUI.toggleHide = function () {\n  hide = !hide;\n  Common.each(hideableGuis, function (gui) {\n    gui.domElement.style.display = hide ? 'none' : '';\n  });\n};\n\nGUI.CLASS_AUTO_PLACE = 'a';\nGUI.CLASS_AUTO_PLACE_CONTAINER = 'ac';\nGUI.CLASS_MAIN = 'main';\nGUI.CLASS_CONTROLLER_ROW = 'cr';\nGUI.CLASS_TOO_TALL = 'taller-than-window';\nGUI.CLASS_CLOSED = 'closed';\nGUI.CLASS_CLOSE_BUTTON = 'close-button';\nGUI.CLASS_CLOSE_TOP = 'close-top';\nGUI.CLASS_CLOSE_BOTTOM = 'close-bottom';\nGUI.CLASS_DRAG = 'drag';\nGUI.DEFAULT_WIDTH = 245;\nGUI.TEXT_CLOSED = 'Close Controls';\nGUI.TEXT_OPEN = 'Open Controls';\n\nGUI._keydownHandler = function (e) {\n  if (document.activeElement.type !== 'text' && (e.which === HIDE_KEY_CODE || e.keyCode === HIDE_KEY_CODE)) {\n    GUI.toggleHide();\n  }\n};\n\ndom.bind(window, 'keydown', GUI._keydownHandler, false);\nCommon.extend(GUI.prototype, {\n  add: function add(object, property) {\n    return _add(this, object, property, {\n      factoryArgs: Array.prototype.slice.call(arguments, 2)\n    });\n  },\n  addColor: function addColor(object, property) {\n    return _add(this, object, property, {\n      color: true\n    });\n  },\n  remove: function remove(controller) {\n    this.__ul.removeChild(controller.__li);\n\n    this.__controllers.splice(this.__controllers.indexOf(controller), 1);\n\n    var _this = this;\n\n    Common.defer(function () {\n      _this.onResize();\n    });\n  },\n  destroy: function destroy() {\n    if (this.parent) {\n      throw new Error('Only the root GUI should be removed with .destroy(). ' + 'For subfolders, use gui.removeFolder(folder) instead.');\n    }\n\n    if (this.autoPlace) {\n      autoPlaceContainer.removeChild(this.domElement);\n    }\n\n    var _this = this;\n\n    Common.each(this.__folders, function (subfolder) {\n      _this.removeFolder(subfolder);\n    });\n    dom.unbind(window, 'keydown', GUI._keydownHandler, false);\n    removeListeners(this);\n  },\n  addFolder: function addFolder(name) {\n    if (this.__folders[name] !== undefined) {\n      throw new Error('You already have a folder in this GUI by the' + ' name \"' + name + '\"');\n    }\n\n    var newGuiParams = {\n      name: name,\n      parent: this\n    };\n    newGuiParams.autoPlace = this.autoPlace;\n\n    if (this.load && this.load.folders && this.load.folders[name]) {\n      newGuiParams.closed = this.load.folders[name].closed;\n      newGuiParams.load = this.load.folders[name];\n    }\n\n    var gui = new GUI(newGuiParams);\n    this.__folders[name] = gui;\n    var li = addRow(this, gui.domElement);\n    dom.addClass(li, 'folder');\n    return gui;\n  },\n  removeFolder: function removeFolder(folder) {\n    this.__ul.removeChild(folder.domElement.parentElement);\n\n    delete this.__folders[folder.name];\n\n    if (this.load && this.load.folders && this.load.folders[folder.name]) {\n      delete this.load.folders[folder.name];\n    }\n\n    removeListeners(folder);\n\n    var _this = this;\n\n    Common.each(folder.__folders, function (subfolder) {\n      folder.removeFolder(subfolder);\n    });\n    Common.defer(function () {\n      _this.onResize();\n    });\n  },\n  open: function open() {\n    this.closed = false;\n  },\n  close: function close() {\n    this.closed = true;\n  },\n  hide: function hide() {\n    this.domElement.style.display = 'none';\n  },\n  show: function show() {\n    this.domElement.style.display = '';\n  },\n  onResize: function onResize() {\n    var root = this.getRoot();\n\n    if (root.scrollable) {\n      var top = dom.getOffset(root.__ul).top;\n      var h = 0;\n      Common.each(root.__ul.childNodes, function (node) {\n        if (!(root.autoPlace && node === root.__save_row)) {\n          h += dom.getHeight(node);\n        }\n      });\n\n      if (window.innerHeight - top - CLOSE_BUTTON_HEIGHT < h) {\n        dom.addClass(root.domElement, GUI.CLASS_TOO_TALL);\n        root.__ul.style.height = window.innerHeight - top - CLOSE_BUTTON_HEIGHT + 'px';\n      } else {\n        dom.removeClass(root.domElement, GUI.CLASS_TOO_TALL);\n        root.__ul.style.height = 'auto';\n      }\n    }\n\n    if (root.__resize_handle) {\n      Common.defer(function () {\n        root.__resize_handle.style.height = root.__ul.offsetHeight + 'px';\n      });\n    }\n\n    if (root.__closeButton) {\n      root.__closeButton.style.width = root.width + 'px';\n    }\n  },\n  onResizeDebounced: Common.debounce(function () {\n    this.onResize();\n  }, 50),\n  remember: function remember() {\n    if (Common.isUndefined(SAVE_DIALOGUE)) {\n      SAVE_DIALOGUE = new CenteredDiv();\n      SAVE_DIALOGUE.domElement.innerHTML = saveDialogContents;\n    }\n\n    if (this.parent) {\n      throw new Error('You can only call remember on a top level GUI.');\n    }\n\n    var _this = this;\n\n    Common.each(Array.prototype.slice.call(arguments), function (object) {\n      if (_this.__rememberedObjects.length === 0) {\n        addSaveMenu(_this);\n      }\n\n      if (_this.__rememberedObjects.indexOf(object) === -1) {\n        _this.__rememberedObjects.push(object);\n      }\n    });\n\n    if (this.autoPlace) {\n      setWidth(this, this.width);\n    }\n  },\n  getRoot: function getRoot() {\n    var gui = this;\n\n    while (gui.parent) {\n      gui = gui.parent;\n    }\n\n    return gui;\n  },\n  getSaveObject: function getSaveObject() {\n    var toReturn = this.load;\n    toReturn.closed = this.closed;\n\n    if (this.__rememberedObjects.length > 0) {\n      toReturn.preset = this.preset;\n\n      if (!toReturn.remembered) {\n        toReturn.remembered = {};\n      }\n\n      toReturn.remembered[this.preset] = getCurrentPreset(this);\n    }\n\n    toReturn.folders = {};\n    Common.each(this.__folders, function (element, key) {\n      toReturn.folders[key] = element.getSaveObject();\n    });\n    return toReturn;\n  },\n  save: function save() {\n    if (!this.load.remembered) {\n      this.load.remembered = {};\n    }\n\n    this.load.remembered[this.preset] = getCurrentPreset(this);\n    markPresetModified(this, false);\n    this.saveToLocalStorageIfPossible();\n  },\n  saveAs: function saveAs(presetName) {\n    if (!this.load.remembered) {\n      this.load.remembered = {};\n      this.load.remembered[DEFAULT_DEFAULT_PRESET_NAME] = getCurrentPreset(this, true);\n    }\n\n    this.load.remembered[presetName] = getCurrentPreset(this);\n    this.preset = presetName;\n    addPresetOption(this, presetName, true);\n    this.saveToLocalStorageIfPossible();\n  },\n  revert: function revert(gui) {\n    Common.each(this.__controllers, function (controller) {\n      if (!this.getRoot().load.remembered) {\n        controller.setValue(controller.initialValue);\n      } else {\n        recallSavedValue(gui || this.getRoot(), controller);\n      }\n\n      if (controller.__onFinishChange) {\n        controller.__onFinishChange.call(controller, controller.getValue());\n      }\n    }, this);\n    Common.each(this.__folders, function (folder) {\n      folder.revert(folder);\n    });\n\n    if (!gui) {\n      markPresetModified(this.getRoot(), false);\n    }\n  },\n  listen: function listen(controller) {\n    var init = this.__listening.length === 0;\n\n    this.__listening.push(controller);\n\n    if (init) {\n      updateDisplays(this.__listening);\n    }\n  },\n  updateDisplay: function updateDisplay() {\n    Common.each(this.__controllers, function (controller) {\n      controller.updateDisplay();\n    });\n    Common.each(this.__folders, function (folder) {\n      folder.updateDisplay();\n    });\n  }\n});\n\nfunction addRow(gui, newDom, liBefore) {\n  var li = document.createElement('li');\n\n  if (newDom) {\n    li.appendChild(newDom);\n  }\n\n  if (liBefore) {\n    gui.__ul.insertBefore(li, liBefore);\n  } else {\n    gui.__ul.appendChild(li);\n  }\n\n  gui.onResize();\n  return li;\n}\n\nfunction removeListeners(gui) {\n  dom.unbind(window, 'resize', gui.__resizeHandler);\n\n  if (gui.saveToLocalStorageIfPossible) {\n    dom.unbind(window, 'unload', gui.saveToLocalStorageIfPossible);\n  }\n}\n\nfunction markPresetModified(gui, modified) {\n  var opt = gui.__preset_select[gui.__preset_select.selectedIndex];\n\n  if (modified) {\n    opt.innerHTML = opt.value + '*';\n  } else {\n    opt.innerHTML = opt.value;\n  }\n}\n\nfunction augmentController(gui, li, controller) {\n  controller.__li = li;\n  controller.__gui = gui;\n  Common.extend(controller, {\n    options: function options(_options) {\n      if (arguments.length > 1) {\n        var nextSibling = controller.__li.nextElementSibling;\n        controller.remove();\n        return _add(gui, controller.object, controller.property, {\n          before: nextSibling,\n          factoryArgs: [Common.toArray(arguments)]\n        });\n      }\n\n      if (Common.isArray(_options) || Common.isObject(_options)) {\n        var _nextSibling = controller.__li.nextElementSibling;\n        controller.remove();\n        return _add(gui, controller.object, controller.property, {\n          before: _nextSibling,\n          factoryArgs: [_options]\n        });\n      }\n    },\n    name: function name(_name) {\n      controller.__li.firstElementChild.firstElementChild.innerHTML = _name;\n      return controller;\n    },\n    listen: function listen() {\n      controller.__gui.listen(controller);\n\n      return controller;\n    },\n    remove: function remove() {\n      controller.__gui.remove(controller);\n\n      return controller;\n    }\n  });\n\n  if (controller instanceof NumberControllerSlider) {\n    var box = new NumberControllerBox(controller.object, controller.property, {\n      min: controller.__min,\n      max: controller.__max,\n      step: controller.__step\n    });\n    Common.each(['updateDisplay', 'onChange', 'onFinishChange', 'step', 'min', 'max'], function (method) {\n      var pc = controller[method];\n      var pb = box[method];\n\n      controller[method] = box[method] = function () {\n        var args = Array.prototype.slice.call(arguments);\n        pb.apply(box, args);\n        return pc.apply(controller, args);\n      };\n    });\n    dom.addClass(li, 'has-slider');\n    controller.domElement.insertBefore(box.domElement, controller.domElement.firstElementChild);\n  } else if (controller instanceof NumberControllerBox) {\n    var r = function r(returned) {\n      if (Common.isNumber(controller.__min) && Common.isNumber(controller.__max)) {\n        var oldName = controller.__li.firstElementChild.firstElementChild.innerHTML;\n        var wasListening = controller.__gui.__listening.indexOf(controller) > -1;\n        controller.remove();\n\n        var newController = _add(gui, controller.object, controller.property, {\n          before: controller.__li.nextElementSibling,\n          factoryArgs: [controller.__min, controller.__max, controller.__step]\n        });\n\n        newController.name(oldName);\n        if (wasListening) newController.listen();\n        return newController;\n      }\n\n      return returned;\n    };\n\n    controller.min = Common.compose(r, controller.min);\n    controller.max = Common.compose(r, controller.max);\n  } else if (controller instanceof BooleanController) {\n    dom.bind(li, 'click', function () {\n      dom.fakeEvent(controller.__checkbox, 'click');\n    });\n    dom.bind(controller.__checkbox, 'click', function (e) {\n      e.stopPropagation();\n    });\n  } else if (controller instanceof FunctionController) {\n    dom.bind(li, 'click', function () {\n      dom.fakeEvent(controller.__button, 'click');\n    });\n    dom.bind(li, 'mouseover', function () {\n      dom.addClass(controller.__button, 'hover');\n    });\n    dom.bind(li, 'mouseout', function () {\n      dom.removeClass(controller.__button, 'hover');\n    });\n  } else if (controller instanceof ColorController) {\n    dom.addClass(li, 'color');\n    controller.updateDisplay = Common.compose(function (val) {\n      li.style.borderLeftColor = controller.__color.toString();\n      return val;\n    }, controller.updateDisplay);\n    controller.updateDisplay();\n  }\n\n  controller.setValue = Common.compose(function (val) {\n    if (gui.getRoot().__preset_select && controller.isModified()) {\n      markPresetModified(gui.getRoot(), true);\n    }\n\n    return val;\n  }, controller.setValue);\n}\n\nfunction recallSavedValue(gui, controller) {\n  var root = gui.getRoot();\n\n  var matchedIndex = root.__rememberedObjects.indexOf(controller.object);\n\n  if (matchedIndex !== -1) {\n    var controllerMap = root.__rememberedObjectIndecesToControllers[matchedIndex];\n\n    if (controllerMap === undefined) {\n      controllerMap = {};\n      root.__rememberedObjectIndecesToControllers[matchedIndex] = controllerMap;\n    }\n\n    controllerMap[controller.property] = controller;\n\n    if (root.load && root.load.remembered) {\n      var presetMap = root.load.remembered;\n      var preset = void 0;\n\n      if (presetMap[gui.preset]) {\n        preset = presetMap[gui.preset];\n      } else if (presetMap[DEFAULT_DEFAULT_PRESET_NAME]) {\n        preset = presetMap[DEFAULT_DEFAULT_PRESET_NAME];\n      } else {\n        return;\n      }\n\n      if (preset[matchedIndex] && preset[matchedIndex][controller.property] !== undefined) {\n        var value = preset[matchedIndex][controller.property];\n        controller.initialValue = value;\n        controller.setValue(value);\n      }\n    }\n  }\n}\n\nfunction _add(gui, object, property, params) {\n  if (object[property] === undefined) {\n    throw new Error('Object \"' + object + '\" has no property \"' + property + '\"');\n  }\n\n  var controller = void 0;\n\n  if (params.color) {\n    controller = new ColorController(object, property);\n  } else {\n    var factoryArgs = [object, property].concat(params.factoryArgs);\n    controller = ControllerFactory.apply(gui, factoryArgs);\n  }\n\n  if (params.before instanceof Controller) {\n    params.before = params.before.__li;\n  }\n\n  recallSavedValue(gui, controller);\n  dom.addClass(controller.domElement, 'c');\n  var name = document.createElement('span');\n  dom.addClass(name, 'property-name');\n  name.innerHTML = controller.property;\n  var container = document.createElement('div');\n  container.appendChild(name);\n  container.appendChild(controller.domElement);\n  var li = addRow(gui, container, params.before);\n  dom.addClass(li, GUI.CLASS_CONTROLLER_ROW);\n\n  if (controller instanceof ColorController) {\n    dom.addClass(li, 'color');\n  } else {\n    dom.addClass(li, _typeof(controller.getValue()));\n  }\n\n  augmentController(gui, li, controller);\n\n  gui.__controllers.push(controller);\n\n  return controller;\n}\n\nfunction getLocalStorageHash(gui, key) {\n  return document.location.href + '.' + key;\n}\n\nfunction addPresetOption(gui, name, setSelected) {\n  var opt = document.createElement('option');\n  opt.innerHTML = name;\n  opt.value = name;\n\n  gui.__preset_select.appendChild(opt);\n\n  if (setSelected) {\n    gui.__preset_select.selectedIndex = gui.__preset_select.length - 1;\n  }\n}\n\nfunction showHideExplain(gui, explain) {\n  explain.style.display = gui.useLocalStorage ? 'block' : 'none';\n}\n\nfunction addSaveMenu(gui) {\n  var div = gui.__save_row = document.createElement('li');\n  dom.addClass(gui.domElement, 'has-save');\n\n  gui.__ul.insertBefore(div, gui.__ul.firstChild);\n\n  dom.addClass(div, 'save-row');\n  var gears = document.createElement('span');\n  gears.innerHTML = '&nbsp;';\n  dom.addClass(gears, 'button gears');\n  var button = document.createElement('span');\n  button.innerHTML = 'Save';\n  dom.addClass(button, 'button');\n  dom.addClass(button, 'save');\n  var button2 = document.createElement('span');\n  button2.innerHTML = 'New';\n  dom.addClass(button2, 'button');\n  dom.addClass(button2, 'save-as');\n  var button3 = document.createElement('span');\n  button3.innerHTML = 'Revert';\n  dom.addClass(button3, 'button');\n  dom.addClass(button3, 'revert');\n  var select = gui.__preset_select = document.createElement('select');\n\n  if (gui.load && gui.load.remembered) {\n    Common.each(gui.load.remembered, function (value, key) {\n      addPresetOption(gui, key, key === gui.preset);\n    });\n  } else {\n    addPresetOption(gui, DEFAULT_DEFAULT_PRESET_NAME, false);\n  }\n\n  dom.bind(select, 'change', function () {\n    for (var index = 0; index < gui.__preset_select.length; index++) {\n      gui.__preset_select[index].innerHTML = gui.__preset_select[index].value;\n    }\n\n    gui.preset = this.value;\n  });\n  div.appendChild(select);\n  div.appendChild(gears);\n  div.appendChild(button);\n  div.appendChild(button2);\n  div.appendChild(button3);\n\n  if (SUPPORTS_LOCAL_STORAGE) {\n    var explain = document.getElementById('dg-local-explain');\n    var localStorageCheckBox = document.getElementById('dg-local-storage');\n    var saveLocally = document.getElementById('dg-save-locally');\n    saveLocally.style.display = 'block';\n\n    if (localStorage.getItem(getLocalStorageHash(gui, 'isLocal')) === 'true') {\n      localStorageCheckBox.setAttribute('checked', 'checked');\n    }\n\n    showHideExplain(gui, explain);\n    dom.bind(localStorageCheckBox, 'change', function () {\n      gui.useLocalStorage = !gui.useLocalStorage;\n      showHideExplain(gui, explain);\n    });\n  }\n\n  var newConstructorTextArea = document.getElementById('dg-new-constructor');\n  dom.bind(newConstructorTextArea, 'keydown', function (e) {\n    if (e.metaKey && (e.which === 67 || e.keyCode === 67)) {\n      SAVE_DIALOGUE.hide();\n    }\n  });\n  dom.bind(gears, 'click', function () {\n    newConstructorTextArea.innerHTML = JSON.stringify(gui.getSaveObject(), undefined, 2);\n    SAVE_DIALOGUE.show();\n    newConstructorTextArea.focus();\n    newConstructorTextArea.select();\n  });\n  dom.bind(button, 'click', function () {\n    gui.save();\n  });\n  dom.bind(button2, 'click', function () {\n    var presetName = prompt('Enter a new preset name.');\n\n    if (presetName) {\n      gui.saveAs(presetName);\n    }\n  });\n  dom.bind(button3, 'click', function () {\n    gui.revert();\n  });\n}\n\nfunction addResizeHandle(gui) {\n  var pmouseX = void 0;\n  gui.__resize_handle = document.createElement('div');\n  Common.extend(gui.__resize_handle.style, {\n    width: '6px',\n    marginLeft: '-3px',\n    height: '200px',\n    cursor: 'ew-resize',\n    position: 'absolute'\n  });\n\n  function drag(e) {\n    e.preventDefault();\n    gui.width += pmouseX - e.clientX;\n    gui.onResize();\n    pmouseX = e.clientX;\n    return false;\n  }\n\n  function dragStop() {\n    dom.removeClass(gui.__closeButton, GUI.CLASS_DRAG);\n    dom.unbind(window, 'mousemove', drag);\n    dom.unbind(window, 'mouseup', dragStop);\n  }\n\n  function dragStart(e) {\n    e.preventDefault();\n    pmouseX = e.clientX;\n    dom.addClass(gui.__closeButton, GUI.CLASS_DRAG);\n    dom.bind(window, 'mousemove', drag);\n    dom.bind(window, 'mouseup', dragStop);\n    return false;\n  }\n\n  dom.bind(gui.__resize_handle, 'mousedown', dragStart);\n  dom.bind(gui.__closeButton, 'mousedown', dragStart);\n  gui.domElement.insertBefore(gui.__resize_handle, gui.domElement.firstElementChild);\n}\n\nfunction setWidth(gui, w) {\n  gui.domElement.style.width = w + 'px';\n\n  if (gui.__save_row && gui.autoPlace) {\n    gui.__save_row.style.width = w + 'px';\n  }\n\n  if (gui.__closeButton) {\n    gui.__closeButton.style.width = w + 'px';\n  }\n}\n\nfunction getCurrentPreset(gui, useInitialValues) {\n  var toReturn = {};\n  Common.each(gui.__rememberedObjects, function (val, index) {\n    var savedValues = {};\n    var controllerMap = gui.__rememberedObjectIndecesToControllers[index];\n    Common.each(controllerMap, function (controller, property) {\n      savedValues[property] = useInitialValues ? controller.initialValue : controller.getValue();\n    });\n    toReturn[index] = savedValues;\n  });\n  return toReturn;\n}\n\nfunction setPresetSelectIndex(gui) {\n  for (var index = 0; index < gui.__preset_select.length; index++) {\n    if (gui.__preset_select[index].value === gui.preset) {\n      gui.__preset_select.selectedIndex = index;\n    }\n  }\n}\n\nfunction updateDisplays(controllerArray) {\n  if (controllerArray.length !== 0) {\n    requestAnimationFrame$1.call(window, function () {\n      updateDisplays(controllerArray);\n    });\n  }\n\n  Common.each(controllerArray, function (c) {\n    c.updateDisplay();\n  });\n}\n\nvar color = {\n  Color: Color,\n  math: ColorMath,\n  interpret: interpret\n};\nvar controllers = {\n  Controller: Controller,\n  BooleanController: BooleanController,\n  OptionController: OptionController,\n  StringController: StringController,\n  NumberController: NumberController,\n  NumberControllerBox: NumberControllerBox,\n  NumberControllerSlider: NumberControllerSlider,\n  FunctionController: FunctionController,\n  ColorController: ColorController\n};\nvar dom$1 = {\n  dom: dom\n};\nvar gui = {\n  GUI: GUI\n};\nvar GUI$1 = GUI;\nvar index = {\n  color: color,\n  controllers: controllers,\n  dom: dom$1,\n  gui: gui,\n  GUI: GUI$1\n};\nexport { color, controllers, dom$1 as dom, gui, GUI$1 as GUI };\nexport default index;","/* eslint-disable no-bitwise */\r\nexport function isMobile() {\r\n    return /mobi|android/i.test(navigator.userAgent);\r\n}\r\nexport function clamp01(input: number) {\r\n    return Math.min(Math.max(input, 0), 1);\r\n}\r\n\r\nexport function correctDeltaX(delta: number, canvas: { width: number, height: number }) {\r\n    const aspectRatio = canvas.width / canvas.height;\r\n    if (aspectRatio < 1) delta *= aspectRatio;\r\n    return delta;\r\n}\r\n\r\nexport function correctDeltaY(delta: number, canvas: { width: number, height: number }) {\r\n    const aspectRatio = canvas.width / canvas.height;\r\n    if (aspectRatio > 1) delta /= aspectRatio;\r\n    return delta;\r\n}\r\n\r\nexport function generateColor() {\r\n    const c = HSVtoRGB(Math.random(), 1, 1);\r\n    c.r *= 0.15;\r\n    c.g *= 0.15;\r\n    c.b *= 0.15;\r\n    return c;\r\n}\r\n\r\nexport function HSVtoRGB(h: number, s: number, v: number) {\r\n    const i = Math.floor(h * 6);\r\n    const f = h * 6 - i;\r\n    const p = v * (1 - s);\r\n    const q = v * (1 - f * s);\r\n    const t = v * (1 - (1 - f) * s);\r\n\r\n    switch (i % 6) {\r\n        case 0: return { r: v, g: t, b: p };\r\n        case 1: return { r: q, g: v, b: p };\r\n        case 2: return { r: p, g: v, b: t };\r\n        case 3: return { r: p, g: q, b: v };\r\n        case 4: return { r: t, g: p, b: v };\r\n        case 5: return { r: v, g: p, b: q };\r\n        default: return { r: v, g: p, b: q };\r\n    }\r\n}\r\n\r\nexport function normalizeColor(input: { r: number, g: number, b: number }) {\r\n    const output = {\r\n        r: input.r / 255,\r\n        g: input.g / 255,\r\n        b: input.b / 255,\r\n    };\r\n    return output;\r\n}\r\n\r\nexport function wrap(value: number, min: number, max: number) {\r\n    const range = max - min;\r\n    if (range === 0) return min;\r\n    return (value - min) % range + min;\r\n}\r\n\r\n\r\nexport function getTextureScale(texture: { width: number, height: number }, width: number, height: number) {\r\n    return {\r\n        x: width / texture.width,\r\n        y: height / texture.height,\r\n    };\r\n}\r\n\r\nexport function scaleByPixelRatio(input: number) {\r\n    const pixelRatio = window.devicePixelRatio || 1;\r\n    return Math.floor(input * pixelRatio);\r\n}\r\n\r\nexport function hashCode(s: string) {\r\n    if (!s) return 0;\r\n\r\n    let hash = 0;\r\n    for (let i = 0; i < s.length; i++) {\r\n        hash = (hash << 5) - hash + s.charCodeAt(i);\r\n        hash |= 0; // Convert to 32bit integer\r\n    }\r\n    return hash;\r\n};\r\n\r\nexport const randomIntRange = (minInclusive: number, maxInclusive: number) => {\r\n    return (minInclusive + (maxInclusive - minInclusive + 1) * Math.random()) | 0;\r\n};\r\n\r\nexport type ColorRgb = { r: number, g: number, b: number };\r\n","import { FrameBufferFactory, FrameBufferObject } from './frame-buffer';\r\nimport { clamp01 } from '../utils';\r\nimport { WebGlSystem } from './webgl';\r\n\r\nexport const createTextureUtils = ({ gl, ext }: WebGlSystem, { createFrameBufferObject }: FrameBufferFactory) => {\r\n\r\n    function captureScreenshot(render: (target: FrameBufferObject) => void, { resolution }: { resolution: number }) {\r\n        const res = getResolution(resolution);\r\n        const target = createFrameBufferObject(res.width, res.height, ext.formatRGBA.internalFormat, ext.formatRGBA.format, ext.halfFloatTexType, gl.NEAREST);\r\n        render(target);\r\n\r\n        const texture32 = framebufferToTexture(target);\r\n        const texture = normalizeTexture(texture32, target.width, target.height);\r\n\r\n        const captureCanvas = textureToCanvas(texture, target.width, target.height);\r\n        const datauri = captureCanvas.toDataURL();\r\n        downloadURI(`fluid.png`, datauri);\r\n        URL.revokeObjectURL(datauri);\r\n    }\r\n\r\n    function downloadURI(filename: string, uri: string) {\r\n        const link = document.createElement(`a`);\r\n        link.download = filename;\r\n        link.href = uri;\r\n        document.body.append(link);\r\n        link.click();\r\n        link.remove();\r\n    }\r\n\r\n    function getResolution(resolution: number) {\r\n        let aspectRatio = gl.drawingBufferWidth / gl.drawingBufferHeight;\r\n        if (aspectRatio < 1)\r\n            aspectRatio = 1 / aspectRatio;\r\n\r\n        const min = Math.round(resolution);\r\n        const max = Math.round(resolution * aspectRatio);\r\n\r\n        if (gl.drawingBufferWidth > gl.drawingBufferHeight)\r\n            return { width: max, height: min };\r\n        return { width: min, height: max };\r\n    }\r\n\r\n    function framebufferToTexture(target: FrameBufferObject) {\r\n        gl.bindFramebuffer(gl.FRAMEBUFFER, target.frameBuffer);\r\n        const length = target.width * target.height * 4;\r\n        const texture = new Float32Array(length);\r\n        gl.readPixels(0, 0, target.width, target.height, gl.RGBA, gl.FLOAT, texture);\r\n        return texture;\r\n    }\r\n\r\n    function normalizeTexture(texture: Float32Array, width: number, height: number) {\r\n        const result = new Uint8Array(texture.length);\r\n        let id = 0;\r\n        for (let i = height - 1; i >= 0; i--) {\r\n            for (let j = 0; j < width; j++) {\r\n                const nid = i * width * 4 + j * 4;\r\n                result[nid + 0] = clamp01(texture[id + 0]) * 255;\r\n                result[nid + 1] = clamp01(texture[id + 1]) * 255;\r\n                result[nid + 2] = clamp01(texture[id + 2]) * 255;\r\n                result[nid + 3] = clamp01(texture[id + 3]) * 255;\r\n                id += 4;\r\n            }\r\n        }\r\n        return result;\r\n    }\r\n\r\n    function textureToCanvas(texture: Uint8Array, width: number, height: number) {\r\n        const captureCanvas = document.createElement(`canvas`);\r\n        const ctx = captureCanvas.getContext(`2d`);\r\n        if (!ctx) { throw new Error(`Could not get canvas 2d context`); }\r\n\r\n        captureCanvas.width = width;\r\n        captureCanvas.height = height;\r\n\r\n        const imageData = ctx.createImageData(width, height);\r\n        imageData.data.set(texture);\r\n        ctx.putImageData(imageData, 0, 0);\r\n\r\n        return captureCanvas;\r\n    }\r\n\r\n    return {\r\n        captureScreenshot,\r\n        getResolution,\r\n        // framebufferToTexture,\r\n        // normalizeTexture,\r\n        // textureToCanvas,\r\n    };\r\n};\r\n","/* eslint-disable lines-between-class-members */\r\n/* eslint-disable max-classes-per-file */\r\nimport { hashCode } from '../utils';\r\nimport { WebGlSystem } from './webgl';\r\n\r\nexport const createShaderFactory = ({ gl, ext }: WebGlSystem) => {\r\n    function compileShader(type: number, source: string, keywords?: null | string[]) {\r\n        source = addKeywords(source, keywords);\r\n\r\n        const shader = gl.createShader(type);\r\n        if (!shader) { throw new Error(`shader could not be created`); }\r\n\r\n        gl.shaderSource(shader, source);\r\n        gl.compileShader(shader);\r\n\r\n        if (!gl.getShaderParameter(shader, gl.COMPILE_STATUS)) {\r\n            console.trace(gl.getShaderInfoLog(shader));\r\n        }\r\n\r\n        return shader;\r\n    };\r\n\r\n    function addKeywords(source: string, keywords?: null | string[]) {\r\n        if (!keywords) return source;\r\n\r\n        let keywordsString = ``;\r\n        keywords.forEach(keyword => {\r\n            keywordsString += `#define ${keyword}\\n`;\r\n        });\r\n        return keywordsString + source;\r\n    }\r\n\r\n    function createProgram(vertexShader: WebGLShader, fragmentShader: WebGLShader) {\r\n        const program = gl.createProgram();\r\n        if (!program) { throw new Error(`program could not be created`); }\r\n\r\n        gl.attachShader(program, vertexShader);\r\n        gl.attachShader(program, fragmentShader);\r\n        gl.linkProgram(program);\r\n\r\n        if (!gl.getProgramParameter(program, gl.LINK_STATUS))\r\n            console.trace(gl.getProgramInfoLog(program));\r\n\r\n        return program;\r\n    }\r\n\r\n    function getUniforms(program: WebGLProgram): { [name: string]: WebGLUniformLocation } {\r\n        const uniforms = {} as { [name: string]: WebGLUniformLocation };\r\n        const uniformCount = gl.getProgramParameter(program, gl.ACTIVE_UNIFORMS);\r\n        for (let i = 0; i < uniformCount; i++) {\r\n            // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\r\n            const uniformName = gl.getActiveUniform(program, i)?.name!;\r\n            // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\r\n            uniforms[uniformName] = gl.getUniformLocation(program, uniformName)!;\r\n        }\r\n        return uniforms;\r\n    }\r\n\r\n    return {\r\n        gl,\r\n        ext,\r\n        compileShader,\r\n        createProgram,\r\n        getUniforms,\r\n    };\r\n};\r\n\r\nexport type ShaderFactory = ReturnType<typeof createShaderFactory>;\r\nexport type ShaderUniforms = ReturnType<ShaderFactory['getUniforms']>;\r\n\r\nexport class ShaderMaterial {\r\n    vertexShader: WebGLShader;\r\n    fragmentShaderSource: string;\r\n    programs: WebGLProgram[];\r\n    activeProgram: null | WebGLProgram;\r\n    uniforms: ShaderUniforms;\r\n\r\n    constructor(private factory: ShaderFactory, vertexShader: WebGLShader, fragmentShaderSource: string) {\r\n        this.vertexShader = vertexShader;\r\n        this.fragmentShaderSource = fragmentShaderSource;\r\n        this.programs = [];\r\n        this.activeProgram = null;\r\n        this.uniforms = {};\r\n    }\r\n\r\n    setKeywords(keywords: string[]) {\r\n        let hash = 0;\r\n        for (let i = 0; i < keywords.length; i++)\r\n            hash += hashCode(keywords[i]);\r\n\r\n        let program = this.programs[hash];\r\n        if (program == null) {\r\n            const fragmentShader = this.factory.compileShader(this.factory.gl.FRAGMENT_SHADER, this.fragmentShaderSource, keywords);\r\n            program = this.factory.createProgram(this.vertexShader, fragmentShader);\r\n            this.programs[hash] = program;\r\n        }\r\n\r\n        if (program === this.activeProgram) return;\r\n\r\n        this.uniforms = this.factory.getUniforms(program);\r\n        this.activeProgram = program;\r\n    }\r\n\r\n    bind() {\r\n        this.factory.gl.useProgram(this.activeProgram);\r\n    }\r\n}\r\n\r\nexport class ShaderProgram {\r\n    uniforms: ShaderUniforms;\r\n    program: WebGLProgram;\r\n\r\n    constructor(private factory: ShaderFactory, vertexShader: WebGLShader, fragmentShader: WebGLShader) {\r\n        this.uniforms = {};\r\n        this.program = this.factory.createProgram(vertexShader, fragmentShader);\r\n        this.uniforms = this.factory.getUniforms(this.program);\r\n    }\r\n\r\n    bind() {\r\n        this.factory.gl.useProgram(this.program);\r\n    }\r\n}\r\n","/* eslint-disable no-bitwise */\r\n/* eslint-disable lines-between-class-members */\r\n/* eslint-disable max-classes-per-file */\r\n\r\nimport { TimeProvider } from '../../../time-provider';\r\nimport { createConfig } from './config';\r\nimport { createFrameBufferFactory, createFrameBufferUtils, DoubleFrameBufferObject, FrameBufferObject } from './systems/frame-buffer';\r\nimport { getWebGLSystem } from './systems/webgl';\r\nimport { startGUI } from './gui';\r\nimport { ColorRgb, correctDeltaX, correctDeltaY, generateColor, getTextureScale, isMobile, normalizeColor, randomIntRange, scaleByPixelRatio, wrap } from './utils';\r\nimport { createTextureUtils } from './systems/texture';\r\nimport { createShaderFactory, ShaderMaterial, ShaderProgram } from './systems/shader';\r\nimport { createShaders } from './shaders';\r\n// import { setupAppPopup } from './setup-app-popup';\r\n\r\n\r\nexport const runFluidSimulator = (host: HTMLDivElement, contentPath: string, style: { width: string, height: string }, options?: { timeProvider?: TimeProvider, disableGui?: boolean, disableInput?: boolean, disableStartupSplats?: boolean }) => {\r\n\r\n    const timeProvider = options?.timeProvider ?? { now: () => Date.now(), isPaused: () => false };\r\n\r\n    // setupAppPopup();\r\n\r\n    // Simulation section\r\n\r\n    // Setup ---\r\n    // const canvas = document.querySelectorAll(`canvas`)[0] as HTMLCanvasElement;\r\n    const canvas = document.createElement(`canvas`);\r\n    canvas.style.width = style.width;\r\n    canvas.style.height = style.height;\r\n    host.append(canvas);\r\n\r\n    resizeCanvas();\r\n\r\n\r\n    class PointerEntity {\r\n        id = -1;\r\n        texcoordX = 0;\r\n        texcoordY = 0;\r\n        prevTexcoordX = 0;\r\n        prevTexcoordY = 0;\r\n        deltaX = 0;\r\n        deltaY = 0;\r\n        down = false;\r\n        moved = false;\r\n        color = { r: 30, g: 0, b: 300 };\r\n        size = undefined as undefined | { x: number, y: number };\r\n        p = { r: 0, g: 0, b: 0 };\r\n    }\r\n    type PointerEntityType = PointerEntity;\r\n\r\n    const pointers = [] as PointerEntityType[];\r\n    const splatStack = [] as number[];\r\n    pointers.push(new PointerEntity());\r\n\r\n    console.log(`runFluidSimulator - 01 getWebGLSystem`, {});\r\n    const webGlSystem = getWebGLSystem(canvas);\r\n    if (!webGlSystem) { return null; }\r\n\r\n    const { gl, ext } = webGlSystem;\r\n    console.log(`runFluidSimulator - 01B getWebGLSystem`, { gl, ext });\r\n\r\n    const frameBufferFactory = createFrameBufferFactory(webGlSystem);\r\n    const {\r\n        createFrameBufferObject,\r\n        createDoubleFrameBufferObject,\r\n    } = frameBufferFactory;\r\n\r\n\r\n    const {\r\n        captureScreenshot,\r\n        getResolution,\r\n    } = createTextureUtils(webGlSystem, frameBufferFactory);\r\n\r\n    const shaderFactory = createShaderFactory(webGlSystem);\r\n\r\n    const config = createConfig();\r\n    if (isMobile()) {\r\n        config.DYE_RESOLUTION = 512;\r\n    }\r\n    if (!ext.supportLinearFiltering) {\r\n        config.DYE_RESOLUTION = 512;\r\n        config.SHADING = false;\r\n        config.BLOOM = false;\r\n        config.SUNRAYS = false;\r\n    }\r\n\r\n    console.log(`runFluidSimulator - 02 startGUI`, {});\r\n\r\n    const gui = options?.disableGui ? null : startGUI({\r\n        config,\r\n        splatStack,\r\n        initFramebuffers,\r\n        updateKeywords,\r\n        captureScreenshot: () => captureScreenshot(render, { resolution: config.CAPTURE_RESOLUTION }),\r\n    });\r\n\r\n    console.log(`runFluidSimulator - 03 ditheringTexture`, { url: `${contentPath}/LDR_LLL1_0.png` });\r\n    const ditheringTexture = createTextureAsync(`${contentPath}/LDR_LLL1_0.png`);\r\n\r\n    console.log(`runFluidSimulator - 04 createShaders`, {});\r\n    const shaders = createShaders(shaderFactory);\r\n    const blurProgram = new ShaderProgram(shaderFactory, shaders.blurVertexShader, shaders.blurShader);\r\n    const copyProgram = new ShaderProgram(shaderFactory, shaders.baseVertexShader, shaders.copyShader);\r\n    const clearProgram = new ShaderProgram(shaderFactory, shaders.baseVertexShader, shaders.clearShader);\r\n    const colorProgram = new ShaderProgram(shaderFactory, shaders.baseVertexShader, shaders.colorShader);\r\n    const checkerboardProgram = new ShaderProgram(shaderFactory, shaders.baseVertexShader, shaders.checkerboardShader);\r\n    const bloomPrefilterProgram = new ShaderProgram(shaderFactory, shaders.baseVertexShader, shaders.bloomPrefilterShader);\r\n    const bloomBlurProgram = new ShaderProgram(shaderFactory, shaders.baseVertexShader, shaders.bloomBlurShader);\r\n    const bloomFinalProgram = new ShaderProgram(shaderFactory, shaders.baseVertexShader, shaders.bloomFinalShader);\r\n    const sunraysMaskProgram = new ShaderProgram(shaderFactory, shaders.baseVertexShader, shaders.sunraysMaskShader);\r\n    const sunraysProgram = new ShaderProgram(shaderFactory, shaders.baseVertexShader, shaders.sunraysShader);\r\n    const splatProgram = new ShaderProgram(shaderFactory, shaders.baseVertexShader, shaders.splatShader);\r\n    const advectionProgram = new ShaderProgram(shaderFactory, shaders.baseVertexShader, shaders.advectionShader);\r\n    const divergenceProgram = new ShaderProgram(shaderFactory, shaders.baseVertexShader, shaders.divergenceShader);\r\n    const curlProgram = new ShaderProgram(shaderFactory, shaders.baseVertexShader, shaders.curlShader);\r\n    const vorticityProgram = new ShaderProgram(shaderFactory, shaders.baseVertexShader, shaders.vorticityShader);\r\n    const pressureProgram = new ShaderProgram(shaderFactory, shaders.baseVertexShader, shaders.pressureShader);\r\n    const gradientSubtractProgram = new ShaderProgram(shaderFactory, shaders.baseVertexShader, shaders.gradientSubtractShader);\r\n    const displayMaterial = new ShaderMaterial(shaderFactory, shaders.baseVertexShader, shaders.displayShaderSource);\r\n\r\n    const {\r\n        blit,\r\n    } = createFrameBufferUtils(webGlSystem);\r\n\r\n    let dye: DoubleFrameBufferObject;\r\n    let velocity: DoubleFrameBufferObject;\r\n    let divergence: FrameBufferObject;\r\n    let curl: FrameBufferObject;\r\n    let pressure: DoubleFrameBufferObject;\r\n    let bloom: FrameBufferObject;\r\n    const bloomFramebuffers = [] as FrameBufferObject[];\r\n    let sunrays: FrameBufferObject;\r\n    let sunraysTemp: FrameBufferObject;\r\n\r\n    function resizeFBO(target: FrameBufferObject, w: number, h: number, internalFormat: number, format: number, type: number, param: number) {\r\n        const newFBO = createFrameBufferObject(w, h, internalFormat, format, type, param);\r\n        copyProgram.bind();\r\n        gl.uniform1i(copyProgram.uniforms.uTexture, target.attach(0));\r\n        blit(newFBO);\r\n        return newFBO;\r\n    }\r\n\r\n    function resizeDoubleFBO(target: DoubleFrameBufferObject, w: number, h: number, internalFormat: number, format: number, type: number, param: number) {\r\n        if (target.width === w && target.height === h)\r\n            return target;\r\n        target.read = resizeFBO(target.read, w, h, internalFormat, format, type, param);\r\n        target.write = createFrameBufferObject(w, h, internalFormat, format, type, param);\r\n        target.width = w;\r\n        target.height = h;\r\n        target.texelSizeX = 1 / w;\r\n        target.texelSizeY = 1 / h;\r\n        return target;\r\n    }\r\n\r\n    function initFramebuffers() {\r\n        const simRes = getResolution(config.SIM_RESOLUTION);\r\n        const dyeRes = getResolution(config.DYE_RESOLUTION);\r\n\r\n        const texType = ext.halfFloatTexType;\r\n        const rgba = ext.formatRGBA;\r\n        const rg = ext.formatRG;\r\n        const r = ext.formatR;\r\n        const filtering = ext.supportLinearFiltering ? gl.LINEAR : gl.NEAREST;\r\n\r\n        gl.disable(gl.BLEND);\r\n\r\n        if (dye == null)\r\n            dye = createDoubleFrameBufferObject(dyeRes.width, dyeRes.height, rgba.internalFormat, rgba.format, texType, filtering);\r\n        else\r\n            dye = resizeDoubleFBO(dye, dyeRes.width, dyeRes.height, rgba.internalFormat, rgba.format, texType, filtering);\r\n\r\n        if (velocity == null)\r\n            velocity = createDoubleFrameBufferObject(simRes.width, simRes.height, rg.internalFormat, rg.format, texType, filtering);\r\n        else\r\n            velocity = resizeDoubleFBO(velocity, simRes.width, simRes.height, rg.internalFormat, rg.format, texType, filtering);\r\n\r\n        divergence = createFrameBufferObject(simRes.width, simRes.height, r.internalFormat, r.format, texType, gl.NEAREST);\r\n        curl = createFrameBufferObject(simRes.width, simRes.height, r.internalFormat, r.format, texType, gl.NEAREST);\r\n        pressure = createDoubleFrameBufferObject(simRes.width, simRes.height, r.internalFormat, r.format, texType, gl.NEAREST);\r\n\r\n        initBloomFramebuffers();\r\n        initSunraysFramebuffers();\r\n    }\r\n\r\n    function initBloomFramebuffers() {\r\n        const res = getResolution(config.BLOOM_RESOLUTION);\r\n\r\n        const texType = ext.halfFloatTexType;\r\n        const rgba = ext.formatRGBA;\r\n        const filtering = ext.supportLinearFiltering ? gl.LINEAR : gl.NEAREST;\r\n\r\n        bloom = createFrameBufferObject(res.width, res.height, rgba.internalFormat, rgba.format, texType, filtering);\r\n\r\n        bloomFramebuffers.length = 0;\r\n        for (let i = 0; i < config.BLOOM_ITERATIONS; i++) {\r\n            const width = res.width >> (i + 1);\r\n            const height = res.height >> (i + 1);\r\n\r\n            if (width < 2 || height < 2) break;\r\n\r\n            const fbo = createFrameBufferObject(width, height, rgba.internalFormat, rgba.format, texType, filtering);\r\n            bloomFramebuffers.push(fbo);\r\n        }\r\n    }\r\n\r\n    function initSunraysFramebuffers() {\r\n        const res = getResolution(config.SUNRAYS_RESOLUTION);\r\n\r\n        const texType = ext.halfFloatTexType;\r\n        const r = ext.formatR;\r\n        const filtering = ext.supportLinearFiltering ? gl.LINEAR : gl.NEAREST;\r\n\r\n        sunrays = createFrameBufferObject(res.width, res.height, r.internalFormat, r.format, texType, filtering);\r\n        sunraysTemp = createFrameBufferObject(res.width, res.height, r.internalFormat, r.format, texType, filtering);\r\n    }\r\n\r\n\r\n    function createTextureAsync(url: string) {\r\n        const texture = gl.createTexture();\r\n        gl.bindTexture(gl.TEXTURE_2D, texture);\r\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR);\r\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.LINEAR);\r\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.REPEAT);\r\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.REPEAT);\r\n        gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGB, 1, 1, 0, gl.RGB, gl.UNSIGNED_BYTE, new Uint8Array([255, 255, 255]));\r\n\r\n        const obj = {\r\n            texture,\r\n            width: 1,\r\n            height: 1,\r\n            attach(id: number) {\r\n                gl.activeTexture(gl.TEXTURE0 + id);\r\n                gl.bindTexture(gl.TEXTURE_2D, texture);\r\n                return id;\r\n            },\r\n        };\r\n\r\n        const image = new Image();\r\n        image.addEventListener(`load`, () => {\r\n            obj.width = image.width;\r\n            obj.height = image.height;\r\n            gl.bindTexture(gl.TEXTURE_2D, texture);\r\n            gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGB, gl.RGB, gl.UNSIGNED_BYTE, image);\r\n        });\r\n        image.src = url;\r\n\r\n        return obj;\r\n    }\r\n\r\n    function updateKeywords() {\r\n        const displayKeywords = [];\r\n        if (config.SHADING) displayKeywords.push(`SHADING`);\r\n        if (config.BLOOM) displayKeywords.push(`BLOOM`);\r\n        if (config.SUNRAYS) displayKeywords.push(`SUNRAYS`);\r\n        displayMaterial.setKeywords(displayKeywords);\r\n    }\r\n\r\n    const start = () => {\r\n        resizeCanvas();\r\n\r\n        console.log(`runFluidSimulator - 05 updateKeywords`, {});\r\n        updateKeywords();\r\n\r\n        console.log(`runFluidSimulator - 06 initFramebuffers`, {});\r\n        initFramebuffers();\r\n\r\n        console.log(`runFluidSimulator - 07 multipleSplats`, {});\r\n        if (!options?.disableStartupSplats) {\r\n            multipleSplats(randomIntRange(5, 25));\r\n        }\r\n\r\n        update();\r\n    };\r\n\r\n    let frameTick = 0;\r\n    function update() {\r\n        // console.log(`runFluidSimulator.update START`, {});\r\n        if (timeProvider.isPaused()) {\r\n            console.log(`runFluidSimulator.update timeProvider.PAUSED`, {});\r\n            requestAnimationFrame(update);\r\n            return;\r\n        }\r\n\r\n        const dt = calcDeltaTime();\r\n\r\n        if (resizeCanvas()) {\r\n            updateKeywords();\r\n            initFramebuffers();\r\n        }\r\n        updateColors(dt);\r\n        applyInputs();\r\n        if (!config.PAUSED)\r\n            step(dt);\r\n        render(null);\r\n\r\n        frameTick++;\r\n        requestAnimationFrame(update);\r\n    }\r\n\r\n    let lastUpdateTime = timeProvider.now();\r\n    function calcDeltaTime() {\r\n        const now = timeProvider.now();\r\n        const dtActual = (now - lastUpdateTime) / 1000;\r\n        const dt = Math.min(dtActual, 0.016666);\r\n        lastUpdateTime = now;\r\n        return dt;\r\n    }\r\n\r\n    function resizeCanvas() {\r\n        const width = scaleByPixelRatio(canvas.clientWidth);\r\n        const height = scaleByPixelRatio(canvas.clientHeight);\r\n        if (canvas.width !== width || canvas.height !== height) {\r\n            canvas.width = width;\r\n            canvas.height = height;\r\n            return true;\r\n        }\r\n        return false;\r\n    }\r\n\r\n    let colorUpdateTimer = 0;\r\n    function updateColors(dt: number) {\r\n        if (!config.COLORFUL) return;\r\n\r\n        colorUpdateTimer += dt * config.COLOR_UPDATE_SPEED;\r\n        if (colorUpdateTimer >= 1) {\r\n            colorUpdateTimer = wrap(colorUpdateTimer, 0, 1);\r\n            pointers.forEach(p => {\r\n                p.color = generateColor();\r\n            });\r\n        }\r\n    }\r\n\r\n    function applyInputs() {\r\n\r\n        const lastSplat = splatStack.pop();\r\n        if (lastSplat != null) {\r\n            console.log(`applyInputs: lastSplat`, { lastSplat, splatStack, pointers });\r\n\r\n            multipleSplats(lastSplat);\r\n        }\r\n\r\n        pointers.forEach(p => {\r\n            if (p.moved) {\r\n                p.moved = false;\r\n                splatPointer(p);\r\n            }\r\n        });\r\n\r\n    }\r\n\r\n    function step(dt: number) {\r\n        gl.disable(gl.BLEND);\r\n\r\n        // Calculate curl strength (based on cross-velocity gradient)\r\n        curlProgram.bind();\r\n        gl.uniform2f(curlProgram.uniforms.texelSize, velocity.texelSizeX, velocity.texelSizeY);\r\n        gl.uniform1i(curlProgram.uniforms.uVelocity, velocity.read.attach(0));\r\n        blit(curl);\r\n\r\n        // Apply a vortex acceleration to velocity (based on curl strength)\r\n        vorticityProgram.bind();\r\n        gl.uniform2f(vorticityProgram.uniforms.texelSize, velocity.texelSizeX, velocity.texelSizeY);\r\n        gl.uniform1i(vorticityProgram.uniforms.uVelocity, velocity.read.attach(0));\r\n        gl.uniform1i(vorticityProgram.uniforms.uCurl, curl.attach(1));\r\n        gl.uniform1f(vorticityProgram.uniforms.curl, config.CURL);\r\n        gl.uniform1f(vorticityProgram.uniforms.dt, dt);\r\n        blit(velocity.write);\r\n        velocity.swap();\r\n\r\n        // Calculate divergence strength (based on parallel-velocity gradient)\r\n        divergenceProgram.bind();\r\n        gl.uniform2f(divergenceProgram.uniforms.texelSize, velocity.texelSizeX, velocity.texelSizeY);\r\n        gl.uniform1i(divergenceProgram.uniforms.uVelocity, velocity.read.attach(0));\r\n        blit(divergence);\r\n\r\n        // Dilute last pressure\r\n        clearProgram.bind();\r\n        gl.uniform1i(clearProgram.uniforms.uTexture, pressure.read.attach(0));\r\n        gl.uniform1f(clearProgram.uniforms.value, config.PRESSURE);\r\n        blit(pressure.write);\r\n        pressure.swap();\r\n\r\n        // Distribute pressure over N iterations based on divergence\r\n        pressureProgram.bind();\r\n        gl.uniform2f(pressureProgram.uniforms.texelSize, velocity.texelSizeX, velocity.texelSizeY);\r\n        gl.uniform1i(pressureProgram.uniforms.uDivergence, divergence.attach(0));\r\n        for (let i = 0; i < config.PRESSURE_ITERATIONS; i++) {\r\n            gl.uniform1i(pressureProgram.uniforms.uPressure, pressure.read.attach(1));\r\n            blit(pressure.write);\r\n            pressure.swap();\r\n        }\r\n\r\n        // Apply pressure gradient as a force to velocity\r\n        gradientSubtractProgram.bind();\r\n        gl.uniform2f(gradientSubtractProgram.uniforms.texelSize, velocity.texelSizeX, velocity.texelSizeY);\r\n        gl.uniform1i(gradientSubtractProgram.uniforms.uPressure, pressure.read.attach(0));\r\n        gl.uniform1i(gradientSubtractProgram.uniforms.uVelocity, velocity.read.attach(1));\r\n        blit(velocity.write);\r\n        velocity.swap();\r\n\r\n        // Move the velocity position (based on the velocity)\r\n        advectionProgram.bind();\r\n        gl.uniform2f(advectionProgram.uniforms.texelSize, velocity.texelSizeX, velocity.texelSizeY);\r\n        if (!ext.supportLinearFiltering)\r\n            gl.uniform2f(advectionProgram.uniforms.dyeTexelSize, velocity.texelSizeX, velocity.texelSizeY);\r\n        const velocityId = velocity.read.attach(0);\r\n        gl.uniform1i(advectionProgram.uniforms.uVelocity, velocityId);\r\n        gl.uniform1i(advectionProgram.uniforms.uSource, velocityId);\r\n        gl.uniform1f(advectionProgram.uniforms.dt, dt);\r\n        gl.uniform1f(advectionProgram.uniforms.dissipation, config.VELOCITY_DISSIPATION);\r\n        gl.uniform2f(advectionProgram.uniforms.motion, config.MOTION_X, config.MOTION_Y);\r\n        blit(velocity.write);\r\n        velocity.swap();\r\n\r\n        // Move the dye position (based on the velocity)\r\n        if (!ext.supportLinearFiltering)\r\n            gl.uniform2f(advectionProgram.uniforms.dyeTexelSize, dye.texelSizeX, dye.texelSizeY);\r\n        gl.uniform1i(advectionProgram.uniforms.uVelocity, velocity.read.attach(0));\r\n        gl.uniform1i(advectionProgram.uniforms.uSource, dye.read.attach(1));\r\n        gl.uniform1f(advectionProgram.uniforms.dissipation, config.DENSITY_DISSIPATION);\r\n        gl.uniform2f(advectionProgram.uniforms.motion, config.MOTION_X, config.MOTION_Y);\r\n        blit(dye.write);\r\n        dye.swap();\r\n    }\r\n\r\n    function render(target: null | FrameBufferObject) {\r\n        if (config.BLOOM)\r\n            applyBloom(dye.read, bloom);\r\n        if (config.SUNRAYS) {\r\n            applySunrays(dye.read, dye.write, sunrays);\r\n            blur(sunrays, sunraysTemp, 1);\r\n        }\r\n\r\n        if (target == null || !config.TRANSPARENT) {\r\n            gl.blendFunc(gl.ONE, gl.ONE_MINUS_SRC_ALPHA);\r\n            gl.enable(gl.BLEND);\r\n        }\r\n        else {\r\n            gl.disable(gl.BLEND);\r\n        }\r\n\r\n        if (!config.TRANSPARENT)\r\n            drawColor(target, normalizeColor(config.BACK_COLOR));\r\n        if (target == null && config.TRANSPARENT)\r\n            drawCheckerboard(target);\r\n        drawDisplay(target);\r\n    }\r\n\r\n    function drawColor(target: null | FrameBufferObject, color: ColorRgb) {\r\n        colorProgram.bind();\r\n        gl.uniform4f(colorProgram.uniforms.color, color.r, color.g, color.b, 1);\r\n        blit(target);\r\n    }\r\n\r\n    function drawCheckerboard(target: null | FrameBufferObject) {\r\n        checkerboardProgram.bind();\r\n        gl.uniform1f(checkerboardProgram.uniforms.aspectRatio, canvas.width / canvas.height);\r\n        blit(target);\r\n    }\r\n\r\n    const TESTING = false;\r\n    let testCount = 0;\r\n    const getTestMaterials = () => [\r\n        dye.read,\r\n        velocity.read,\r\n        // divergence,\r\n        // curl,\r\n        // pressure.read,\r\n        // bloom,\r\n        // ditheringTexture,\r\n        // sunrays,\r\n        // sunraysTemp,\r\n    ];\r\n    function drawDisplay(target: null | FrameBufferObject) {\r\n        // console.log(`drawDisplay`, { target });\r\n\r\n        const width = target == null ? gl.drawingBufferWidth : target.width;\r\n        const height = target == null ? gl.drawingBufferHeight : target.height;\r\n\r\n        if (TESTING) {\r\n            displayMaterial.bind();\r\n            const tMats = getTestMaterials();\r\n            const tMat = tMats[Math.floor(testCount / 100) % tMats.length];\r\n            gl.uniform1i(displayMaterial.uniforms.uTexture, tMat.attach(0));\r\n            blit(target);\r\n            testCount++;\r\n            return;\r\n        }\r\n\r\n        displayMaterial.bind();\r\n        if (config.SHADING)\r\n            gl.uniform2f(displayMaterial.uniforms.texelSize, 1 / width, 1 / height);\r\n        gl.uniform1i(displayMaterial.uniforms.uTexture, dye.read.attach(0));\r\n        if (config.BLOOM) {\r\n            gl.uniform1i(displayMaterial.uniforms.uBloom, bloom.attach(1));\r\n            gl.uniform1i(displayMaterial.uniforms.uDithering, ditheringTexture.attach(2));\r\n            const scale = getTextureScale(ditheringTexture, width, height);\r\n            gl.uniform2f(displayMaterial.uniforms.ditherScale, scale.x, scale.y);\r\n        }\r\n        if (config.SUNRAYS)\r\n            gl.uniform1i(displayMaterial.uniforms.uSunrays, sunrays.attach(3));\r\n        blit(target);\r\n    }\r\n\r\n    function applyBloom(source: FrameBufferObject, destination: FrameBufferObject) {\r\n        if (bloomFramebuffers.length < 2)\r\n            return;\r\n\r\n        let last = destination;\r\n\r\n        gl.disable(gl.BLEND);\r\n        bloomPrefilterProgram.bind();\r\n        const knee = config.BLOOM_THRESHOLD * config.BLOOM_SOFT_KNEE + 0.0001;\r\n        const curve0 = config.BLOOM_THRESHOLD - knee;\r\n        const curve1 = knee * 2;\r\n        const curve2 = 0.25 / knee;\r\n        gl.uniform3f(bloomPrefilterProgram.uniforms.curve, curve0, curve1, curve2);\r\n        gl.uniform1f(bloomPrefilterProgram.uniforms.threshold, config.BLOOM_THRESHOLD);\r\n        gl.uniform1i(bloomPrefilterProgram.uniforms.uTexture, source.attach(0));\r\n        blit(last);\r\n\r\n        bloomBlurProgram.bind();\r\n        for (const dest of bloomFramebuffers) {\r\n            gl.uniform2f(bloomBlurProgram.uniforms.texelSize, last.texelSizeX, last.texelSizeY);\r\n            gl.uniform1i(bloomBlurProgram.uniforms.uTexture, last.attach(0));\r\n            blit(dest);\r\n            last = dest;\r\n        }\r\n\r\n        gl.blendFunc(gl.ONE, gl.ONE);\r\n        gl.enable(gl.BLEND);\r\n\r\n        for (let i = bloomFramebuffers.length - 2; i >= 0; i--) {\r\n            const baseTex = bloomFramebuffers[i];\r\n            gl.uniform2f(bloomBlurProgram.uniforms.texelSize, last.texelSizeX, last.texelSizeY);\r\n            gl.uniform1i(bloomBlurProgram.uniforms.uTexture, last.attach(0));\r\n            gl.viewport(0, 0, baseTex.width, baseTex.height);\r\n            blit(baseTex);\r\n            last = baseTex;\r\n        }\r\n\r\n        gl.disable(gl.BLEND);\r\n        bloomFinalProgram.bind();\r\n        gl.uniform2f(bloomFinalProgram.uniforms.texelSize, last.texelSizeX, last.texelSizeY);\r\n        gl.uniform1i(bloomFinalProgram.uniforms.uTexture, last.attach(0));\r\n        gl.uniform1f(bloomFinalProgram.uniforms.intensity, config.BLOOM_INTENSITY);\r\n        blit(destination);\r\n    }\r\n\r\n    function applySunrays(source: FrameBufferObject, mask: FrameBufferObject, destination: FrameBufferObject) {\r\n        gl.disable(gl.BLEND);\r\n        sunraysMaskProgram.bind();\r\n        gl.uniform1i(sunraysMaskProgram.uniforms.uTexture, source.attach(0));\r\n        blit(mask);\r\n\r\n        sunraysProgram.bind();\r\n        gl.uniform1f(sunraysProgram.uniforms.weight, config.SUNRAYS_WEIGHT);\r\n        gl.uniform1i(sunraysProgram.uniforms.uTexture, mask.attach(0));\r\n        blit(destination);\r\n    }\r\n\r\n    function blur(target: FrameBufferObject, temp: FrameBufferObject, iterations: number) {\r\n        blurProgram.bind();\r\n        for (let i = 0; i < iterations; i++) {\r\n            gl.uniform2f(blurProgram.uniforms.texelSize, target.texelSizeX, 0);\r\n            gl.uniform1i(blurProgram.uniforms.uTexture, target.attach(0));\r\n            blit(temp);\r\n\r\n            gl.uniform2f(blurProgram.uniforms.texelSize, 0, target.texelSizeY);\r\n            gl.uniform1i(blurProgram.uniforms.uTexture, temp.attach(0));\r\n            blit(target);\r\n        }\r\n    }\r\n\r\n    function splatPointer(pointer: PointerEntity) {\r\n        const dx = pointer.deltaX * config.SPLAT_FORCE;\r\n        const dy = pointer.deltaY * config.SPLAT_FORCE;\r\n        // const dy = -10;\r\n        splat(pointer.texcoordX, pointer.texcoordY, dx, dy, pointer.color, pointer.size);\r\n    }\r\n\r\n    function multipleSplats(amount: number) {\r\n        for (let i = 0; i < amount; i++) {\r\n            const color = generateColor();\r\n            color.r *= 10;\r\n            color.g *= 10;\r\n            color.b *= 10;\r\n            const x = Math.random();\r\n            const y = Math.random();\r\n            const dx = 1000 * (Math.random() - 0.5);\r\n            const dy = 1000 * (Math.random() - 0.5);\r\n            splat(x, y, dx, dy, color);\r\n        }\r\n    }\r\n\r\n    function splat(x: number, y: number, dx: number, dy: number, color: ColorRgb, size?: { x: number, y: number }) {\r\n        // console.log(`splat`, { x, y, dx, dy, color });\r\n\r\n        splatProgram.bind();\r\n        gl.uniform1i(splatProgram.uniforms.uTarget, velocity.read.attach(0));\r\n        gl.uniform1f(splatProgram.uniforms.aspectRatio, canvas.width / canvas.height);\r\n        gl.uniform2f(splatProgram.uniforms.point, x, y);\r\n        gl.uniform3f(splatProgram.uniforms.color, dx, dy, 0);\r\n        gl.uniform1f(splatProgram.uniforms.radius, correctRadius((size?.x ?? (config.SPLAT_RADIUS * 2)) * 0.5 / 100));\r\n        blit(velocity.write);\r\n        velocity.swap();\r\n\r\n        gl.uniform1i(splatProgram.uniforms.uTarget, dye.read.attach(0));\r\n        gl.uniform3f(splatProgram.uniforms.color, color.r, color.g, color.b);\r\n        blit(dye.write);\r\n        dye.swap();\r\n    }\r\n\r\n    function correctRadius(radius: number) {\r\n        const aspectRatio = canvas.width / canvas.height;\r\n        if (aspectRatio > 1)\r\n            radius *= aspectRatio;\r\n        return radius;\r\n    }\r\n\r\n    console.log(`runFluidSimulator - 08 addEventListeners`, {});\r\n\r\n    const windowSubs = [] as { name: string, handler: () => void }[];\r\n    const windowAddEventListener = ((name: string, handler: () => void) => {\r\n        if (options?.disableInput) { return; }\r\n\r\n        window.addEventListener(name, handler);\r\n        windowSubs.push({ name, handler });\r\n    }) as typeof window.addEventListener;\r\n    const windowEventListenersDestroy = () => {\r\n        windowSubs.forEach(({ name, handler }) => {\r\n            window.removeEventListener(name, handler);\r\n        });\r\n    };\r\n\r\n    const canvasSubs = [] as { name: string, handler: () => void }[];\r\n    const canvasAddEventListener = ((name: string, handler: () => void) => {\r\n        if (options?.disableInput) { return; }\r\n\r\n        canvas.addEventListener(name, handler);\r\n        canvasSubs.push({ name, handler });\r\n    }) as typeof canvas.addEventListener;\r\n    const canvasEventListenersDestroy = () => {\r\n        canvasSubs.forEach(({ name, handler }) => {\r\n            canvas.removeEventListener(name, handler);\r\n        });\r\n    };\r\n\r\n    canvasAddEventListener(`mousedown`, e => {\r\n        const posX = scaleByPixelRatio(e.offsetX);\r\n        const posY = scaleByPixelRatio(e.offsetY);\r\n        let pointer = pointers.find(p => p.id === -1);\r\n        if (pointer == null)\r\n            pointer = new PointerEntity();\r\n        updatePointerDownData(pointer, -1, posX, posY);\r\n    });\r\n\r\n    canvasAddEventListener(`mousemove`, e => {\r\n        const pointer = pointers[0];\r\n        if (!pointer.down) return;\r\n        const posX = scaleByPixelRatio(e.offsetX);\r\n        const posY = scaleByPixelRatio(e.offsetY);\r\n        updatePointerMoveData(pointer, posX, posY);\r\n    });\r\n\r\n    windowAddEventListener(`mouseup`, () => {\r\n        updatePointerUpData(pointers[0]);\r\n    });\r\n\r\n    canvasAddEventListener(`touchstart`, e => {\r\n        e.preventDefault();\r\n        const touches = e.targetTouches as unknown as Touch[];\r\n        while (touches.length >= pointers.length)\r\n            pointers.push(new PointerEntity());\r\n        for (const [i, touch] of touches.entries()) {\r\n            const posX = scaleByPixelRatio(touch.pageX);\r\n            const posY = scaleByPixelRatio(touch.pageY);\r\n            updatePointerDownData(pointers[i + 1], touch.identifier, posX, posY);\r\n        }\r\n    });\r\n\r\n    canvasAddEventListener(`touchmove`, e => {\r\n        e.preventDefault();\r\n        const touches = e.targetTouches as unknown as Touch[];\r\n        for (const [i, touch] of touches.entries()) {\r\n            const pointer = pointers[i + 1];\r\n            if (!pointer.down) continue;\r\n            const posX = scaleByPixelRatio(touch.pageX);\r\n            const posY = scaleByPixelRatio(touch.pageY);\r\n            updatePointerMoveData(pointer, posX, posY);\r\n        }\r\n    }, false);\r\n\r\n    windowAddEventListener(`touchend`, e => {\r\n        const touches = e.changedTouches as unknown as Touch[];\r\n        for (const touch of touches) {\r\n            const pointer = pointers.find(p => p.id === touch.identifier);\r\n            if (pointer == null) continue;\r\n            updatePointerUpData(pointer);\r\n        }\r\n    });\r\n\r\n    windowAddEventListener(`keydown`, e => {\r\n        if (e.code === `KeyP`)\r\n            config.PAUSED = !config.PAUSED;\r\n        if (e.key === ` `)\r\n            splatStack.push(randomIntRange(5, 25));\r\n    });\r\n\r\n    function updatePointerDownData(pointer: PointerEntity, id: number, posX: number, posY: number) {\r\n        pointer.id = id;\r\n        pointer.down = true;\r\n        pointer.moved = false;\r\n        pointer.texcoordX = posX / canvas.width;\r\n        pointer.texcoordY = 1 - posY / canvas.height;\r\n        pointer.prevTexcoordX = pointer.texcoordX;\r\n        pointer.prevTexcoordY = pointer.texcoordY;\r\n        pointer.deltaX = 0;\r\n        pointer.deltaY = 0;\r\n        pointer.color = generateColor();\r\n\r\n        // console.log(`updatePointerDownData`, { pointer });\r\n    }\r\n\r\n    function updatePointerMoveData(pointer: PointerEntity, posX: number, posY: number) {\r\n        pointer.prevTexcoordX = pointer.texcoordX;\r\n        pointer.prevTexcoordY = pointer.texcoordY;\r\n        pointer.texcoordX = posX / canvas.width;\r\n        pointer.texcoordY = 1 - posY / canvas.height;\r\n        pointer.deltaX = correctDeltaX(pointer.texcoordX - pointer.prevTexcoordX, canvas);\r\n        pointer.deltaY = correctDeltaY(pointer.texcoordY - pointer.prevTexcoordY, canvas);\r\n        pointer.moved = Math.abs(pointer.deltaX) > 0 || Math.abs(pointer.deltaY) > 0;\r\n    }\r\n\r\n    function updatePointerUpData(pointer: PointerEntity) {\r\n        pointer.down = false;\r\n    }\r\n\r\n    // console.log(`runFluidSimulator - 09 update Start Loop`, {});\r\n    // update();\r\n\r\n    console.log(`runFluidSimulator - 10 DONE`, {});\r\n\r\n    const pointerMap = new Map<number, PointerEntity>();\r\n    return {\r\n        start,\r\n        canvas,\r\n        getDisplaySize: () => ({\r\n            width: canvas.width,\r\n            height: canvas.height,\r\n        }),\r\n        getFrameTick: () => frameTick,\r\n        config,\r\n        updateConfig: () => {\r\n            updateKeywords();\r\n        },\r\n        splat: (id: number, active: boolean, x: number, y: number, dx: number, dy: number, size?: { x: number, y: number }, color?: ColorRgb) => {\r\n            let p = pointerMap.get(id);\r\n            if (!p) {\r\n                p = new PointerEntity();\r\n                pointerMap.set(id, p);\r\n                pointers.push(p);\r\n                p.id = id;\r\n                // console.log(`splat - new`, { id, active, x, y });\r\n            }\r\n            // console.log(`splat`, { id, color, active, x, y });\r\n\r\n\r\n            p.down = active;\r\n            p.moved = active;\r\n            p.texcoordX = x;\r\n            p.texcoordY = y;\r\n            p.prevTexcoordX = x - dx;\r\n            p.prevTexcoordY = y - dy;\r\n            p.deltaX = correctDeltaX(p.texcoordX - p.prevTexcoordX, canvas);\r\n            p.deltaY = correctDeltaY(p.texcoordY - p.prevTexcoordY, canvas);\r\n            p.color = color ?? generateColor();\r\n            p.size = size;\r\n        },\r\n        close: () => {\r\n            gui?.gui?.destroy();\r\n            windowEventListenersDestroy();\r\n            canvasEventListenersDestroy();\r\n\r\n            gl.canvas.width = 1;\r\n            gl.canvas.height = 1;\r\n            canvas.remove();\r\n        },\r\n    };\r\n};\r\n","import { WebGlSystem } from './webgl';\r\n\r\nexport const createFrameBufferFactory = ({ gl }: WebGlSystem) => {\r\n\r\n    function createFrameBufferObject(w: number, h: number, internalFormat: number, format: number, type: number, param: number) {\r\n        gl.activeTexture(gl.TEXTURE0);\r\n        const texture = gl.createTexture();\r\n        if (!texture) { throw new Error(`texture not created`); }\r\n\r\n        gl.bindTexture(gl.TEXTURE_2D, texture);\r\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, param);\r\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, param);\r\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\r\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\r\n        gl.texImage2D(gl.TEXTURE_2D, 0, internalFormat, w, h, 0, format, type, null);\r\n\r\n        const frameBuffer = gl.createFramebuffer();\r\n        if (!frameBuffer) { throw new Error(`frame buffer not created`); }\r\n\r\n        gl.bindFramebuffer(gl.FRAMEBUFFER, frameBuffer);\r\n        gl.framebufferTexture2D(gl.FRAMEBUFFER, gl.COLOR_ATTACHMENT0, gl.TEXTURE_2D, texture, 0);\r\n        gl.viewport(0, 0, w, h);\r\n        gl.clear(gl.COLOR_BUFFER_BIT);\r\n\r\n        const texelSizeX = 1 / w;\r\n        const texelSizeY = 1 / h;\r\n\r\n        return {\r\n            texture,\r\n            frameBuffer,\r\n            width: w,\r\n            height: h,\r\n            texelSizeX,\r\n            texelSizeY,\r\n            attach(id: number) {\r\n                gl.activeTexture(gl.TEXTURE0 + id);\r\n                gl.bindTexture(gl.TEXTURE_2D, texture);\r\n                return id;\r\n            },\r\n        };\r\n    }\r\n\r\n    function createDoubleFrameBufferObject(w: number, h: number, internalFormat: number, format: number, type: number, param: number) {\r\n        let fbo1 = createFrameBufferObject(w, h, internalFormat, format, type, param);\r\n        let fbo2 = createFrameBufferObject(w, h, internalFormat, format, type, param);\r\n\r\n        return {\r\n            width: w,\r\n            height: h,\r\n            texelSizeX: fbo1.texelSizeX,\r\n            texelSizeY: fbo1.texelSizeY,\r\n            get read() {\r\n                return fbo1;\r\n            },\r\n            set read(value) {\r\n                fbo1 = value;\r\n            },\r\n            get write() {\r\n                return fbo2;\r\n            },\r\n            set write(value) {\r\n                fbo2 = value;\r\n            },\r\n            swap() {\r\n                const temp = fbo1;\r\n                fbo1 = fbo2;\r\n                fbo2 = temp;\r\n            },\r\n        };\r\n    }\r\n\r\n\r\n    return {\r\n        createFrameBufferObject,\r\n        createDoubleFrameBufferObject,\r\n    };\r\n};\r\n\r\nexport type FrameBufferFactory = ReturnType<typeof createFrameBufferFactory>;\r\nexport type FrameBufferObject = ReturnType<FrameBufferFactory['createFrameBufferObject']>;\r\nexport type DoubleFrameBufferObject = ReturnType<FrameBufferFactory['createDoubleFrameBufferObject']>;\r\n\r\n\r\nexport const createFrameBufferUtils = ({ gl }: WebGlSystem) => {\r\n\r\n    const createBlit = () => {\r\n        // 4 2d-coords: [0](-1,-1) [1](-1,1) [2](1,1) [3](1,-1)\r\n        gl.bindBuffer(gl.ARRAY_BUFFER, gl.createBuffer());\r\n        gl.bufferData(gl.ARRAY_BUFFER, new Float32Array([-1, -1, -1, 1, 1, 1, 1, -1]), gl.STATIC_DRAW);\r\n\r\n        // 6 points (2 triangles) => [0,1,2] [0,2,3]\r\n        gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, gl.createBuffer());\r\n        gl.bufferData(gl.ELEMENT_ARRAY_BUFFER, new Uint16Array([0, 1, 2, 0, 2, 3]), gl.STATIC_DRAW);\r\n\r\n        // coords = size 2, floats, no norm, stride, or offset\r\n        gl.vertexAttribPointer(0, 2, gl.FLOAT, false, 0, 0);\r\n        gl.enableVertexAttribArray(0);\r\n\r\n        return (target: null | FrameBufferObject, clear = false) => {\r\n            // console.log(`blit`, { target, clear });\r\n\r\n            if (target == null) {\r\n                gl.viewport(0, 0, gl.drawingBufferWidth, gl.drawingBufferHeight);\r\n                gl.bindFramebuffer(gl.FRAMEBUFFER, null);\r\n            }\r\n            else {\r\n                gl.viewport(0, 0, target.width, target.height);\r\n                gl.bindFramebuffer(gl.FRAMEBUFFER, target.frameBuffer);\r\n            }\r\n            if (clear) {\r\n                gl.clearColor(0, 0, 0, 1);\r\n                gl.clear(gl.COLOR_BUFFER_BIT);\r\n            }\r\n            // CHECK_FRAMEBUFFER_STATUS();\r\n\r\n            // 2 Triangles (6 points)\r\n            gl.drawElements(gl.TRIANGLES, 6, gl.UNSIGNED_SHORT, 0);\r\n        };\r\n    };\r\n    const blit = createBlit();\r\n\r\n    // function CHECK_FRAMEBUFFER_STATUS() {\r\n    //     const status = gl.checkFramebufferStatus(gl.FRAMEBUFFER);\r\n    //     if (status != gl.FRAMEBUFFER_COMPLETE)\r\n    //         console.trace(`Framebuffer error: ${status}`);\r\n    // }\r\n\r\n    return {\r\n        blit,\r\n    };\r\n};\r\n","\r\n// Normal\r\nexport const createConfig = () => ({\r\n    SIM_RESOLUTION: 128,\r\n    DYE_RESOLUTION: 1024,\r\n    CAPTURE_RESOLUTION: 512,\r\n    DENSITY_DISSIPATION: 1,\r\n    VELOCITY_DISSIPATION: 0.2,\r\n    PRESSURE: 0.8,\r\n    PRESSURE_ITERATIONS: 20,\r\n    CURL: 30,\r\n    SPLAT_RADIUS: 0.25,\r\n    SPLAT_FORCE: 6000,\r\n    SHADING: true,\r\n    COLORFUL: true,\r\n    COLOR_UPDATE_SPEED: 10,\r\n    PAUSED: false,\r\n    BACK_COLOR: { r: 0, g: 0, b: 0 },\r\n    TRANSPARENT: false,\r\n    BLOOM: true,\r\n    BLOOM_ITERATIONS: 8,\r\n    BLOOM_RESOLUTION: 256,\r\n    BLOOM_INTENSITY: 0.8,\r\n    BLOOM_THRESHOLD: 0.6,\r\n    BLOOM_SOFT_KNEE: 0.7,\r\n    SUNRAYS: true,\r\n    SUNRAYS_RESOLUTION: 196,\r\n    SUNRAYS_WEIGHT: 1,\r\n\r\n    MOTION_X: 0,\r\n    MOTION_Y: 0,\r\n});\r\n\r\n// Simple\r\n// export const createConfig = () => ({\r\n//     SIM_RESOLUTION: 128,\r\n//     DYE_RESOLUTION: 1024,\r\n//     CAPTURE_RESOLUTION: 512,\r\n//     DENSITY_DISSIPATION: 0.1,\r\n//     VELOCITY_DISSIPATION: 0.1,\r\n//     PRESSURE: 1,\r\n//     PRESSURE_ITERATIONS: 20,\r\n//     CURL: 0,\r\n//     SPLAT_RADIUS: 0.1,\r\n//     SPLAT_FORCE: 6000,\r\n//     SHADING: false,\r\n//     COLORFUL: true,\r\n//     COLOR_UPDATE_SPEED: 10,\r\n//     PAUSED: false,\r\n//     BACK_COLOR: { r: 0, g: 0, b: 0 },\r\n//     TRANSPARENT: false,\r\n//     BLOOM: false,\r\n//     BLOOM_ITERATIONS: 8,\r\n//     BLOOM_RESOLUTION: 256,\r\n//     BLOOM_INTENSITY: 0.8,\r\n//     BLOOM_THRESHOLD: 0.6,\r\n//     BLOOM_SOFT_KNEE: 0.7,\r\n//     SUNRAYS: false,\r\n//     SUNRAYS_RESOLUTION: 196,\r\n//     SUNRAYS_WEIGHT: 1,\r\n// });\r\n\r\nexport type Config = ReturnType<typeof createConfig>;\r\n","import * as dat from 'dat.gui';\r\nimport { Config } from './config';\r\nimport { ga } from './ga';\r\nimport { isMobile, randomIntRange } from './utils';\r\n\r\n// type DatGui = {\r\n//     add: (configObject: unknown, key: string, options?: (number | { [key: string]: number }), options2?: number) => {\r\n//         name: (value: string) => {\r\n//             onFinishChange: (callback: () => void) => void;\r\n//             listen: () => void;\r\n//             step: (count: number) => void;\r\n//             __li: {\r\n//                 className: string;\r\n//                 style: HTMLDivElement['style'];\r\n//             };\r\n//             domElement: HTMLDivElement;\r\n//         };\r\n//     };\r\n//     addFolder: (name: string) => DatGui;\r\n//     addColor: (configObject: unknown, key: string) => {\r\n//         name: (value: string) => void;\r\n//     };\r\n//     close: () => void;\r\n// };\r\n// declare let dat: {\r\n//     GUI: {\r\n//         new(...args: unknown[]): DatGui;\r\n//     };\r\n// };\r\n\r\nexport function startGUI({\r\n    config,\r\n    splatStack,\r\n    initFramebuffers,\r\n    updateKeywords,\r\n    captureScreenshot,\r\n}: {\r\n    config: Config;\r\n    splatStack: number[];\r\n    initFramebuffers: () => void;\r\n    updateKeywords: () => void;\r\n    captureScreenshot: () => void;\r\n}) {\r\n    const gui = new dat.GUI({ width: 300 });\r\n    gui.add(config, `DYE_RESOLUTION`, { 'high': 1024, 'medium': 512, 'low': 256, 'very low': 128 }).name(`quality`).onFinishChange(initFramebuffers);\r\n    gui.add(config, `SIM_RESOLUTION`, { '32': 32, '64': 64, '128': 128, '256': 256 }).name(`sim resolution`).onFinishChange(initFramebuffers);\r\n    gui.add(config, `DENSITY_DISSIPATION`, 0, 4).name(`density diffusion`);\r\n    gui.add(config, `VELOCITY_DISSIPATION`, 0, 4).name(`velocity diffusion`);\r\n    gui.add(config, `PRESSURE`, 0, 1).name(`pressure`);\r\n    gui.add(config, `CURL`, 0, 50).name(`vorticity`).step(1);\r\n    gui.add(config, `SPLAT_RADIUS`, 0.01, 1).name(`splat radius`);\r\n    gui.add(config, `SHADING`).name(`shading`).onFinishChange(updateKeywords);\r\n    gui.add(config, `COLORFUL`).name(`colorful`);\r\n    gui.add(config, `PAUSED`).name(`paused`).listen();\r\n\r\n    gui.add({\r\n        fun: () => {\r\n            splatStack.push(randomIntRange(5, 25));\r\n        },\r\n    }, `fun`).name(`Random splats`);\r\n\r\n    const bloomFolder = gui.addFolder(`Bloom`);\r\n    bloomFolder.add(config, `BLOOM`).name(`enabled`).onFinishChange(updateKeywords);\r\n    bloomFolder.add(config, `BLOOM_INTENSITY`, 0.1, 2).name(`intensity`);\r\n    bloomFolder.add(config, `BLOOM_THRESHOLD`, 0, 1).name(`threshold`);\r\n\r\n    const sunraysFolder = gui.addFolder(`Sunrays`);\r\n    sunraysFolder.add(config, `SUNRAYS`).name(`enabled`).onFinishChange(updateKeywords);\r\n    sunraysFolder.add(config, `SUNRAYS_WEIGHT`, 0.3, 1).name(`weight`);\r\n\r\n    const captureFolder = gui.addFolder(`Capture`);\r\n    captureFolder.addColor(config, `BACK_COLOR`).name(`background color`);\r\n    captureFolder.add(config, `TRANSPARENT`).name(`transparent`);\r\n    captureFolder.add({ fun: captureScreenshot }, `fun`).name(`take screenshot`);\r\n\r\n    const github = gui.add({\r\n        fun: () => {\r\n            window.open(`https://github.com/PavelDoGreat/WebGL-Fluid-Simulation`);\r\n            ga(`send`, `event`, `link button`, `github`);\r\n        },\r\n    }, `fun`).name(`Github - PavelDoGreat`);\r\n    // github.__li.className = `cr function bigFont`;\r\n    // github.__li.style.borderLeft = `3px solid #8C8C8C`;\r\n    const githubIcon = document.createElement(`span`);\r\n    github.domElement.parentElement?.append(githubIcon);\r\n    githubIcon.className = `icon github`;\r\n\r\n    // const twitter = gui.add({\r\n    //     fun: () => {\r\n    //         ga(`send`, `event`, `link button`, `twitter`);\r\n    //         window.open(`https://twitter.com/PavelDoGreat`);\r\n    //     },\r\n    // }, `fun`).name(`Twitter`);\r\n    // twitter.__li.className = `cr function bigFont`;\r\n    // twitter.__li.style.borderLeft = `3px solid #8C8C8C`;\r\n    // const twitterIcon = document.createElement(`span`);\r\n    // twitter.domElement.parentElement?.append(twitterIcon);\r\n    // twitterIcon.className = `icon twitter`;\r\n\r\n    // const discord = gui.add({\r\n    //     fun: () => {\r\n    //         ga(`send`, `event`, `link button`, `discord`);\r\n    //         window.open(`https://discordapp.com/invite/CeqZDDE`);\r\n    //     },\r\n    // }, `fun`).name(`Discord`);\r\n    // discord.__li.className = `cr function bigFont`;\r\n    // discord.__li.style.borderLeft = `3px solid #8C8C8C`;\r\n    // const discordIcon = document.createElement(`span`);\r\n    // discord.domElement.parentElement?.append(discordIcon);\r\n    // discordIcon.className = `icon discord`;\r\n\r\n    // const app = gui.add({\r\n    //     fun: () => {\r\n    //         ga(`send`, `event`, `link button`, `app`);\r\n    //         window.open(`http://onelink.to/5b58bn`);\r\n    //     },\r\n    // }, `fun`).name(`Check out mobile app`);\r\n    // app.__li.className = `cr function appBigFont`;\r\n    // app.__li.style.borderLeft = `3px solid #00FF7F`;\r\n    // const appIcon = document.createElement(`span`);\r\n    // app.domElement.parentElement?.append(appIcon);\r\n    // appIcon.className = `icon app`;\r\n\r\n    // if (isMobile())\r\n    //     gui.close();\r\n    gui.close();\r\n\r\n    return { gui };\r\n}\r\n","import { ShaderFactory } from './systems/shader';\r\n\r\nexport const createShaders = ({ gl, ext, compileShader }: ShaderFactory) => {\r\n    return {\r\n        baseVertexShader: compileShader(gl.VERTEX_SHADER, `\r\n    precision highp float;\r\n\r\n    attribute vec2 aPosition;\r\n    varying vec2 vUv;\r\n    varying vec2 vL;\r\n    varying vec2 vR;\r\n    varying vec2 vT;\r\n    varying vec2 vB;\r\n    uniform vec2 texelSize;\r\n\r\n    void main () {\r\n        vUv = aPosition * 0.5 + 0.5;\r\n        vL = vUv - vec2(texelSize.x, 0.0);\r\n        vR = vUv + vec2(texelSize.x, 0.0);\r\n        vT = vUv + vec2(0.0, texelSize.y);\r\n        vB = vUv - vec2(0.0, texelSize.y);\r\n        gl_Position = vec4(aPosition, 0.0, 1.0);\r\n    }\r\n`),\r\n\r\n        blurVertexShader: compileShader(gl.VERTEX_SHADER, `\r\n    precision highp float;\r\n\r\n    attribute vec2 aPosition;\r\n    varying vec2 vUv;\r\n    varying vec2 vL;\r\n    varying vec2 vR;\r\n    uniform vec2 texelSize;\r\n\r\n    void main () {\r\n        vUv = aPosition * 0.5 + 0.5;\r\n        float offset = 1.33333333;\r\n        vL = vUv - texelSize * offset;\r\n        vR = vUv + texelSize * offset;\r\n        gl_Position = vec4(aPosition, 0.0, 1.0);\r\n    }\r\n`),\r\n\r\n        blurShader: compileShader(gl.FRAGMENT_SHADER, `\r\n    precision mediump float;\r\n    precision mediump sampler2D;\r\n\r\n    varying vec2 vUv;\r\n    varying vec2 vL;\r\n    varying vec2 vR;\r\n    uniform sampler2D uTexture;\r\n\r\n    void main () {\r\n        vec4 sum = texture2D(uTexture, vUv) * 0.29411764;\r\n        sum += texture2D(uTexture, vL) * 0.35294117;\r\n        sum += texture2D(uTexture, vR) * 0.35294117;\r\n        gl_FragColor = sum;\r\n    }\r\n`),\r\n\r\n        copyShader: compileShader(gl.FRAGMENT_SHADER, `\r\n    precision mediump float;\r\n    precision mediump sampler2D;\r\n\r\n    varying highp vec2 vUv;\r\n    uniform sampler2D uTexture;\r\n\r\n    void main () {\r\n        gl_FragColor = texture2D(uTexture, vUv);\r\n    }\r\n`),\r\n\r\n        clearShader: compileShader(gl.FRAGMENT_SHADER, `\r\n    precision mediump float;\r\n    precision mediump sampler2D;\r\n\r\n    varying highp vec2 vUv;\r\n    uniform sampler2D uTexture;\r\n    uniform float value;\r\n\r\n    void main () {\r\n        gl_FragColor = value * texture2D(uTexture, vUv);\r\n    }\r\n`),\r\n\r\n        colorShader: compileShader(gl.FRAGMENT_SHADER, `\r\n    precision mediump float;\r\n\r\n    uniform vec4 color;\r\n\r\n    void main () {\r\n        gl_FragColor = color;\r\n    }\r\n`),\r\n\r\n        checkerboardShader: compileShader(gl.FRAGMENT_SHADER, `\r\n    precision highp float;\r\n    precision highp sampler2D;\r\n\r\n    varying vec2 vUv;\r\n    uniform sampler2D uTexture;\r\n    uniform float aspectRatio;\r\n\r\n    #define SCALE 25.0\r\n\r\n    void main () {\r\n        vec2 uv = floor(vUv * SCALE * vec2(aspectRatio, 1.0));\r\n        float v = mod(uv.x + uv.y, 2.0);\r\n        v = v * 0.1 + 0.8;\r\n        gl_FragColor = vec4(vec3(v), 1.0);\r\n    }\r\n`),\r\n\r\n        displayShaderSource: `\r\n    precision highp float;\r\n    precision highp sampler2D;\r\n\r\n    varying vec2 vUv;\r\n    varying vec2 vL;\r\n    varying vec2 vR;\r\n    varying vec2 vT;\r\n    varying vec2 vB;\r\n    uniform sampler2D uTexture;\r\n    uniform sampler2D uBloom;\r\n    uniform sampler2D uSunrays;\r\n    uniform sampler2D uDithering;\r\n    uniform vec2 ditherScale;\r\n    uniform vec2 texelSize;\r\n\r\n    vec3 linearToGamma (vec3 color) {\r\n        color = max(color, vec3(0));\r\n        return max(1.055 * pow(color, vec3(0.416666667)) - 0.055, vec3(0));\r\n    }\r\n\r\n    void main () {\r\n        vec3 c = texture2D(uTexture, vUv).rgb;\r\n\r\n    #ifdef SHADING\r\n        vec3 lc = texture2D(uTexture, vL).rgb;\r\n        vec3 rc = texture2D(uTexture, vR).rgb;\r\n        vec3 tc = texture2D(uTexture, vT).rgb;\r\n        vec3 bc = texture2D(uTexture, vB).rgb;\r\n\r\n        float dx = length(rc) - length(lc);\r\n        float dy = length(tc) - length(bc);\r\n\r\n        vec3 n = normalize(vec3(dx, dy, length(texelSize)));\r\n        vec3 l = vec3(0.0, 0.0, 1.0);\r\n\r\n        float diffuse = clamp(dot(n, l) + 0.7, 0.7, 1.0);\r\n        c *= diffuse;\r\n    #endif\r\n\r\n    #ifdef BLOOM\r\n        vec3 bloom = texture2D(uBloom, vUv).rgb;\r\n    #endif\r\n\r\n    #ifdef SUNRAYS\r\n        float sunrays = texture2D(uSunrays, vUv).r;\r\n        c *= sunrays;\r\n    #ifdef BLOOM\r\n        bloom *= sunrays;\r\n    #endif\r\n    #endif\r\n\r\n    #ifdef BLOOM\r\n        float noise = texture2D(uDithering, vUv * ditherScale).r;\r\n        noise = noise * 2.0 - 1.0;\r\n        bloom += noise / 255.0;\r\n        bloom = linearToGamma(bloom);\r\n        c += bloom;\r\n    #endif\r\n\r\n        float a = max(c.r, max(c.g, c.b));\r\n        gl_FragColor = vec4(c, a);\r\n    }\r\n`,\r\n\r\n        bloomPrefilterShader: compileShader(gl.FRAGMENT_SHADER, `\r\n    precision mediump float;\r\n    precision mediump sampler2D;\r\n\r\n    varying vec2 vUv;\r\n    uniform sampler2D uTexture;\r\n    uniform vec3 curve;\r\n    uniform float threshold;\r\n\r\n    void main () {\r\n        vec3 c = texture2D(uTexture, vUv).rgb;\r\n        float br = max(c.r, max(c.g, c.b));\r\n        float rq = clamp(br - curve.x, 0.0, curve.y);\r\n        rq = curve.z * rq * rq;\r\n        c *= max(rq, br - threshold) / max(br, 0.0001);\r\n        gl_FragColor = vec4(c, 0.0);\r\n    }\r\n`),\r\n\r\n        bloomBlurShader: compileShader(gl.FRAGMENT_SHADER, `\r\n    precision mediump float;\r\n    precision mediump sampler2D;\r\n\r\n    varying vec2 vL;\r\n    varying vec2 vR;\r\n    varying vec2 vT;\r\n    varying vec2 vB;\r\n    uniform sampler2D uTexture;\r\n\r\n    void main () {\r\n        vec4 sum = vec4(0.0);\r\n        sum += texture2D(uTexture, vL);\r\n        sum += texture2D(uTexture, vR);\r\n        sum += texture2D(uTexture, vT);\r\n        sum += texture2D(uTexture, vB);\r\n        sum *= 0.25;\r\n        gl_FragColor = sum;\r\n    }\r\n`),\r\n\r\n        bloomFinalShader: compileShader(gl.FRAGMENT_SHADER, `\r\n    precision mediump float;\r\n    precision mediump sampler2D;\r\n\r\n    varying vec2 vL;\r\n    varying vec2 vR;\r\n    varying vec2 vT;\r\n    varying vec2 vB;\r\n    uniform sampler2D uTexture;\r\n    uniform float intensity;\r\n\r\n    void main () {\r\n        vec4 sum = vec4(0.0);\r\n        sum += texture2D(uTexture, vL);\r\n        sum += texture2D(uTexture, vR);\r\n        sum += texture2D(uTexture, vT);\r\n        sum += texture2D(uTexture, vB);\r\n        sum *= 0.25;\r\n        gl_FragColor = sum * intensity;\r\n    }\r\n`),\r\n\r\n        sunraysMaskShader: compileShader(gl.FRAGMENT_SHADER, `\r\n    precision highp float;\r\n    precision highp sampler2D;\r\n\r\n    varying vec2 vUv;\r\n    uniform sampler2D uTexture;\r\n\r\n    void main () {\r\n        vec4 c = texture2D(uTexture, vUv);\r\n        float br = max(c.r, max(c.g, c.b));\r\n        c.a = 1.0 - min(max(br * 20.0, 0.0), 0.8);\r\n        gl_FragColor = c;\r\n    }\r\n`),\r\n\r\n        sunraysShader: compileShader(gl.FRAGMENT_SHADER, `\r\n    precision highp float;\r\n    precision highp sampler2D;\r\n\r\n    varying vec2 vUv;\r\n    uniform sampler2D uTexture;\r\n    uniform float weight;\r\n\r\n    #define ITERATIONS 16\r\n\r\n    void main () {\r\n        float Density = 0.3;\r\n        float Decay = 0.95;\r\n        float Exposure = 0.7;\r\n\r\n        vec2 coord = vUv;\r\n        vec2 dir = vUv - 0.5;\r\n\r\n        dir *= 1.0 / float(ITERATIONS) * Density;\r\n        float illuminationDecay = 1.0;\r\n\r\n        float color = texture2D(uTexture, vUv).a;\r\n\r\n        for (int i = 0; i < ITERATIONS; i++)\r\n        {\r\n            coord -= dir;\r\n            float col = texture2D(uTexture, coord).a;\r\n            color += col * illuminationDecay * weight;\r\n            illuminationDecay *= Decay;\r\n        }\r\n\r\n        gl_FragColor = vec4(color * Exposure, 0.0, 0.0, 1.0);\r\n    }\r\n`),\r\n\r\n        splatShader: compileShader(gl.FRAGMENT_SHADER, `\r\n    precision highp float;\r\n    precision highp sampler2D;\r\n\r\n    varying vec2 vUv;\r\n    uniform sampler2D uTarget;\r\n    uniform float aspectRatio;\r\n    uniform vec3 color;\r\n    uniform vec2 point;\r\n    uniform float radius;\r\n\r\n    void main () {\r\n        vec2 p = vUv - point.xy;\r\n        p.x *= aspectRatio;\r\n        vec3 splat = exp(-dot(p, p) / radius) * color;\r\n        vec3 base = texture2D(uTarget, vUv).xyz;\r\n        gl_FragColor = vec4(base + splat, 1.0);\r\n    }\r\n`),\r\n\r\n        // Based on the center velocity, grab the value that would move to this position (as if the velocity is sucking that value into this position) \r\n        // Also to linear interpolation of that value between the points\r\n        advectionShader: compileShader(gl.FRAGMENT_SHADER, `\r\n    precision highp float;\r\n    precision highp sampler2D;\r\n\r\n    varying vec2 vUv;\r\n    uniform sampler2D uVelocity;\r\n    uniform sampler2D uSource;\r\n    uniform vec2 texelSize;\r\n    uniform vec2 dyeTexelSize;\r\n    uniform float dt;\r\n    uniform float dissipation;\r\n    uniform vec2 motion;\r\n\r\n    vec4 bilerp (sampler2D sam, vec2 uv, vec2 tsize) {\r\n        vec2 st = uv / tsize - 0.5;\r\n\r\n        vec2 iuv = floor(st);\r\n        vec2 fuv = fract(st);\r\n\r\n        vec4 a = texture2D(sam, (iuv + vec2(0.5, 0.5)) * tsize);\r\n        vec4 b = texture2D(sam, (iuv + vec2(1.5, 0.5)) * tsize);\r\n        vec4 c = texture2D(sam, (iuv + vec2(0.5, 1.5)) * tsize);\r\n        vec4 d = texture2D(sam, (iuv + vec2(1.5, 1.5)) * tsize);\r\n\r\n        return mix(mix(a, b, fuv.x), mix(c, d, fuv.x), fuv.y);\r\n    }\r\n\r\n    void main () {\r\n    #ifdef MANUAL_FILTERING\r\n        vec2 coord = vUv - dt * bilerp(uVelocity, vUv, texelSize).xy * texelSize - dt * motion;\r\n        vec4 result = bilerp(uSource, coord, dyeTexelSize);\r\n    #else\r\n        vec2 coord = vUv - dt * texture2D(uVelocity, vUv).xy * texelSize - dt * motion;\r\n        vec4 result = texture2D(uSource, coord);\r\n    #endif\r\n        float decay = 1.0 + dissipation * dt;\r\n        gl_FragColor = result / decay;\r\n    }`,\r\n            ext.supportLinearFiltering ? null : [`MANUAL_FILTERING`],\r\n        ),\r\n\r\n        divergenceShader: compileShader(gl.FRAGMENT_SHADER, `\r\n    precision mediump float;\r\n    precision mediump sampler2D;\r\n\r\n    varying highp vec2 vUv;\r\n    varying highp vec2 vL;\r\n    varying highp vec2 vR;\r\n    varying highp vec2 vT;\r\n    varying highp vec2 vB;\r\n    uniform sampler2D uVelocity;\r\n\r\n    void main () {\r\n        float L = texture2D(uVelocity, vL).x;\r\n        float R = texture2D(uVelocity, vR).x;\r\n        float T = texture2D(uVelocity, vT).y;\r\n        float B = texture2D(uVelocity, vB).y;\r\n\r\n        vec2 C = texture2D(uVelocity, vUv).xy;\r\n        if (vL.x < 0.0) { L = -C.x; }\r\n        if (vR.x > 1.0) { R = -C.x; }\r\n        if (vT.y > 1.0) { T = -C.y; }\r\n        if (vB.y < 0.0) { B = -C.y; }\r\n\r\n        float div = 0.5 * (R - L + T - B);\r\n        gl_FragColor = vec4(div, 0.0, 0.0, 1.0);\r\n    }\r\n`),\r\n\r\n        curlShader: compileShader(gl.FRAGMENT_SHADER, `\r\n    precision mediump float;\r\n    precision mediump sampler2D;\r\n\r\n    varying highp vec2 vUv;\r\n    varying highp vec2 vL;\r\n    varying highp vec2 vR;\r\n    varying highp vec2 vT;\r\n    varying highp vec2 vB;\r\n    uniform sampler2D uVelocity;\r\n\r\n    void main () {\r\n        float L = texture2D(uVelocity, vL).y;\r\n        float R = texture2D(uVelocity, vR).y;\r\n        float T = texture2D(uVelocity, vT).x;\r\n        float B = texture2D(uVelocity, vB).x;\r\n        float vorticity = R - L - T + B;\r\n        gl_FragColor = vec4(0.5 * vorticity, 0.0, 0.0, 1.0);\r\n    }\r\n`),\r\n\r\n        vorticityShader: compileShader(gl.FRAGMENT_SHADER, `\r\n    precision highp float;\r\n    precision highp sampler2D;\r\n\r\n    varying vec2 vUv;\r\n    varying vec2 vL;\r\n    varying vec2 vR;\r\n    varying vec2 vT;\r\n    varying vec2 vB;\r\n    uniform sampler2D uVelocity;\r\n    uniform sampler2D uCurl;\r\n    uniform float curl;\r\n    uniform float dt;\r\n\r\n    void main () {\r\n        float L = texture2D(uCurl, vL).x;\r\n        float R = texture2D(uCurl, vR).x;\r\n        float T = texture2D(uCurl, vT).x;\r\n        float B = texture2D(uCurl, vB).x;\r\n        float C = texture2D(uCurl, vUv).x;\r\n\r\n        vec2 force = 0.5 * vec2(abs(T) - abs(B), abs(R) - abs(L));\r\n        force /= length(force) + 0.0001;\r\n        force *= curl * C;\r\n        force.y *= -1.0;\r\n\r\n        vec2 velocity = texture2D(uVelocity, vUv).xy;\r\n        velocity += force * dt;\r\n        velocity = min(max(velocity, -1000.0), 1000.0);\r\n        gl_FragColor = vec4(velocity, 0.0, 1.0);\r\n    }\r\n`),\r\n\r\n        pressureShader: compileShader(gl.FRAGMENT_SHADER, `\r\n    precision mediump float;\r\n    precision mediump sampler2D;\r\n\r\n    varying highp vec2 vUv;\r\n    varying highp vec2 vL;\r\n    varying highp vec2 vR;\r\n    varying highp vec2 vT;\r\n    varying highp vec2 vB;\r\n    uniform sampler2D uPressure;\r\n    uniform sampler2D uDivergence;\r\n\r\n    void main () {\r\n        float L = texture2D(uPressure, vL).x;\r\n        float R = texture2D(uPressure, vR).x;\r\n        float T = texture2D(uPressure, vT).x;\r\n        float B = texture2D(uPressure, vB).x;\r\n        float C = texture2D(uPressure, vUv).x;\r\n        float divergence = texture2D(uDivergence, vUv).x;\r\n        float pressure = (L + R + B + T - divergence) * 0.25;\r\n        gl_FragColor = vec4(pressure, 0.0, 0.0, 1.0);\r\n    }\r\n`),\r\n\r\n        gradientSubtractShader: compileShader(gl.FRAGMENT_SHADER, `\r\n    precision mediump float;\r\n    precision mediump sampler2D;\r\n\r\n    varying highp vec2 vUv;\r\n    varying highp vec2 vL;\r\n    varying highp vec2 vR;\r\n    varying highp vec2 vT;\r\n    varying highp vec2 vB;\r\n    uniform sampler2D uPressure;\r\n    uniform sampler2D uVelocity;\r\n\r\n    void main () {\r\n        float L = texture2D(uPressure, vL).x;\r\n        float R = texture2D(uPressure, vR).x;\r\n        float T = texture2D(uPressure, vT).x;\r\n        float B = texture2D(uPressure, vB).x;\r\n        vec2 velocity = texture2D(uVelocity, vUv).xy;\r\n        velocity.xy -= vec2(R - L, T - B);\r\n        gl_FragColor = vec4(velocity, 0.0, 1.0);\r\n    }\r\n`),\r\n    };\r\n};\r\n","import { getValuesAsItems } from './objects';\r\n\r\nexport const moveItem = <T>(obj: T, from: T[], to: T[]) => {\r\n    const i = from.indexOf(obj);\r\n    if (i < 0) { throw new Error(`moveItem Failed to find an item in the from array: ${JSON.stringify({ obj, from, to })}`); }\r\n    from.splice(i, 1);\r\n    to.push(obj);\r\n};\r\n\r\nexport const distinct = <T>(items: T[]): T[] => {\r\n    const set = new Set(items);\r\n    return [...set];\r\n};\r\n\r\nexport const shuffle = <T>(items: T[]): T[] => {\r\n    return items.map(x => ({ x, value: Math.random() })).sort((a, b) => a.value - b.value).map(x => x.x);\r\n};\r\n\r\nexport const distinct_key = <T>(items: T[], getKey: (item: T) => string): T[] => {\r\n    const set = {} as { [key: string]: T };\r\n    items.forEach(x => { set[getKey(x)] = x; });\r\n    return getValuesAsItems(set);\r\n};\r\n\r\nexport const groupItems = <T>(items: T[], getKey: (item: T) => string): { [key: string]: T[] } => {\r\n    const groups = {} as { [key: string]: T[] };\r\n    for (const x of items) {\r\n        const g = groups[getKey(x)] ?? (groups[getKey(x)] = []);\r\n        g.push(x);\r\n    }\r\n    return groups;\r\n};\r\n\r\nexport const mergeItems = <T>(items: T[], getKey: (item: T) => string, getMerged: (item: T[], key: string) => T): T[] => {\r\n    const groups = groupItems(items, getKey);\r\n    const merged = getValuesAsItems(groups).map(g => getMerged(g, getKey(g[0])));\r\n    return merged;\r\n};\r\n\r\nexport function sameArrayContents<T>(a: undefined | null | T[], b?: undefined | null | T[]) {\r\n    if (a === b) { return true; }\r\n    if (a == null && b == null) { return true; }\r\n    if (a == null || b == null) { return false; }\r\n    if (a.length !== b.length) { return false; }\r\n    for (const i in a) {\r\n        if (a[i] !== b[i]) { return false; }\r\n    }\r\n    return true;\r\n}\r\n","(function (Prism) {\n  Prism.languages.typescript = Prism.languages.extend('javascript', {\n    'class-name': {\n      pattern: /(\\b(?:class|extends|implements|instanceof|interface|new|type)\\s+)(?!keyof\\b)(?!\\s)[_$a-zA-Z\\xA0-\\uFFFF](?:(?!\\s)[$\\w\\xA0-\\uFFFF])*(?:\\s*<(?:[^<>]|<(?:[^<>]|<[^<>]*>)*>)*>)?/,\n      lookbehind: true,\n      greedy: true,\n      inside: null // see below\n\n    },\n    // From JavaScript Prism keyword list and TypeScript language spec: https://github.com/Microsoft/TypeScript/blob/master/doc/spec.md#221-reserved-words\n    'keyword': /\\b(?:abstract|as|asserts|async|await|break|case|catch|class|const|constructor|continue|debugger|declare|default|delete|do|else|enum|export|extends|finally|for|from|function|get|if|implements|import|in|instanceof|interface|is|keyof|let|module|namespace|new|null|of|package|private|protected|public|readonly|return|require|set|static|super|switch|this|throw|try|type|typeof|undefined|var|void|while|with|yield)\\b/,\n    'builtin': /\\b(?:string|Function|any|number|boolean|Array|symbol|console|Promise|unknown|never)\\b/\n  }); // doesn't work with TS because TS is too complex\n\n  delete Prism.languages.typescript['parameter']; // a version of typescript specifically for highlighting types\n\n  var typeInside = Prism.languages.extend('typescript', {});\n  delete typeInside['class-name'];\n  Prism.languages.typescript['class-name'].inside = typeInside;\n  Prism.languages.insertBefore('typescript', 'function', {\n    'generic-function': {\n      // e.g. foo<T extends \"bar\" | \"baz\">( ...\n      pattern: /#?(?!\\s)[_$a-zA-Z\\xA0-\\uFFFF](?:(?!\\s)[$\\w\\xA0-\\uFFFF])*\\s*<(?:[^<>]|<(?:[^<>]|<[^<>]*>)*>)*>(?=\\s*\\()/,\n      greedy: true,\n      inside: {\n        'function': /^#?(?!\\s)[_$a-zA-Z\\xA0-\\uFFFF](?:(?!\\s)[$\\w\\xA0-\\uFFFF])*/,\n        'generic': {\n          pattern: /<[\\s\\S]+/,\n          // everything after the first <\n          alias: 'class-name',\n          inside: typeInside\n        }\n      }\n    }\n  });\n  Prism.languages.ts = Prism.languages.typescript;\n})(Prism);","'use strict';\nvar isArray = require('../internals/is-array');\nvar toLength = require('../internals/to-length');\nvar bind = require('../internals/function-bind-context');\n\n// `FlattenIntoArray` abstract operation\n// https://tc39.github.io/proposal-flatMap/#sec-FlattenIntoArray\nvar flattenIntoArray = function (target, original, source, sourceLen, start, depth, mapper, thisArg) {\n  var targetIndex = start;\n  var sourceIndex = 0;\n  var mapFn = mapper ? bind(mapper, thisArg, 3) : false;\n  var element;\n\n  while (sourceIndex < sourceLen) {\n    if (sourceIndex in source) {\n      element = mapFn ? mapFn(source[sourceIndex], sourceIndex, original) : source[sourceIndex];\n\n      if (depth > 0 && isArray(element)) {\n        targetIndex = flattenIntoArray(target, original, element, toLength(element.length), targetIndex, depth - 1) - 1;\n      } else {\n        if (targetIndex >= 0x1FFFFFFFFFFFFF) throw TypeError('Exceed the acceptable array length');\n        target[targetIndex] = element;\n      }\n\n      targetIndex++;\n    }\n    sourceIndex++;\n  }\n  return targetIndex;\n};\n\nmodule.exports = flattenIntoArray;\n","// this method was added to unscopables after implementation\n// in popular engines, so it's moved to a separate module\nvar addToUnscopables = require('../internals/add-to-unscopables');\n\n// https://tc39.es/ecma262/#sec-array.prototype-@@unscopables\naddToUnscopables('flatMap');\n","/* eslint-disable no-return-assign */\r\n/* eslint-disable no-multi-assign */\r\n/* eslint-disable @typescript-eslint/no-unused-expressions */\r\n/* eslint-disable no-bitwise */\r\n\r\n// FROM: https://stackoverflow.com/a/47593316/567524\r\n\r\nfunction xmur3(str: string) {\r\n    let h = 1779033703 ^ str.length;\r\n    for (let i = 0; i < str.length; i++) {\r\n        h = Math.imul(h ^ str.charCodeAt(i), 3432918353);\r\n        h = h << 13 | h >>> 19;\r\n    }\r\n\r\n    return () => {\r\n        h = Math.imul(h ^ h >>> 16, 2246822507);\r\n        h = Math.imul(h ^ h >>> 13, 3266489909);\r\n        return (h ^= h >>> 16) >>> 0;\r\n    };\r\n}\r\n\r\nfunction mulberry32(a: number) {\r\n    return () => {\r\n        let t = a += 0x6D2B79F5;\r\n        t = Math.imul(t ^ t >>> 15, t | 1);\r\n        t ^= t + Math.imul(t ^ t >>> 7, t | 61);\r\n        return ((t ^ t >>> 14) >>> 0) / 4294967296;\r\n    };\r\n}\r\n\r\nexport const createRandomGenerator = (hash: string) => {\r\n    const seed = xmur3(hash)();\r\n    return {\r\n        random: mulberry32(seed),\r\n    };\r\n};\r\n","/* **********************************************\n     Begin prism-core.js\n********************************************** */\n/// <reference lib=\"WebWorker\"/>\nvar _self = typeof window !== 'undefined' ? window // if in browser\n: typeof WorkerGlobalScope !== 'undefined' && self instanceof WorkerGlobalScope ? self // if in worker\n: {} // if in node js\n;\n/**\n * Prism: Lightweight, robust, elegant syntax highlighting\n *\n * @license MIT <https://opensource.org/licenses/MIT>\n * @author Lea Verou <https://lea.verou.me>\n * @namespace\n * @public\n */\n\n\nvar Prism = function (_self) {\n  // Private helper vars\n  var lang = /\\blang(?:uage)?-([\\w-]+)\\b/i;\n  var uniqueId = 0;\n  var _ = {\n    /**\n     * By default, Prism will attempt to highlight all code elements (by calling {@link Prism.highlightAll}) on the\n     * current page after the page finished loading. This might be a problem if e.g. you wanted to asynchronously load\n     * additional languages or plugins yourself.\n     *\n     * By setting this value to `true`, Prism will not automatically highlight all code elements on the page.\n     *\n     * You obviously have to change this value before the automatic highlighting started. To do this, you can add an\n     * empty Prism object into the global scope before loading the Prism script like this:\n     *\n     * ```js\n     * window.Prism = window.Prism || {};\n     * Prism.manual = true;\n     * // add a new <script> to load Prism's script\n     * ```\n     *\n     * @default false\n     * @type {boolean}\n     * @memberof Prism\n     * @public\n     */\n    manual: _self.Prism && _self.Prism.manual,\n    disableWorkerMessageHandler: _self.Prism && _self.Prism.disableWorkerMessageHandler,\n\n    /**\n     * A namespace for utility methods.\n     *\n     * All function in this namespace that are not explicitly marked as _public_ are for __internal use only__ and may\n     * change or disappear at any time.\n     *\n     * @namespace\n     * @memberof Prism\n     */\n    util: {\n      encode: function encode(tokens) {\n        if (tokens instanceof Token) {\n          return new Token(tokens.type, encode(tokens.content), tokens.alias);\n        } else if (Array.isArray(tokens)) {\n          return tokens.map(encode);\n        } else {\n          return tokens.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/\\u00a0/g, ' ');\n        }\n      },\n\n      /**\n       * Returns the name of the type of the given value.\n       *\n       * @param {any} o\n       * @returns {string}\n       * @example\n       * type(null)      === 'Null'\n       * type(undefined) === 'Undefined'\n       * type(123)       === 'Number'\n       * type('foo')     === 'String'\n       * type(true)      === 'Boolean'\n       * type([1, 2])    === 'Array'\n       * type({})        === 'Object'\n       * type(String)    === 'Function'\n       * type(/abc+/)    === 'RegExp'\n       */\n      type: function type(o) {\n        return Object.prototype.toString.call(o).slice(8, -1);\n      },\n\n      /**\n       * Returns a unique number for the given object. Later calls will still return the same number.\n       *\n       * @param {Object} obj\n       * @returns {number}\n       */\n      objId: function objId(obj) {\n        if (!obj['__id']) {\n          Object.defineProperty(obj, '__id', {\n            value: ++uniqueId\n          });\n        }\n\n        return obj['__id'];\n      },\n\n      /**\n       * Creates a deep clone of the given object.\n       *\n       * The main intended use of this function is to clone language definitions.\n       *\n       * @param {T} o\n       * @param {Record<number, any>} [visited]\n       * @returns {T}\n       * @template T\n       */\n      clone: function deepClone(o, visited) {\n        visited = visited || {};\n        var clone, id;\n\n        switch (_.util.type(o)) {\n          case 'Object':\n            id = _.util.objId(o);\n\n            if (visited[id]) {\n              return visited[id];\n            }\n\n            clone =\n            /** @type {Record<string, any>} */\n            {};\n            visited[id] = clone;\n\n            for (var key in o) {\n              if (o.hasOwnProperty(key)) {\n                clone[key] = deepClone(o[key], visited);\n              }\n            }\n\n            return (\n              /** @type {any} */\n              clone\n            );\n\n          case 'Array':\n            id = _.util.objId(o);\n\n            if (visited[id]) {\n              return visited[id];\n            }\n\n            clone = [];\n            visited[id] = clone;\n\n            /** @type {Array} */\n\n            /** @type {any} */\n            o.forEach(function (v, i) {\n              clone[i] = deepClone(v, visited);\n            });\n            return (\n              /** @type {any} */\n              clone\n            );\n\n          default:\n            return o;\n        }\n      },\n\n      /**\n       * Returns the Prism language of the given element set by a `language-xxxx` or `lang-xxxx` class.\n       *\n       * If no language is set for the element or the element is `null` or `undefined`, `none` will be returned.\n       *\n       * @param {Element} element\n       * @returns {string}\n       */\n      getLanguage: function getLanguage(element) {\n        while (element && !lang.test(element.className)) {\n          element = element.parentElement;\n        }\n\n        if (element) {\n          return (element.className.match(lang) || [, 'none'])[1].toLowerCase();\n        }\n\n        return 'none';\n      },\n\n      /**\n       * Returns the script element that is currently executing.\n       *\n       * This does __not__ work for line script element.\n       *\n       * @returns {HTMLScriptElement | null}\n       */\n      currentScript: function currentScript() {\n        if (typeof document === 'undefined') {\n          return null;\n        }\n\n        if ('currentScript' in document && 1 < 2\n        /* hack to trip TS' flow analysis */\n        ) {\n            return (\n              /** @type {any} */\n              document.currentScript\n            );\n          } // IE11 workaround\n        // we'll get the src of the current script by parsing IE11's error stack trace\n        // this will not work for inline scripts\n\n\n        try {\n          throw new Error();\n        } catch (err) {\n          // Get file src url from stack. Specifically works with the format of stack traces in IE.\n          // A stack will look like this:\n          //\n          // Error\n          //    at _.util.currentScript (http://localhost/components/prism-core.js:119:5)\n          //    at Global code (http://localhost/components/prism-core.js:606:1)\n          var src = (/at [^(\\r\\n]*\\((.*):.+:.+\\)$/i.exec(err.stack) || [])[1];\n\n          if (src) {\n            var scripts = document.getElementsByTagName('script');\n\n            for (var i in scripts) {\n              if (scripts[i].src == src) {\n                return scripts[i];\n              }\n            }\n          }\n\n          return null;\n        }\n      },\n\n      /**\n       * Returns whether a given class is active for `element`.\n       *\n       * The class can be activated if `element` or one of its ancestors has the given class and it can be deactivated\n       * if `element` or one of its ancestors has the negated version of the given class. The _negated version_ of the\n       * given class is just the given class with a `no-` prefix.\n       *\n       * Whether the class is active is determined by the closest ancestor of `element` (where `element` itself is\n       * closest ancestor) that has the given class or the negated version of it. If neither `element` nor any of its\n       * ancestors have the given class or the negated version of it, then the default activation will be returned.\n       *\n       * In the paradoxical situation where the closest ancestor contains __both__ the given class and the negated\n       * version of it, the class is considered active.\n       *\n       * @param {Element} element\n       * @param {string} className\n       * @param {boolean} [defaultActivation=false]\n       * @returns {boolean}\n       */\n      isActive: function isActive(element, className, defaultActivation) {\n        var no = 'no-' + className;\n\n        while (element) {\n          var classList = element.classList;\n\n          if (classList.contains(className)) {\n            return true;\n          }\n\n          if (classList.contains(no)) {\n            return false;\n          }\n\n          element = element.parentElement;\n        }\n\n        return !!defaultActivation;\n      }\n    },\n\n    /**\n     * This namespace contains all currently loaded languages and the some helper functions to create and modify languages.\n     *\n     * @namespace\n     * @memberof Prism\n     * @public\n     */\n    languages: {\n      /**\n       * Creates a deep copy of the language with the given id and appends the given tokens.\n       *\n       * If a token in `redef` also appears in the copied language, then the existing token in the copied language\n       * will be overwritten at its original position.\n       *\n       * ## Best practices\n       *\n       * Since the position of overwriting tokens (token in `redef` that overwrite tokens in the copied language)\n       * doesn't matter, they can technically be in any order. However, this can be confusing to others that trying to\n       * understand the language definition because, normally, the order of tokens matters in Prism grammars.\n       *\n       * Therefore, it is encouraged to order overwriting tokens according to the positions of the overwritten tokens.\n       * Furthermore, all non-overwriting tokens should be placed after the overwriting ones.\n       *\n       * @param {string} id The id of the language to extend. This has to be a key in `Prism.languages`.\n       * @param {Grammar} redef The new tokens to append.\n       * @returns {Grammar} The new language created.\n       * @public\n       * @example\n       * Prism.languages['css-with-colors'] = Prism.languages.extend('css', {\n       *     // Prism.languages.css already has a 'comment' token, so this token will overwrite CSS' 'comment' token\n       *     // at its original position\n       *     'comment': { ... },\n       *     // CSS doesn't have a 'color' token, so this token will be appended\n       *     'color': /\\b(?:red|green|blue)\\b/\n       * });\n       */\n      extend: function extend(id, redef) {\n        var lang = _.util.clone(_.languages[id]);\n\n        for (var key in redef) {\n          lang[key] = redef[key];\n        }\n\n        return lang;\n      },\n\n      /**\n       * Inserts tokens _before_ another token in a language definition or any other grammar.\n       *\n       * ## Usage\n       *\n       * This helper method makes it easy to modify existing languages. For example, the CSS language definition\n       * not only defines CSS highlighting for CSS documents, but also needs to define highlighting for CSS embedded\n       * in HTML through `<style>` elements. To do this, it needs to modify `Prism.languages.markup` and add the\n       * appropriate tokens. However, `Prism.languages.markup` is a regular JavaScript object literal, so if you do\n       * this:\n       *\n       * ```js\n       * Prism.languages.markup.style = {\n       *     // token\n       * };\n       * ```\n       *\n       * then the `style` token will be added (and processed) at the end. `insertBefore` allows you to insert tokens\n       * before existing tokens. For the CSS example above, you would use it like this:\n       *\n       * ```js\n       * Prism.languages.insertBefore('markup', 'cdata', {\n       *     'style': {\n       *         // token\n       *     }\n       * });\n       * ```\n       *\n       * ## Special cases\n       *\n       * If the grammars of `inside` and `insert` have tokens with the same name, the tokens in `inside`'s grammar\n       * will be ignored.\n       *\n       * This behavior can be used to insert tokens after `before`:\n       *\n       * ```js\n       * Prism.languages.insertBefore('markup', 'comment', {\n       *     'comment': Prism.languages.markup.comment,\n       *     // tokens after 'comment'\n       * });\n       * ```\n       *\n       * ## Limitations\n       *\n       * The main problem `insertBefore` has to solve is iteration order. Since ES2015, the iteration order for object\n       * properties is guaranteed to be the insertion order (except for integer keys) but some browsers behave\n       * differently when keys are deleted and re-inserted. So `insertBefore` can't be implemented by temporarily\n       * deleting properties which is necessary to insert at arbitrary positions.\n       *\n       * To solve this problem, `insertBefore` doesn't actually insert the given tokens into the target object.\n       * Instead, it will create a new object and replace all references to the target object with the new one. This\n       * can be done without temporarily deleting properties, so the iteration order is well-defined.\n       *\n       * However, only references that can be reached from `Prism.languages` or `insert` will be replaced. I.e. if\n       * you hold the target object in a variable, then the value of the variable will not change.\n       *\n       * ```js\n       * var oldMarkup = Prism.languages.markup;\n       * var newMarkup = Prism.languages.insertBefore('markup', 'comment', { ... });\n       *\n       * assert(oldMarkup !== Prism.languages.markup);\n       * assert(newMarkup === Prism.languages.markup);\n       * ```\n       *\n       * @param {string} inside The property of `root` (e.g. a language id in `Prism.languages`) that contains the\n       * object to be modified.\n       * @param {string} before The key to insert before.\n       * @param {Grammar} insert An object containing the key-value pairs to be inserted.\n       * @param {Object<string, any>} [root] The object containing `inside`, i.e. the object that contains the\n       * object to be modified.\n       *\n       * Defaults to `Prism.languages`.\n       * @returns {Grammar} The new grammar object.\n       * @public\n       */\n      insertBefore: function insertBefore(inside, before, insert, root) {\n        root = root ||\n        /** @type {any} */\n        _.languages;\n        var grammar = root[inside];\n        /** @type {Grammar} */\n\n        var ret = {};\n\n        for (var token in grammar) {\n          if (grammar.hasOwnProperty(token)) {\n            if (token == before) {\n              for (var newToken in insert) {\n                if (insert.hasOwnProperty(newToken)) {\n                  ret[newToken] = insert[newToken];\n                }\n              }\n            } // Do not insert token which also occur in insert. See #1525\n\n\n            if (!insert.hasOwnProperty(token)) {\n              ret[token] = grammar[token];\n            }\n          }\n        }\n\n        var old = root[inside];\n        root[inside] = ret; // Update references in other language definitions\n\n        _.languages.DFS(_.languages, function (key, value) {\n          if (value === old && key != inside) {\n            this[key] = ret;\n          }\n        });\n\n        return ret;\n      },\n      // Traverse a language definition with Depth First Search\n      DFS: function DFS(o, callback, type, visited) {\n        visited = visited || {};\n        var objId = _.util.objId;\n\n        for (var i in o) {\n          if (o.hasOwnProperty(i)) {\n            callback.call(o, i, o[i], type || i);\n\n            var property = o[i],\n                propertyType = _.util.type(property);\n\n            if (propertyType === 'Object' && !visited[objId(property)]) {\n              visited[objId(property)] = true;\n              DFS(property, callback, null, visited);\n            } else if (propertyType === 'Array' && !visited[objId(property)]) {\n              visited[objId(property)] = true;\n              DFS(property, callback, i, visited);\n            }\n          }\n        }\n      }\n    },\n    plugins: {},\n\n    /**\n     * This is the most high-level function in Prisms API.\n     * It fetches all the elements that have a `.language-xxxx` class and then calls {@link Prism.highlightElement} on\n     * each one of them.\n     *\n     * This is equivalent to `Prism.highlightAllUnder(document, async, callback)`.\n     *\n     * @param {boolean} [async=false] Same as in {@link Prism.highlightAllUnder}.\n     * @param {HighlightCallback} [callback] Same as in {@link Prism.highlightAllUnder}.\n     * @memberof Prism\n     * @public\n     */\n    highlightAll: function highlightAll(async, callback) {\n      _.highlightAllUnder(document, async, callback);\n    },\n\n    /**\n     * Fetches all the descendants of `container` that have a `.language-xxxx` class and then calls\n     * {@link Prism.highlightElement} on each one of them.\n     *\n     * The following hooks will be run:\n     * 1. `before-highlightall`\n     * 2. `before-all-elements-highlight`\n     * 3. All hooks of {@link Prism.highlightElement} for each element.\n     *\n     * @param {ParentNode} container The root element, whose descendants that have a `.language-xxxx` class will be highlighted.\n     * @param {boolean} [async=false] Whether each element is to be highlighted asynchronously using Web Workers.\n     * @param {HighlightCallback} [callback] An optional callback to be invoked on each element after its highlighting is done.\n     * @memberof Prism\n     * @public\n     */\n    highlightAllUnder: function highlightAllUnder(container, async, callback) {\n      var env = {\n        callback: callback,\n        container: container,\n        selector: 'code[class*=\"language-\"], [class*=\"language-\"] code, code[class*=\"lang-\"], [class*=\"lang-\"] code'\n      };\n\n      _.hooks.run('before-highlightall', env);\n\n      env.elements = Array.prototype.slice.apply(env.container.querySelectorAll(env.selector));\n\n      _.hooks.run('before-all-elements-highlight', env);\n\n      for (var i = 0, element; element = env.elements[i++];) {\n        _.highlightElement(element, async === true, env.callback);\n      }\n    },\n\n    /**\n     * Highlights the code inside a single element.\n     *\n     * The following hooks will be run:\n     * 1. `before-sanity-check`\n     * 2. `before-highlight`\n     * 3. All hooks of {@link Prism.highlight}. These hooks will be run by an asynchronous worker if `async` is `true`.\n     * 4. `before-insert`\n     * 5. `after-highlight`\n     * 6. `complete`\n     *\n     * Some the above hooks will be skipped if the element doesn't contain any text or there is no grammar loaded for\n     * the element's language.\n     *\n     * @param {Element} element The element containing the code.\n     * It must have a class of `language-xxxx` to be processed, where `xxxx` is a valid language identifier.\n     * @param {boolean} [async=false] Whether the element is to be highlighted asynchronously using Web Workers\n     * to improve performance and avoid blocking the UI when highlighting very large chunks of code. This option is\n     * [disabled by default](https://prismjs.com/faq.html#why-is-asynchronous-highlighting-disabled-by-default).\n     *\n     * Note: All language definitions required to highlight the code must be included in the main `prism.js` file for\n     * asynchronous highlighting to work. You can build your own bundle on the\n     * [Download page](https://prismjs.com/download.html).\n     * @param {HighlightCallback} [callback] An optional callback to be invoked after the highlighting is done.\n     * Mostly useful when `async` is `true`, since in that case, the highlighting is done asynchronously.\n     * @memberof Prism\n     * @public\n     */\n    highlightElement: function highlightElement(element, async, callback) {\n      // Find language\n      var language = _.util.getLanguage(element);\n\n      var grammar = _.languages[language]; // Set language on the element, if not present\n\n      element.className = element.className.replace(lang, '').replace(/\\s+/g, ' ') + ' language-' + language; // Set language on the parent, for styling\n\n      var parent = element.parentElement;\n\n      if (parent && parent.nodeName.toLowerCase() === 'pre') {\n        parent.className = parent.className.replace(lang, '').replace(/\\s+/g, ' ') + ' language-' + language;\n      }\n\n      var code = element.textContent;\n      var env = {\n        element: element,\n        language: language,\n        grammar: grammar,\n        code: code\n      };\n\n      function insertHighlightedCode(highlightedCode) {\n        env.highlightedCode = highlightedCode;\n\n        _.hooks.run('before-insert', env);\n\n        env.element.innerHTML = env.highlightedCode;\n\n        _.hooks.run('after-highlight', env);\n\n        _.hooks.run('complete', env);\n\n        callback && callback.call(env.element);\n      }\n\n      _.hooks.run('before-sanity-check', env);\n\n      if (!env.code) {\n        _.hooks.run('complete', env);\n\n        callback && callback.call(env.element);\n        return;\n      }\n\n      _.hooks.run('before-highlight', env);\n\n      if (!env.grammar) {\n        insertHighlightedCode(_.util.encode(env.code));\n        return;\n      }\n\n      if (async && _self.Worker) {\n        var worker = new Worker(_.filename);\n\n        worker.onmessage = function (evt) {\n          insertHighlightedCode(evt.data);\n        };\n\n        worker.postMessage(JSON.stringify({\n          language: env.language,\n          code: env.code,\n          immediateClose: true\n        }));\n      } else {\n        insertHighlightedCode(_.highlight(env.code, env.grammar, env.language));\n      }\n    },\n\n    /**\n     * Low-level function, only use if you know what youre doing. It accepts a string of text as input\n     * and the language definitions to use, and returns a string with the HTML produced.\n     *\n     * The following hooks will be run:\n     * 1. `before-tokenize`\n     * 2. `after-tokenize`\n     * 3. `wrap`: On each {@link Token}.\n     *\n     * @param {string} text A string with the code to be highlighted.\n     * @param {Grammar} grammar An object containing the tokens to use.\n     *\n     * Usually a language definition like `Prism.languages.markup`.\n     * @param {string} language The name of the language definition passed to `grammar`.\n     * @returns {string} The highlighted HTML.\n     * @memberof Prism\n     * @public\n     * @example\n     * Prism.highlight('var foo = true;', Prism.languages.javascript, 'javascript');\n     */\n    highlight: function highlight(text, grammar, language) {\n      var env = {\n        code: text,\n        grammar: grammar,\n        language: language\n      };\n\n      _.hooks.run('before-tokenize', env);\n\n      env.tokens = _.tokenize(env.code, env.grammar);\n\n      _.hooks.run('after-tokenize', env);\n\n      return Token.stringify(_.util.encode(env.tokens), env.language);\n    },\n\n    /**\n     * This is the heart of Prism, and the most low-level function you can use. It accepts a string of text as input\n     * and the language definitions to use, and returns an array with the tokenized code.\n     *\n     * When the language definition includes nested tokens, the function is called recursively on each of these tokens.\n     *\n     * This method could be useful in other contexts as well, as a very crude parser.\n     *\n     * @param {string} text A string with the code to be highlighted.\n     * @param {Grammar} grammar An object containing the tokens to use.\n     *\n     * Usually a language definition like `Prism.languages.markup`.\n     * @returns {TokenStream} An array of strings and tokens, a token stream.\n     * @memberof Prism\n     * @public\n     * @example\n     * let code = `var foo = 0;`;\n     * let tokens = Prism.tokenize(code, Prism.languages.javascript);\n     * tokens.forEach(token => {\n     *     if (token instanceof Prism.Token && token.type === 'number') {\n     *         console.log(`Found numeric literal: ${token.content}`);\n     *     }\n     * });\n     */\n    tokenize: function tokenize(text, grammar) {\n      var rest = grammar.rest;\n\n      if (rest) {\n        for (var token in rest) {\n          grammar[token] = rest[token];\n        }\n\n        delete grammar.rest;\n      }\n\n      var tokenList = new LinkedList();\n      addAfter(tokenList, tokenList.head, text);\n      matchGrammar(text, tokenList, grammar, tokenList.head, 0);\n      return toArray(tokenList);\n    },\n\n    /**\n     * @namespace\n     * @memberof Prism\n     * @public\n     */\n    hooks: {\n      all: {},\n\n      /**\n       * Adds the given callback to the list of callbacks for the given hook.\n       *\n       * The callback will be invoked when the hook it is registered for is run.\n       * Hooks are usually directly run by a highlight function but you can also run hooks yourself.\n       *\n       * One callback function can be registered to multiple hooks and the same hook multiple times.\n       *\n       * @param {string} name The name of the hook.\n       * @param {HookCallback} callback The callback function which is given environment variables.\n       * @public\n       */\n      add: function add(name, callback) {\n        var hooks = _.hooks.all;\n        hooks[name] = hooks[name] || [];\n        hooks[name].push(callback);\n      },\n\n      /**\n       * Runs a hook invoking all registered callbacks with the given environment variables.\n       *\n       * Callbacks will be invoked synchronously and in the order in which they were registered.\n       *\n       * @param {string} name The name of the hook.\n       * @param {Object<string, any>} env The environment variables of the hook passed to all callbacks registered.\n       * @public\n       */\n      run: function run(name, env) {\n        var callbacks = _.hooks.all[name];\n\n        if (!callbacks || !callbacks.length) {\n          return;\n        }\n\n        for (var i = 0, callback; callback = callbacks[i++];) {\n          callback(env);\n        }\n      }\n    },\n    Token: Token\n  };\n  _self.Prism = _; // Typescript note:\n  // The following can be used to import the Token type in JSDoc:\n  //\n  //   @typedef {InstanceType<import(\"./prism-core\")[\"Token\"]>} Token\n\n  /**\n   * Creates a new token.\n   *\n   * @param {string} type See {@link Token#type type}\n   * @param {string | TokenStream} content See {@link Token#content content}\n   * @param {string|string[]} [alias] The alias(es) of the token.\n   * @param {string} [matchedStr=\"\"] A copy of the full string this token was created from.\n   * @class\n   * @global\n   * @public\n   */\n\n  function Token(type, content, alias, matchedStr) {\n    /**\n     * The type of the token.\n     *\n     * This is usually the key of a pattern in a {@link Grammar}.\n     *\n     * @type {string}\n     * @see GrammarToken\n     * @public\n     */\n    this.type = type;\n    /**\n     * The strings or tokens contained by this token.\n     *\n     * This will be a token stream if the pattern matched also defined an `inside` grammar.\n     *\n     * @type {string | TokenStream}\n     * @public\n     */\n\n    this.content = content;\n    /**\n     * The alias(es) of the token.\n     *\n     * @type {string|string[]}\n     * @see GrammarToken\n     * @public\n     */\n\n    this.alias = alias; // Copy of the full string this token was created from\n\n    this.length = (matchedStr || '').length | 0;\n  }\n  /**\n   * A token stream is an array of strings and {@link Token Token} objects.\n   *\n   * Token streams have to fulfill a few properties that are assumed by most functions (mostly internal ones) that process\n   * them.\n   *\n   * 1. No adjacent strings.\n   * 2. No empty strings.\n   *\n   *    The only exception here is the token stream that only contains the empty string and nothing else.\n   *\n   * @typedef {Array<string | Token>} TokenStream\n   * @global\n   * @public\n   */\n\n  /**\n   * Converts the given token or token stream to an HTML representation.\n   *\n   * The following hooks will be run:\n   * 1. `wrap`: On each {@link Token}.\n   *\n   * @param {string | Token | TokenStream} o The token or token stream to be converted.\n   * @param {string} language The name of current language.\n   * @returns {string} The HTML representation of the token or token stream.\n   * @memberof Token\n   * @static\n   */\n\n\n  Token.stringify = function stringify(o, language) {\n    if (typeof o == 'string') {\n      return o;\n    }\n\n    if (Array.isArray(o)) {\n      var s = '';\n      o.forEach(function (e) {\n        s += stringify(e, language);\n      });\n      return s;\n    }\n\n    var env = {\n      type: o.type,\n      content: stringify(o.content, language),\n      tag: 'span',\n      classes: ['token', o.type],\n      attributes: {},\n      language: language\n    };\n    var aliases = o.alias;\n\n    if (aliases) {\n      if (Array.isArray(aliases)) {\n        Array.prototype.push.apply(env.classes, aliases);\n      } else {\n        env.classes.push(aliases);\n      }\n    }\n\n    _.hooks.run('wrap', env);\n\n    var attributes = '';\n\n    for (var name in env.attributes) {\n      attributes += ' ' + name + '=\"' + (env.attributes[name] || '').replace(/\"/g, '&quot;') + '\"';\n    }\n\n    return '<' + env.tag + ' class=\"' + env.classes.join(' ') + '\"' + attributes + '>' + env.content + '</' + env.tag + '>';\n  };\n  /**\n   * @param {RegExp} pattern\n   * @param {number} pos\n   * @param {string} text\n   * @param {boolean} lookbehind\n   * @returns {RegExpExecArray | null}\n   */\n\n\n  function matchPattern(pattern, pos, text, lookbehind) {\n    pattern.lastIndex = pos;\n    var match = pattern.exec(text);\n\n    if (match && lookbehind && match[1]) {\n      // change the match to remove the text matched by the Prism lookbehind group\n      var lookbehindLength = match[1].length;\n      match.index += lookbehindLength;\n      match[0] = match[0].slice(lookbehindLength);\n    }\n\n    return match;\n  }\n  /**\n   * @param {string} text\n   * @param {LinkedList<string | Token>} tokenList\n   * @param {any} grammar\n   * @param {LinkedListNode<string | Token>} startNode\n   * @param {number} startPos\n   * @param {RematchOptions} [rematch]\n   * @returns {void}\n   * @private\n   *\n   * @typedef RematchOptions\n   * @property {string} cause\n   * @property {number} reach\n   */\n\n\n  function matchGrammar(text, tokenList, grammar, startNode, startPos, rematch) {\n    for (var token in grammar) {\n      if (!grammar.hasOwnProperty(token) || !grammar[token]) {\n        continue;\n      }\n\n      var patterns = grammar[token];\n      patterns = Array.isArray(patterns) ? patterns : [patterns];\n\n      for (var j = 0; j < patterns.length; ++j) {\n        if (rematch && rematch.cause == token + ',' + j) {\n          return;\n        }\n\n        var patternObj = patterns[j],\n            inside = patternObj.inside,\n            lookbehind = !!patternObj.lookbehind,\n            greedy = !!patternObj.greedy,\n            alias = patternObj.alias;\n\n        if (greedy && !patternObj.pattern.global) {\n          // Without the global flag, lastIndex won't work\n          var flags = patternObj.pattern.toString().match(/[imsuy]*$/)[0];\n          patternObj.pattern = RegExp(patternObj.pattern.source, flags + 'g');\n        }\n        /** @type {RegExp} */\n\n\n        var pattern = patternObj.pattern || patternObj;\n\n        for ( // iterate the token list and keep track of the current token/string position\n        var currentNode = startNode.next, pos = startPos; currentNode !== tokenList.tail; pos += currentNode.value.length, currentNode = currentNode.next) {\n          if (rematch && pos >= rematch.reach) {\n            break;\n          }\n\n          var str = currentNode.value;\n\n          if (tokenList.length > text.length) {\n            // Something went terribly wrong, ABORT, ABORT!\n            return;\n          }\n\n          if (str instanceof Token) {\n            continue;\n          }\n\n          var removeCount = 1; // this is the to parameter of removeBetween\n\n          var match;\n\n          if (greedy) {\n            match = matchPattern(pattern, pos, text, lookbehind);\n\n            if (!match) {\n              break;\n            }\n\n            var from = match.index;\n            var to = match.index + match[0].length;\n            var p = pos; // find the node that contains the match\n\n            p += currentNode.value.length;\n\n            while (from >= p) {\n              currentNode = currentNode.next;\n              p += currentNode.value.length;\n            } // adjust pos (and p)\n\n\n            p -= currentNode.value.length;\n            pos = p; // the current node is a Token, then the match starts inside another Token, which is invalid\n\n            if (currentNode.value instanceof Token) {\n              continue;\n            } // find the last node which is affected by this match\n\n\n            for (var k = currentNode; k !== tokenList.tail && (p < to || typeof k.value === 'string'); k = k.next) {\n              removeCount++;\n              p += k.value.length;\n            }\n\n            removeCount--; // replace with the new match\n\n            str = text.slice(pos, p);\n            match.index -= pos;\n          } else {\n            match = matchPattern(pattern, 0, str, lookbehind);\n\n            if (!match) {\n              continue;\n            }\n          }\n\n          var from = match.index,\n              matchStr = match[0],\n              before = str.slice(0, from),\n              after = str.slice(from + matchStr.length);\n          var reach = pos + str.length;\n\n          if (rematch && reach > rematch.reach) {\n            rematch.reach = reach;\n          }\n\n          var removeFrom = currentNode.prev;\n\n          if (before) {\n            removeFrom = addAfter(tokenList, removeFrom, before);\n            pos += before.length;\n          }\n\n          removeRange(tokenList, removeFrom, removeCount);\n          var wrapped = new Token(token, inside ? _.tokenize(matchStr, inside) : matchStr, alias, matchStr);\n          currentNode = addAfter(tokenList, removeFrom, wrapped);\n\n          if (after) {\n            addAfter(tokenList, currentNode, after);\n          }\n\n          if (removeCount > 1) {\n            // at least one Token object was removed, so we have to do some rematching\n            // this can only happen if the current pattern is greedy\n            matchGrammar(text, tokenList, grammar, currentNode.prev, pos, {\n              cause: token + ',' + j,\n              reach: reach\n            });\n          }\n        }\n      }\n    }\n  }\n  /**\n   * @typedef LinkedListNode\n   * @property {T} value\n   * @property {LinkedListNode<T> | null} prev The previous node.\n   * @property {LinkedListNode<T> | null} next The next node.\n   * @template T\n   * @private\n   */\n\n  /**\n   * @template T\n   * @private\n   */\n\n\n  function LinkedList() {\n    /** @type {LinkedListNode<T>} */\n    var head = {\n      value: null,\n      prev: null,\n      next: null\n    };\n    /** @type {LinkedListNode<T>} */\n\n    var tail = {\n      value: null,\n      prev: head,\n      next: null\n    };\n    head.next = tail;\n    /** @type {LinkedListNode<T>} */\n\n    this.head = head;\n    /** @type {LinkedListNode<T>} */\n\n    this.tail = tail;\n    this.length = 0;\n  }\n  /**\n   * Adds a new node with the given value to the list.\n   * @param {LinkedList<T>} list\n   * @param {LinkedListNode<T>} node\n   * @param {T} value\n   * @returns {LinkedListNode<T>} The added node.\n   * @template T\n   */\n\n\n  function addAfter(list, node, value) {\n    // assumes that node != list.tail && values.length >= 0\n    var next = node.next;\n    var newNode = {\n      value: value,\n      prev: node,\n      next: next\n    };\n    node.next = newNode;\n    next.prev = newNode;\n    list.length++;\n    return newNode;\n  }\n  /**\n   * Removes `count` nodes after the given node. The given node will not be removed.\n   * @param {LinkedList<T>} list\n   * @param {LinkedListNode<T>} node\n   * @param {number} count\n   * @template T\n   */\n\n\n  function removeRange(list, node, count) {\n    var next = node.next;\n\n    for (var i = 0; i < count && next !== list.tail; i++) {\n      next = next.next;\n    }\n\n    node.next = next;\n    next.prev = node;\n    list.length -= i;\n  }\n  /**\n   * @param {LinkedList<T>} list\n   * @returns {T[]}\n   * @template T\n   */\n\n\n  function toArray(list) {\n    var array = [];\n    var node = list.head.next;\n\n    while (node !== list.tail) {\n      array.push(node.value);\n      node = node.next;\n    }\n\n    return array;\n  }\n\n  if (!_self.document) {\n    if (!_self.addEventListener) {\n      // in Node.js\n      return _;\n    }\n\n    if (!_.disableWorkerMessageHandler) {\n      // In worker\n      _self.addEventListener('message', function (evt) {\n        var message = JSON.parse(evt.data),\n            lang = message.language,\n            code = message.code,\n            immediateClose = message.immediateClose;\n\n        _self.postMessage(_.highlight(code, _.languages[lang], lang));\n\n        if (immediateClose) {\n          _self.close();\n        }\n      }, false);\n    }\n\n    return _;\n  } // Get current script and highlight\n\n\n  var script = _.util.currentScript();\n\n  if (script) {\n    _.filename = script.src;\n\n    if (script.hasAttribute('data-manual')) {\n      _.manual = true;\n    }\n  }\n\n  function highlightAutomaticallyCallback() {\n    if (!_.manual) {\n      _.highlightAll();\n    }\n  }\n\n  if (!_.manual) {\n    // If the document state is \"loading\", then we'll use DOMContentLoaded.\n    // If the document state is \"interactive\" and the prism.js script is deferred, then we'll also use the\n    // DOMContentLoaded event because there might be some plugins or languages which have also been deferred and they\n    // might take longer one animation frame to execute which can create a race condition where only some plugins have\n    // been loaded when Prism.highlightAll() is executed, depending on how fast resources are loaded.\n    // See https://github.com/PrismJS/prism/issues/2102\n    var readyState = document.readyState;\n\n    if (readyState === 'loading' || readyState === 'interactive' && script && script.defer) {\n      document.addEventListener('DOMContentLoaded', highlightAutomaticallyCallback);\n    } else {\n      if (window.requestAnimationFrame) {\n        window.requestAnimationFrame(highlightAutomaticallyCallback);\n      } else {\n        window.setTimeout(highlightAutomaticallyCallback, 16);\n      }\n    }\n  }\n\n  return _;\n}(_self);\n\nif (typeof module !== 'undefined' && module.exports) {\n  module.exports = Prism;\n} // hack for components to work correctly in node.js\n\n\nif (typeof global !== 'undefined') {\n  global.Prism = Prism;\n} // some additional documentation/types\n\n/**\n * The expansion of a simple `RegExp` literal to support additional properties.\n *\n * @typedef GrammarToken\n * @property {RegExp} pattern The regular expression of the token.\n * @property {boolean} [lookbehind=false] If `true`, then the first capturing group of `pattern` will (effectively)\n * behave as a lookbehind group meaning that the captured text will not be part of the matched text of the new token.\n * @property {boolean} [greedy=false] Whether the token is greedy.\n * @property {string|string[]} [alias] An optional alias or list of aliases.\n * @property {Grammar} [inside] The nested grammar of this token.\n *\n * The `inside` grammar will be used to tokenize the text value of each token of this kind.\n *\n * This can be used to make nested and even recursive language definitions.\n *\n * Note: This can cause infinite recursion. Be careful when you embed different languages or even the same language into\n * each another.\n * @global\n * @public\n*/\n\n/**\n * @typedef Grammar\n * @type {Object<string, RegExp | GrammarToken | Array<RegExp | GrammarToken>>}\n * @property {Grammar} [rest] An optional grammar object that will be appended to this grammar.\n * @global\n * @public\n */\n\n/**\n * A function which will invoked after an element was successfully highlighted.\n *\n * @callback HighlightCallback\n * @param {Element} element The element successfully highlighted.\n * @returns {void}\n * @global\n * @public\n*/\n\n/**\n * @callback HookCallback\n * @param {Object<string, any>} env The environment variables of the hook.\n * @returns {void}\n * @global\n * @public\n */\n\n/* **********************************************\n     Begin prism-markup.js\n********************************************** */\n\n\nPrism.languages.markup = {\n  'comment': /<!--[\\s\\S]*?-->/,\n  'prolog': /<\\?[\\s\\S]+?\\?>/,\n  'doctype': {\n    // https://www.w3.org/TR/xml/#NT-doctypedecl\n    pattern: /<!DOCTYPE(?:[^>\"'[\\]]|\"[^\"]*\"|'[^']*')+(?:\\[(?:[^<\"'\\]]|\"[^\"]*\"|'[^']*'|<(?!!--)|<!--(?:[^-]|-(?!->))*-->)*\\]\\s*)?>/i,\n    greedy: true,\n    inside: {\n      'internal-subset': {\n        pattern: /(\\[)[\\s\\S]+(?=\\]>$)/,\n        lookbehind: true,\n        greedy: true,\n        inside: null // see below\n\n      },\n      'string': {\n        pattern: /\"[^\"]*\"|'[^']*'/,\n        greedy: true\n      },\n      'punctuation': /^<!|>$|[[\\]]/,\n      'doctype-tag': /^DOCTYPE/,\n      'name': /[^\\s<>'\"]+/\n    }\n  },\n  'cdata': /<!\\[CDATA\\[[\\s\\S]*?]]>/i,\n  'tag': {\n    pattern: /<\\/?(?!\\d)[^\\s>\\/=$<%]+(?:\\s(?:\\s*[^\\s>\\/=]+(?:\\s*=\\s*(?:\"[^\"]*\"|'[^']*'|[^\\s'\">=]+(?=[\\s>]))|(?=[\\s/>])))+)?\\s*\\/?>/,\n    greedy: true,\n    inside: {\n      'tag': {\n        pattern: /^<\\/?[^\\s>\\/]+/,\n        inside: {\n          'punctuation': /^<\\/?/,\n          'namespace': /^[^\\s>\\/:]+:/\n        }\n      },\n      'attr-value': {\n        pattern: /=\\s*(?:\"[^\"]*\"|'[^']*'|[^\\s'\">=]+)/,\n        inside: {\n          'punctuation': [{\n            pattern: /^=/,\n            alias: 'attr-equals'\n          }, /\"|'/]\n        }\n      },\n      'punctuation': /\\/?>/,\n      'attr-name': {\n        pattern: /[^\\s>\\/]+/,\n        inside: {\n          'namespace': /^[^\\s>\\/:]+:/\n        }\n      }\n    }\n  },\n  'entity': [{\n    pattern: /&[\\da-z]{1,8};/i,\n    alias: 'named-entity'\n  }, /&#x?[\\da-f]{1,8};/i]\n};\nPrism.languages.markup['tag'].inside['attr-value'].inside['entity'] = Prism.languages.markup['entity'];\nPrism.languages.markup['doctype'].inside['internal-subset'].inside = Prism.languages.markup; // Plugin to make entity title show the real entity, idea by Roman Komarov\n\nPrism.hooks.add('wrap', function (env) {\n  if (env.type === 'entity') {\n    env.attributes['title'] = env.content.replace(/&amp;/, '&');\n  }\n});\nObject.defineProperty(Prism.languages.markup.tag, 'addInlined', {\n  /**\n   * Adds an inlined language to markup.\n   *\n   * An example of an inlined language is CSS with `<style>` tags.\n   *\n   * @param {string} tagName The name of the tag that contains the inlined language. This name will be treated as\n   * case insensitive.\n   * @param {string} lang The language key.\n   * @example\n   * addInlined('style', 'css');\n   */\n  value: function addInlined(tagName, lang) {\n    var includedCdataInside = {};\n    includedCdataInside['language-' + lang] = {\n      pattern: /(^<!\\[CDATA\\[)[\\s\\S]+?(?=\\]\\]>$)/i,\n      lookbehind: true,\n      inside: Prism.languages[lang]\n    };\n    includedCdataInside['cdata'] = /^<!\\[CDATA\\[|\\]\\]>$/i;\n    var inside = {\n      'included-cdata': {\n        pattern: /<!\\[CDATA\\[[\\s\\S]*?\\]\\]>/i,\n        inside: includedCdataInside\n      }\n    };\n    inside['language-' + lang] = {\n      pattern: /[\\s\\S]+/,\n      inside: Prism.languages[lang]\n    };\n    var def = {};\n    def[tagName] = {\n      pattern: RegExp(/(<__[^>]*>)(?:<!\\[CDATA\\[(?:[^\\]]|\\](?!\\]>))*\\]\\]>|(?!<!\\[CDATA\\[)[\\s\\S])*?(?=<\\/__>)/.source.replace(/__/g, function () {\n        return tagName;\n      }), 'i'),\n      lookbehind: true,\n      greedy: true,\n      inside: inside\n    };\n    Prism.languages.insertBefore('markup', 'cdata', def);\n  }\n});\nPrism.languages.html = Prism.languages.markup;\nPrism.languages.mathml = Prism.languages.markup;\nPrism.languages.svg = Prism.languages.markup;\nPrism.languages.xml = Prism.languages.extend('markup', {});\nPrism.languages.ssml = Prism.languages.xml;\nPrism.languages.atom = Prism.languages.xml;\nPrism.languages.rss = Prism.languages.xml;\n/* **********************************************\n     Begin prism-css.js\n********************************************** */\n\n(function (Prism) {\n  var string = /(\"|')(?:\\\\(?:\\r\\n|[\\s\\S])|(?!\\1)[^\\\\\\r\\n])*\\1/;\n  Prism.languages.css = {\n    'comment': /\\/\\*[\\s\\S]*?\\*\\//,\n    'atrule': {\n      pattern: /@[\\w-](?:[^;{\\s]|\\s+(?![\\s{]))*(?:;|(?=\\s*\\{))/,\n      inside: {\n        'rule': /^@[\\w-]+/,\n        'selector-function-argument': {\n          pattern: /(\\bselector\\s*\\(\\s*(?![\\s)]))(?:[^()\\s]|\\s+(?![\\s)])|\\((?:[^()]|\\([^()]*\\))*\\))+(?=\\s*\\))/,\n          lookbehind: true,\n          alias: 'selector'\n        },\n        'keyword': {\n          pattern: /(^|[^\\w-])(?:and|not|only|or)(?![\\w-])/,\n          lookbehind: true\n        } // See rest below\n\n      }\n    },\n    'url': {\n      // https://drafts.csswg.org/css-values-3/#urls\n      pattern: RegExp('\\\\burl\\\\((?:' + string.source + '|' + /(?:[^\\\\\\r\\n()\"']|\\\\[\\s\\S])*/.source + ')\\\\)', 'i'),\n      greedy: true,\n      inside: {\n        'function': /^url/i,\n        'punctuation': /^\\(|\\)$/,\n        'string': {\n          pattern: RegExp('^' + string.source + '$'),\n          alias: 'url'\n        }\n      }\n    },\n    'selector': RegExp('[^{}\\\\s](?:[^{};\"\\'\\\\s]|\\\\s+(?![\\\\s{])|' + string.source + ')*(?=\\\\s*\\\\{)'),\n    'string': {\n      pattern: string,\n      greedy: true\n    },\n    'property': /(?!\\s)[-_a-z\\xA0-\\uFFFF](?:(?!\\s)[-\\w\\xA0-\\uFFFF])*(?=\\s*:)/i,\n    'important': /!important\\b/i,\n    'function': /[-a-z0-9]+(?=\\()/i,\n    'punctuation': /[(){};:,]/\n  };\n  Prism.languages.css['atrule'].inside.rest = Prism.languages.css;\n  var markup = Prism.languages.markup;\n\n  if (markup) {\n    markup.tag.addInlined('style', 'css');\n    Prism.languages.insertBefore('inside', 'attr-value', {\n      'style-attr': {\n        pattern: /(^|[\"'\\s])style\\s*=\\s*(?:\"[^\"]*\"|'[^']*')/i,\n        lookbehind: true,\n        inside: {\n          'attr-value': {\n            pattern: /=\\s*(?:\"[^\"]*\"|'[^']*'|[^\\s'\">=]+)/,\n            inside: {\n              'style': {\n                pattern: /([\"'])[\\s\\S]+(?=[\"']$)/,\n                lookbehind: true,\n                alias: 'language-css',\n                inside: Prism.languages.css\n              },\n              'punctuation': [{\n                pattern: /^=/,\n                alias: 'attr-equals'\n              }, /\"|'/]\n            }\n          },\n          'attr-name': /^style/i\n        }\n      }\n    }, markup.tag);\n  }\n})(Prism);\n/* **********************************************\n     Begin prism-clike.js\n********************************************** */\n\n\nPrism.languages.clike = {\n  'comment': [{\n    pattern: /(^|[^\\\\])\\/\\*[\\s\\S]*?(?:\\*\\/|$)/,\n    lookbehind: true,\n    greedy: true\n  }, {\n    pattern: /(^|[^\\\\:])\\/\\/.*/,\n    lookbehind: true,\n    greedy: true\n  }],\n  'string': {\n    pattern: /([\"'])(?:\\\\(?:\\r\\n|[\\s\\S])|(?!\\1)[^\\\\\\r\\n])*\\1/,\n    greedy: true\n  },\n  'class-name': {\n    pattern: /(\\b(?:class|interface|extends|implements|trait|instanceof|new)\\s+|\\bcatch\\s+\\()[\\w.\\\\]+/i,\n    lookbehind: true,\n    inside: {\n      'punctuation': /[.\\\\]/\n    }\n  },\n  'keyword': /\\b(?:if|else|while|do|for|return|in|instanceof|function|new|try|throw|catch|finally|null|break|continue)\\b/,\n  'boolean': /\\b(?:true|false)\\b/,\n  'function': /\\w+(?=\\()/,\n  'number': /\\b0x[\\da-f]+\\b|(?:\\b\\d+(?:\\.\\d*)?|\\B\\.\\d+)(?:e[+-]?\\d+)?/i,\n  'operator': /[<>]=?|[!=]=?=?|--?|\\+\\+?|&&?|\\|\\|?|[?*/~^%]/,\n  'punctuation': /[{}[\\];(),.:]/\n};\n/* **********************************************\n     Begin prism-javascript.js\n********************************************** */\n\nPrism.languages.javascript = Prism.languages.extend('clike', {\n  'class-name': [Prism.languages.clike['class-name'], {\n    pattern: /(^|[^$\\w\\xA0-\\uFFFF])(?!\\s)[_$A-Z\\xA0-\\uFFFF](?:(?!\\s)[$\\w\\xA0-\\uFFFF])*(?=\\.(?:prototype|constructor))/,\n    lookbehind: true\n  }],\n  'keyword': [{\n    pattern: /((?:^|})\\s*)(?:catch|finally)\\b/,\n    lookbehind: true\n  }, {\n    pattern: /(^|[^.]|\\.\\.\\.\\s*)\\b(?:as|async(?=\\s*(?:function\\b|\\(|[$\\w\\xA0-\\uFFFF]|$))|await|break|case|class|const|continue|debugger|default|delete|do|else|enum|export|extends|for|from|function|(?:get|set)(?=\\s*[\\[$\\w\\xA0-\\uFFFF])|if|implements|import|in|instanceof|interface|let|new|null|of|package|private|protected|public|return|static|super|switch|this|throw|try|typeof|undefined|var|void|while|with|yield)\\b/,\n    lookbehind: true\n  }],\n  // Allow for all non-ASCII characters (See http://stackoverflow.com/a/2008444)\n  'function': /#?(?!\\s)[_$a-zA-Z\\xA0-\\uFFFF](?:(?!\\s)[$\\w\\xA0-\\uFFFF])*(?=\\s*(?:\\.\\s*(?:apply|bind|call)\\s*)?\\()/,\n  'number': /\\b(?:(?:0[xX](?:[\\dA-Fa-f](?:_[\\dA-Fa-f])?)+|0[bB](?:[01](?:_[01])?)+|0[oO](?:[0-7](?:_[0-7])?)+)n?|(?:\\d(?:_\\d)?)+n|NaN|Infinity)\\b|(?:\\b(?:\\d(?:_\\d)?)+\\.?(?:\\d(?:_\\d)?)*|\\B\\.(?:\\d(?:_\\d)?)+)(?:[Ee][+-]?(?:\\d(?:_\\d)?)+)?/,\n  'operator': /--|\\+\\+|\\*\\*=?|=>|&&=?|\\|\\|=?|[!=]==|<<=?|>>>?=?|[-+*/%&|^!=<>]=?|\\.{3}|\\?\\?=?|\\?\\.?|[~:]/\n});\nPrism.languages.javascript['class-name'][0].pattern = /(\\b(?:class|interface|extends|implements|instanceof|new)\\s+)[\\w.\\\\]+/;\nPrism.languages.insertBefore('javascript', 'keyword', {\n  'regex': {\n    pattern: /((?:^|[^$\\w\\xA0-\\uFFFF.\"'\\])\\s]|\\b(?:return|yield))\\s*)\\/(?:\\[(?:[^\\]\\\\\\r\\n]|\\\\.)*]|\\\\.|[^/\\\\\\[\\r\\n])+\\/[gimyus]{0,6}(?=(?:\\s|\\/\\*(?:[^*]|\\*(?!\\/))*\\*\\/)*(?:$|[\\r\\n,.;:})\\]]|\\/\\/))/,\n    lookbehind: true,\n    greedy: true,\n    inside: {\n      'regex-source': {\n        pattern: /^(\\/)[\\s\\S]+(?=\\/[a-z]*$)/,\n        lookbehind: true,\n        alias: 'language-regex',\n        inside: Prism.languages.regex\n      },\n      'regex-flags': /[a-z]+$/,\n      'regex-delimiter': /^\\/|\\/$/\n    }\n  },\n  // This must be declared before keyword because we use \"function\" inside the look-forward\n  'function-variable': {\n    pattern: /#?(?!\\s)[_$a-zA-Z\\xA0-\\uFFFF](?:(?!\\s)[$\\w\\xA0-\\uFFFF])*(?=\\s*[=:]\\s*(?:async\\s*)?(?:\\bfunction\\b|(?:\\((?:[^()]|\\([^()]*\\))*\\)|(?!\\s)[_$a-zA-Z\\xA0-\\uFFFF](?:(?!\\s)[$\\w\\xA0-\\uFFFF])*)\\s*=>))/,\n    alias: 'function'\n  },\n  'parameter': [{\n    pattern: /(function(?:\\s+(?!\\s)[_$a-zA-Z\\xA0-\\uFFFF](?:(?!\\s)[$\\w\\xA0-\\uFFFF])*)?\\s*\\(\\s*)(?!\\s)(?:[^()\\s]|\\s+(?![\\s)])|\\([^()]*\\))+(?=\\s*\\))/,\n    lookbehind: true,\n    inside: Prism.languages.javascript\n  }, {\n    pattern: /(?!\\s)[_$a-zA-Z\\xA0-\\uFFFF](?:(?!\\s)[$\\w\\xA0-\\uFFFF])*(?=\\s*=>)/i,\n    inside: Prism.languages.javascript\n  }, {\n    pattern: /(\\(\\s*)(?!\\s)(?:[^()\\s]|\\s+(?![\\s)])|\\([^()]*\\))+(?=\\s*\\)\\s*=>)/,\n    lookbehind: true,\n    inside: Prism.languages.javascript\n  }, {\n    pattern: /((?:\\b|\\s|^)(?!(?:as|async|await|break|case|catch|class|const|continue|debugger|default|delete|do|else|enum|export|extends|finally|for|from|function|get|if|implements|import|in|instanceof|interface|let|new|null|of|package|private|protected|public|return|set|static|super|switch|this|throw|try|typeof|undefined|var|void|while|with|yield)(?![$\\w\\xA0-\\uFFFF]))(?:(?!\\s)[_$a-zA-Z\\xA0-\\uFFFF](?:(?!\\s)[$\\w\\xA0-\\uFFFF])*\\s*)\\(\\s*|\\]\\s*\\(\\s*)(?!\\s)(?:[^()\\s]|\\s+(?![\\s)])|\\([^()]*\\))+(?=\\s*\\)\\s*\\{)/,\n    lookbehind: true,\n    inside: Prism.languages.javascript\n  }],\n  'constant': /\\b[A-Z](?:[A-Z_]|\\dx?)*\\b/\n});\nPrism.languages.insertBefore('javascript', 'string', {\n  'template-string': {\n    pattern: /`(?:\\\\[\\s\\S]|\\${(?:[^{}]|{(?:[^{}]|{[^}]*})*})+}|(?!\\${)[^\\\\`])*`/,\n    greedy: true,\n    inside: {\n      'template-punctuation': {\n        pattern: /^`|`$/,\n        alias: 'string'\n      },\n      'interpolation': {\n        pattern: /((?:^|[^\\\\])(?:\\\\{2})*)\\${(?:[^{}]|{(?:[^{}]|{[^}]*})*})+}/,\n        lookbehind: true,\n        inside: {\n          'interpolation-punctuation': {\n            pattern: /^\\${|}$/,\n            alias: 'punctuation'\n          },\n          rest: Prism.languages.javascript\n        }\n      },\n      'string': /[\\s\\S]+/\n    }\n  }\n});\n\nif (Prism.languages.markup) {\n  Prism.languages.markup.tag.addInlined('script', 'javascript');\n}\n\nPrism.languages.js = Prism.languages.javascript;\n/* **********************************************\n     Begin prism-file-highlight.js\n********************************************** */\n\n(function () {\n  if (typeof self === 'undefined' || !self.Prism || !self.document) {\n    return;\n  } // https://developer.mozilla.org/en-US/docs/Web/API/Element/matches#Polyfill\n\n\n  if (!Element.prototype.matches) {\n    Element.prototype.matches = Element.prototype.msMatchesSelector || Element.prototype.webkitMatchesSelector;\n  }\n\n  var Prism = window.Prism;\n  var LOADING_MESSAGE = 'Loading';\n\n  var FAILURE_MESSAGE = function FAILURE_MESSAGE(status, message) {\n    return ' Error ' + status + ' while fetching file: ' + message;\n  };\n\n  var FAILURE_EMPTY_MESSAGE = ' Error: File does not exist or is empty';\n  var EXTENSIONS = {\n    'js': 'javascript',\n    'py': 'python',\n    'rb': 'ruby',\n    'ps1': 'powershell',\n    'psm1': 'powershell',\n    'sh': 'bash',\n    'bat': 'batch',\n    'h': 'c',\n    'tex': 'latex'\n  };\n  var STATUS_ATTR = 'data-src-status';\n  var STATUS_LOADING = 'loading';\n  var STATUS_LOADED = 'loaded';\n  var STATUS_FAILED = 'failed';\n  var SELECTOR = 'pre[data-src]:not([' + STATUS_ATTR + '=\"' + STATUS_LOADED + '\"])' + ':not([' + STATUS_ATTR + '=\"' + STATUS_LOADING + '\"])';\n  var lang = /\\blang(?:uage)?-([\\w-]+)\\b/i;\n  /**\n   * Sets the Prism `language-xxxx` or `lang-xxxx` class to the given language.\n   *\n   * @param {HTMLElement} element\n   * @param {string} language\n   * @returns {void}\n   */\n\n  function setLanguageClass(element, language) {\n    var className = element.className;\n    className = className.replace(lang, ' ') + ' language-' + language;\n    element.className = className.replace(/\\s+/g, ' ').trim();\n  }\n\n  Prism.hooks.add('before-highlightall', function (env) {\n    env.selector += ', ' + SELECTOR;\n  });\n  Prism.hooks.add('before-sanity-check', function (env) {\n    var pre =\n    /** @type {HTMLPreElement} */\n    env.element;\n\n    if (pre.matches(SELECTOR)) {\n      env.code = ''; // fast-path the whole thing and go to complete\n\n      pre.setAttribute(STATUS_ATTR, STATUS_LOADING); // mark as loading\n      // add code element with loading message\n\n      var code = pre.appendChild(document.createElement('CODE'));\n      code.textContent = LOADING_MESSAGE;\n      var src = pre.getAttribute('data-src');\n      var language = env.language;\n\n      if (language === 'none') {\n        // the language might be 'none' because there is no language set;\n        // in this case, we want to use the extension as the language\n        var extension = (/\\.(\\w+)$/.exec(src) || [, 'none'])[1];\n        language = EXTENSIONS[extension] || extension;\n      } // set language classes\n\n\n      setLanguageClass(code, language);\n      setLanguageClass(pre, language); // preload the language\n\n      var autoloader = Prism.plugins.autoloader;\n\n      if (autoloader) {\n        autoloader.loadLanguages(language);\n      } // load file\n\n\n      var xhr = new XMLHttpRequest();\n      xhr.open('GET', src, true);\n\n      xhr.onreadystatechange = function () {\n        if (xhr.readyState == 4) {\n          if (xhr.status < 400 && xhr.responseText) {\n            // mark as loaded\n            pre.setAttribute(STATUS_ATTR, STATUS_LOADED); // highlight code\n\n            code.textContent = xhr.responseText;\n            Prism.highlightElement(code);\n          } else {\n            // mark as failed\n            pre.setAttribute(STATUS_ATTR, STATUS_FAILED);\n\n            if (xhr.status >= 400) {\n              code.textContent = FAILURE_MESSAGE(xhr.status, xhr.statusText);\n            } else {\n              code.textContent = FAILURE_EMPTY_MESSAGE;\n            }\n          }\n        }\n      };\n\n      xhr.send(null);\n    }\n  });\n  Prism.plugins.fileHighlight = {\n    /**\n     * Executes the File Highlight plugin for all matching `pre` elements under the given container.\n     *\n     * Note: Elements which are already loaded or currently loading will not be touched by this method.\n     *\n     * @param {ParentNode} [container=document]\n     */\n    highlight: function highlight(container) {\n      var elements = (container || document).querySelectorAll(SELECTOR);\n\n      for (var i = 0, element; element = elements[i++];) {\n        Prism.highlightElement(element);\n      }\n    }\n  };\n  var logged = false;\n  /** @deprecated Use `Prism.plugins.fileHighlight.highlight` instead. */\n\n  Prism.fileHighlight = function () {\n    if (!logged) {\n      console.warn('Prism.fileHighlight is deprecated. Use `Prism.plugins.fileHighlight.highlight` instead.');\n      logged = true;\n    }\n\n    Prism.plugins.fileHighlight.highlight.apply(this, arguments);\n  };\n})();","import { useEffect, useState, useRef } from 'react';\r\nimport { sameArrayContents } from 'utils/arrays';\r\nimport { ErrorState } from 'utils/error';\r\n\r\ntype TDoWork = (\r\n    doWorkInner: (stopIfObsolete: (() => void)) => Promise<void>,\r\n    getContext?: () => unknown[]) => void;\r\n\r\n\r\nexport function useMounted() {\r\n    const mounted = useRef(true);\r\n    useEffect(() => {\r\n        // Unmount on unsub\r\n        return () => {\r\n            mounted.current = false;\r\n        };\r\n    }, [/* Init Only */]);\r\n    return { mounted };\r\n}\r\n\r\nexport function useDebounce(timeMs = 250) {\r\n    const { mounted } = useMounted();\r\n    const debouncer = useRef({\r\n        timeoutId: setTimeout(() => { }),\r\n        debounce: (action: () => void) => {\r\n            clearTimeout(debouncer.current.timeoutId);\r\n            debouncer.current.timeoutId = setTimeout(() => {\r\n                if (!mounted.current) { return; }\r\n                action();\r\n            }, timeMs);\r\n        },\r\n    });\r\n\r\n    return debouncer.current;\r\n}\r\n\r\n/** Automatically handle loading and error objects with asyncronous calls\r\n * @return The { loading, error, doWork } values\r\n * @example\r\n *\r\n *      const { loading, error, doWork } = ChatHooks.useAutoLoadingError();\r\n *      ...\r\n *          doWork(async (stopIfObsolete) => {\r\n *              ...\r\n *              const result = async DoAsyncWork());\r\n *              stopIfObsolete(); // Stop work if component has been unmounted, or if contextValues have changed since beginning of doWork\r\n *              ...\r\n *              setResult(result);\r\n *          }, () => [ contextValueA, contextValueB ]); // Optional context values to stop work if changed\r\n *    \r\n */\r\nexport function useAutoLoadingError() {\r\n    const { mounted } = useMounted();\r\n    const [loadingError, setLoadingError] = useState({ loading: false, error: null as null | ErrorState });\r\n\r\n    const UNMOUNTED = `unmounted`;\r\n    const CHANGED_CONTEXT = `changedContext`;\r\n\r\n    const doWork: TDoWork = (\r\n        doWorkInner: (stopIfObsolete: (() => void)) => Promise<void>,\r\n        getContext?: () => unknown[]) => {\r\n\r\n        let contextInit = undefined as undefined | unknown[];\r\n\r\n        const stopIfObsolete = () => {\r\n            if (!mounted.current) {\r\n                // eslint-disable-next-line @typescript-eslint/no-throw-literal\r\n                throw UNMOUNTED;\r\n            }\r\n            const c = getContext?.();\r\n\r\n            if (!sameArrayContents(contextInit, c)) {\r\n                // eslint-disable-next-line @typescript-eslint/no-throw-literal\r\n                throw CHANGED_CONTEXT;\r\n            }\r\n        };\r\n\r\n        const doCall = async () => {\r\n            contextInit = getContext?.();\r\n            setLoadingError({ loading: true, error: null });\r\n\r\n            // eslint-disable-next-line @typescript-eslint/no-unused-vars\r\n            let hadError = false;\r\n\r\n            try {\r\n                try {\r\n                    await doWorkInner(stopIfObsolete);\r\n                    stopIfObsolete();\r\n                    setLoadingError({ loading: false, error: null });\r\n                }\r\n                catch (error) {\r\n                    // Ignore unmounted or changed context\r\n                    if (error !== UNMOUNTED && error !== CHANGED_CONTEXT) {\r\n                        throw error;\r\n                    }\r\n                }\r\n            } catch (error) {\r\n                // console.log(`doWork catch`, { err: error });\r\n                hadError = true;\r\n\r\n                if (!mounted.current) {\r\n                    // console.warn(`doWork Error when not Mounted`, { err: error });\r\n                    return;\r\n                }\r\n\r\n                setLoadingError({ loading: false, error: { message: error.message ?? `Unknown Error in doWork`, error, retryCallback: doCall } });\r\n            }\r\n        };\r\n\r\n        // Start Async\r\n        (async () => await doCall())();\r\n    };\r\n\r\n    return { loading: loadingError.loading, error: loadingError.error, doWork };\r\n}\r\n\r\nexport function useLoadData<T>(doWork: TDoWork, getData: () => Promise<T>, getDataDeps?: () => unknown[]) {\r\n    const [data, setData] = useState(null as null | T);\r\n    useEffect(() => {\r\n        // console.log(`useLoadData.useEffect`);\r\n        doWork(async (stopIfObsolete) => {\r\n            // console.log(`useLoadData.useEffect.doWork`);\r\n            const d = await getData();\r\n            stopIfObsolete();\r\n            setData(d);\r\n        }, getDataDeps);\r\n    }, getDataDeps?.() ?? []);\r\n    return { data };\r\n}\r\n","import React, { useState, useEffect } from 'react';\r\nimport { ActivityIndicator, View } from 'react-native-lite';\r\nimport { theme } from 'themes/theme';\r\n\r\nexport const Loading = ({ loading }: { loading?: boolean }) => {\r\n\r\n    const visible = loading;\r\n\r\n    // // Show loading for a min time\r\n    // const [visible, setVisible] = useState(loading);\r\n    // const MIN_TIME_MS = 500;\r\n    // useEffect(() => {\r\n    //     if (loading) { setVisible(true); return () => { }; }\r\n    //     const timeoutId = setTimeout(() => {\r\n    //         setVisible(false);\r\n    //     }, MIN_TIME_MS);\r\n    //     return () => {\r\n    //         clearTimeout(timeoutId);\r\n    //     };\r\n    // }, [loading]);\r\n\r\n    if (!visible) { return <></>; }\r\n\r\n    return (\r\n        <View>\r\n            <ActivityIndicator size='large' color={theme.colors.loader} />\r\n        </View>\r\n    );\r\n};\r\n\r\nexport const LoadingInline = ({ loading }: { loading?: boolean }) => {\r\n\r\n    const visible = loading;\r\n\r\n    // // Show loading for a min time\r\n    // const [visible, setVisible] = useState(loading);\r\n    // const MIN_TIME_MS = 500;\r\n    // useEffect(() => {\r\n    //     if (loading) { setVisible(true); return () => { }; }\r\n    //     const timeoutId = setTimeout(() => {\r\n    //         setVisible(false);\r\n    //     }, MIN_TIME_MS);\r\n    //     return () => {\r\n    //         clearTimeout(timeoutId);\r\n    //     };\r\n    // }, [loading]);\r\n\r\n    if (!visible) { return <></>; }\r\n\r\n    return (\r\n        <>\r\n            <ActivityIndicator size='small' color={theme.colors.loader} />\r\n        </>\r\n    );\r\n};\r\n","import { distinct, shuffle } from 'utils/arrays';\r\nimport { SpeechService } from '../../utils/speech';\r\nimport { ProblemService, ProblemAnswer } from '../problems-service';\r\nimport { getSpellingEntries } from './spelling-entries';\r\n\r\nexport const createSpellingProblemService = ({ speechService, maxAnswers = 4, sectionSize = 25 }: { speechService: SpeechService, maxAnswers?: number, sectionSize?: number }): ProblemService => {\r\n    const speech = speechService;\r\n    const spellingEntries = getSpellingEntries();\r\n    const sectionCount = Math.ceil(spellingEntries.length / sectionSize);\r\n\r\n    let state = {\r\n        nextIndex: 0,\r\n        completedSectionKeys: [] as string[],\r\n    };\r\n\r\n    const getSectionKey = (sectionIndex: number) => {\r\n        return `${sectionIndex}`;\r\n    };\r\n    const getSectionName = (sectionIndex: number) => {\r\n        return `Spelling ${sectionIndex + 1}`;\r\n    };\r\n\r\n    const service: ProblemService = {\r\n        load: async (storage) => {\r\n            const loaded = await storage.load<typeof state>();\r\n            if (loaded) {\r\n                state = loaded;\r\n            }\r\n        },\r\n        save: async (storage) => {\r\n            await storage.save(state);\r\n        },\r\n        getSections: () => [...new Array(sectionCount)].map((x, i) => ({\r\n            key: getSectionKey(i),\r\n            name: getSectionName(i),\r\n            isComplete: state.completedSectionKeys.includes(getSectionKey(i)),\r\n        })),\r\n        gotoSection: ({ key }) => {\r\n            const a = Number.parseInt(key, 10);\r\n            state.nextIndex = a * sectionSize;\r\n            console.log(`createSpellingProblemService gotoSection`, { key, a, state });\r\n        },\r\n        getNextProblem: () => {\r\n            if (state.nextIndex >= spellingEntries.length) {\r\n                state.nextIndex = 0;\r\n            }\r\n\r\n            const i = state.nextIndex;\r\n            state.nextIndex++;\r\n\r\n            const p = spellingEntries[i];\r\n            const correctValue = p.word;\r\n            const wrongAnswerCount = maxAnswers - 1;\r\n            const wrongValues =\r\n                shuffle(distinct(p.mispellings)).slice(0, wrongAnswerCount);\r\n\r\n            const answers: ProblemAnswer[] = shuffle([...wrongValues.map(x => ({ value: `${x}`, isCorrect: false })), { value: `${correctValue}`, isCorrect: true }]).map(x => ({ ...x, key: x.value }));\r\n\r\n            const isLastOfSection = (i + 1) % sectionSize === 0;\r\n            const isLastOfSubject = i === spellingEntries.length - 1;\r\n            return {\r\n                key: `${i + 1}`,\r\n                question: `Word ${i + 1}`,\r\n                onQuestion: () => { speech.speak(correctValue); },\r\n                answers,\r\n                sectionKey: getSectionKey(Math.floor(i / sectionSize)),\r\n                isLastOfSection,\r\n                isLastOfSubject,\r\n            };\r\n        },\r\n        recordAnswer: (problem, answer) => {\r\n            if (answer.isCorrect && problem.isLastOfSection) {\r\n                state.completedSectionKeys.push(problem.sectionKey);\r\n            }\r\n        },\r\n    };\r\n\r\n    return service;\r\n};\r\n","import { ifError } from 'assert';\r\nimport React, { useState } from 'react';\r\nimport { View, Text, TouchableOpacity } from 'react-native-lite';\r\n\r\nconst styles = {\r\n    mainView: {\r\n        flexDirection: `row`,\r\n        flexWrap: `wrap`,\r\n        alignItems: `center`,\r\n    },\r\n    mainView_column: {\r\n        flexDirection: `column`,\r\n    },\r\n    tabView: {\r\n        flexDirection: `row`,\r\n        alignItems: `center`,\r\n        background: `#1e1e1e`,\r\n        // alignSelf: `flex-start`,\r\n        padding: 4,\r\n        marginRight: 1,\r\n    },\r\n    tabView_selected: {\r\n        flexDirection: `row`,\r\n        alignItems: `center`,\r\n        background: `#292a2d`,\r\n        // alignSelf: `flex-start`,\r\n        padding: 4,\r\n        marginRight: 1,\r\n    },\r\n    tabText: {\r\n        fontSize: 14,\r\n    },\r\n    tabText_selected: {\r\n        fontSize: 14,\r\n        color: `#FFFF88`,\r\n    },\r\n    headerTabView: {\r\n        flexDirection: `row`,\r\n        alignItems: `center`,\r\n        // background: `#1e1e1e`,\r\n        // alignSelf: `flex-start`,\r\n        padding: 4,\r\n        marginRight: 1,\r\n    },\r\n    headerTabText: {\r\n        fontSize: 14,\r\n    },\r\n    moveButtonView: {\r\n        minWidth: 24,\r\n        justifyContents: `center`,\r\n        alignItems: `center`,\r\n    },\r\n} as const;\r\n\r\nexport const TabsListEditorComponent = <T extends {}>({\r\n    items,\r\n    onChange,\r\n    getLabel,\r\n    getKey,\r\n    selected,\r\n    onSelect,\r\n    onCreateNewItem,\r\n    header,\r\n    style,\r\n}: {\r\n    items: T[];\r\n    onChange?: (items: T[]) => void;\r\n    getLabel: (item: T) => string;\r\n    getKey: (item: T, index: number) => string;\r\n    selected?: T;\r\n    onSelect: (selected: T) => void;\r\n    onCreateNewItem: () => T;\r\n    header?: string;\r\n    style?: {\r\n        selectedTabText?: { color?: string };\r\n    };\r\n}) => {\r\n\r\n    if (!onChange) {\r\n        return (\r\n            <TabsComponent\r\n                items={items}\r\n                getLabel={getLabel}\r\n                getKey={getKey}\r\n                selected={selected}\r\n                onSelect={onSelect}\r\n                header={header}\r\n                style={style}\r\n            />\r\n        );\r\n    }\r\n\r\n    const onAdd = () => {\r\n        const newItem = onCreateNewItem();\r\n        onChange([...items, newItem]);\r\n        onSelect(newItem);\r\n    };\r\n    const onDelete = () => {\r\n        const newItems = [...items.filter(x => x !== selected)];\r\n        onChange(newItems);\r\n        if (newItems.length > 0) {\r\n            onSelect(newItems[0]);\r\n        }\r\n    };\r\n    const onMove = (item: T, oldIndex: number, newIndex: number) => {\r\n        if (newIndex < 0 || newIndex > items.length - 1) { return; }\r\n        const newItems = [...items];\r\n        newItems.splice(oldIndex, 1);\r\n        newItems.splice(newIndex, 0, item);\r\n\r\n        onChange(newItems);\r\n    };\r\n\r\n    return (\r\n        <TabsComponent\r\n            items={items}\r\n            getLabel={getLabel}\r\n            getKey={getKey}\r\n            selected={selected}\r\n            onSelect={onSelect}\r\n            onMove={onMove}\r\n            onAdd={onAdd}\r\n            onDelete={onDelete}\r\n            header={header}\r\n            style={style}\r\n        />\r\n    );\r\n};\r\n\r\nexport const TabsComponent = <T extends {}>({\r\n    items,\r\n    getLabel,\r\n    getKey,\r\n    selected,\r\n    onSelect,\r\n    onMove,\r\n    onAdd,\r\n    onDelete,\r\n    header,\r\n    style,\r\n}: {\r\n    items: T[];\r\n    getLabel: (item: T) => string;\r\n    getKey: (item: T, index: number) => string;\r\n    selected?: T;\r\n    onSelect: (selected: T) => void;\r\n    onMove?: (item: T, fromIndex: number, toIndex: number) => void;\r\n    onAdd?: () => void;\r\n    onDelete?: () => void;\r\n    header?: string;\r\n    style?: {\r\n        selectedTabText?: { color?: string };\r\n    };\r\n}) => {\r\n    const [mode, setMode] = useState(`row` as 'row' | 'column');\r\n\r\n    return (\r\n        <View style={mode === `row` ? styles.mainView : styles.mainView_column}>\r\n\r\n            {!!header && (\r\n                <TouchableOpacity onPress={() => setMode(s => s === `row` ? `column` : `row`)}>\r\n                    <View style={styles.headerTabView}>\r\n                        <Text style={styles.tabText}>{`${mode === `row` ? ` ` : ` `}`}</Text>\r\n                        <Text style={styles.headerTabText}>{`${header}`}</Text>\r\n                    </View>\r\n                </TouchableOpacity>\r\n            )}\r\n\r\n            {items.map((x, i) => (\r\n                <View key={getKey(x, i)} style={x === selected ? styles.tabView_selected : styles.tabView}>\r\n                    {mode === `column` && onMove && (\r\n                        <>\r\n                            <TouchableOpacity onPress={() => onMove(x, i, i - 1)}>\r\n                                <View style={styles.moveButtonView}>\r\n                                    <Text style={styles.tabText}>{`${i <= 0 ? ` ` : ``}`}</Text>\r\n                                </View>\r\n                            </TouchableOpacity>\r\n                            <TouchableOpacity onPress={() => onMove(x, i, i + 1)}>\r\n                                <View style={styles.moveButtonView}>\r\n                                    <Text style={styles.tabText}>{`${i >= items.length - 1 ? ` ` : ``}`}</Text>\r\n                                </View>\r\n                            </TouchableOpacity>\r\n                        </>\r\n                    )}\r\n                    <TouchableOpacity style={{ flex: 1 }} onPress={() => onSelect(x)}>\r\n                        <View>\r\n                            <Text style={x === selected ? { ...styles.tabText_selected, ...style?.selectedTabText } : { ...styles.tabText }}>{`${getLabel(x)}`}</Text>\r\n                        </View>\r\n                    </TouchableOpacity>\r\n                </View>\r\n            ))}\r\n            <View style={{ flex: 1, flexDirection: `row` }}>\r\n                {onAdd && (\r\n                    <>\r\n                        <TouchableOpacity onPress={() => onAdd()}>\r\n                            <View style={styles.tabView}>\r\n                                <Text style={styles.tabText}>{`${``} Add`}</Text>\r\n                            </View>\r\n                        </TouchableOpacity>\r\n                    </>\r\n                )}\r\n                <View style={{ flex: 1 }} />\r\n                {onDelete && (\r\n                    <TouchableOpacity onPress={() => onDelete()}>\r\n                        <View style={styles.tabView}>\r\n                            <Text style={styles.tabText}>{`${``} Delete`}</Text>\r\n                        </View>\r\n                    </TouchableOpacity>\r\n                )}\r\n            </View>\r\n        </View>\r\n    );\r\n};\r\n","(function (Prism) {\n  var javascript = Prism.util.clone(Prism.languages.javascript);\n  Prism.languages.jsx = Prism.languages.extend('markup', javascript);\n  Prism.languages.jsx.tag.pattern = /<\\/?(?:[\\w.:-]+(?:\\s+(?:[\\w.:$-]+(?:=(?:\"(?:\\\\[^]|[^\\\\\"])*\"|'(?:\\\\[^]|[^\\\\'])*'|[^\\s{'\">=]+|\\{(?:\\{(?:\\{[^{}]*\\}|[^{}])*\\}|[^{}])+\\}))?|\\{\\s*\\.{3}\\s*[a-z_$][\\w$]*(?:\\.[a-z_$][\\w$]*)*\\s*\\}))*\\s*\\/?)?>/i;\n  Prism.languages.jsx.tag.inside['tag'].pattern = /^<\\/?[^\\s>\\/]*/i;\n  Prism.languages.jsx.tag.inside['attr-value'].pattern = /=(?!\\{)(?:\"(?:\\\\[^]|[^\\\\\"])*\"|'(?:\\\\[^]|[^\\\\'])*'|[^\\s'\">]+)/i;\n  Prism.languages.jsx.tag.inside['tag'].inside['class-name'] = /^[A-Z]\\w*(?:\\.[A-Z]\\w*)*$/;\n  Prism.languages.insertBefore('inside', 'attr-name', {\n    'spread': {\n      pattern: /\\{\\s*\\.{3}\\s*[a-z_$][\\w$]*(?:\\.[a-z_$][\\w$]*)*\\s*\\}/,\n      inside: {\n        'punctuation': /\\.{3}|[{}.]/,\n        'attr-value': /\\w+/\n      }\n    }\n  }, Prism.languages.jsx.tag);\n  Prism.languages.insertBefore('inside', 'attr-value', {\n    'script': {\n      // Allow for two levels of nesting\n      pattern: /=(?:\\{(?:\\{(?:\\{[^{}]*\\}|[^{}])*\\}|[^{}])+\\})/i,\n      inside: {\n        'script-punctuation': {\n          pattern: /^=(?={)/,\n          alias: 'punctuation'\n        },\n        rest: Prism.languages.jsx\n      },\n      'alias': 'language-javascript'\n    }\n  }, Prism.languages.jsx.tag); // The following will handle plain text inside tags\n\n  var stringifyToken = function stringifyToken(token) {\n    if (!token) {\n      return '';\n    }\n\n    if (typeof token === 'string') {\n      return token;\n    }\n\n    if (typeof token.content === 'string') {\n      return token.content;\n    }\n\n    return token.content.map(stringifyToken).join('');\n  };\n\n  var walkTokens = function walkTokens(tokens) {\n    var openedTags = [];\n\n    for (var i = 0; i < tokens.length; i++) {\n      var token = tokens[i];\n      var notTagNorBrace = false;\n\n      if (typeof token !== 'string') {\n        if (token.type === 'tag' && token.content[0] && token.content[0].type === 'tag') {\n          // We found a tag, now find its kind\n          if (token.content[0].content[0].content === '</') {\n            // Closing tag\n            if (openedTags.length > 0 && openedTags[openedTags.length - 1].tagName === stringifyToken(token.content[0].content[1])) {\n              // Pop matching opening tag\n              openedTags.pop();\n            }\n          } else {\n            if (token.content[token.content.length - 1].content === '/>') {// Autoclosed tag, ignore\n            } else {\n              // Opening tag\n              openedTags.push({\n                tagName: stringifyToken(token.content[0].content[1]),\n                openedBraces: 0\n              });\n            }\n          }\n        } else if (openedTags.length > 0 && token.type === 'punctuation' && token.content === '{') {\n          // Here we might have entered a JSX context inside a tag\n          openedTags[openedTags.length - 1].openedBraces++;\n        } else if (openedTags.length > 0 && openedTags[openedTags.length - 1].openedBraces > 0 && token.type === 'punctuation' && token.content === '}') {\n          // Here we might have left a JSX context inside a tag\n          openedTags[openedTags.length - 1].openedBraces--;\n        } else {\n          notTagNorBrace = true;\n        }\n      }\n\n      if (notTagNorBrace || typeof token === 'string') {\n        if (openedTags.length > 0 && openedTags[openedTags.length - 1].openedBraces === 0) {\n          // Here we are inside a tag, and not inside a JSX context.\n          // That's plain text: drop any tokens matched.\n          var plainText = stringifyToken(token); // And merge text with adjacent text\n\n          if (i < tokens.length - 1 && (typeof tokens[i + 1] === 'string' || tokens[i + 1].type === 'plain-text')) {\n            plainText += stringifyToken(tokens[i + 1]);\n            tokens.splice(i + 1, 1);\n          }\n\n          if (i > 0 && (typeof tokens[i - 1] === 'string' || tokens[i - 1].type === 'plain-text')) {\n            plainText = stringifyToken(tokens[i - 1]) + plainText;\n            tokens.splice(i - 1, 1);\n            i--;\n          }\n\n          tokens[i] = new Prism.Token('plain-text', plainText, null, plainText);\n        }\n      }\n\n      if (token.content && typeof token.content !== 'string') {\n        walkTokens(token.content);\n      }\n    }\n  };\n\n  Prism.hooks.add('after-tokenize', function (env) {\n    if (env.language !== 'jsx' && env.language !== 'tsx') {\n      return;\n    }\n\n    walkTokens(env.tokens);\n  });\n})(Prism);","import React, { useState, useRef, useEffect } from 'react';\r\nimport { View, Text, Pressable, Platform } from 'react-native-lite';\r\n\r\nexport type GamepadPressState = { moveDirection: { x: number, y: number }, buttons: { key: string, text: string, isDown: boolean }[] };\r\nexport const GamepadAnalogStateful = (props: {\r\n    style: { backgroundColor: string, borderColor: string };\r\n    onPressStateChange: (value: GamepadPressState) => void;\r\n    buttons: { text: string, key: string }[];\r\n}) => {\r\n\r\n    const state = useRef({\r\n        moveDirection: { x: 0, y: 0 },\r\n        buttons: props.buttons.map((x, i) => ({\r\n            isDown: false,\r\n            key: x.key,\r\n            text: x.text,\r\n            onPressIn: () => {\r\n                state.current.buttons[i].isDown = true;\r\n                props.onPressStateChange(state.current);\r\n            },\r\n            onPressOut: () => {\r\n                state.current.buttons[i].isDown = false;\r\n                props.onPressStateChange(state.current);\r\n            },\r\n        })),\r\n    });\r\n\r\n    const onMovePressIn = (dir: { x: number, y: number }) => {\r\n        const s = state.current;\r\n\r\n        state.current.moveDirection = {\r\n            x: dir.x ? dir.x : s.moveDirection.x,\r\n            y: dir.y ? dir.y : s.moveDirection.y,\r\n        };\r\n\r\n        console.log(`onMovePressIn`, { dir, s, moveDirection: state.current.moveDirection });\r\n\r\n        props.onPressStateChange(state.current);\r\n    };\r\n\r\n    const onMovePressOut = (dir: { x: number, y: number }) => {\r\n        const s = state.current;\r\n        state.current.moveDirection = {\r\n            x: dir.x ? 0 : s.moveDirection.x,\r\n            y: dir.y ? 0 : s.moveDirection.y,\r\n        };\r\n        props.onPressStateChange(state.current);\r\n    };\r\n\r\n    return (\r\n        <GamepadAnalog {...props} onMovePressIn={onMovePressIn} onMovePressOut={onMovePressOut} buttons={state.current.buttons} />\r\n    );\r\n};\r\n\r\nconst inputStyles = {\r\n    container: { flex: 1, alignSelf: `stretch`, flexDirection: `row`, justifyContent: `space-between`, alignItems: `center`, padding: 4 },\r\n    section: { justifyContent: `center`, alignItems: `center`, padding: 4 },\r\n    moveSectionWrapper: { overflow: `hidden` },\r\n    moveSectionRotation: { transform: `rotate(0.125turn)`, margin: 0 },\r\n    row: { flexDirection: `row` },\r\n    cellTouch: { outline: `none` },\r\n    cellView: { pointerEvents: `none`, position: `relative`, margin: 4, width: 56, height: 56, justifyContent: `center`, alignItems: `center`, borderWidth: 0, borderStyle: `solid`, outline: `none` },\r\n    cellText: { userSelect: `none`, pointerEvents: `none` },\r\n    moveCellText: { userSelect: `none`, pointerEvents: `none`, transform: `rotate(-0.125turn)` },\r\n    cellEmptyView: { margin: 2, width: 56, height: 56 },\r\n    cellTextOcclusionView: { position: `absolute`, top: 0, bottom: 0, left: 0, right: 0, backgroundColor: `red`, opacity: 0 },\r\n} as const;\r\n\r\nexport const GamepadAnalog = (props: {\r\n    style: { backgroundColor: string, borderColor: string };\r\n    onMovePressIn: (direction: { x: number, y: number }) => void;\r\n    onMovePressOut: (direction: { x: number, y: number }) => void;\r\n    buttons: { text: string, onPressIn: () => void, onPressOut: () => void }[];\r\n}) => {\r\n    const { onMovePressIn, onMovePressOut } = props;\r\n\r\n    const cellViewStyle = { ...inputStyles.cellView, ...props.style };\r\n\r\n    // Keyboard\r\n    useEffect(() => {\r\n        const onIgnore = (e: KeyboardEvent) => {\r\n            e.preventDefault();\r\n            e.stopPropagation?.();\r\n            return false;\r\n        };\r\n        if (Platform.OS === `web`) {\r\n            const onKeyDown = (e: KeyboardEvent) => {\r\n                if (e.key === `ArrowUp`) { onMovePressIn({ x: 0, y: +1 }); return onIgnore(e); }\r\n                if (e.key === `ArrowDown`) { onMovePressIn({ x: 0, y: -1 }); return onIgnore(e); }\r\n                if (e.key === `ArrowLeft`) { onMovePressIn({ x: -1, y: 0 }); return onIgnore(e); }\r\n                if (e.key === `ArrowRight`) { onMovePressIn({ x: +1, y: 0 }); return onIgnore(e); }\r\n                if (e.key === ` `) { props.buttons[0]?.onPressIn(); return onIgnore(e); }\r\n                // console.log(`onKeyDown`, { key: e.key });\r\n                return true;\r\n            };\r\n            const onKeyUp = (e: KeyboardEvent) => {\r\n                if (e.key === `ArrowUp`) { onMovePressOut({ x: 0, y: +1 }); return onIgnore(e); }\r\n                if (e.key === `ArrowDown`) { onMovePressOut({ x: 0, y: -1 }); return onIgnore(e); }\r\n                if (e.key === `ArrowLeft`) { onMovePressOut({ x: -1, y: 0 }); return onIgnore(e); }\r\n                if (e.key === `ArrowRight`) { onMovePressOut({ x: +1, y: 0 }); return onIgnore(e); }\r\n                if (e.key === ` `) { props.buttons[0]?.onPressOut(); return onIgnore(e); }\r\n                return true;\r\n            };\r\n            window.addEventListener(`keydown`, onKeyDown);\r\n            window.addEventListener(`keyup`, onKeyUp);\r\n            return () => {\r\n                window.removeEventListener(`keydown`, onKeyDown);\r\n                window.removeEventListener(`keyup`, onKeyUp);\r\n            };\r\n        }\r\n\r\n        return () => { };\r\n    });\r\n\r\n    const DirectionButton = ({ text, direction }: { text: string, direction: { x: number, y: number } }) => {\r\n        return (\r\n            <Pressable style={inputStyles.cellTouch} onPressIn={() => onMovePressIn(direction)} onPressOut={() => onMovePressOut(direction)}>\r\n                <View style={cellViewStyle}>\r\n                    <Text style={inputStyles.moveCellText}>{text}</Text>\r\n                    <View style={inputStyles.cellTextOcclusionView} />\r\n                </View>\r\n            </Pressable>\r\n        );\r\n    };\r\n\r\n    const ActionButton = ({ text, onPressIn, onPressOut }: { text: string, onPressIn: () => void, onPressOut: () => void }) => {\r\n        return (\r\n            <Pressable style={inputStyles.cellTouch} onPressIn={onPressIn} onPressOut={onPressOut}>\r\n                <View style={cellViewStyle}>\r\n                    <Text style={inputStyles.cellText}>{text}</Text>\r\n                    <View style={inputStyles.cellTextOcclusionView} />\r\n                </View>\r\n            </Pressable>\r\n        );\r\n    };\r\n\r\n    return (\r\n        <View style={inputStyles.container}>\r\n            <View style={inputStyles.moveSectionWrapper}>\r\n                <View style={inputStyles.moveSectionRotation}>\r\n                    <View style={inputStyles.section}>\r\n                        <View style={inputStyles.row} >\r\n                            <DirectionButton direction={{ x: 0, y: +1 }} text='' />\r\n                            <DirectionButton direction={{ x: +1, y: 0 }} text='' />\r\n                        </View>\r\n                        <View style={inputStyles.row} >\r\n                            <DirectionButton direction={{ x: -1, y: 0 }} text='' />\r\n                            <DirectionButton direction={{ x: 0, y: -1 }} text='' />\r\n                        </View>\r\n                    </View>\r\n                </View>\r\n            </View>\r\n            <View style={inputStyles.section} >\r\n                <View style={inputStyles.row} >\r\n                    {props.buttons.map(x => (\r\n                        <React.Fragment key={`${x.text}`}>\r\n                            <View style={inputStyles.cellEmptyView} />\r\n                            <ActionButton {...x} />\r\n                        </React.Fragment>\r\n                    ))}\r\n                </View>\r\n            </View>\r\n        </View>\r\n    );\r\n};\r\n","export type Vector2 = { x: number, y: number };\r\nexport const getDistanceSq = (a: Vector2, b: Vector2) => {\r\n    const x = a.x - b.x;\r\n    const y = a.y - b.y;\r\n    return x * x + y * y;\r\n};\r\n","/* eslint-disable react/no-array-index-key */\r\n/* eslint-disable jsx-a11y/accessible-emoji */\r\nimport React, { useState, useEffect, useRef } from 'react';\r\nimport { View, Text, Pressable, TouchableOpacity, Platform } from 'react-native-lite';\r\nimport { createMultiplesProblemService } from './problems/multiples';\r\nimport { ProblemService, Problem } from './problems/problems-service';\r\nimport { GamepadAnalogStateful, GamepadPressState } from './components/game-pad-analog';\r\nimport { getDistanceSq, Vector2 } from './utils/vectors';\r\nimport { createReviewProblemService } from './problems/problems-reviewer';\r\nimport { createProgressGameProblemService } from './progress-games/progress-game';\r\nimport { createAutoSavedProblemService } from './problems/problem-state-storage';\r\nimport { SubjectNavigator } from './utils/subject-navigator';\r\n\r\nexport const EducationalGame_StarBlastSideways_Multiples = (props: {}) => {\r\n    return <EducationalGame_StarBlastSideways problemService={createAutoSavedProblemService(createReviewProblemService(createMultiplesProblemService({ min: 1, max: 12 }), {}), `ProblemsMultiples`)} />;\r\n};\r\n\r\nexport const EducationalGame_StarBlastSideways = (props: { problemService: ProblemService }) => {\r\n    // Add Pet Feeder\r\n    return <EducationalGame_StarBlastSideways_Inner problemService={createProgressGameProblemService(props.problemService)} />;\r\n};\r\n\r\nconst EducationalGame_StarBlastSideways_Inner = (props: { problemService: ProblemService }) => {\r\n    const [pauseState, setPauseState] = useState({ paused: false } as { paused: boolean });\r\n    const [pressState, setPressState] = useState({ moveDirection: { x: 0, y: 0 }, buttons: [] } as GamepadPressState);\r\n    const onPressStateChange = (value: GamepadPressState) => {\r\n        // console.log(`onPressStateChange`, { ...x, dir: { ...x.moveDirection }, buttons: x.buttons.map(b => ({ ...b })) });\r\n        setPressState(value);\r\n    };\r\n\r\n    const [problemSourceKey, setProblemSourceKey] = useState(0);\r\n\r\n    return (\r\n        <>\r\n            <View>\r\n                <View style={{ alignItems: `center`, alignSelf: `stretch` }} >\r\n                    <View style={{ overflow: `hidden`, padding: 10, paddingTop: 4, paddingBottom: 64 }}>\r\n                        <View style={{ position: `relative` }}>\r\n                            <GameView pressState={pressState} pauseState={pauseState} problemService={props.problemService} problemSourceKey={`${problemSourceKey}`} />\r\n                            {/* <Pressable style={{ position: `absolute`, top: 0, bottom: 0, left: 0, right: 0, opacity: 0 }} onPressIn={() => { }} onPressOut={() => { }} /> */}\r\n                            <View style={{ zIndex: 10, flex: 1, alignSelf: `stretch` }}>\r\n                                <GamepadAnalogStateful style={colors.gamepad} onPressStateChange={onPressStateChange} buttons={[{ key: `A`, text: `` }]} />\r\n                            </View>\r\n                        </View>\r\n                    </View>\r\n                </View>\r\n                <SubjectNavigator problemService={props.problemService}\r\n                    onOpen={() => setPauseState({ paused: true })}\r\n                    onClose={() => setPauseState({ paused: false })}\r\n                    onSubjectNavigation={() => { setPauseState({ paused: false }); setProblemSourceKey(s => s + 1); }}\r\n                />\r\n            </View>\r\n        </>\r\n    );\r\n};\r\n\r\n\r\nconst colors = {\r\n    gamepad: {\r\n        backgroundColor: `#333333`,\r\n        borderColor: `#000033`,\r\n    },\r\n    viewscreen: {\r\n        borderColor: `#000033`,\r\n        backgroundColor: `#000000`,\r\n    },\r\n};\r\n\r\nconst gameStyles = {\r\n    directAnswerButtonContainer: { alignSelf: `flex-end`, justifyContent: `space-around`, height: 250, padding: 4 },\r\n    directAnswerButton: { width: 40, height: 40, backgroundColor: `#FFFFFF`, opacity: 0.1 },\r\n    directAnswerButton_hidden: { width: 40, height: 40 },\r\n    viewscreenView: {\r\n        height: 300,\r\n        width: 300,\r\n        backgroundColor: colors.viewscreen.backgroundColor,\r\n        borderColor: colors.viewscreen.borderColor,\r\n        borderWidth: 1,\r\n        borderStyle: `solid`,\r\n    },\r\n    sprite: {\r\n        viewSize: { width: 32, height: 32 },\r\n        text: {\r\n            fontFamily: `\"Lucida Console\", Monaco, monospace`,\r\n            fontSize: 32,\r\n            textAlign: `center`,\r\n        },\r\n    },\r\n    answer: {\r\n        text: {\r\n            fontFamily: `\"Lucida Console\", Monaco, monospace`,\r\n            fontSize: 24,\r\n            fontSize_small: 14,\r\n            textAlign: `center`,\r\n            whiteSpace: `pre-wrap`,\r\n        },\r\n    },\r\n    question: {\r\n        view: { flex: 1, justifyContent: `center`, padding: 4 },\r\n        text: {\r\n            fontFamily: `\"Lucida Console\", Monaco, monospace`,\r\n            fontSize: 24,\r\n            fontSize_small: 14,\r\n            whiteSpace: `pre-wrap`,\r\n        },\r\n    },\r\n    gameOver: {\r\n        view: { flex: 1, justifyContent: `center`, padding: 4 },\r\n        text: {\r\n            fontFamily: `\"Lucida Console\", Monaco, monospace`,\r\n            fontSize: 24,\r\n            textAlign: `center`,\r\n        },\r\n    },\r\n} as const;\r\n\r\ntype GamePosition = {\r\n    x: number;\r\n    y: number;\r\n    rotation: number;\r\n};\r\n\r\ntype GameState = {\r\n    lastActualTimeMs: number;\r\n    lastGameTime: number;\r\n    gameSpeed: number;\r\n\r\n    lives: number;\r\n    deadTime?: number;\r\n    gameOverTime?: number;\r\n    score: number;\r\n\r\n    weaponsLock?: {\r\n        lockedAtPlayerPosition: GamePosition;\r\n        lockedEnemy: { pos: GamePosition };\r\n    };\r\n    playerTargetPosition?: { x: number, y: number };\r\n};\r\n\r\n\r\ntype AnswerState = { key: string, value: string, isCorrect: boolean, isAnsweredWrong: boolean };\r\nconst GameView = (props: { pressState: GamepadPressState, pauseState: { paused: boolean }, problemService: ProblemService, problemSourceKey: string }) => {\r\n\r\n    const pressState = useRef(props.pressState);\r\n    pressState.current = props.pressState;\r\n\r\n    const pauseState = useRef(props.pauseState);\r\n    pauseState.current = props.pauseState;\r\n\r\n    const gameAcceleration = 0.1;\r\n    const gameDeceleration = 0.2;\r\n    const maxGameSpeed = 5;\r\n    const minGameSpeed = 0.5;\r\n\r\n    const getDefaultGameState = (): GameState => ({\r\n        lastActualTimeMs: Date.now(),\r\n        lastGameTime: 0,\r\n        gameSpeed: 1,\r\n        lives: 3,\r\n        score: 0,\r\n    });\r\n    const gameState = useRef(getDefaultGameState());\r\n    const getGameTime = () => {\r\n        const now = Date.now();\r\n        let actualTimePassed = (now - gameState.current.lastActualTimeMs) / 1000;\r\n        gameState.current.lastActualTimeMs = now;\r\n\r\n        if (actualTimePassed === 0) {\r\n            return { gameTime: gameState.current.lastGameTime };\r\n        }\r\n\r\n        // Left App, frozen, etc?\r\n        if (actualTimePassed > 0.1) {\r\n            actualTimePassed = 0.1;\r\n        }\r\n\r\n        const gameTimePassed = actualTimePassed * gameState.current.gameSpeed;\r\n        const gameTime = gameState.current.lastGameTime + gameTimePassed;\r\n        gameState.current.lastGameTime = gameTime;\r\n\r\n        return {\r\n            gameTime,\r\n        };\r\n    };\r\n\r\n    const playerPositionState = useRef({\r\n        y: gameStyles.viewscreenView.height * 0.5, x: gameStyles.viewscreenView.width * 0.15, rotation: 0,\r\n    } as GamePosition);\r\n    const projectilesState = useRef({ lastShotActualTime: 0, shots: [], debris: [] } as ProjectilesState);\r\n    const enemiesState = useRef({ enemies: [] } as EnemiesState);\r\n\r\n    const problemsState = useRef(null as null | { problemTime: number, question: string, answers: (Problem['answers'][0] & { key: string, pos: GamePosition, isAnsweredWrong: boolean })[] });\r\n    const [renderId, setRenderId] = useState(0);\r\n\r\n    const restartGame = () => {\r\n        // Move enemies back\r\n        enemiesState.current.enemies.forEach(e2 => { e2.pos.x += gameStyles.viewscreenView.width * 0.5; });\r\n\r\n        // Reset Player\r\n        playerPositionState.current.y = gameStyles.viewscreenView.height * 0.5;\r\n        playerPositionState.current.x = gameStyles.viewscreenView.width * 0.15;\r\n\r\n        gameState.current = { ...getDefaultGameState(), lastGameTime: gameState.current.lastGameTime };\r\n    };\r\n\r\n    const gameOver = () => {\r\n        gameState.current = {\r\n            ...gameState.current,\r\n            lives: 0,\r\n            gameOverTime: getGameTime().gameTime,\r\n        };\r\n    };\r\n\r\n    const gotoNextProblem = () => {\r\n        const p = props.problemService.getNextProblem();\r\n\r\n        console.log(`gotoNextProblem`, { p });\r\n\r\n        if (!p.question) {\r\n            // Game over - problems done\r\n            return;\r\n        }\r\n\r\n        const pSize = gameStyles.viewscreenView.width / (p.answers.length + 1);\r\n        const newProblemState = {\r\n            problemTime: getGameTime().gameTime,\r\n            question: p.question,\r\n            answers: p.answers.map((x, i) => ({ ...x, key: `${p.question} ${x.value}`, pos: { y: pSize * (0.5 + i), x: gameStyles.viewscreenView.width - gameStyles.sprite.viewSize.width * 0.5, rotation: 0 }, isAnsweredWrong: false })),\r\n        };\r\n        const newEnemyState = {\r\n            enemies: newProblemState.answers.map((ans, i) => {\r\n                const enemy = {\r\n                    key: `${p.question} ${ans.value}`,\r\n                    answer: ans,\r\n                    pos: { y: pSize * (0.5 + i), x: gameStyles.viewscreenView.width - gameStyles.sprite.viewSize.width * 1.5, rotation: 0 },\r\n                    vel: { x: -5, y: 0 },\r\n                    onHit: () => {\r\n                        setTimeout(() => {\r\n                            console.log(`onHit`, { ans });\r\n                            props.problemService.recordAnswer(p, ans);\r\n                            if (ans.isCorrect) {\r\n                                // TODO: Update score, etc.\r\n                                // Let bullets clear\r\n                                projectilesState.current.shots.forEach(x => { x.ignore = true; });\r\n                                gotoNextProblem();\r\n\r\n                                gameState.current = {\r\n                                    ...gameState.current,\r\n                                    score: gameState.current.score += Math.floor(enemy.pos.x) * 1000,\r\n                                    gameSpeed: Math.min(maxGameSpeed, gameState.current.gameSpeed * 1 + gameAcceleration),\r\n                                };\r\n                            } else {\r\n                                ans.isAnsweredWrong = true;\r\n\r\n                                gameState.current = {\r\n                                    ...gameState.current,\r\n                                    score: gameState.current.score -= Math.floor(enemy.pos.x) * 1500,\r\n                                    gameSpeed: Math.max(minGameSpeed, gameState.current.gameSpeed * 1 - gameDeceleration),\r\n                                };\r\n                            }\r\n                        });\r\n                    },\r\n                    destroyed: false,\r\n                };\r\n\r\n                return enemy;\r\n            }),\r\n        };\r\n\r\n        problemsState.current = newProblemState;\r\n        enemiesState.current = newEnemyState;\r\n        setRenderId(s => s + 1);\r\n\r\n        setTimeout(() => {\r\n            p.onQuestion?.();\r\n        }, 250);\r\n    };\r\n\r\n    useEffect(() => {\r\n        gotoNextProblem();\r\n    }, [props.problemSourceKey]);\r\n\r\n    useEffect(() => {\r\n        // Game Loop\r\n        let gameLastTime = getGameTime().gameTime;\r\n        const gameLoop = () => {\r\n            const { gameTime } = getGameTime();\r\n            const gameDeltaTime = gameTime - gameLastTime;\r\n            gameLastTime = gameTime;\r\n\r\n            if (pauseState.current.paused || gameDeltaTime <= 0) {\r\n                requestAnimationFrame(gameLoop);\r\n                return;\r\n            }\r\n\r\n            // if (!pressState.current.moveDirection.x\r\n            //     && !pressState.current.moveDirection.y) {\r\n            //     // No change\r\n            //     requestAnimationFrame(gameLoop);\r\n            //     return;\r\n            // }\r\n\r\n            // console.log(`gameLoop Update`);\r\n\r\n            // Update\r\n\r\n            const getCommonState = (): CommonGameState => {\r\n                return {\r\n                    gameTime,\r\n                    gameDeltaTime,\r\n                    gameState: gameState.current,\r\n                    pressState: pressState.current,\r\n                    playerPosition: playerPositionState.current,\r\n                    projectilesState: projectilesState.current,\r\n                    enemiesState: enemiesState.current,\r\n                    onLoseLife: () => {\r\n                        if (gameState.current.deadTime || gameState.current.gameOverTime) { return; }\r\n\r\n                        projectilesState.current.debris.push({ key: `player${gameTime}`, kind: `player-character`, pos: { ...playerPositionState.current }, vel: { x: 0, y: 0 } });\r\n\r\n\r\n                        if (gameState.current.lives <= 1) {\r\n                            // Game over\r\n                            gameOver();\r\n                            return;\r\n                        }\r\n\r\n                        // Move enemies back\r\n                        // enemiesState.current.enemies.forEach(e2 => { e2.pos.x += gameStyles.viewscreenView.width * 0.5; });\r\n\r\n                        gameState.current = {\r\n                            ...gameState.current,\r\n                            lives: gameState.current.lives - 1,\r\n                            deadTime: gameTime,\r\n                        };\r\n                    },\r\n                };\r\n            };\r\n\r\n\r\n            // Game\r\n            const gameResult = updateGame(getCommonState());\r\n            gameState.current = gameResult;\r\n\r\n            if (!gameState.current.gameOverTime) {\r\n                // Player\r\n                const playerResult = updatePlayer(getCommonState());\r\n                playerPositionState.current = playerResult.playerPosition;\r\n            } else if (getGameTime().gameTime > 1 + gameState.current.gameOverTime\r\n                && pressState.current.buttons[0]?.isDown) {\r\n                setTimeout(() => {\r\n                    restartGame();\r\n                }, 250);\r\n            }\r\n\r\n            // Projectiles\r\n            const projectilesResult = updateProjectiles(getCommonState());\r\n            projectilesState.current = projectilesResult;\r\n\r\n            // Enemies\r\n            const enemiesResult = updateEnemies(getCommonState());\r\n            enemiesState.current = enemiesResult;\r\n\r\n\r\n            // Game Loop\r\n            requestAnimationFrame(gameLoop);\r\n            setRenderId(s => s + 1);\r\n        };\r\n\r\n        requestAnimationFrame(gameLoop);\r\n    }, []);\r\n\r\n\r\n    // console.log(`GameView render`, { playerStylePosition });\r\n\r\n    const timeSinceProblem = getGameTime().gameTime - (problemsState.current?.problemTime ?? 0);\r\n\r\n    const directAnswer = (enemy: EnemiesState['enemies'][0]) => {\r\n        if (gameState.current.gameOverTime) { restartGame(); return; }\r\n        if (gameState.current.deadTime) { return; }\r\n        if (enemy.destroyed || enemy.explodeTime) { return; }\r\n        gameState.current.weaponsLock = { lockedEnemy: enemy, lockedAtPlayerPosition: playerPositionState.current };\r\n        const { shots } = projectilesState.current;\r\n        shots.push({ key: `${getGameTime()}${shots.length}`, pos: { ...playerPositionState.current }, lockedEnemy: enemy });\r\n        gameState.current.playerTargetPosition = { x: playerPositionState.current.x, y: enemy.pos.y };\r\n    };\r\n\r\n    return (\r\n        <>\r\n            <View style={gameStyles.viewscreenView} >\r\n                {/* <TextPositioned text={`${gameState.current.score.toLocaleString()}`} position={{ x: 0, y: -0.8 * gameStyles.sprite.viewSize.height, rotation: 0 }} /> */}\r\n                {[... new Array(gameState.current.lives)].map((x, i) => (\r\n                    <Sprite key={`life${i}`} kind='life' position={{ x: gameStyles.viewscreenView.width - (gameStyles.sprite.viewSize.width * (1 + i)), y: gameStyles.viewscreenView.height - 0.5 * gameStyles.sprite.viewSize.height, rotation: 0 }} />\r\n                ))}\r\n                {projectilesState.current.debris.map(x => (\r\n                    <Sprite key={x.key} kind={x.hasHitGround ? `${x.kind}-splat` as SpriteKind : x.kind} position={x.pos} />\r\n                ))}\r\n                {enemiesState.current?.enemies.filter(e => !e.destroyed).map(e => (\r\n                    <React.Fragment key={e.key}>\r\n                        {!e.answer.isAnsweredWrong && (<TextPositioned position={{ y: e.pos.y, x: e.pos.x + gameStyles.sprite.viewSize.width, rotation: 0 }} text={e.answer.value} />)}\r\n                        {e.answer.isAnsweredWrong && (<Sprite kind='answer-wrong' position={{ y: e.pos.y, x: e.pos.x + gameStyles.sprite.viewSize.width, rotation: 0 }} />)}\r\n                    </React.Fragment>\r\n                ))}\r\n                {enemiesState.current?.enemies.filter(x => !x.destroyed).map(x => (\r\n                    <React.Fragment key={x.key}>\r\n                        <Sprite kind={x.explodeTime ? `enemy-explode` : `enemy`} position={x.pos} />\r\n                        {x === gameState.current.weaponsLock?.lockedEnemy && (\r\n                            <Sprite kind='lock' position={x.pos} />\r\n                        )}\r\n                    </React.Fragment>\r\n                ))}\r\n                {!gameState.current.gameOverTime && !gameState.current.deadTime && (\r\n                    <Sprite kind='player' position={playerPositionState.current} />\r\n                )}\r\n                {projectilesState.current.shots.map(x => (\r\n                    <Sprite key={x.key} kind={x.explodeTime ? `shot-explode` : `shot`} position={x.pos} />\r\n                ))}\r\n                {gameState.current.gameOverTime && (\r\n                    <View>\r\n                        <View style={{ position: `absolute`, top: gameStyles.viewscreenView.height * 0.5, width: gameStyles.viewscreenView.width }}>\r\n                            <Text style={gameStyles.gameOver.text}>Game Over</Text>\r\n                            {getGameTime().gameTime > 1 + gameState.current.gameOverTime && (<Text style={gameStyles.gameOver.text}>Continue?</Text>)}\r\n                        </View>\r\n                    </View>\r\n                )}\r\n\r\n                <View style={gameStyles.directAnswerButtonContainer}>\r\n                    {enemiesState.current?.enemies.map(e => (\r\n                        <TouchableOpacity key={e.key} onPress={() => directAnswer(e)} >\r\n                            <View style={!e.destroyed && !e.explodeTime ? gameStyles.directAnswerButton : gameStyles.directAnswerButton_hidden} />\r\n                        </TouchableOpacity>\r\n                    ))}\r\n                </View>\r\n            </View>\r\n            <View style={{ position: `relative`, height: gameStyles.question.text.fontSize * 3, alignSelf: `stretch` }}>\r\n                <TextPositioned text={problemsState.current?.question ?? ``} position={{ x: gameStyles.viewscreenView.width * 0.25, y: gameStyles.question.text.fontSize * 1 - Math.max(0, gameStyles.viewscreenView.height * 0.5 - 125 * timeSinceProblem), rotation: 0 }} />\r\n            </View>\r\n            {/* <View>\r\n                <Text>{`${renderId}`}</Text>\r\n            </View> */}\r\n            {/* <View style={[gameStyles.question.view, { transform: `translate(0px,${-Math.max(0, gameStyles.viewscreenView.height * 0.5 - 125 * timeSinceProblem)}px)` }]}>\r\n                <Text style={{...gameStyles.question.text, text.length > 10 ? s.fontSize_small * 0.5 : s.fontSize}} >{problemsState.current?.question}</Text>\r\n            </View> */}\r\n\r\n        </>\r\n    );\r\n};\r\n\r\ntype CommonGameState = { gameTime: number, gameDeltaTime: number, gameState: GameState, pressState: GamepadPressState, playerPosition: GamePosition, projectilesState: ProjectilesState, enemiesState: EnemiesState, onLoseLife: () => void };\r\n\r\nconst updateGame = ({ gameTime, gameDeltaTime, pressState, playerPosition, gameState, enemiesState }: CommonGameState): GameState => {\r\n\r\n    // Respawn Player\r\n    if (gameState.deadTime && gameTime > 3 + gameState.deadTime) {\r\n        playerPosition.y = gameStyles.viewscreenView.height * 0.5;\r\n        playerPosition.x = gameStyles.viewscreenView.width * 0.15;\r\n\r\n        enemiesState.enemies.forEach(e2 => { e2.pos.x += gameStyles.viewscreenView.width * 0.5; });\r\n\r\n        return { ...gameState, deadTime: undefined };\r\n    }\r\n\r\n    return gameState;\r\n};\r\n\r\nconst updatePlayer = ({ gameTime, gameDeltaTime, pressState, playerPosition, gameState }: CommonGameState): { playerPosition: GamePosition } => {\r\n    if (gameState.deadTime) { return { playerPosition }; }\r\n\r\n    const dirPress = pressState.moveDirection;\r\n    const targetPos = gameState.playerTargetPosition;\r\n    const dir = dirPress.x || dirPress.y ? { x: dirPress.x, y: -dirPress.y }\r\n        : targetPos ? { x: targetPos.x - playerPosition.x, y: targetPos.y - playerPosition.y }\r\n            : { x: 0, y: 0 };\r\n    dir.x = dir.x === 0 ? 0 : Math.sign(dir.x);\r\n    dir.y = dir.y === 0 ? 0 : Math.sign(dir.y);\r\n\r\n    if (gameState.playerTargetPosition) {\r\n        console.log(`updatePlayer`, { dirPress, dir, targetPos, playerPosition });\r\n    }\r\n\r\n    if (dirPress.x || dirPress.y) {\r\n        gameState.playerTargetPosition = undefined;\r\n    }\r\n    if (gameState.playerTargetPosition && getDistanceSq(playerPosition, gameState.playerTargetPosition) < 5 * 5) {\r\n        gameState.playerTargetPosition = undefined;\r\n    }\r\n\r\n    const targetRotation = dir.y * 0.05;\r\n\r\n    const pos = {\r\n        x: playerPosition.x + dir.x * gameDeltaTime * 250,\r\n        y: playerPosition.y + dir.y * gameDeltaTime * 250,\r\n        rotation: playerPosition.rotation * 0.9 + targetRotation * 0.1,\r\n    };\r\n\r\n    const w = gameStyles.viewscreenView.width;\r\n    const gw = gameStyles.sprite.viewSize.width * 0.5;\r\n    const h = gameStyles.viewscreenView.height;\r\n    const gh = gameStyles.sprite.viewSize.height * 0.5;\r\n    pos.x = pos.x < gw ? gw : pos.x > w - gw ? w - gw : pos.x;\r\n    pos.y = pos.y < gh ? gh : pos.y > h - gh ? h - gh : pos.y;\r\n\r\n    return { playerPosition: pos };\r\n};\r\n\r\ntype ProjectilesState = {\r\n    lastShotActualTime: number;\r\n    shots: { key: string, pos: GamePosition, explodeTime?: number, ignore?: boolean, lockedEnemy?: { pos: GamePosition, explodeTime?: number, destoyed?: boolean } }[];\r\n    debris: { key: string, vel: Vector2, pos: GamePosition, kind: SpriteKind, hasHitGround?: boolean }[];\r\n};\r\nconst updateProjectiles = ({ gameTime, gameDeltaTime, pressState, playerPosition: playerPos, enemiesState, projectilesState, gameState, onLoseLife }: CommonGameState): ProjectilesState => {\r\n    const { shots, debris, lastShotActualTime } = projectilesState;\r\n\r\n    const canShoot = !gameState.deadTime && !gameState.gameOverTime && (Date.now() / 1000) > 0.25 + lastShotActualTime;\r\n\r\n    // console.log(`updateProjectiles`, { canShoot, gameTime, lastShotTime });\r\n\r\n    const didShoot = canShoot && pressState.buttons.find(x => x.key === `A`)?.isDown;\r\n    if (didShoot) {\r\n        const lockedEnemy = gameState.weaponsLock?.lockedEnemy;\r\n        shots.push({ key: `${gameTime}${shots.length}`, pos: { ...playerPos }, lockedEnemy });\r\n    }\r\n\r\n    // Move shots\r\n    shots.forEach(x => {\r\n        if (x.explodeTime) { return; }\r\n\r\n        if (x.lockedEnemy && !x.lockedEnemy.explodeTime && !x.lockedEnemy.destoyed) {\r\n            x.pos.y += (x.lockedEnemy.pos.y - x.pos.y) * 0.25;\r\n            x.pos.x += Math.min(250 * gameDeltaTime, (x.lockedEnemy.pos.x - x.pos.x) * 0.5);\r\n        } else {\r\n            x.pos.x += 250 * gameDeltaTime;\r\n        }\r\n    });\r\n\r\n    // Move debris\r\n    debris.forEach(d => {\r\n        if (d.hasHitGround) { return; }\r\n\r\n        // Gravity\r\n        d.vel.y += 100 * gameDeltaTime;\r\n\r\n        d.pos.y += d.vel.y * gameDeltaTime;\r\n        d.pos.x += d.vel.x * gameDeltaTime;\r\n\r\n        const pad = gameStyles.sprite.viewSize.width * 0.5;\r\n        const w = gameStyles.viewscreenView.width;\r\n        if (d.pos.x < pad) { d.pos.x = pad; d.vel.x = -d.vel.x; }\r\n        if (d.pos.x > w - pad) { d.pos.x = w - pad; d.vel.x = -d.vel.x; }\r\n\r\n        const hPad = gameStyles.sprite.viewSize.width * 0.8;\r\n        const h = gameStyles.viewscreenView.height;\r\n        if (d.pos.y > h - hPad + Math.random() * 10) {\r\n            d.hasHitGround = true;\r\n\r\n            if (d.kind === `kitten`) {\r\n                onLoseLife();\r\n            }\r\n        }\r\n\r\n    });\r\n\r\n    // Clean up too much debris\r\n    if (debris.length > 25) {\r\n        debris.shift();\r\n    }\r\n\r\n    const newShots = shots\r\n        // Remove shots offscreen\r\n        .filter(x => x.pos.x < gameStyles.viewscreenView.width)\r\n        // Remove exploded\r\n        .filter(x => !x.explodeTime || gameTime < 1 + x.explodeTime)\r\n        ;\r\n\r\n    return {\r\n        ...projectilesState,\r\n        lastShotActualTime: didShoot ? (Date.now() / 1000) : lastShotActualTime,\r\n        shots: newShots,\r\n    };\r\n};\r\n\r\ntype EnemiesState = {\r\n    enemies: {\r\n        key: string;\r\n        pos: GamePosition;\r\n        vel: Vector2;\r\n        explodeTime?: number;\r\n        answer: AnswerState;\r\n        onHit: () => void;\r\n        destroyed?: boolean;\r\n    }[];\r\n};\r\nconst updateEnemies = ({ gameTime, gameDeltaTime, projectilesState, enemiesState, gameState, playerPosition, onLoseLife }: CommonGameState): EnemiesState => {\r\n    const { enemies } = enemiesState;\r\n    const { shots } = projectilesState;\r\n\r\n    // Detect Collisions\r\n\r\n    // Enemies - Bullets\r\n    const radius = gameStyles.sprite.viewSize.width * 0.75;\r\n    const radiusSq = radius * radius;\r\n\r\n    enemies.forEach(e => shots.forEach(s => {\r\n        // console.log(`Checking!`, { e, s });\r\n\r\n        if (e.explodeTime) { return; }\r\n        if (s.explodeTime || s.ignore) { return; }\r\n\r\n        // Only shoot locked enemy\r\n        if (s.lockedEnemy && s.lockedEnemy !== e) { return; }\r\n\r\n        if (getDistanceSq(e.pos, s.pos) < radiusSq) {\r\n            console.log(`Exploded!`, { e, s });\r\n\r\n            e.explodeTime = gameTime;\r\n            s.explodeTime = gameTime;\r\n\r\n            e.onHit();\r\n\r\n            if (e.answer.isCorrect) {\r\n                projectilesState.debris.push({ key: `${e.key} ${gameTime}`, kind: `alien`, pos: { ...e.pos }, vel: { ...e.vel } });\r\n            } else {\r\n                projectilesState.debris.push({ key: `${e.key} ${gameTime}`, kind: `kitten`, pos: { ...e.pos }, vel: { ...e.vel } });\r\n            }\r\n        }\r\n    }));\r\n\r\n    // Enemies - Enemies (bounce)\r\n    const radiusSq_enemies = radius * radius * 1.5 * 1.5;\r\n    enemies.forEach((e, i) => enemies.forEach((e2, i2) => {\r\n\r\n        if (i >= i2) { return; }\r\n        if (e.explodeTime) { return; }\r\n        if (e2.explodeTime) { return; }\r\n\r\n        if (getDistanceSq(e.pos, e2.pos) < radiusSq_enemies) {\r\n\r\n            // Transfer momentum\r\n            const frictionRatio = 0.95;\r\n            const swap = e.vel.y;\r\n            e.vel.y = e2.vel.y * frictionRatio;\r\n            e2.vel.y = swap * frictionRatio;\r\n            // }\r\n\r\n            // if (getDistanceSq(e.pos, e2.pos) < radiusSq_enemies * 0.8 * 0.8) {\r\n            // Move apart\r\n            const a = e.pos.y < e2.pos.y ? e : e2;\r\n            const b = e.pos.y < e2.pos.y ? e2 : e;\r\n\r\n            a.pos.y -= 10 * gameDeltaTime;\r\n            b.pos.y += 10 * gameDeltaTime;\r\n            a.vel.y -= 10 * gameDeltaTime;\r\n            b.vel.y += 10 * gameDeltaTime;\r\n        }\r\n    }));\r\n\r\n    // Enemies - Player\r\n    const radiusSq_player = radius * radius * 0.8 * 0.8;\r\n    enemies.forEach((e, i) => {\r\n        if (e.explodeTime) { return; }\r\n        if (gameState.deadTime || gameState.gameOverTime) { return; }\r\n\r\n        if (getDistanceSq(e.pos, playerPosition) < radiusSq_player) {\r\n            onLoseLife();\r\n\r\n            // e.explodeTime = gameTime;\r\n            // e.onHit();\r\n\r\n            return;\r\n        }\r\n    });\r\n\r\n    // Enemies move\r\n    enemies.forEach(e => {\r\n        if (e.explodeTime) { return; }\r\n\r\n        e.vel.y += (-1 + 2 * Math.random()) * 250 * gameDeltaTime;\r\n        // e.vel.x += -3 * gameDeltaTime;\r\n\r\n        if (!gameState.deadTime && !gameState.gameOverTime) {\r\n            e.vel.x = -25;\r\n        } else {\r\n            e.vel.x = 0;\r\n        }\r\n\r\n        // Move away from ground\r\n        if (e.pos.y > gameStyles.viewscreenView.height * 0.7) {\r\n            // e.vel.y += -100 * gameDeltaTime;\r\n            e.vel.y = -5;\r\n        }\r\n\r\n        // Keep on screen\r\n        if (e.pos.x > gameStyles.viewscreenView.width - gameStyles.sprite.viewSize.width * 2) {\r\n            e.pos.x = gameStyles.viewscreenView.width - gameStyles.sprite.viewSize.width * 2;\r\n        }\r\n\r\n        e.pos.x += e.vel.x * gameDeltaTime;\r\n        e.pos.y += e.vel.y * gameDeltaTime;\r\n\r\n        const pad = gameStyles.sprite.viewSize.height * 0.5;\r\n        const h = gameStyles.viewscreenView.height;\r\n        if (e.pos.y < pad) { e.pos.y = pad; e.vel.y = 5; }\r\n        if (e.pos.y > h - pad) { e.pos.y = h - pad; e.vel.y = -e.vel.y; }\r\n\r\n        const wPad = gameStyles.sprite.viewSize.width * 0.5;\r\n        if (e.pos.x < wPad) {\r\n            e.pos.x = wPad;\r\n        }\r\n\r\n        // // Attack player\r\n        // if (e.pos.x < playerPosition.x) {\r\n        //     e.pos.y = playerPosition.y;\r\n        //     // e.vel.y = (playerPosition.y - e.pos.y) * 5;\r\n        // }\r\n    });\r\n\r\n    // Closest Enemy\r\n    const closestEnemyToPlayer = enemiesState.enemies.filter(x => !x.explodeTime && !x.destroyed)\r\n        .sort((a, b) => Math.abs(a.pos.y - playerPosition.y) < Math.abs(b.pos.y - playerPosition.y) ? -1 : 1)[0];\r\n\r\n    const updateWeaponsLock = (enemy: typeof enemiesState.enemies[0]) => {\r\n        // Only update on player movement\r\n        if (gameState.weaponsLock?.lockedAtPlayerPosition.y === playerPosition.y) {\r\n            return;\r\n        }\r\n\r\n        gameState.weaponsLock = {\r\n            lockedAtPlayerPosition: playerPosition,\r\n            lockedEnemy: enemy,\r\n        };\r\n    };\r\n\r\n    // Attack Player\r\n    if (closestEnemyToPlayer?.pos.x < playerPosition.x + gameStyles.sprite.viewSize.width * 0.5) {\r\n        closestEnemyToPlayer.pos.y = playerPosition.y;\r\n    } else {\r\n        // Lock on Enemy\r\n        updateWeaponsLock(closestEnemyToPlayer);\r\n    }\r\n\r\n    // Cleanup\r\n    const newEnemies = enemies;\r\n    newEnemies.filter(x => x.explodeTime && gameTime > 1 + x.explodeTime).forEach(x => {\r\n        x.destroyed = true;\r\n\r\n    });\r\n    // // Remove exploded\r\n    // .filter(x => !x.explodeTime || gameTime < 1 + x.explodeTime)\r\n    // ;\r\n\r\n    return {\r\n        enemies: newEnemies,\r\n    };\r\n};\r\n\r\ntype SpriteKind = 'text' | 'player' | 'player-character' | 'player-character-splat' | 'shot' | 'shot-explode' | 'lock' | 'enemy' | 'enemy-explode' | 'answer-wrong' | 'alien' | 'kitten' | 'alien-splat' | 'kitten-splat' | 'super-kitten' | 'life';\r\nconst getSpriteEmoji = (kind: SpriteKind) => {\r\n    // \r\n    // \r\n    // \r\n    // \r\n    // \r\n    switch (kind) {\r\n        case `player`: return { text: ``, rotation: +0.125, offsetX: 0, offsetY: -0.25 };\r\n        case `player-character`: return { text: `` };\r\n        case `player-character-splat`: return { text: ``, rotation: 0.15 };\r\n        case `shot`: return { text: ``, rotation: -0.25 };\r\n        case `shot-explode`: return { text: ``, rotation: 0, scale: 0.5 };\r\n        case `lock`: return { text: ``, offsetX: -0.25, offsetY: -0.125, scale: 1.5 };\r\n        case `enemy`: return { text: ``, offsetX: -0.125, offsetY: -0.125 };\r\n        case `enemy-explode`: return { text: ``, offsetX: -0.125, offsetY: -0.125 };\r\n        case `answer-wrong`: return { text: ``, offsetX: -0.125, offsetY: -0.125 };\r\n        case `alien`: return { text: ``, offsetX: 0, offsetY: 0 };\r\n        // case `kitten`: return { text: ``, offsetX: 0, offsetY: 0 };\r\n        case `kitten`: return { text: ``, offsetX: 0, offsetY: 0 };\r\n        case `alien-splat`: return { text: ``, offsetX: 0, offsetY: 0 };\r\n        case `kitten-splat`: return { text: ``, offsetX: 0, offsetY: 0 };\r\n        case `super-kitten`: return { text: ``, offsetX: 0, offsetY: 0 };\r\n        // case `kitten-splat`: return { text: ``, offsetX: 0, offsetY: 0 };\r\n        case `life`: return { text: ``, scale: 0.5 };\r\n        case `text`: return { text: ``, offsetX: 0, offsetY: -0.125 };\r\n        default: return { text: `` };\r\n    }\r\n};\r\n\r\nconst Sprite = ({ kind, position, text }: { kind: SpriteKind, position: { x: number, y: number, rotation: number }, text?: string }) => {\r\n    const s = getSpriteEmoji(kind);\r\n    const size = gameStyles.sprite.viewSize;\r\n    const { fontSize } = gameStyles.sprite.text;\r\n\r\n    const stylePosition = {\r\n        position: `absolute`,\r\n        ...size,\r\n        transform: `translate(${position.x}px, ${position.y}px) rotate(${position.rotation ?? 0}turn)`,\r\n        // backgroundColor: `red`,\r\n        pointerEvents: `none`,\r\n    } as const;\r\n    const styleRotation = {\r\n        ...size,\r\n        transform: `translate( ${size.width * -0.5 + Math.floor((s.offsetX ?? 0) * fontSize)}px, ${size.height * -0.5 + Math.floor((s.offsetY ?? 0) * fontSize)}px) rotate(${s.rotation ?? 0}turn) scale(${s.scale ?? 1})`,\r\n    };\r\n    return (\r\n        <View style={stylePosition}>\r\n            <View style={styleRotation}>\r\n                <Text style={gameStyles.sprite.text}>{text ?? s.text}</Text>\r\n            </View>\r\n        </View>\r\n    );\r\n};\r\n\r\nconst TextPositioned = ({ text, position }: { text: string, position: { x: number, y: number, rotation: number } }) => {\r\n    const s = gameStyles.answer.text;\r\n    const fontSize = text.length > 10 ? s.fontSize_small : s.fontSize;\r\n\r\n    const offsetY = -fontSize * 0.5 - 4;\r\n\r\n    const stylePosition = {\r\n        position: `absolute`,\r\n        transform: `translate(${position.x}px, ${position.y + offsetY}px) rotate(${position.rotation ?? 0}turn)`,\r\n        pointerEvents: `none`,\r\n        maxWidth: gameStyles.viewscreenView.width * 0.5,\r\n        // backgroundColor: `red`,\r\n    } as const;\r\n\r\n    return (\r\n        <View style={stylePosition}>\r\n            <Text style={{ ...gameStyles.answer.text, fontSize }}>{text}</Text>\r\n        </View>\r\n    );\r\n};\r\n","import { shuffle, distinct } from 'utils/arrays';\r\nimport { ProblemService, ProblemResult, ProblemAnswer } from './problems-service';\r\n\r\nexport const createMultiplesProblemService = ({\r\n    min = 1,\r\n    max = 12,\r\n    maxAnswers = 4,\r\n}: {\r\n    min?: number;\r\n    max?: number;\r\n    maxAnswers?: number;\r\n}): ProblemService => {\r\n\r\n    let state = {\r\n        n: min - 1,\r\n        m: min,\r\n        completedSectionKeys: [] as string[],\r\n    };\r\n    const getSectionKey = (m: number) => {\r\n        return `${m}`;\r\n    };\r\n    const getSectionName = (m: number) => {\r\n        return `Multiples of ${m}`;\r\n    };\r\n\r\n    const problemService: ProblemService = {\r\n        load: async (storage) => {\r\n            const loaded = await storage.load<typeof state>();\r\n            if (loaded) {\r\n                state = loaded;\r\n            }\r\n        },\r\n        save: async (storage) => {\r\n            await storage.save(state);\r\n        },\r\n        getSections: () => [...new Array(max - min + 1)].map((x, i) => ({\r\n            key: getSectionKey(i + min),\r\n            name: getSectionName(i + min),\r\n            isComplete: state.completedSectionKeys.includes(getSectionKey(i + min)),\r\n        })),\r\n        gotoSection: ({ key }) => {\r\n            const bVal = Number.parseInt(key, 10);\r\n            state.m = bVal;\r\n            state.n = min - 1;\r\n        },\r\n        getNextProblem: (): ProblemResult => {\r\n            state.n++;\r\n            if (state.n > max) {\r\n                state.n = min;\r\n                state.m++;\r\n                if (state.m > max) {\r\n                    // Loop\r\n                    state.n = min;\r\n                    state.m = min;\r\n                    // return { done: true, key: `done` };\r\n                }\r\n            }\r\n\r\n            const { n, m } = state;\r\n            const correctValue = n * m;\r\n            const wrongAnswerCount = maxAnswers - 1;\r\n            const wrongValues =\r\n                distinct(\r\n                    [...new Array(100)].map(() =>\r\n                        Math.round(n + 1 - 2 * Math.random())\r\n                        * Math.round(m + 1 - 2 * Math.random())\r\n                        + Math.round(2 - 4 * Math.random()))\r\n                        .filter(x => x !== correctValue)\r\n                        .filter(x => x > 0),\r\n                ).slice(0, wrongAnswerCount);\r\n\r\n            const answers: ProblemAnswer[] = shuffle([...wrongValues.map(x => ({ value: `${x}`, isCorrect: false })), { value: `${correctValue}`, isCorrect: true }]).map(x => ({ ...x, key: x.value }));\r\n\r\n            return {\r\n                key: `${m} x ${n}`,\r\n                question: `${m} x ${n}`,\r\n                answers,\r\n                sectionKey: getSectionKey(m),\r\n                isLastOfSection: n === max,\r\n                isLastOfSubject: n === max && m === max,\r\n            };\r\n        },\r\n        recordAnswer: (problem, answer) => {\r\n            if (answer.isCorrect && problem.isLastOfSection) {\r\n                state.completedSectionKeys.push(problem.sectionKey);\r\n            }\r\n        },\r\n    };\r\n\r\n    return problemService;\r\n};\r\n","/* eslint-disable react/no-array-index-key */\r\nimport React, { useEffect, useState } from 'react';\r\nimport { View, Text, TouchableOpacity } from 'react-native-lite';\r\nimport { shuffle } from 'utils/arrays';\r\n\r\nconst englishKeyboard = {\r\n    rows: [\r\n        { keys: `qwertyuiop`.split(``) },\r\n        { keys: ` asdfghjkl`.split(``) },\r\n        { keys: `  zxcvbnm `.split(``) },\r\n    ],\r\n};\r\n\r\nconst styles = {\r\n    container: {},\r\n    rowView: { flex: 1, flexDirection: `row` },\r\n    keyView: {\r\n        margin: 2,\r\n        padding: 2,\r\n        // width: 20,\r\n        flex: 1,\r\n        height: 20,\r\n        backgroundColor: `#111111`,\r\n        justifyContent: `center`,\r\n        alignItems: `center`,\r\n    },\r\n    keyView_disabled: { opacity: 0.5 },\r\n    keyText: {\r\n        fontSize: 16,\r\n    },\r\n    keyText_wrong: {\r\n        fontSize: 16,\r\n        color: `#FF0000`,\r\n    },\r\n} as const;\r\n\r\nexport const KeyboardSimplified = ({ expectedCharacter, showHints, onExpectedKeyPress }: { expectedCharacter: string, showHints: boolean, onExpectedKeyPress: () => void }) => {\r\n    const keyboard = englishKeyboard;\r\n\r\n    const [hintKeys, setHintKeys] = useState(null as null | string[]);\r\n    const [wrongKeys, setWrongKeys] = useState([] as string[]);\r\n    useEffect(() => {\r\n        if (!showHints) { setHintKeys(null); }\r\n\r\n        const hints = [expectedCharacter, ...shuffle(keyboard.rows.flatMap(x => x.keys).map(x => x.trim()).filter(x => x)).slice(0, 3)];\r\n        setHintKeys(hints);\r\n        setWrongKeys([]);\r\n    }, [expectedCharacter, showHints]);\r\n\r\n    const onKeyPress = (key: string) => {\r\n        if (key === expectedCharacter) {\r\n            onExpectedKeyPress();\r\n            return;\r\n        }\r\n        // Remove from choices\r\n        if (showHints) {\r\n            setHintKeys(s => (s ?? []).filter(x => x !== key));\r\n            setWrongKeys(s => [...s, key]);\r\n        }\r\n    };\r\n\r\n    return (\r\n        <>\r\n            <View style={styles.container}>\r\n                {keyboard.rows.map((row, iRow) => (\r\n                    <View style={styles.rowView} key={`${iRow}`} >\r\n                        {row.keys.map((k, i) => (\r\n                            <TouchableOpacity key={`${k}${i}`} style={{ outline: `none` }} onPress={() => onKeyPress(k)}>\r\n                                <View style={!hintKeys || hintKeys.includes(k) ? {} : styles.keyView_disabled} >\r\n                                    <View style={styles.keyView}>\r\n                                        <Text style={wrongKeys.includes(k) ? styles.keyText_wrong : styles.keyText}>{k}</Text>\r\n                                    </View>\r\n                                </View>\r\n                            </TouchableOpacity>\r\n                        ))}\r\n                    </View>\r\n                ))}\r\n            </View>\r\n        </>\r\n    );\r\n};\r\n","import React, { useState, useEffect } from 'react';\r\nimport { View, Text, TouchableOpacity } from 'react-native-lite';\r\nimport { DoodleDrawing, defaultDoodleDrawing, DoodleData } from './doodle';\r\nimport { DoodleDrawerView, DoodleDisplayView } from './doodle-view';\r\nimport { KeyboardSimplified } from './keyboard-simplified';\r\n\r\nexport const styles = {\r\n    container: {\r\n        alignItems: `center`,\r\n    },\r\n    drawing: {\r\n        width: 312,\r\n        height: 312,\r\n        color: `#FFFFFF`,\r\n        backgroundColor: `#000000`,\r\n    },\r\n    drawingChoicesView: {\r\n        maxWidth: 312 + 4 * 4 + 4,\r\n        flexDirection: `row`,\r\n        flexWrap: `wrap`,\r\n    },\r\n    drawingChoiceWrapper: {\r\n        padding: 4,\r\n    },\r\n    drawingChoice: {\r\n        width: 78,\r\n        height: 78,\r\n        color: `#FFFFFF`,\r\n        backgroundColor: `#000000`,\r\n    },\r\n    titleView: {\r\n        justifyContent: `center`,\r\n        alignItems: `center`,\r\n    },\r\n    titleText: {\r\n        fontSize: 20,\r\n        color: `#FFFFFF`,\r\n    },\r\n    promptView: {\r\n        justifyContent: `center`,\r\n        alignItems: `center`,\r\n    },\r\n    promptText: {\r\n        fontSize: 20,\r\n        color: `#FFFF00`,\r\n    },\r\n    hintText: {\r\n        fontSize: 14,\r\n        color: `#FFFF00`,\r\n    },\r\n    buttonRowView: {\r\n        flexDirection: `row`,\r\n    },\r\n    buttonView: {\r\n        margin: 4,\r\n        padding: 8,\r\n        backgroundColor: `#111111`,\r\n    },\r\n    buttonText: {\r\n        fontSize: 20,\r\n        color: `#FFFF00`,\r\n    },\r\n} as const;\r\n\r\nexport const DoodleGameView_DrawWord = (props: { prompt: string, hint?: string, onDone: (drawing: DoodleDrawing) => void, onSkip?: () => void }) => {\r\n    const [drawing, setDrawing] = useState(defaultDoodleDrawing());\r\n    const changeDoodle = (value: DoodleDrawing) => {\r\n        setDrawing(value);\r\n    };\r\n\r\n    const done = () => {\r\n        props.onDone(drawing);\r\n    };\r\n    const skip = () => {\r\n        props.onSkip?.();\r\n    };\r\n\r\n    useEffect(() => {\r\n        // Reset problem when prompt changes\r\n        setDrawing(defaultDoodleDrawing());\r\n    }, [props.prompt]);\r\n\r\n    return (\r\n        <View style={styles.container}>\r\n            <View style={styles.titleView}>\r\n                <Text style={styles.titleText}>Draw</Text>\r\n            </View>\r\n            <DoodleDrawerView style={styles.drawing} drawing={drawing} onChange={changeDoodle} />\r\n            <View style={styles.promptView}>\r\n                <Text style={styles.promptText}>{props.prompt}</Text>\r\n                {!!props.hint && (<Text style={styles.hintText}>{props.hint}</Text>)}\r\n            </View>\r\n            <View style={styles.buttonRowView}>\r\n                {!!props.onSkip && (\r\n                    <TouchableOpacity onPress={skip}>\r\n                        <View style={styles.buttonView}>\r\n                            <Text style={styles.buttonText}>Skip</Text>\r\n                        </View>\r\n                    </TouchableOpacity>\r\n                )}\r\n                <TouchableOpacity onPress={done}>\r\n                    <View style={styles.buttonView}>\r\n                        <Text style={styles.buttonText}>Done</Text>\r\n                    </View>\r\n                </TouchableOpacity>\r\n            </View>\r\n        </View>\r\n    );\r\n};\r\n\r\nexport const DoodleGameView_ChooseBest = (props: { prompt: string, drawings: DoodleData[], onChooseBest: (drawing: DoodleData) => void }) => {\r\n    return (\r\n        <View style={styles.container}>\r\n            <View style={styles.titleView}>\r\n                <Text style={styles.titleText}>Choose Best</Text>\r\n            </View>\r\n            <View style={styles.promptView}>\r\n                <Text style={styles.promptText}>{props.prompt}</Text>\r\n            </View>\r\n            <View style={styles.drawingChoicesView} >\r\n                {props.drawings.map(x => (\r\n                    <TouchableOpacity key={x.key} onPress={() => props.onChooseBest(x)}>\r\n                        <View style={styles.drawingChoiceWrapper} >\r\n                            <DoodleDisplayView style={styles.drawingChoice} drawing={x.drawing} />\r\n                        </View>\r\n                    </TouchableOpacity>\r\n                ))}\r\n            </View>\r\n        </View>\r\n    );\r\n};\r\n\r\nconst typeStyles = {\r\n    completedText: {\r\n        fontSize: 16,\r\n        color: `#FFFF00`,\r\n    },\r\n} as const;\r\nexport const DoodleGameView_TypeExpected = (props: { prompt: string, drawings: DoodleData[], onDone: () => void, sayAgain: () => void }) => {\r\n\r\n    const [status, setStatus] = useState({ completed: ``, remaining: props.prompt });\r\n    useEffect(() => {\r\n        setStatus({ completed: ``, remaining: props.prompt });\r\n    }, [props.prompt, props.drawings]);\r\n\r\n    const onExpectedKeyPress = () => {\r\n        setStatus(s => {\r\n            if (s.remaining.length <= 1) {\r\n                props.onDone();\r\n            }\r\n            const nextChar = s.remaining[0];\r\n            return {\r\n                completed: s.completed + nextChar,\r\n                remaining: s.remaining.substr(1),\r\n            };\r\n        });\r\n    };\r\n\r\n    return (\r\n        <View style={styles.container}>\r\n            <View style={styles.titleView}>\r\n                <Text style={styles.titleText}>Type Word</Text>\r\n            </View>\r\n            <View style={styles.drawingChoicesView} >\r\n                {props.drawings.map(x => (\r\n                    <View key={x.key} style={styles.drawingChoiceWrapper} >\r\n                        <DoodleDisplayView style={styles.drawingChoice} drawing={x.drawing} />\r\n                    </View>\r\n                ))}\r\n            </View>\r\n            <TouchableOpacity onPress={props.sayAgain}>\r\n                <View style={styles.buttonView}>\r\n                    <Text style={styles.buttonText}>Say Again</Text>\r\n                </View>\r\n            </TouchableOpacity>\r\n            <View>\r\n                <Text style={typeStyles.completedText}>{`${status.completed}${status.remaining.length > 0 ? `_` : ``}`}</Text>\r\n            </View>\r\n            <KeyboardSimplified expectedCharacter={status.remaining[0] ?? ` `} showHints onExpectedKeyPress={onExpectedKeyPress} />\r\n        </View>\r\n    );\r\n};\r\n","import React, { useState } from 'react';\r\nimport { View, Text, TouchableOpacity, TextInput } from 'react-native-lite';\r\n\r\n\r\nexport const createLeaderboard = <TScoreState extends {}>(args: {\r\n    storageKey: string;\r\n    sortKey: (item: TScoreState) => string | number;\r\n    sortDescending?: boolean;\r\n    scoreColumns: { name: string, getValue: (item: TScoreState) => string }[];\r\n}) => {\r\n\r\n    type LeaderboardScore = { name: string, score: TScoreState };\r\n    const leaderboard = {\r\n        saveScore: (name: string, score: TScoreState) => {\r\n            const data = leaderboard.loadScore();\r\n\r\n            data.push({ name, score });\r\n            data.sort((a, b) => args.sortKey(a.score) < args.sortKey(b.score) ? -1 : 1);\r\n\r\n            localStorage.setItem(args.storageKey, JSON.stringify(data));\r\n        },\r\n        loadScore: () => {\r\n            const json = localStorage.getItem(args.storageKey);\r\n            if (!json) { return []; }\r\n\r\n            const data = JSON.parse(json) as LeaderboardScore[];\r\n            data.sort((a, b) => (args.sortKey(a.score) > args.sortKey(b.score) ? -1 : 1) * (args.sortDescending ? -1 : 1));\r\n            return data;\r\n        },\r\n    };\r\n\r\n    const leaderboardInputStyles = {\r\n        container: {\r\n            flex: 1,\r\n            alignItems: `center`,\r\n            margin: 16,\r\n        },\r\n        textInput: {\r\n            fontFamily: `\"Lucida Console\", Monaco, monospace`,\r\n            fontSize: 16,\r\n            color: `#0000FF`,\r\n        },\r\n        buttonView: {\r\n            margin: 4,\r\n            padding: 4,\r\n            borderColor: `#FFFF00`,\r\n            borderStyle: `solid`,\r\n            borderWidth: 1,\r\n            borderRadius: 4,\r\n        },\r\n        buttonText: {\r\n            fontFamily: `\"Lucida Console\", Monaco, monospace`,\r\n            fontSize: 16,\r\n            color: `#FFFF00`,\r\n        },\r\n    } as const;\r\n\r\n    const LeaderboardNameInput = (props: { onSubmit: (value: string) => void }) => {\r\n        const [name, setName] = useState(``);\r\n        return (\r\n            <View style={leaderboardInputStyles.container}>\r\n                <TextInput style={leaderboardInputStyles.textInput} value={name} onChange={setName} placeholder='Name' keyboardType='default' autoCompleteType='off' />\r\n                <TouchableOpacity onPress={() => !!name && props.onSubmit(name)} style={!name ? { opacity: 0.5 } : {}}>\r\n                    <View style={leaderboardInputStyles.buttonView}>\r\n                        <Text style={leaderboardInputStyles.buttonText}>Save Score</Text>\r\n                    </View>\r\n                </TouchableOpacity>\r\n            </View >\r\n        );\r\n    };\r\n\r\n    const leaderboardStyles = {\r\n        container: {\r\n            marginTop: 16,\r\n            borderColor: `#FFFFFF`,\r\n            borderStyle: `solid`,\r\n            borderWidth: 1,\r\n            borderRadius: 0,\r\n        },\r\n        scoreView: {\r\n            flexDirection: `row`,\r\n            justifyContent: `space-around`,\r\n            padding: 4,\r\n            borderColor: `#FFFFFF`,\r\n            borderStyle: `solid`,\r\n            borderWidth: 1,\r\n            borderRadius: 0,\r\n        },\r\n        nameText: {\r\n            flex: 2,\r\n            fontFamily: `\"Lucida Console\", Monaco, monospace`,\r\n            fontSize: 12,\r\n            color: `#FFFFFF`,\r\n            overflow: `hidden`,\r\n        },\r\n        scoreText: {\r\n            flex: 1,\r\n            textAlign: `right`,\r\n            fontFamily: `\"Lucida Console\", Monaco, monospace`,\r\n            fontSize: 12,\r\n            color: `#FFFF00`,\r\n        },\r\n    } as const;\r\n\r\n    const LeaderboardViewInner = (props: { scores: LeaderboardScore[] }) => {\r\n\r\n        return (\r\n            <View style={leaderboardStyles.container}>\r\n                <View style={leaderboardStyles.scoreView}>\r\n                    <Text style={leaderboardStyles.nameText}>Leaderboard</Text>\r\n                    {args.scoreColumns.map(x => (\r\n                        <Text key={x.name} style={leaderboardStyles.scoreText} />\r\n                    ))}\r\n                </View>\r\n                <View style={leaderboardStyles.scoreView}>\r\n                    <Text style={leaderboardStyles.nameText}>Name</Text>\r\n                    {args.scoreColumns.map(x => (\r\n                        <Text key={x.name} style={leaderboardStyles.scoreText} >{x.name}</Text>\r\n                    ))}\r\n                </View>\r\n                {props.scores.map(x => (\r\n                    <View style={leaderboardStyles.scoreView}>\r\n                        <Text style={leaderboardStyles.nameText}>{x.name}</Text>\r\n                        {args.scoreColumns.map(c => (\r\n                            <Text key={x.name} style={leaderboardStyles.scoreText} >{c.getValue(x.score)}</Text>\r\n                        ))}\r\n                    </View>\r\n                ))}\r\n            </View>\r\n        );\r\n    };\r\n\r\n    const useLeaderboard = ({\r\n        getScore,\r\n    }: {\r\n        getScore: () => TScoreState;\r\n    }) => {\r\n\r\n        const [leaderboardScores, setLeaderboardScores] = useState({ scores: leaderboard.loadScore() } as { scores: LeaderboardScore[] });\r\n\r\n        const LeaderboardArea = (props: { gameOver: boolean, onScoreSaved: () => void }) => {\r\n\r\n            const onSaveScore = (name: string) => {\r\n                leaderboard.saveScore(name, getScore());\r\n                setLeaderboardScores({ scores: leaderboard.loadScore() });\r\n                props.onScoreSaved();\r\n            };\r\n\r\n            return (\r\n                <>\r\n                    {!!props.gameOver && (<LeaderboardNameInput onSubmit={onSaveScore} />)}\r\n                    <LeaderboardViewInner scores={leaderboardScores.scores} />\r\n                </>\r\n            );\r\n        };\r\n\r\n        return {\r\n            LeaderboardArea,\r\n        };\r\n    };\r\n\r\n\r\n    return {\r\n        useLeaderboard,\r\n    };\r\n};\r\n","export const userProfileChracters = `\r\n                       \r\n`.split(` `).map(x => x.trim()).filter(x => x);\r\n","import React, { useRef, useState, useEffect } from 'react';\r\nimport { View, Text, TouchableOpacity } from 'react-native-lite';\r\nimport { useAutoLoadingError } from 'utils-react/hooks';\r\nimport { C } from 'controls-react';\r\nimport { Icon } from 'controls-react/icon';\r\nimport { IconKind } from 'controls-react/icon-kind';\r\nimport { UserDataService, UserProfileInfo } from './user-data-service';\r\nimport { userProfileChracters } from './user-profile-emojis';\r\n\r\n\r\nexport const UserProfileManagerView = (props: { onClose?: () => void }) => {\r\n\r\n    const { loading, error, doWork } = useAutoLoadingError();\r\n    const [userProfiles, setUserProfiles] = useState(null as null | UserProfileInfo[]);\r\n\r\n    const reload = () => doWork(async (stopIfObsolete) => {\r\n        await UserDataService.get().setup();\r\n        stopIfObsolete();\r\n\r\n        const profiles = await UserDataService.get().getUserProfiles();\r\n        setUserProfiles(profiles);\r\n    });\r\n\r\n    useEffect(() => {\r\n        reload();\r\n    }, []);\r\n\r\n    return (\r\n        <C.View_Panel>\r\n            <C.Text_FormTitle >Users</C.Text_FormTitle>\r\n            <C.LoadingInline loading={loading} />\r\n            <C.ErrorBox error={error} />\r\n            {userProfiles?.map(x => (\r\n                <UserProfileView key={x.key} userProfile={x} onActiveUserChange={reload} onUserProfileChange={reload} />\r\n            ))}\r\n            <C.Text_FormTitle >Add User</C.Text_FormTitle>\r\n            <AddUserProfileView onUserAdded={reload} />\r\n            {!!props.onClose && (\r\n                <C.View_FormActionRow>\r\n                    <C.Button_FormAction onPress={() => props.onClose?.()}>Done</C.Button_FormAction>\r\n                </C.View_FormActionRow>\r\n            )}\r\n        </C.View_Panel>\r\n    );\r\n};\r\n\r\nconst AddUserProfileView = (props: { onUserAdded: () => void }) => {\r\n    const { loading, error, doWork } = useAutoLoadingError();\r\n    const [shareCode, setShareCode] = useState(null as null | string);\r\n    const addShareCode = () => {\r\n        if (!shareCode) { return; }\r\n\r\n        doWork(async (stopIfObsolete) => {\r\n            await UserDataService.get().addUserFromShareCode(shareCode);\r\n            stopIfObsolete();\r\n            props.onUserAdded();\r\n            setShareCode(null);\r\n        });\r\n    };\r\n\r\n    return (\r\n        <>\r\n            <C.View_Form>\r\n                <C.View_FieldRow>\r\n                    <C.LoadingInline loading={loading} />\r\n                    <C.Input_Text value={shareCode ?? ``} onChange={setShareCode} placeholder='Enter Share Code' />\r\n                    <C.Button_FieldInline onPress={addShareCode}>Add User</C.Button_FieldInline>\r\n                </C.View_FieldRow>\r\n                <C.ErrorBox error={error} />\r\n            </C.View_Form>\r\n        </>\r\n    );\r\n};\r\n\r\n\r\nconst UserProfileView = ({ userProfile, onActiveUserChange, onUserProfileChange }: { userProfile: UserProfileInfo, onActiveUserChange: () => void, onUserProfileChange: () => void }) => {\r\n    const { loading, error, doWork } = useAutoLoadingError();\r\n    const [shareCode, setShareCode] = useState(null as null | string);\r\n    const [characters, setCharacters] = useState(null as null | string[]);\r\n\r\n    const createShareCode = () => doWork(async (stopIfObsolete) => {\r\n        const result = await UserDataService.get().createShareCode(userProfile.key);\r\n        stopIfObsolete();\r\n        setShareCode(result.shareCode);\r\n    });\r\n    const makeActive = () => doWork(async (stopIfObsolete) => {\r\n        await UserDataService.get().setActiveUser(userProfile.key);\r\n        stopIfObsolete();\r\n        onActiveUserChange();\r\n    });\r\n\r\n    const showCharacterSelection = () => {\r\n        setCharacters(userProfileChracters);\r\n    };\r\n    const selectCharacter = (character: string) => doWork(async (stopIfObsolete) => {\r\n        await UserDataService.get().setUserProfileInfo(userProfile.key, { emoji: character });\r\n\r\n        setCharacters(null);\r\n        onUserProfileChange();\r\n    });\r\n\r\n    if (characters) {\r\n        return (\r\n            <>\r\n                <C.View_Form>\r\n                    <View style={{ flexDirection: `row`, flexWrap: `wrap` }}>\r\n                        {characters.map(x => (\r\n                            <TouchableOpacity key={x} onPress={() => selectCharacter(x)} >\r\n                                <View>\r\n                                    <Text style={{ fontSize: 32 }} >{x}</Text>\r\n                                </View>\r\n                            </TouchableOpacity>\r\n                        ))}\r\n                    </View>\r\n                </C.View_Form>\r\n            </>\r\n        );\r\n    }\r\n\r\n    return (\r\n        <>\r\n            <C.View_Form>\r\n                <C.View_FieldRow>\r\n                    <C.LoadingInline loading={loading} />\r\n                    <TouchableOpacity onPress={makeActive}>\r\n                        <Icon style={{ size: 32 }} kind={userProfile.isActive ? IconKind.checkChecked : IconKind.checkUnchecked} />\r\n                    </TouchableOpacity>\r\n                    <TouchableOpacity onPress={showCharacterSelection} >\r\n                        <View>\r\n                            <Text style={{ fontSize: 32 }} >{userProfile.emoji}</Text>\r\n                        </View>\r\n                    </TouchableOpacity>\r\n                    <UserProfileName userProfile={userProfile} onNameChange={onUserProfileChange} />\r\n                    {!!shareCode && (\r\n                        <C.Text_FieldLabel>{shareCode}</C.Text_FieldLabel>\r\n                    )}\r\n                    {!shareCode && (\r\n                        <C.Button_FieldInline onPress={createShareCode}>Create Share Code</C.Button_FieldInline>\r\n                    )}\r\n                </C.View_FieldRow>\r\n                <C.ErrorBox error={error} />\r\n            </C.View_Form>\r\n        </>\r\n    );\r\n};\r\n\r\n\r\nexport const UserProfileName = ({ userProfile, onNameChange }: { userProfile: UserProfileInfo, onNameChange: () => void }) => {\r\n    const { loading, error, doWork } = useAutoLoadingError();\r\n    const [name, setName] = useState(userProfile.name);\r\n    const [isEditingName, setIsEditingName] = useState(false);\r\n\r\n    const changeName = () => doWork(async (stopIfObsolete) => {\r\n        console.log(`UserProfileName changeName`, { name });\r\n\r\n        await UserDataService.get().setUserProfileInfo(userProfile.key, { name });\r\n\r\n        setIsEditingName(false);\r\n        onNameChange();\r\n    });\r\n\r\n    return (\r\n        <>\r\n            {!isEditingName && (\r\n                <TouchableOpacity onPress={() => setIsEditingName(true)} >\r\n                    <C.Text_FieldLabel>{userProfile.name}</C.Text_FieldLabel>\r\n                </TouchableOpacity>\r\n            )}\r\n            {isEditingName && (\r\n                <>\r\n                    <C.Input_Text value={name} onChange={setName} onSubmit={changeName} />\r\n                    <C.Button_FieldInline onPress={changeName}>Change</C.Button_FieldInline>\r\n                </>\r\n            )}\r\n        </>\r\n    );\r\n};\r\n","/* eslint-disable react/no-array-index-key */\r\nimport React, { ReactNode, useEffect, useRef, useState } from 'react';\r\nimport { View, Text, TouchableOpacity } from 'react-native-lite';\r\nimport { Utterances } from 'comments/utterances';\r\nimport { LessonModule, SetProjectState } from '../common/lesson-types';\r\nimport { LessonView_ConstructCode, LessonView_ExperimentCode, LessonView_PreviewResult, LessonView_UnderstandCode } from '../common/components/lesson-view';\r\n\r\nconst styles = {\r\n    container: {\r\n        background: `#111111`,\r\n    },\r\n    containerPanel: {\r\n        background: `#292a2d`,\r\n    },\r\n    editorModeTabRowView: {\r\n        flexDirection: `row`,\r\n        paddingLeft: 16,\r\n    },\r\n    editorModeTabView: {\r\n        background: `#1e1e1e`,\r\n        alignSelf: `flex-start`,\r\n        padding: 8,\r\n        marginRight: 1,\r\n    },\r\n    editorModeTabView_selected: {\r\n        background: `#292a2d`,\r\n        alignSelf: `flex-start`,\r\n        padding: 8,\r\n        marginRight: 1,\r\n    },\r\n    editorModeTabText: {\r\n        fontSize: 14,\r\n        color: `#FFFFFFF`,\r\n    },\r\n    editorModeTabText_selected: {\r\n        fontSize: 14,\r\n        color: `#FFFF88`,\r\n    },\r\n    buttonView: {\r\n        background: `#1e1e1e`,\r\n        alignSelf: `flex-start`,\r\n        padding: 8,\r\n        margin: 1,\r\n    },\r\n    buttonText: {\r\n        fontSize: 14,\r\n        color: `#FFFFFFF`,\r\n    },\r\n    sectionHeaderText: {\r\n        margin: 8,\r\n        fontSize: 18,\r\n        color: `#FFFF88`,\r\n    },\r\n    infoView: {\r\n    },\r\n    infoText: {\r\n        margin: 8,\r\n        fontSize: 12,\r\n        wrap: `wrap`,\r\n    },\r\n    lessonFieldView: {\r\n        flexDirection: `row`,\r\n    },\r\n    lessonFieldLabelText: {\r\n        minWidth: 80,\r\n        padding: 4,\r\n        fontSize: 12,\r\n    },\r\n    lessonFieldText: {\r\n        flex: 1,\r\n        padding: 4,\r\n        fontSize: 12,\r\n        wrap: `wrap`,\r\n    },\r\n    jsonText: {\r\n        padding: 4,\r\n        fontSize: 12,\r\n        color: `#FFFFFF`,\r\n        background: `#000000`,\r\n    },\r\n} as const;\r\n\r\n\r\nconst getLessonNavigatorItems = (module: LessonModule) => {\r\n    const items = module.lessons.flatMap((x, i) => [\r\n        { kind: `lesson` as const, lesson: x, label: `${i + 1}. ${x.title}` },\r\n        { kind: `preview` as const, lesson: x, label: `   Preview the Result` },\r\n        { kind: `construct` as const, lesson: x, label: `   Construct the Code` },\r\n        { kind: `understand` as const, lesson: x, label: `   Understand the Code` },\r\n        { kind: `experiment` as const, lesson: x, label: `   Experiment with the Code` },\r\n    ]);\r\n\r\n    // Add Intro Preview\r\n    const lastLesson = module.lessons[module.lessons.length - 1];\r\n    if (lastLesson) {\r\n        const lastLessonMainFile = lastLesson.projectState.files.find(x => x.path === lastLesson.focus.filePath);\r\n        items.unshift({\r\n            kind: `preview` as const,\r\n            lesson: {\r\n                ...lastLesson,\r\n                key: `lesson-`,\r\n                focus: { ...lastLesson.focus, index: 0, length: lastLessonMainFile?.content.length ?? 0 },\r\n            },\r\n            label: ` Lesson Objective`,\r\n        });\r\n    }\r\n\r\n    return items.map(x => ({ ...x, key: x.lesson.key + x.kind }));\r\n};\r\ntype NavigatorItem = ReturnType<typeof getLessonNavigatorItems>[0];\r\n\r\nexport const LessonModulePlayer = (props: { module: LessonModule, setProjectState: SetProjectState }) => {\r\n    const [items, setItems] = useState(getLessonNavigatorItems(props.module));\r\n    const [activeItem, setActiveItem] = useState(null as null | NavigatorItem);\r\n\r\n    useEffect(() => {\r\n        const newItems = getLessonNavigatorItems(props.module);\r\n        setItems(newItems);\r\n        nextStep({ items: newItems, useTimeout: false });\r\n    }, [props.module]);\r\n\r\n    const navigate = (targetItem: NavigatorItem) => {\r\n        if (targetItem.kind !== `lesson`) {\r\n            setActiveItem(targetItem);\r\n            return;\r\n        }\r\n\r\n        nextStep({ items, activeItem: targetItem, useTimeout: false });\r\n    };\r\n\r\n    const nextStep = (options?: { items?: NavigatorItem[], activeItem?: NavigatorItem, useTimeout: boolean }) => {\r\n        // console.log(`LessonModulePlayer nextStep`, { activeItem, options });\r\n        const itemsToUse = options?.items ?? items;\r\n        const activeItemToUse = options?.activeItem ?? activeItem;\r\n        if (!itemsToUse) { return; }\r\n\r\n        const itemSteps = itemsToUse.filter(x => x.kind !== `lesson`);\r\n        const activeItemStepIndex = itemSteps.findIndex(x => x.key === activeItemToUse?.key);\r\n        const activeItemIndex = itemsToUse.findIndex(x => x.key === activeItemToUse?.key);\r\n        const nextItem = (activeItemStepIndex >= 0 ? itemSteps[activeItemStepIndex + 1] : null)\r\n            ?? (activeItemIndex >= 0 ? itemsToUse[activeItemIndex + 1] : null)\r\n            ?? itemsToUse[0];\r\n\r\n        if (options?.useTimeout) {\r\n            setTimeout(() => {\r\n                setActiveItem(nextItem);\r\n            }, 1000);\r\n        } else {\r\n            setActiveItem(nextItem);\r\n        }\r\n    };\r\n\r\n    return (\r\n        <>\r\n            <View style={styles.container}>\r\n                {items && (\r\n                    <LessonModuleNavigator items={items} activeItem={activeItem ?? undefined} onChange={navigate}>\r\n                        <View key={activeItem?.key}>\r\n                            {activeItem?.kind === `preview` && (\r\n                                <LessonView_PreviewResult data={activeItem.lesson} setProjectState={props.setProjectState} onDone={nextStep} />\r\n                            )}\r\n                            {activeItem?.kind === `construct` && (\r\n                                <LessonView_ConstructCode data={activeItem.lesson} onDone={nextStep} />\r\n                            )}\r\n                            {activeItem?.kind === `understand` && (\r\n                                <LessonView_UnderstandCode data={activeItem.lesson} onDone={nextStep} />\r\n                            )}\r\n                            {activeItem?.kind === `experiment` && (\r\n                                <LessonView_ExperimentCode data={activeItem.lesson} setProjectState={props.setProjectState} onDone={nextStep} />\r\n                            )}\r\n                        </View>\r\n\r\n                        <div>\r\n                            <h3 style={{ borderTop: `solid 1px #3ca4ff`, padding: 8, margin: 0, marginTop: 16, textAlign: `center` }}>Community Comments - {props.module.title}</h3>\r\n                            <Utterances repo='ricklove/ricklove-code-lesson-comments' />\r\n                        </div>\r\n                    </LessonModuleNavigator>\r\n                )}\r\n            </View>\r\n        </>\r\n    );\r\n};\r\n\r\n\r\nconst navigatorStyles = {\r\n    outerContainer: {\r\n        flexDirection: `row`,\r\n    },\r\n    contentContainer: {\r\n        flex: 1,\r\n        overflow: `auto`,\r\n    },\r\n    container: {\r\n        flexDirection: `column`,\r\n    },\r\n    itemsContainer: {\r\n        // paddingLeft: 24,\r\n        background: `#333333`,\r\n    },\r\n    itemView_header: {\r\n        flexDirection: `row`,\r\n        alignItems: `center`,\r\n        background: `#333333`,\r\n        // alignSelf: `flex-start`,\r\n        padding: 4,\r\n        marginRight: 1,\r\n    },\r\n    itemView: {\r\n        flexDirection: `row`,\r\n        alignItems: `center`,\r\n        background: `#1e1e1e`,\r\n        // alignSelf: `flex-start`,\r\n        padding: 4,\r\n        marginRight: 1,\r\n    },\r\n    itemView_selected: {\r\n        flexDirection: `row`,\r\n        alignItems: `center`,\r\n        background: `#292a2d`,\r\n        // alignSelf: `flex-start`,\r\n        padding: 4,\r\n        marginRight: 1,\r\n    },\r\n    itemText: {\r\n        fontSize: 14,\r\n    },\r\n    itemText_selected: {\r\n        fontSize: 14,\r\n        color: `#FFFF88`,\r\n    },\r\n    // headerTabView: {\r\n    //     flexDirection: `row`,\r\n    //     alignItems: `center`,\r\n    //     // background: `#1e1e1e`,\r\n    //     // alignSelf: `flex-start`,\r\n    //     padding: 4,\r\n    //     marginRight: 1,\r\n    // },\r\n    // headerTabText: {\r\n    //     fontSize: 14,\r\n    // },\r\n    // moveButtonView: {\r\n    //     minWidth: 24,\r\n    //     justifyContents: `center`,\r\n    //     alignItems: `center`,\r\n    // },\r\n} as const;\r\n\r\nexport const LessonModuleNavigator = (props: { children: ReactNode, items: NavigatorItem[], activeItem?: NavigatorItem, onChange: (value: NavigatorItem) => void }) => {\r\n    const { items, activeItem } = props;\r\n\r\n    const hasLoadedHash = useRef(false);\r\n    const [isExpanded, setIsExpanded] = useState(true);\r\n    const [isNarrowScreen, setIsNarrowScreen] = useState(false);\r\n\r\n    const onLoad = (width: number) => {\r\n        const isNarrow = width < 600;\r\n        setIsNarrowScreen(isNarrow);\r\n    };\r\n\r\n    useEffect(() => {\r\n        if (isNarrowScreen) {\r\n            setIsExpanded(false);\r\n        }\r\n    }, [isNarrowScreen]);\r\n\r\n    useEffect(() => {\r\n        if (!activeItem?.key) { return; }\r\n\r\n        if (!hasLoadedHash.current) {\r\n            hasLoadedHash.current = true;\r\n            // First Load\r\n            const hash = window.location.hash.substr(1);\r\n            const matchItem = props.items.find(x => x.key === hash);\r\n\r\n            console.log(`LessonModuleNavigator load`, { hash, matchItem });\r\n            if (matchItem) {\r\n                props.onChange(matchItem);\r\n                return;\r\n            }\r\n        }\r\n\r\n        window.history.replaceState(null, activeItem?.label ?? ``, `#${activeItem?.key ?? ``}`);\r\n    }, [activeItem]);\r\n\r\n    const changeItem = (item: typeof items[0]) => {\r\n        props.onChange(item);\r\n    };\r\n\r\n    if (!isExpanded && activeItem) {\r\n        return (\r\n            <>\r\n                <TouchableOpacity onPress={() => setIsExpanded(() => true)}>\r\n                    <View style={navigatorStyles.itemView_header}>\r\n                        <Text style={navigatorStyles.itemText_selected}>{`${` `}Lesson Navigation`}</Text>\r\n                    </View>\r\n                    <View style={navigatorStyles.itemsContainer}>\r\n                        <View style={navigatorStyles.itemView_selected}>\r\n                            <Text style={navigatorStyles.itemText_selected}>{`${` `}${activeItem.label}`}</Text>\r\n                        </View>\r\n                    </View>\r\n                </TouchableOpacity>\r\n                {props.children}\r\n            </>\r\n        );\r\n    }\r\n\r\n\r\n    return (\r\n        <>\r\n            <div onLoad={(e) => { onLoad((e.target as HTMLDivElement).clientWidth); }}>\r\n                <View style={navigatorStyles.outerContainer}>\r\n                    <View style={navigatorStyles.container}>\r\n                        <TouchableOpacity onPress={() => setIsExpanded(() => false)}>\r\n                            <View style={navigatorStyles.itemView_header}>\r\n                                <Text style={navigatorStyles.itemText_selected}>{`${` `}Lesson Navigation`}</Text>\r\n                            </View>\r\n                        </TouchableOpacity>\r\n                        <View style={navigatorStyles.itemsContainer}>\r\n                            {items.map(x => (\r\n                                <TouchableOpacity key={x.key} onPress={() => { if (isNarrowScreen) { setIsExpanded(() => false); } if (x.key === activeItem?.key) { return; } changeItem(x); }}>\r\n                                    <View style={x.key === activeItem?.key ? navigatorStyles.itemView_selected : navigatorStyles.itemView}>\r\n                                        <Text style={x.key === activeItem?.key ? navigatorStyles.itemText_selected : navigatorStyles.itemText}>{`${x.key === activeItem?.key ? ` ` : ``}${x.label}`}</Text>\r\n                                    </View>\r\n                                </TouchableOpacity>\r\n                            ))}\r\n                        </View>\r\n                    </View>\r\n                    <View style={navigatorStyles.contentContainer}>\r\n                        {props.children}\r\n                    </View>\r\n                </View>\r\n            </div>\r\n        </>\r\n    );\r\n};\r\n","import { ApiError } from './error';\r\n\r\nexport function fetchWithTimeout(url: string, options: RequestInit, timeoutMs = 10000): Promise<Response> {\r\n    return Promise.race([\r\n        fetch(url, options),\r\n        new Promise((resolve, reject) =>\r\n            setTimeout(() => reject(new ApiError(`Fetch Timeout`)), timeoutMs),\r\n        ) as Promise<Response>,\r\n    ]);\r\n}\r\n\r\nexport async function webRequest(url: string, data: unknown, options?: { method?: 'POST' | 'PUT', timeoutMs?: number }) {\r\n\r\n    const body = JSON.stringify(data);\r\n    const reqData: RequestInit = {\r\n        method: options?.method ?? `POST`,\r\n        headers: {\r\n            'Accept': `application/json`,\r\n            'Content-Type': `application/json`,\r\n            'Content-Length': `${body.length}`,\r\n        },\r\n        body,\r\n    };\r\n    const result = await fetchWithTimeout(url, reqData, options?.timeoutMs).catch((error) => { throw new ApiError(`Request Failure`, { url, data, error }); });\r\n    if (!result.ok) {\r\n        throw new ApiError(`Api Error`, { data: (await result.json().catch(error => {/* Ignore Parse Error */ })) ?? {}, responseStatus: result.status, request: { url, data } });\r\n    }\r\n    const resultObj = await result.json().catch((error) => { throw new ApiError(`Request Parse Failure`, { url, data, error }); });\r\n    return resultObj;\r\n}\r\n","\"use strict\"; // Updated from commit 46d1426 - vscode/src/vs/editor/common/diff/diffComputer.ts\n\n/*---------------------------------------------------------------------------------------------\r\n *  Copyright (c) Microsoft Corporation. All rights reserved.\r\n *  Licensed under the MIT License. See License.txt in the project root for license information.\r\n *--------------------------------------------------------------------------------------------*/\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar diff_1 = require(\"./diff\");\n\nvar strings = require(\"./strings\");\n\nvar MAXIMUM_RUN_TIME = 5000; // 5 seconds\n\nvar MINIMUM_MATCHING_CHARACTER_LENGTH = 3;\n\nfunction computeDiff(originalSequence, modifiedSequence, continueProcessingPredicate, pretty) {\n  var diffAlgo = new diff_1.LcsDiff(originalSequence, modifiedSequence, continueProcessingPredicate);\n  return diffAlgo.ComputeDiff(pretty);\n}\n\nvar LineMarkerSequence =\n/** @class */\nfunction () {\n  function LineMarkerSequence(lines) {\n    var startColumns = [];\n    var endColumns = [];\n\n    for (var i = 0, length_1 = lines.length; i < length_1; i++) {\n      startColumns[i] = LineMarkerSequence._getFirstNonBlankColumn(lines[i], 1);\n      endColumns[i] = LineMarkerSequence._getLastNonBlankColumn(lines[i], 1);\n    }\n\n    this._lines = lines;\n    this._startColumns = startColumns;\n    this._endColumns = endColumns;\n  }\n\n  LineMarkerSequence.prototype.getLength = function () {\n    return this._lines.length;\n  };\n\n  LineMarkerSequence.prototype.getElementAtIndex = function (i) {\n    return this._lines[i].substring(this._startColumns[i] - 1, this._endColumns[i] - 1);\n  };\n\n  LineMarkerSequence.prototype.getStartLineNumber = function (i) {\n    return i + 1;\n  };\n\n  LineMarkerSequence.prototype.getStartColumn = function (i) {\n    return this._startColumns[i];\n  };\n\n  LineMarkerSequence.prototype.getEndLineNumber = function (i) {\n    return i + 1;\n  };\n\n  LineMarkerSequence.prototype.getEndColumn = function (i) {\n    return this._endColumns[i];\n  };\n\n  LineMarkerSequence._getFirstNonBlankColumn = function (txt, defaultValue) {\n    var r = strings.firstNonWhitespaceIndex(txt);\n\n    if (r === -1) {\n      return defaultValue;\n    }\n\n    return r + 1;\n  };\n\n  LineMarkerSequence._getLastNonBlankColumn = function (txt, defaultValue) {\n    var r = strings.lastNonWhitespaceIndex(txt);\n\n    if (r === -1) {\n      return defaultValue;\n    }\n\n    return r + 2;\n  };\n\n  LineMarkerSequence.prototype.getCharSequence = function (shouldIgnoreTrimWhitespace, startIndex, endIndex) {\n    var charCodes = [];\n    var lineNumbers = [];\n    var columns = [];\n    var len = 0;\n\n    for (var index = startIndex; index <= endIndex; index++) {\n      var lineContent = this._lines[index];\n      var startColumn = shouldIgnoreTrimWhitespace ? this._startColumns[index] : 1;\n      var endColumn = shouldIgnoreTrimWhitespace ? this._endColumns[index] : lineContent.length + 1;\n\n      for (var col = startColumn; col < endColumn; col++) {\n        charCodes[len] = lineContent.charCodeAt(col - 1);\n        lineNumbers[len] = index + 1;\n        columns[len] = col;\n        len++;\n      }\n    }\n\n    return new CharSequence(charCodes, lineNumbers, columns);\n  };\n\n  return LineMarkerSequence;\n}();\n\nvar CharSequence =\n/** @class */\nfunction () {\n  function CharSequence(charCodes, lineNumbers, columns) {\n    this._charCodes = charCodes;\n    this._lineNumbers = lineNumbers;\n    this._columns = columns;\n  }\n\n  CharSequence.prototype.getLength = function () {\n    return this._charCodes.length;\n  };\n\n  CharSequence.prototype.getElementAtIndex = function (i) {\n    return this._charCodes[i];\n  };\n\n  CharSequence.prototype.getStartLineNumber = function (i) {\n    return this._lineNumbers[i];\n  };\n\n  CharSequence.prototype.getStartColumn = function (i) {\n    return this._columns[i];\n  };\n\n  CharSequence.prototype.getEndLineNumber = function (i) {\n    return this._lineNumbers[i];\n  };\n\n  CharSequence.prototype.getEndColumn = function (i) {\n    return this._columns[i] + 1;\n  };\n\n  return CharSequence;\n}();\n\nvar CharChange =\n/** @class */\nfunction () {\n  function CharChange(originalStartLineNumber, originalStartColumn, originalEndLineNumber, originalEndColumn, modifiedStartLineNumber, modifiedStartColumn, modifiedEndLineNumber, modifiedEndColumn) {\n    this.originalStartLineNumber = originalStartLineNumber;\n    this.originalStartColumn = originalStartColumn;\n    this.originalEndLineNumber = originalEndLineNumber;\n    this.originalEndColumn = originalEndColumn;\n    this.modifiedStartLineNumber = modifiedStartLineNumber;\n    this.modifiedStartColumn = modifiedStartColumn;\n    this.modifiedEndLineNumber = modifiedEndLineNumber;\n    this.modifiedEndColumn = modifiedEndColumn;\n  }\n\n  CharChange.createFromDiffChange = function (diffChange, originalCharSequence, modifiedCharSequence) {\n    var originalStartLineNumber;\n    var originalStartColumn;\n    var originalEndLineNumber;\n    var originalEndColumn;\n    var modifiedStartLineNumber;\n    var modifiedStartColumn;\n    var modifiedEndLineNumber;\n    var modifiedEndColumn;\n\n    if (diffChange.originalLength === 0) {\n      originalStartLineNumber = 0;\n      originalStartColumn = 0;\n      originalEndLineNumber = 0;\n      originalEndColumn = 0;\n    } else {\n      originalStartLineNumber = originalCharSequence.getStartLineNumber(diffChange.originalStart);\n      originalStartColumn = originalCharSequence.getStartColumn(diffChange.originalStart);\n      originalEndLineNumber = originalCharSequence.getEndLineNumber(diffChange.originalStart + diffChange.originalLength - 1);\n      originalEndColumn = originalCharSequence.getEndColumn(diffChange.originalStart + diffChange.originalLength - 1);\n    }\n\n    if (diffChange.modifiedLength === 0) {\n      modifiedStartLineNumber = 0;\n      modifiedStartColumn = 0;\n      modifiedEndLineNumber = 0;\n      modifiedEndColumn = 0;\n    } else {\n      modifiedStartLineNumber = modifiedCharSequence.getStartLineNumber(diffChange.modifiedStart);\n      modifiedStartColumn = modifiedCharSequence.getStartColumn(diffChange.modifiedStart);\n      modifiedEndLineNumber = modifiedCharSequence.getEndLineNumber(diffChange.modifiedStart + diffChange.modifiedLength - 1);\n      modifiedEndColumn = modifiedCharSequence.getEndColumn(diffChange.modifiedStart + diffChange.modifiedLength - 1);\n    }\n\n    return new CharChange(originalStartLineNumber, originalStartColumn, originalEndLineNumber, originalEndColumn, modifiedStartLineNumber, modifiedStartColumn, modifiedEndLineNumber, modifiedEndColumn);\n  };\n\n  return CharChange;\n}();\n\nfunction postProcessCharChanges(rawChanges) {\n  if (rawChanges.length <= 1) {\n    return rawChanges;\n  }\n\n  var result = [rawChanges[0]];\n  var prevChange = result[0];\n\n  for (var i = 1, len = rawChanges.length; i < len; i++) {\n    var currChange = rawChanges[i];\n    var originalMatchingLength = currChange.originalStart - (prevChange.originalStart + prevChange.originalLength);\n    var modifiedMatchingLength = currChange.modifiedStart - (prevChange.modifiedStart + prevChange.modifiedLength); // Both of the above should be equal, but the continueProcessingPredicate may prevent this from being true\n\n    var matchingLength = Math.min(originalMatchingLength, modifiedMatchingLength);\n\n    if (matchingLength < MINIMUM_MATCHING_CHARACTER_LENGTH) {\n      // Merge the current change into the previous one\n      prevChange.originalLength = currChange.originalStart + currChange.originalLength - prevChange.originalStart;\n      prevChange.modifiedLength = currChange.modifiedStart + currChange.modifiedLength - prevChange.modifiedStart;\n    } else {\n      // Add the current change\n      result.push(currChange);\n      prevChange = currChange;\n    }\n  }\n\n  return result;\n}\n\nvar LineChange =\n/** @class */\nfunction () {\n  function LineChange(originalStartLineNumber, originalEndLineNumber, modifiedStartLineNumber, modifiedEndLineNumber, charChanges) {\n    this.originalStartLineNumber = originalStartLineNumber;\n    this.originalEndLineNumber = originalEndLineNumber;\n    this.modifiedStartLineNumber = modifiedStartLineNumber;\n    this.modifiedEndLineNumber = modifiedEndLineNumber;\n    this.charChanges = charChanges;\n  }\n\n  LineChange.createFromDiffResult = function (shouldIgnoreTrimWhitespace, diffChange, originalLineSequence, modifiedLineSequence, continueProcessingPredicate, shouldComputeCharChanges, shouldPostProcessCharChanges) {\n    var originalStartLineNumber;\n    var originalEndLineNumber;\n    var modifiedStartLineNumber;\n    var modifiedEndLineNumber;\n    var charChanges = undefined;\n\n    if (diffChange.originalLength === 0) {\n      originalStartLineNumber = originalLineSequence.getStartLineNumber(diffChange.originalStart) - 1;\n      originalEndLineNumber = 0;\n    } else {\n      originalStartLineNumber = originalLineSequence.getStartLineNumber(diffChange.originalStart);\n      originalEndLineNumber = originalLineSequence.getEndLineNumber(diffChange.originalStart + diffChange.originalLength - 1);\n    }\n\n    if (diffChange.modifiedLength === 0) {\n      modifiedStartLineNumber = modifiedLineSequence.getStartLineNumber(diffChange.modifiedStart) - 1;\n      modifiedEndLineNumber = 0;\n    } else {\n      modifiedStartLineNumber = modifiedLineSequence.getStartLineNumber(diffChange.modifiedStart);\n      modifiedEndLineNumber = modifiedLineSequence.getEndLineNumber(diffChange.modifiedStart + diffChange.modifiedLength - 1);\n    }\n\n    if (shouldComputeCharChanges && diffChange.originalLength !== 0 && diffChange.modifiedLength !== 0 && continueProcessingPredicate()) {\n      var originalCharSequence = originalLineSequence.getCharSequence(shouldIgnoreTrimWhitespace, diffChange.originalStart, diffChange.originalStart + diffChange.originalLength - 1);\n      var modifiedCharSequence = modifiedLineSequence.getCharSequence(shouldIgnoreTrimWhitespace, diffChange.modifiedStart, diffChange.modifiedStart + diffChange.modifiedLength - 1);\n      var rawChanges = computeDiff(originalCharSequence, modifiedCharSequence, continueProcessingPredicate, true);\n\n      if (shouldPostProcessCharChanges) {\n        rawChanges = postProcessCharChanges(rawChanges);\n      }\n\n      charChanges = [];\n\n      for (var i = 0, length_2 = rawChanges.length; i < length_2; i++) {\n        charChanges.push(CharChange.createFromDiffChange(rawChanges[i], originalCharSequence, modifiedCharSequence));\n      }\n    }\n\n    return new LineChange(originalStartLineNumber, originalEndLineNumber, modifiedStartLineNumber, modifiedEndLineNumber, charChanges);\n  };\n\n  return LineChange;\n}();\n\nvar DiffComputer =\n/** @class */\nfunction () {\n  function DiffComputer(originalLines, modifiedLines, opts) {\n    this.shouldComputeCharChanges = opts.shouldComputeCharChanges;\n    this.shouldPostProcessCharChanges = opts.shouldPostProcessCharChanges;\n    this.shouldIgnoreTrimWhitespace = opts.shouldIgnoreTrimWhitespace;\n    this.shouldMakePrettyDiff = opts.shouldMakePrettyDiff;\n    this.maximumRunTimeMs = MAXIMUM_RUN_TIME;\n    this.originalLines = originalLines;\n    this.modifiedLines = modifiedLines;\n    this.original = new LineMarkerSequence(originalLines);\n    this.modified = new LineMarkerSequence(modifiedLines);\n  }\n\n  DiffComputer.prototype.computeDiff = function () {\n    if (this.original.getLength() === 1 && this.original.getElementAtIndex(0).length === 0) {\n      // empty original => fast path\n      return [{\n        originalStartLineNumber: 1,\n        originalEndLineNumber: 1,\n        modifiedStartLineNumber: 1,\n        modifiedEndLineNumber: this.modified.getLength(),\n        charChanges: [{\n          modifiedEndColumn: 0,\n          modifiedEndLineNumber: 0,\n          modifiedStartColumn: 0,\n          modifiedStartLineNumber: 0,\n          originalEndColumn: 0,\n          originalEndLineNumber: 0,\n          originalStartColumn: 0,\n          originalStartLineNumber: 0\n        }]\n      }];\n    }\n\n    if (this.modified.getLength() === 1 && this.modified.getElementAtIndex(0).length === 0) {\n      // empty modified => fast path\n      return [{\n        originalStartLineNumber: 1,\n        originalEndLineNumber: this.original.getLength(),\n        modifiedStartLineNumber: 1,\n        modifiedEndLineNumber: 1,\n        charChanges: [{\n          modifiedEndColumn: 0,\n          modifiedEndLineNumber: 0,\n          modifiedStartColumn: 0,\n          modifiedStartLineNumber: 0,\n          originalEndColumn: 0,\n          originalEndLineNumber: 0,\n          originalStartColumn: 0,\n          originalStartLineNumber: 0\n        }]\n      }];\n    }\n\n    this.computationStartTime = new Date().getTime();\n    var rawChanges = computeDiff(this.original, this.modified, this._continueProcessingPredicate.bind(this), this.shouldMakePrettyDiff); // The diff is always computed with ignoring trim whitespace\n    // This ensures we get the prettiest diff\n\n    if (this.shouldIgnoreTrimWhitespace) {\n      var lineChanges = [];\n\n      for (var i = 0, length_3 = rawChanges.length; i < length_3; i++) {\n        lineChanges.push(LineChange.createFromDiffResult(this.shouldIgnoreTrimWhitespace, rawChanges[i], this.original, this.modified, this._continueProcessingPredicate.bind(this), this.shouldComputeCharChanges, this.shouldPostProcessCharChanges));\n      }\n\n      return lineChanges;\n    } // Need to post-process and introduce changes where the trim whitespace is different\n    // Note that we are looping starting at -1 to also cover the lines before the first change\n\n\n    var result = [];\n    var originalLineIndex = 0;\n    var modifiedLineIndex = 0;\n\n    for (var i = -1\n    /* !!!! */\n    , len = rawChanges.length; i < len; i++) {\n      var nextChange = i + 1 < len ? rawChanges[i + 1] : null;\n      var originalStop = nextChange ? nextChange.originalStart : this.originalLines.length;\n      var modifiedStop = nextChange ? nextChange.modifiedStart : this.modifiedLines.length;\n\n      while (originalLineIndex < originalStop && modifiedLineIndex < modifiedStop) {\n        var originalLine = this.originalLines[originalLineIndex];\n        var modifiedLine = this.modifiedLines[modifiedLineIndex];\n\n        if (originalLine !== modifiedLine) {\n          // These lines differ only in trim whitespace\n          // Check the leading whitespace\n          {\n            var originalStartColumn = LineMarkerSequence._getFirstNonBlankColumn(originalLine, 1);\n\n            var modifiedStartColumn = LineMarkerSequence._getFirstNonBlankColumn(modifiedLine, 1);\n\n            while (originalStartColumn > 1 && modifiedStartColumn > 1) {\n              var originalChar = originalLine.charCodeAt(originalStartColumn - 2);\n              var modifiedChar = modifiedLine.charCodeAt(modifiedStartColumn - 2);\n\n              if (originalChar !== modifiedChar) {\n                break;\n              }\n\n              originalStartColumn--;\n              modifiedStartColumn--;\n            }\n\n            if (originalStartColumn > 1 || modifiedStartColumn > 1) {\n              this._pushTrimWhitespaceCharChange(result, originalLineIndex + 1, 1, originalStartColumn, modifiedLineIndex + 1, 1, modifiedStartColumn);\n            }\n          } // Check the trailing whitespace\n\n          {\n            var originalEndColumn = LineMarkerSequence._getLastNonBlankColumn(originalLine, 1);\n\n            var modifiedEndColumn = LineMarkerSequence._getLastNonBlankColumn(modifiedLine, 1);\n\n            var originalMaxColumn = originalLine.length + 1;\n            var modifiedMaxColumn = modifiedLine.length + 1;\n\n            while (originalEndColumn < originalMaxColumn && modifiedEndColumn < modifiedMaxColumn) {\n              var originalChar = originalLine.charCodeAt(originalEndColumn - 1);\n              var modifiedChar = originalLine.charCodeAt(modifiedEndColumn - 1);\n\n              if (originalChar !== modifiedChar) {\n                break;\n              }\n\n              originalEndColumn++;\n              modifiedEndColumn++;\n            }\n\n            if (originalEndColumn < originalMaxColumn || modifiedEndColumn < modifiedMaxColumn) {\n              this._pushTrimWhitespaceCharChange(result, originalLineIndex + 1, originalEndColumn, originalMaxColumn, modifiedLineIndex + 1, modifiedEndColumn, modifiedMaxColumn);\n            }\n          }\n        }\n\n        originalLineIndex++;\n        modifiedLineIndex++;\n      }\n\n      if (nextChange) {\n        // Emit the actual change\n        result.push(LineChange.createFromDiffResult(this.shouldIgnoreTrimWhitespace, nextChange, this.original, this.modified, this._continueProcessingPredicate.bind(this), this.shouldComputeCharChanges, this.shouldPostProcessCharChanges));\n        originalLineIndex += nextChange.originalLength;\n        modifiedLineIndex += nextChange.modifiedLength;\n      }\n    }\n\n    return result;\n  };\n\n  DiffComputer.prototype._pushTrimWhitespaceCharChange = function (result, originalLineNumber, originalStartColumn, originalEndColumn, modifiedLineNumber, modifiedStartColumn, modifiedEndColumn) {\n    if (this._mergeTrimWhitespaceCharChange(result, originalLineNumber, originalStartColumn, originalEndColumn, modifiedLineNumber, modifiedStartColumn, modifiedEndColumn)) {\n      // Merged into previous\n      return;\n    }\n\n    var charChanges = undefined;\n\n    if (this.shouldComputeCharChanges) {\n      charChanges = [new CharChange(originalLineNumber, originalStartColumn, originalLineNumber, originalEndColumn, modifiedLineNumber, modifiedStartColumn, modifiedLineNumber, modifiedEndColumn)];\n    }\n\n    result.push(new LineChange(originalLineNumber, originalLineNumber, modifiedLineNumber, modifiedLineNumber, charChanges));\n  };\n\n  DiffComputer.prototype._mergeTrimWhitespaceCharChange = function (result, originalLineNumber, originalStartColumn, originalEndColumn, modifiedLineNumber, modifiedStartColumn, modifiedEndColumn) {\n    var len = result.length;\n\n    if (len === 0) {\n      return false;\n    }\n\n    var prevChange = result[len - 1];\n\n    if (prevChange.originalEndLineNumber === 0 || prevChange.modifiedEndLineNumber === 0) {\n      // Don't merge with inserts/deletes\n      return false;\n    }\n\n    if (prevChange.originalEndLineNumber + 1 === originalLineNumber && prevChange.modifiedEndLineNumber + 1 === modifiedLineNumber) {\n      prevChange.originalEndLineNumber = originalLineNumber;\n      prevChange.modifiedEndLineNumber = modifiedLineNumber;\n\n      if (this.shouldComputeCharChanges) {\n        prevChange.charChanges.push(new CharChange(originalLineNumber, originalStartColumn, originalLineNumber, originalEndColumn, modifiedLineNumber, modifiedStartColumn, modifiedLineNumber, modifiedEndColumn));\n      }\n\n      return true;\n    }\n\n    return false;\n  };\n\n  DiffComputer.prototype._continueProcessingPredicate = function () {\n    if (this.maximumRunTimeMs === 0) {\n      return true;\n    }\n\n    var now = new Date().getTime();\n    return now - this.computationStartTime < this.maximumRunTimeMs;\n  };\n\n  return DiffComputer;\n}();\n\nexports.DiffComputer = DiffComputer;","import { distinct_key } from 'utils/arrays';\r\nimport { StringSpan } from 'utils/string-span';\r\nimport { IDiffComputerOpts, DiffComputer, ILineChange } from 'vscode-diff';\r\n\r\nconst getSpanRange = (v: { span: StringSpan, lineSpans: StringSpan[], startLine: number, endLine: number, startColumn?: number, endColumn?: number, otherAtStart: boolean, otherAtEnd: boolean }) => {\r\n    const afterLine = v.endLine === 0; // || v.endColumn === 0;\r\n    if (afterLine) {\r\n        const atStart = v.startLine === 0 && v.otherAtStart;\r\n        if (atStart) {\r\n            const cStart = 0;\r\n            const cAfterEnd = 0;\r\n            const cChange = v.span.newRange(cStart, cAfterEnd - cStart);\r\n            return {\r\n                start: cStart,\r\n                afterEnd: cAfterEnd,\r\n                change: cChange,\r\n                span: v.span,\r\n                lineSpans: v.lineSpans,\r\n            };\r\n        }\r\n\r\n        const atEnd = v.startLine === 0 && v.otherAtEnd;\r\n        if (atEnd) {\r\n            const cStart = v.span.length;\r\n            const cAfterEnd = cStart;\r\n            const cChange = v.span.newRange(cStart, cAfterEnd - cStart);\r\n            return {\r\n                start: cStart,\r\n                afterEnd: cAfterEnd,\r\n                change: cChange,\r\n                span: v.span,\r\n                lineSpans: v.lineSpans,\r\n            };\r\n        }\r\n\r\n        // After line\r\n        const cStart = v.startLine >= v.lineSpans.length ? v.span.length : v.lineSpans[v.startLine].start;\r\n        const cAfterEnd = cStart;\r\n        const cChange = v.span.newRange(cStart, cAfterEnd - cStart);\r\n        return {\r\n            start: cStart,\r\n            afterEnd: cAfterEnd,\r\n            change: cChange,\r\n            span: v.span,\r\n            lineSpans: v.lineSpans,\r\n        };\r\n    }\r\n\r\n    // Whole lines\r\n    if (!v.startColumn || !v.endColumn) {\r\n        const cStart = v.startLine <= 1 ? 0\r\n            // Start of this line\r\n            : v.lineSpans[v.startLine - 1].start;\r\n\r\n        const cAfterEnd = v.endLine > v.lineSpans.length ? v.span.length\r\n            // End of this line\r\n            : v.lineSpans[v.endLine - 1].start + v.lineSpans[v.endLine - 1].length;\r\n\r\n        const cChange = v.span.newRange(cStart, cAfterEnd - cStart);\r\n        return {\r\n            start: cStart,\r\n            afterEnd: cAfterEnd,\r\n            change: cChange,\r\n            span: v.span,\r\n            lineSpans: v.lineSpans,\r\n        };\r\n    }\r\n\r\n    // Char Range\r\n    const start = v.lineSpans[v.startLine - 1].start + v.startColumn - 1;\r\n    const afterEnd = v.lineSpans[v.endLine - 1].start + v.endColumn - 1;\r\n    const change = v.span.newRange(start, afterEnd - start);\r\n\r\n    return {\r\n        start,\r\n        afterEnd,\r\n        change,\r\n        span: v.span,\r\n        lineSpans: v.lineSpans,\r\n    };\r\n};\r\n\r\nexport const diff = (a: string, b: string) => {\r\n    const aSpan = new StringSpan(a);\r\n    const bSpan = new StringSpan(b);\r\n    const aLineSpans = aSpan.splitOnRegExp(/\\n/g).map((x, i) => i === 0 ? x.transform(0, 1) : x.transform(1, 1));\r\n    const bLineSpans = bSpan.splitOnRegExp(/\\n/g).map((x, i) => i === 0 ? x.transform(0, 1) : x.transform(1, 1));\r\n    const options: IDiffComputerOpts = {\r\n        shouldPostProcessCharChanges: true,\r\n        shouldIgnoreTrimWhitespace: false,\r\n        shouldMakePrettyDiff: true,\r\n        shouldComputeCharChanges: true,\r\n\r\n        // maxComputationTime: 0, // time in milliseconds, 0 => no computation limit.\r\n    };\r\n    const diffComputer = new DiffComputer(aLineSpans.map(x => x.toText()), bLineSpans.map(x => x.toText()), options);\r\n    const lineChanges: ILineChange[] = diffComputer.computeDiff();\r\n\r\n    type LineCharChange = {\r\n        line: {\r\n            readonly originalStartLineNumber: number;\r\n            readonly originalEndLineNumber: number;\r\n            readonly modifiedStartLineNumber: number;\r\n            readonly modifiedEndLineNumber: number;\r\n        };\r\n        readonly originalStartLineNumber: number;\r\n        readonly originalEndLineNumber: number;\r\n        readonly modifiedStartLineNumber: number;\r\n        readonly modifiedEndLineNumber: number;\r\n        readonly originalStartColumn?: number;\r\n        readonly originalEndColumn?: number;\r\n        readonly modifiedStartColumn?: number;\r\n        readonly modifiedEndColumn?: number;\r\n    };\r\n    const charChanges = lineChanges\r\n        .flatMap(x => x.charChanges?.map(c => ({\r\n            line: x,\r\n            ...c,\r\n            // ...x,\r\n        })) as LineCharChange[] ?? [{\r\n            line: x,\r\n            ...x,\r\n            originalStartColumn: undefined,\r\n            originalEndColumn: undefined,\r\n            modifiedStartColumn: undefined,\r\n            modifiedEndColumn: undefined,\r\n        }]);\r\n\r\n    console.log(`diff`, { charChanges, lineChanges, aSpan, bSpan });\r\n\r\n    const changes = charChanges\r\n        .map(x => {\r\n            if (x.originalStartColumn === 0 && x.originalEndColumn === 0\r\n                || x.modifiedStartColumn === 0 && x.modifiedEndColumn === 0) {\r\n                // Whole Line\r\n                return {\r\n                    ...x,\r\n                    a: getSpanRange({\r\n                        span: aSpan,\r\n                        lineSpans: aLineSpans,\r\n                        startLine: x.line.originalStartLineNumber,\r\n                        endLine: x.line.originalEndLineNumber,\r\n                        startColumn: undefined,\r\n                        endColumn: undefined,\r\n                        otherAtStart: x.modifiedStartLineNumber <= 1 && (x.modifiedStartColumn ?? 1) === 1,\r\n                        otherAtEnd: x.modifiedStartLineNumber >= bLineSpans.length,\r\n                    }),\r\n                    b: getSpanRange({\r\n                        span: bSpan,\r\n                        lineSpans: bLineSpans,\r\n                        startLine: x.line.modifiedStartLineNumber,\r\n                        endLine: x.line.modifiedEndLineNumber,\r\n                        startColumn: undefined,\r\n                        endColumn: undefined,\r\n                        otherAtStart: x.originalStartLineNumber <= 1 && (x.originalStartColumn ?? 1) === 1,\r\n                        otherAtEnd: x.originalStartLineNumber >= aLineSpans.length,\r\n                    }),\r\n                };\r\n            }\r\n\r\n            const aSpanRange = getSpanRange({\r\n                span: aSpan,\r\n                lineSpans: aLineSpans,\r\n                startLine: x.originalStartLineNumber,\r\n                endLine: x.originalEndLineNumber,\r\n                startColumn: x.originalStartColumn,\r\n                endColumn: x.originalEndColumn,\r\n                otherAtStart: x.modifiedStartLineNumber <= 1 && (x.modifiedStartColumn ?? 1) === 1,\r\n                otherAtEnd: x.modifiedStartLineNumber >= bLineSpans.length,\r\n            });\r\n            const bSpanRange = getSpanRange({\r\n                span: bSpan,\r\n                lineSpans: bLineSpans,\r\n                startLine: x.modifiedStartLineNumber,\r\n                endLine: x.modifiedEndLineNumber,\r\n                startColumn: x.modifiedStartColumn,\r\n                endColumn: x.modifiedEndColumn,\r\n                otherAtStart: x.originalStartLineNumber <= 1 && (x.originalStartColumn ?? 1) === 1,\r\n                otherAtEnd: x.originalStartLineNumber >= aLineSpans.length,\r\n            });\r\n\r\n            return {\r\n                ...x,\r\n                a: aSpanRange,\r\n                b: bSpanRange,\r\n            };\r\n        });\r\n\r\n    return {\r\n        changes: distinct_key(changes, x => `${x.a.change.start}:${x.a.change.length}=>${x.b.change.start}:${x.b.change.length}`),\r\n    };\r\n};\r\n","import { diff } from './diff';\r\nimport { calculateFilesHashCode } from './lesson-hash';\r\nimport { LessonProjectState, LessonExperimentReplacement } from './lesson-types';\r\n\r\nexport const lessonExperiments_createReplacementProjectState = (projectState: LessonProjectState, replacements: LessonExperimentReplacement[]): LessonProjectState => {\r\n    const files = projectState.files.map(x => {\r\n        const file = { ...x };\r\n        replacements\r\n            .filter(r => r.selection.filePath === x.path)\r\n            // Apply replacements from end so the index will be valid\r\n            .sort((a, b) => - (a.selection.index - b.selection.index))\r\n            .forEach(r => { file.content = `${file.content.substr(0, r.selection.index)}${r.content}${file.content.substr(r.selection.index + r.selection.length)}`; });\r\n        return file;\r\n    });\r\n\r\n    const finalProjectState: LessonProjectState = {\r\n        files,\r\n        filesHashCode: calculateFilesHashCode(files),\r\n    };\r\n\r\n    console.log(`lessonExperiments_createReplacementProjectState`, finalProjectState, projectState, replacements);\r\n    return finalProjectState;\r\n};\r\nexport const lessonExperiments_calculateProjectStateReplacements = (projectState: LessonProjectState, newProjectState: LessonProjectState): { replacements: LessonExperimentReplacement[] } => {\r\n\r\n    const replacements = projectState.files.map(x => ({\r\n        oldFile: x,\r\n        newFile: newProjectState.files.find(f => f.path === x.path),\r\n    }))\r\n        .filter(x => x.newFile)\r\n        .map(x => ({\r\n            filePath: x.oldFile.path,\r\n            changes: diff(x.oldFile.content, x.newFile?.content ?? ``).changes,\r\n        }))\r\n        .flatMap(x => x.changes.map(c => ({\r\n            filePath: x.filePath,\r\n            change: c,\r\n        })))\r\n        .map(x => ({\r\n            // _change: x.change,\r\n            selection: { filePath: x.filePath, index: x.change.a.change.start, length: x.change.a.change.length },\r\n            content: (x.change.b?.change.length ?? 0) === 0 ? `` : x.change.b?.change.toText() ?? ``,\r\n        }));\r\n\r\n    console.log(`lessonExperiments_calculateProjectStateReplacements`, replacements, projectState, newProjectState);\r\n    return { replacements };\r\n};\r\n\r\n\r\n// const runTests = () => {\r\n//     const testRoundTrip = (fileStart: string, fileEnd: string) => {\r\n//         console.log(`testRoundTrip`, { fileStart, fileEnd });\r\n\r\n//         const projectStart: LessonProjectState = {\r\n//             files: [{ content: fileStart, language: `tsx`, path: `./test.tsx` }],\r\n//         };\r\n//         const projectEnd: LessonProjectState = {\r\n//             files: [{ content: fileEnd, language: `tsx`, path: `./test.tsx` }],\r\n//         };\r\n//         const { replacements } = lessonExperiments_calculateProjectStateReplacements(projectStart, projectEnd);\r\n//         const actualProjectEnd = lessonExperiments_createReplacementProjectState(projectStart, replacements);\r\n\r\n//         if (fileEnd === actualProjectEnd.files[0].content) {\r\n//             console.log(`PASS`, { expected: fileEnd, actual: actualProjectEnd.files[0].content });\r\n//             return true;\r\n//         }\r\n\r\n//         console.error(`FAIL`, { expected: fileEnd, actual: actualProjectEnd.files[0].content });\r\n//         return false;\r\n//     };\r\n\r\n//     let failCount = 0;\r\n//     failCount += !testRoundTrip(`Test`, `Test`) ? 1 : 0;\r\n//     failCount += !testRoundTrip(`Test\\r\\n`, `Test\\r\\n`) ? 1 : 0;\r\n//     failCount += !testRoundTrip(`Test`, `123`) ? 1 : 0;\r\n//     failCount += !testRoundTrip(`Test\\r\\n`, `Test`) ? 1 : 0;\r\n//     failCount += !testRoundTrip(`Test`, `Test\\r\\n`) ? 1 : 0;\r\n//     failCount += !testRoundTrip(`A\\r\\nTest\\r\\n123\\r\\nB`, `A\\r\\n123\\r\\nTest\\r\\nB`) ? 1 : 0;\r\n//     failCount += !testRoundTrip(`Test`, `123\\r\\nTest`) ? 1 : 0;\r\n//     failCount += !testRoundTrip(`Test`, `Test\\r\\n123`) ? 1 : 0;\r\n//     failCount += !testRoundTrip(`123\\r\\nTest`, `Test`) ? 1 : 0;\r\n//     failCount += !testRoundTrip(`Test\\r\\n123`, `Test`) ? 1 : 0;\r\n//     failCount += !testRoundTrip(`Test\\n123`, `123\\nTest`) ? 1 : 0;\r\n//     failCount += !testRoundTrip(`Test`, `123\\nTest`) ? 1 : 0;\r\n//     failCount += !testRoundTrip(`Test`, `Test\\n123`) ? 1 : 0;\r\n//     failCount += !testRoundTrip(`123\\nTest`, `Test`) ? 1 : 0;\r\n//     failCount += !testRoundTrip(`Test\\n123`, `Test`) ? 1 : 0;\r\n\r\n//     console.log(`FailCount`, { failCount });\r\n//     const breakdance = true;\r\n// };\r\n// runTests();\r\n","!function (r, t) {\n  \"object\" == typeof exports && \"undefined\" != typeof module ? module.exports = t() : \"function\" == typeof define && define.amd ? define(t) : r.dayjs_plugin_relativeTime = t();\n}(this, function () {\n  \"use strict\";\n\n  return function (r, t, e) {\n    r = r || {};\n    var n = t.prototype,\n        o = {\n      future: \"in %s\",\n      past: \"%s ago\",\n      s: \"a few seconds\",\n      m: \"a minute\",\n      mm: \"%d minutes\",\n      h: \"an hour\",\n      hh: \"%d hours\",\n      d: \"a day\",\n      dd: \"%d days\",\n      M: \"a month\",\n      MM: \"%d months\",\n      y: \"a year\",\n      yy: \"%d years\"\n    };\n\n    function i(r, t, e, o) {\n      return n.fromToBase(r, t, e, o);\n    }\n\n    e.en.relativeTime = o, n.fromToBase = function (t, n, i, d, u) {\n      for (var a, f, s, l = i.$locale().relativeTime || o, h = r.thresholds || [{\n        l: \"s\",\n        r: 44,\n        d: \"second\"\n      }, {\n        l: \"m\",\n        r: 89\n      }, {\n        l: \"mm\",\n        r: 44,\n        d: \"minute\"\n      }, {\n        l: \"h\",\n        r: 89\n      }, {\n        l: \"hh\",\n        r: 21,\n        d: \"hour\"\n      }, {\n        l: \"d\",\n        r: 35\n      }, {\n        l: \"dd\",\n        r: 25,\n        d: \"day\"\n      }, {\n        l: \"M\",\n        r: 45\n      }, {\n        l: \"MM\",\n        r: 10,\n        d: \"month\"\n      }, {\n        l: \"y\",\n        r: 17\n      }, {\n        l: \"yy\",\n        d: \"year\"\n      }], m = h.length, c = 0; c < m; c += 1) {\n        var y = h[c];\n        y.d && (a = d ? e(t).diff(i, y.d, !0) : i.diff(t, y.d, !0));\n        var p = (r.rounding || Math.round)(Math.abs(a));\n\n        if (s = a > 0, p <= y.r || !y.r) {\n          p <= 1 && c > 0 && (y = h[c - 1]);\n          var v = l[y.l];\n          u && (p = u(\"\" + p)), f = \"string\" == typeof v ? v.replace(\"%d\", p) : v(p, n, y.l, s);\n          break;\n        }\n      }\n\n      if (n) return f;\n      var M = s ? l.future : l.past;\n      return \"function\" == typeof M ? M(f) : M.replace(\"%s\", f);\n    }, n.to = function (r, t) {\n      return i(r, t, this, !0);\n    }, n.from = function (r, t) {\n      return i(r, t, this);\n    };\n\n    var d = function d(r) {\n      return r.$u ? e.utc() : e();\n    };\n\n    n.toNow = function (r) {\n      return this.to(d(this), r);\n    }, n.fromNow = function (r) {\n      return this.from(d(this), r);\n    };\n  };\n});","var fails = require('../internals/fails');\nvar whitespaces = require('../internals/whitespaces');\n\nvar non = '\\u200B\\u0085\\u180E';\n\n// check that a method works with the correct list\n// of whitespaces and has a correct name\nmodule.exports = function (METHOD_NAME) {\n  return fails(function () {\n    return !!whitespaces[METHOD_NAME]() || non[METHOD_NAME]() != non || whitespaces[METHOD_NAME].name !== METHOD_NAME;\n  });\n};\n","export const websocketsApiConfig = {\r\n    websocketsApiUrl: `wss://p4w1a7ysk8.execute-api.us-east-1.amazonaws.com/prod`,\r\n};\r\n","'use strict';\nvar $ = require('../internals/export');\nvar flattenIntoArray = require('../internals/flatten-into-array');\nvar toObject = require('../internals/to-object');\nvar toLength = require('../internals/to-length');\nvar aFunction = require('../internals/a-function');\nvar arraySpeciesCreate = require('../internals/array-species-create');\n\n// `Array.prototype.flatMap` method\n// https://tc39.es/ecma262/#sec-array.prototype.flatmap\n$({ target: 'Array', proto: true }, {\n  flatMap: function flatMap(callbackfn /* , thisArg */) {\n    var O = toObject(this);\n    var sourceLen = toLength(O.length);\n    var A;\n    aFunction(callbackfn);\n    A = arraySpeciesCreate(O, 0);\n    A.length = flattenIntoArray(A, O, O, sourceLen, 0, 1, callbackfn, arguments.length > 1 ? arguments[1] : undefined);\n    return A;\n  }\n});\n","import React, { useState } from 'react';\r\nimport { View, Text, TouchableOpacity, Platform } from 'react-native-lite';\r\nimport { ProblemService } from '../problems/problems-service';\r\n\r\n\r\nconst subjectStyles = {\r\n    container: {\r\n        margin: 16,\r\n    },\r\n    header: {\r\n        view: {\r\n            margin: 4,\r\n        },\r\n        text: {\r\n            fontSize: 16,\r\n        },\r\n    },\r\n    section: {\r\n        view: {\r\n            margin: 4,\r\n            flexDirection: `row`,\r\n        },\r\n        text: {\r\n            fontSize: 16,\r\n        },\r\n    },\r\n} as const;\r\n\r\nexport type SubjectProblemService = {\r\n    getSections: () => { key: string, name: string, isComplete: boolean }[];\r\n    gotoSection: (section: { key: string }) => void;\r\n};\r\nexport const SubjectNavigator = (props: { problemService: SubjectProblemService, onOpen: () => void, onClose: () => void, onSubjectNavigation: () => void }) => {\r\n\r\n    const [isExpanded, setIsExpanded] = useState(false);\r\n    const toggle = () => {\r\n        if (!isExpanded) {\r\n            props.onOpen();\r\n        }\r\n        if (isExpanded) {\r\n            props.onClose();\r\n        }\r\n        setIsExpanded(s => !s);\r\n    };\r\n\r\n    return (\r\n        <View style={subjectStyles.container}>\r\n            <TouchableOpacity onPress={toggle}>\r\n                <View style={subjectStyles.header.view}>\r\n                    <Text style={subjectStyles.header.text}>Sections</Text>\r\n                </View>\r\n            </TouchableOpacity>\r\n            {isExpanded && (\r\n                <View>\r\n                    {props.problemService.getSections().map(s => (\r\n                        <TouchableOpacity key={s.key} onPress={() => {\r\n                            console.log(`SubjectNavigator onSection`, { s });\r\n                            props.problemService.gotoSection(s);\r\n                            props.onSubjectNavigation();\r\n                            props.onClose();\r\n                            setIsExpanded(false);\r\n                            if (Platform.OS === `web`) {\r\n                                window.scrollTo(0, 0);\r\n                            }\r\n                        }}>\r\n                            <View style={subjectStyles.section.view}>\r\n                                <Text style={subjectStyles.section.text}>{s.isComplete ? `` : ``}</Text>\r\n                                <Text style={subjectStyles.section.text}>{s.name}</Text>\r\n                            </View>\r\n                        </TouchableOpacity>\r\n                    ))}\r\n                </View>\r\n            )}\r\n\r\n        </View>\r\n    );\r\n};\r\n","import { ProblemStateStorage, ProblemService } from './problems-service';\r\n\r\nexport const createProblemStateStorage = (storageKey: string): ProblemStateStorage => {\r\n    const storage: ProblemStateStorage = {\r\n        load: async <T>() => {\r\n            try {\r\n                return JSON.parse(localStorage.getItem(storageKey) ?? `error - NOT FOUND`) as T;\r\n            }\r\n            catch{\r\n                return null;\r\n            }\r\n        },\r\n        save: async (value) => {\r\n            localStorage.setItem(storageKey, JSON.stringify(value));\r\n        },\r\n    };\r\n    return storage;\r\n};\r\n\r\nexport const createAutoSavedProblemService = (problemSource: ProblemService, storageKey: string): ProblemService => {\r\n    const storage = createProblemStateStorage(storageKey);\r\n\r\n    // Load \r\n    (async () => await problemSource.load(storage))();\r\n\r\n    return {\r\n        ...problemSource,\r\n        recordAnswer: (problem, answer) => {\r\n            problemSource.recordAnswer(problem, answer);\r\n\r\n            if (problem.isLastOfSection) {\r\n                (async () => await problemSource.save(storage))();\r\n            }\r\n        },\r\n    };\r\n};\r\n","import { createUploadApiWebClient } from 'upload-api/client/web-client';\r\nimport { uploadApiConfig } from 'upload-api/client/config';\r\nimport { UploadUrl } from 'upload-api/client/types';\r\nimport { createUploader, downloadData } from 'upload-api/client/uploader';\r\nimport { AppError } from 'utils/error';\r\nimport { delay } from 'utils/delay';\r\nimport { error } from 'console';\r\n\r\nconst USER_DATA_SERVICE_STATE_KEY = `_USER_DATA_SERVICE_STATE`;\r\nexport type UserProfileInfo = {\r\n    key: string;\r\n    name: string;\r\n    emoji: string;\r\n    isActive: boolean;\r\n};\r\ntype UserProfileMetadata = {\r\n    name?: string;\r\n    emoji?: string;\r\n};\r\ntype UserProfileData = {\r\n    key: string;\r\n    name: string;\r\n    emoji?: string;\r\n    uploadUrl: UploadUrl;\r\n    lastUploadTimestamp?: number;\r\n};\r\ntype UserServiceState = {\r\n    userProfiles: UserProfileData[];\r\n    activeUserProfileKey: string;\r\n    changeTimestamp: number;\r\n};\r\ntype UserData = {\r\n    data: { [key: string]: null | string };\r\n    metadata?: UserProfileMetadata;\r\n    timestamp: number;\r\n};\r\n\r\nconst createUserDataService = () => {\r\n    const uploadApi = createUploadApiWebClient(uploadApiConfig);\r\n\r\n    const storage = {\r\n        getUserDataServiceState: (): null | UserServiceState => {\r\n            try {\r\n                return JSON.parse(localStorage.getItem(USER_DATA_SERVICE_STATE_KEY) ?? `NULL !{}`);\r\n            } catch{\r\n                return null;\r\n            }\r\n        },\r\n        setUserDataServiceState: (state: UserServiceState) => {\r\n            localStorage.setItem(USER_DATA_SERVICE_STATE_KEY, JSON.stringify(state));\r\n        },\r\n        getUserData: (): UserData => {\r\n            const state = storage.getUserDataServiceState();\r\n            const userState = state && state.userProfiles.find(x => x.key === state.activeUserProfileKey);\r\n            const data = {\r\n                data: {},\r\n                metadata: { name: userState?.name, emoji: userState?.emoji },\r\n                timestamp: Date.now(),\r\n            } as UserData;\r\n            const keys = Object.keys(localStorage).filter(x => !x.startsWith(`_`));\r\n            for (const k of keys) {\r\n                data.data[k] = localStorage.getItem(k);\r\n            }\r\n            return data;\r\n        },\r\n        clearUserData: () => {\r\n            // Remove all old data\r\n            const keys = Object.keys(localStorage).filter(x => !x.startsWith(`_`));\r\n            for (const k of keys) {\r\n                localStorage.removeItem(k);\r\n            }\r\n\r\n            // Load metadata\r\n            const state = storage.getUserDataServiceState();\r\n            if (!state) { return; }\r\n            state.userProfiles.forEach(x => { x.lastUploadTimestamp = undefined; });\r\n            storage.setUserDataServiceState(state);\r\n        },\r\n        setUserData: (userData: UserData) => {\r\n            storage.clearUserData();\r\n\r\n            // Set New data\r\n            for (const k of Object.keys(userData.data)) {\r\n                const val = userData.data[k];\r\n                if (!val) {\r\n                    localStorage.removeItem(k);\r\n                    return;\r\n                }\r\n                localStorage.setItem(k, val);\r\n            }\r\n\r\n            // Load metadata\r\n            const state = storage.getUserDataServiceState();\r\n            const userState = state && state.userProfiles.find(x => x.key === state.activeUserProfileKey);\r\n            if (!state || !userState) { return; }\r\n            userState.emoji = userData.metadata?.emoji ?? userState.emoji;\r\n            userState.name = userData.metadata?.name ?? userState.name;\r\n            userState.lastUploadTimestamp = userData.timestamp;\r\n            storage.setUserDataServiceState(state);\r\n        },\r\n    };\r\n\r\n    const getUserProfile = (userProfileKey: string) => {\r\n        const state = storage.getUserDataServiceState();\r\n        if (!state) { return null; }\r\n        return state.userProfiles.find(x => x.key === userProfileKey);\r\n    };\r\n    const getActiveUserProfile = () => {\r\n        const state = storage.getUserDataServiceState();\r\n        if (!state?.activeUserProfileKey) { return null; }\r\n        return state.userProfiles.find(x => x.key === state.activeUserProfileKey);\r\n    };\r\n\r\n    const uploadBackup = async (userState: UserProfileData, userData: UserData) => {\r\n        const uploadUrl = await uploadApi.createUploadUrl({ prefix: `backup/users/${userState.name}/${userState.uploadUrl.relativePath}/${Date.now()}` });\r\n        const uploader = createUploader(uploadUrl.uploadUrl);\r\n        await uploader.uploadData(userData);\r\n    };\r\n\r\n    const uploadWithAutoRenew = async (userProfileKey: string, userData: UserData) => {\r\n        const state = storage.getUserDataServiceState();\r\n        const userState = state && state.userProfiles.find(x => x.key === userProfileKey);\r\n        if (!state || !userState) { return; }\r\n\r\n        // Upload backup\r\n        await uploadBackup(userState, userData);\r\n\r\n        const upload = async () => {\r\n            const uploader = createUploader(userState.uploadUrl);\r\n            await uploader.uploadData(userData);\r\n        };\r\n\r\n        try {\r\n            // Try to upload\r\n            console.log(`uploadWithAutoRenew - Attempt 1`);\r\n            await upload();\r\n            console.log(`uploadWithAutoRenew - UPLOADED`);\r\n        } catch{\r\n            // Rewew and try again\r\n            console.log(`uploadWithAutoRenew - Attempt 2`);\r\n\r\n            const newUploarUrl = await uploadApi.renewUploadUrl({ uploadUrl: userState.uploadUrl });\r\n            userState.uploadUrl = newUploarUrl.uploadUrl;\r\n            storage.setUserDataServiceState(state);\r\n\r\n            await upload();\r\n\r\n            console.log(`uploadWithAutoRenew - UPLOADED AFTER RENEW`);\r\n        }\r\n    };\r\n\r\n    const updateUserProfileFromServer = async (userProfileKey: string) => {\r\n        console.log(`updateUserProfile`, { userProfileKey });\r\n        const state = storage.getUserDataServiceState();\r\n        const userState = state && state.userProfiles.find(x => x.key === userProfileKey);\r\n        if (!state || !userState) {\r\n            console.log(`updateUserProfile - NO USER STATE`, { userProfileKey });\r\n            return;\r\n        }\r\n\r\n        const userData = await downloadData(userState.uploadUrl.getUrl) as UserData;\r\n        if (!userData.timestamp || userData.timestamp <= (userState.lastUploadTimestamp ?? 0)) {\r\n            // Skip if not new\r\n            console.log(`updateUserProfile - NOT NEW`, { name: userState.name });\r\n            return;\r\n        }\r\n\r\n        console.log(`updateUserProfile - UPDATED USER PROFILE`, { name: userState.name });\r\n        userState.emoji = userData.metadata?.emoji ?? userState.emoji;\r\n        userState.name = userData.metadata?.name ?? userState.name;\r\n        userState.lastUploadTimestamp = userData.timestamp;\r\n        storage.setUserDataServiceState(state);\r\n\r\n        if (userState.key === state.activeUserProfileKey) {\r\n            console.log(`updateUserProfile - UPDATED ACTIVE USER DATA`, { name: userState.name });\r\n            storage.setUserData(userData);\r\n        }\r\n    };\r\n    const updateAllProfilesFromServer = async () => {\r\n        const state = storage.getUserDataServiceState();\r\n        if (!state) { return; }\r\n\r\n        for (const userState of state.userProfiles) {\r\n            try {\r\n                // eslint-disable-next-line no-await-in-loop\r\n                await updateUserProfileFromServer(userState.key);\r\n            } catch (error_) {\r\n                console.log(`updateAllProfiles - ERROR Updating user profile`, { error: error_ });\r\n            }\r\n        }\r\n    };\r\n\r\n    let isSetupStarted = false;\r\n    let isSetupDone = false;\r\n\r\n    const service = {\r\n        setup: async () => {\r\n            if (isSetupStarted) {\r\n                while (!isSetupDone) {\r\n                    // eslint-disable-next-line no-await-in-loop\r\n                    await delay(10);\r\n                }\r\n                return;\r\n            }\r\n            isSetupStarted = true;\r\n            const doSetup = async () => {\r\n                console.log(`UserDataService:setup`);\r\n\r\n                const a = getActiveUserProfile();\r\n                if (a) {\r\n                    await updateAllProfilesFromServer();\r\n                    return;\r\n                }\r\n\r\n                const state = storage.getUserDataServiceState();\r\n                if (state && state.userProfiles.length > 0) {\r\n                    state.activeUserProfileKey = state.userProfiles[0].key;\r\n                    storage.setUserDataServiceState(state);\r\n                    await updateAllProfilesFromServer();\r\n                    return;\r\n                }\r\n\r\n                const newUploadUrlResult = await uploadApi.createUploadUrl({ prefix: `users` });\r\n                const newState: UserServiceState = state ?? {\r\n                    userProfiles: [{\r\n                        key: newUploadUrlResult.uploadUrl.relativePath,\r\n                        name: `${`Player 1`}`,\r\n                        uploadUrl: newUploadUrlResult.uploadUrl,\r\n                    }],\r\n                    activeUserProfileKey: newUploadUrlResult.uploadUrl.relativePath,\r\n                    changeTimestamp: 0,\r\n                };\r\n                storage.setUserDataServiceState(newState);\r\n\r\n                // Upload initial data\r\n                await service.uploadUserData();\r\n            };\r\n\r\n            try {\r\n                await doSetup();\r\n                isSetupDone = true;\r\n            } catch (error_) {\r\n                // Setup Failed\r\n                isSetupDone = true;\r\n                throw error_;\r\n            }\r\n        },\r\n        getActiveUser: (): null | UserProfileInfo => {\r\n            const user = getActiveUserProfile();\r\n            if (!user) { return null; }\r\n            return {\r\n                key: user.key,\r\n                name: user.name,\r\n                emoji: user.emoji ?? ``,\r\n                isActive: true,\r\n            };\r\n        },\r\n        setActiveUser: async (userProfileKey: string) => {\r\n            console.log(`setActiveUser`, { userProfileKey });\r\n            const state = storage.getUserDataServiceState();\r\n            if (!state) { return; }\r\n\r\n            if (!state.userProfiles.find(x => x.key === userProfileKey)) {\r\n                console.log(`setActiveUser - User Profile Not Found`, { userProfileKey });\r\n                throw new AppError(`User Profile not found`);\r\n            }\r\n\r\n            // Don't upload old user data - the chance of this being out of date is high\r\n            // // Upload old user data\r\n            // await service.uploadUserData();\r\n\r\n            if (state.activeUserProfileKey !== userProfileKey) {\r\n                console.log(`setActiveUser - user changed - clearing state`);\r\n\r\n                state.activeUserProfileKey = userProfileKey;\r\n                state.changeTimestamp = 0;\r\n                storage.setUserDataServiceState(state);\r\n                storage.clearUserData();\r\n            }\r\n\r\n            console.log(`setActiveUser - before download`, { stateJson: JSON.stringify(storage.getUserDataServiceState()) });\r\n\r\n            // Download new user data\r\n            await service.downloadUserDataIfNewer();\r\n        },\r\n        getUserProfiles: async (): Promise<UserProfileInfo[]> => {\r\n            const state = storage.getUserDataServiceState();\r\n            if (!state?.activeUserProfileKey) { return []; }\r\n            return state.userProfiles.map(x => ({\r\n                key: x.key,\r\n                name: x.name,\r\n                emoji: x.emoji ?? ``,\r\n                isActive: state.activeUserProfileKey === x.key,\r\n            }));\r\n        },\r\n        setUserProfileInfo: async (userProfileKey: string, info: { emoji?: string, name?: string }) => {\r\n            const state = storage.getUserDataServiceState();\r\n            if (!state) {\r\n                console.log(`uploadUserData - NO STATE`);\r\n                return;\r\n            }\r\n\r\n            const userState = state.userProfiles.find(x => x.key === userProfileKey);\r\n            if (!userState) {\r\n                console.log(`uploadUserData - NO USER STATE`);\r\n                return;\r\n            }\r\n\r\n            userState.emoji = info.emoji ?? userState.emoji;\r\n            userState.name = info.name ?? userState.name;\r\n            storage.setUserDataServiceState(state);\r\n\r\n            // Save to remote data\r\n            const uploader = createUploader(userState.uploadUrl);\r\n            const uData = await uploader.downloadData() as UserData;\r\n            if (!uData) { return; }\r\n            uData.metadata = {\r\n                name: userState.name,\r\n                emoji: userState.emoji,\r\n            };\r\n            uData.timestamp = Date.now();\r\n            await uploadWithAutoRenew(userProfileKey, uData);\r\n        },\r\n        uploadUserData: async () => {\r\n            console.log(`uploadUserData`);\r\n\r\n            const state = storage.getUserDataServiceState();\r\n            if (!state) {\r\n                console.log(`uploadUserData - NO STATE`);\r\n                return;\r\n            }\r\n\r\n            const userState = state.userProfiles.find(x => x.key === state.activeUserProfileKey);\r\n            if (!userState) {\r\n                console.log(`uploadUserData - NO user State`, { state });\r\n                return;\r\n            }\r\n\r\n            userState.lastUploadTimestamp = Date.now();\r\n            storage.setUserDataServiceState(state);\r\n\r\n            const userData = storage.getUserData();\r\n            await uploadWithAutoRenew(userState.key, userData);\r\n\r\n            console.log(`uploadUserData - UPLOADED`, { userData });\r\n        },\r\n        downloadUserDataIfNewer: async () => {\r\n            const state = storage.getUserDataServiceState();\r\n            if (!state) { return; }\r\n\r\n            const userState = state.userProfiles.find(x => x.key === state.activeUserProfileKey);\r\n            if (!userState) { return; }\r\n\r\n            console.log(`downloadUserDataIfNewer`);\r\n\r\n            const uploader = createUploader(userState.uploadUrl);\r\n            const userData = await uploader.downloadData() as UserData;\r\n\r\n            // Don't update if not newer\r\n            if (!userData.timestamp || userData.timestamp <= (userState.lastUploadTimestamp ?? 0)) {\r\n                console.log(`downloadUserDataIfNewer - Local data is up to date`, { state, userData });\r\n                return;\r\n            }\r\n\r\n            console.log(`downloadUserDataIfNewer - UPDATING`, { state, userData });\r\n            storage.clearUserData();\r\n            storage.setUserData(userData);\r\n        },\r\n        createShareCode: async (userProfileKey: string) => {\r\n            await service.setup();\r\n            const user = getUserProfile(userProfileKey);\r\n            if (!user) {\r\n                throw new AppError(`user should not be null`);\r\n            }\r\n\r\n            const shareUrlResult = await uploadApi.createUploadUrl({ shareablePath: true });\r\n\r\n            // Save user uploadUrl to shared path\r\n            const uploader = createUploader(shareUrlResult.uploadUrl);\r\n            await uploader.uploadData(user.uploadUrl);\r\n\r\n            return {\r\n                shareCode: shareUrlResult.uploadUrl.relativePath,\r\n            };\r\n        },\r\n        addUserFromShareCode: async (shareCode: string) => {\r\n            console.log(`addUserFromShareCode`, { shareCode });\r\n\r\n            // Don't have a clean way to get the path, but can generate a new path from the server and use it as a template\r\n            const shareUrlResult = await uploadApi.createUploadUrl({ shareablePath: true });\r\n            const shareGetUrl = shareUrlResult.uploadUrl.getUrl.replace(shareUrlResult.uploadUrl.relativePath, shareCode.toUpperCase());\r\n            const sharedUploadUrl = await downloadData(shareGetUrl) as UploadUrl;\r\n            if (!sharedUploadUrl.putUrl) {\r\n                console.log(`addUserFromShareCode - FAILED TO GET PROFILE`);\r\n                throw new AppError(`Failed to get user profile`);\r\n            }\r\n\r\n            const state = storage.getUserDataServiceState();\r\n            if (!state) {\r\n                console.log(`addUserFromShareCode - NO STATE`);\r\n                throw new AppError(`UserDataService is not setup`);\r\n            }\r\n\r\n            // Already has that user profile\r\n            if (state.userProfiles.find(x => x.key === sharedUploadUrl.relativePath)) {\r\n                console.log(`addUserFromShareCode - ALREADY HAS USER`, { userKey: sharedUploadUrl.relativePath });\r\n                return;\r\n            }\r\n\r\n            state.userProfiles.push({\r\n                key: sharedUploadUrl.relativePath,\r\n                name: `Player ${state.userProfiles.length + 1}`,\r\n                uploadUrl: sharedUploadUrl,\r\n            });\r\n            storage.setUserDataServiceState(state);\r\n\r\n            console.log(`addUserFromShareCode - ADDED`, { userKey: sharedUploadUrl.relativePath });\r\n\r\n            // Reload profile\r\n            await updateUserProfileFromServer(sharedUploadUrl.relativePath);\r\n        },\r\n    };\r\n    return service;\r\n};\r\n\r\nexport type UserDataService = ReturnType<typeof createUserDataService>;\r\nconst serviceState = {\r\n    instance: null as null | UserDataService,\r\n};\r\nexport const UserDataService = {\r\n    get: (): UserDataService => {\r\n        if (!serviceState.instance) {\r\n            serviceState.instance = createUserDataService();\r\n        };\r\n        return serviceState.instance;\r\n    },\r\n};\r\n","export { delay } from 'utils/delay';\r\nexport { randomIndex, randomItem } from 'utils/random';\r\nexport { getValuesAsItems } from 'utils/objects';\r\nexport { moveItem } from 'utils/arrays';\r\nexport const randomBinary = (length: number) => String.fromCharCode(...[...new Array(length)].map(x => Math.random() * (126 - 32) + 32));\r\n","import { distinct, shuffle } from 'utils/arrays';\r\nimport { StringSpan } from 'utils/string-span';\r\nimport { highlight, languages } from 'prismjs';\r\nimport { LessonProjectFileSelection } from '../lesson-types';\r\nimport 'prismjs/components/prism-typescript';\r\nimport 'prismjs/components/prism-jsx';\r\nimport 'prismjs/components/prism-tsx';\r\nimport 'prism-themes/themes/prism-vsc-dark-plus.css';\r\n\r\nexport const isSimilarCodeToken = (a: string, b: string) => {\r\n    if (/^\\d+$/g.test(a) &&\r\n        /^\\d+$/g.test(b)) { return true; }\r\n    if (/^\\w+$/g.test(a) &&\r\n        /^\\w+$/g.test(b)) { return true; }\r\n    if (/^\\W+$/g.test(a) &&\r\n        /^\\W+$/g.test(b)) { return true; }\r\n\r\n    return false;\r\n};\r\n\r\n\r\ntype CodeWithClasses = { code: string, classes: string[] };\r\nconst parseHighlightedSpans = (html: string): CodeWithClasses[] => {\r\n    const h = new StringSpan(html, 0, html.length);\r\n    const tagsWithCode = h.splitOnRegExp(/<[^>]*>/g).filter(x => x.length > 0).map(t => {\r\n\r\n        const iTagLast = t.indexOf(`>`);\r\n        if (iTagLast < 0) {\r\n            return {\r\n                raw: t,\r\n                tag: t,\r\n                code: t,\r\n            };\r\n        }\r\n\r\n        const iTagLength = iTagLast - t.start + 1;\r\n        return {\r\n            raw: t,\r\n            tag: t.newRange(t.start, iTagLength),\r\n            code: t.newRange(iTagLast + 1, t.length - iTagLength),\r\n        };\r\n    });\r\n\r\n    const tagContext = [] as StringSpan[];\r\n    const tagsWithContext = tagsWithCode.map(t => {\r\n        if (t.tag.startsWith(`</`)) {\r\n            tagContext.pop();\r\n        } else if (t.tag.startsWith(`<`)) {\r\n            tagContext.push(t.tag);\r\n        }\r\n        return {\r\n            ...t,\r\n            context: [...tagContext],\r\n        };\r\n    });\r\n    const tagsWithClasses = tagsWithContext.map(t => {\r\n        const classInfos = t.context.map(c => {\r\n            const cParts = c.splitOnRegExp(/class=('|\")/g);\r\n            if (cParts.length <= 1) { return { raw: c, cParts }; }\r\n\r\n            const classPart = cParts[1];\r\n            const classContentParts = classPart.splitOnRegExp(/('|\")/g);\r\n\r\n            const classContent = classContentParts[1].trimStart([`\"`, `'`]);\r\n            if (!classContent) { return { raw: c, cParts, classContentParts }; }\r\n\r\n            return {\r\n                raw: c,\r\n                cParts,\r\n                classContentParts,\r\n                classContent: classContent.toText(),\r\n                classes: classContent.toText().split(` `).filter(x => x).map(x => x as string),\r\n            };\r\n        });\r\n        return {\r\n            ...t,\r\n            classInfos,\r\n            classes: distinct(classInfos.flatMap(x => x.classes ?? [])),\r\n        };\r\n    });\r\n\r\n    const codeWithClasses = tagsWithClasses.map(x => ({\r\n        code: x.code.toText()\r\n            .replace(/&lt;/g, `<`)\r\n            .replace(/&gt;/g, `>`)\r\n            .replace(/&amp;/g, `&`)\r\n        ,\r\n        classes: x.classes,\r\n    }))\r\n        .filter(x => x.code);\r\n\r\n    console.log(`parseHighlightedSpans`, { codeWithClasses, tagsWithClasses, summary: codeWithClasses.map(x => `<span class='${x.classes.join(` `)}'>${x.code}</span>`).join(``) });\r\n    // const iFocus = h.lastIndexOf(`<span`, lengthSameStart);\r\n    return codeWithClasses;\r\n};\r\n\r\nexport type CodePart = {\r\n    code: string;\r\n    classes: string[];\r\n    index: number;\r\n    length: number;\r\n    indexAfterEnd: number;\r\n    isInSelection: boolean;\r\n    onPress?: (value: CodePart) => void;\r\n};\r\nexport type CodePartsData = {\r\n    // codeBefore: string;\r\n    codeFocus: string;\r\n    // codeAfter: string;\r\n    codeParts: CodePart[];\r\n    selection?: LessonProjectFileSelection;\r\n};\r\nexport const getCodeParts = (code: string, language: 'tsx', selection?: LessonProjectFileSelection): CodePartsData => {\r\n\r\n    const html = highlight(code, languages[language], language);\r\n    const codeWithClasses = parseHighlightedSpans(html);\r\n    let index = 0;\r\n    const codeParts = codeWithClasses.map(x => {\r\n        const r = {\r\n            code: x.code,\r\n            classes: x.classes,\r\n            index,\r\n            length: x.code.length,\r\n            indexAfterEnd: index + x.code.length,\r\n            _rawCode: code.substr(index, x.code.length),\r\n        };\r\n        index += x.code.length;\r\n        return r;\r\n    });\r\n\r\n    if (codeParts.some(x => x.code !== x._rawCode)) {\r\n        console.error(`getCodeParts FAILED`, { codeParts: codeWithClasses, codePartsFailed: codeParts.filter(x => x.code !== x._rawCode) });\r\n    }\r\n\r\n    const s = selection ?? {\r\n        index: 0,\r\n        length: code.length,\r\n    };\r\n\r\n    const codePartsAll = modifyCodeParts(codeParts.map(x => ({ ...x, isInSelection: true, indexAfterEnd: x.index + x.length })), s, (x, inRange) => ({ ...x, isInSelection: inRange }));\r\n\r\n    console.log(`getCodeParts`, {\r\n        codePartsAll,\r\n        code,\r\n        selection,\r\n    });\r\n\r\n    if (codePartsAll.some(x => x.code !== code.substr(x.index, x.length))) {\r\n        console.error(`getCodeParts FAILED`, { codeParts: codeWithClasses, codePartsFailed: codeParts.filter(x => x.code !== x._rawCode) });\r\n    }\r\n\r\n    const codeFocus = code.substr(s.index, s.length);\r\n    return {\r\n        codeFocus,\r\n        codeParts: codePartsAll,\r\n        selection,\r\n    };\r\n};\r\nconst modifyCodeParts = <T extends CodePart>(codeParts: CodePart[], range: { index: number, length: number }, getCodePart: (codePart: CodePart, inRange: boolean) => T): T[] => {\r\n    const s = {\r\n        ...range,\r\n        indexAfterEnd: range.index + range.length,\r\n    };\r\n\r\n    const codePartsAll: T[] = [];\r\n    for (const c of codeParts) {\r\n        // Before\r\n        if (c.indexAfterEnd < s.index) {\r\n            codePartsAll.push(getCodePart(c, false));\r\n            continue;\r\n        }\r\n        // After\r\n        if (c.index > s.indexAfterEnd) {\r\n            codePartsAll.push(getCodePart(c, false));\r\n            continue;\r\n        }\r\n        // Within\r\n        if (c.index >= s.index && c.indexAfterEnd <= s.indexAfterEnd) {\r\n            codePartsAll.push(getCodePart(c, true));\r\n            continue;\r\n        }\r\n\r\n        // Overlap\r\n        const shouldSplitStart = c.index < s.index;\r\n        const shouldSplitEnd = c.indexAfterEnd > s.indexAfterEnd;\r\n        const iCodeStart = shouldSplitStart ? s.index - c.index : 0;\r\n        const iCodeAfterEnd = shouldSplitEnd ? s.indexAfterEnd - c.index : c.length;\r\n        const before = c.code.substr(0, iCodeStart);\r\n        const within = c.code.substr(iCodeStart, iCodeAfterEnd - iCodeStart);\r\n        const after = c.code.substr(iCodeAfterEnd, c.length - iCodeAfterEnd);\r\n        codePartsAll.push(...[\r\n            getCodePart({ ...c, code: before, index: c.index, length: iCodeStart }, false),\r\n            getCodePart({ ...c, code: within, index: c.index + iCodeStart, length: iCodeAfterEnd - iCodeStart }, true),\r\n            getCodePart({ ...c, code: after, index: c.index + iCodeAfterEnd, length: c.length - iCodeAfterEnd }, false),\r\n        ].filter(x => x.length > 0));\r\n    }\r\n\r\n    return codePartsAll;\r\n};\r\n\r\nexport const getCodePartsCompleted = (codeParts: CodePart[], incomplete: { index: number, length: number }, options?: { showBlank?: boolean }): CodePart[] => {\r\n    const codePartsCompleted = modifyCodeParts(codeParts, incomplete, (x, inRange) => ({ ...x, isIncomplete: inRange }));\r\n    if (options?.showBlank) {\r\n        return codePartsCompleted.map(x => ({ ...x, code: x.isIncomplete ? x.code.replace(/./g, ` `) : x.code }));\r\n    }\r\n    return codePartsCompleted.filter(x => !x.isIncomplete);\r\n};\r\n\r\nexport const getAutoComplete = ({ codeParts, selection }: { codeParts: CodePart[], selection?: { index: number, length: number } }, codeFocusCompleted?: string) => {\r\n    if (!selection\r\n        || codeFocusCompleted == null\r\n        || selection.length === codeFocusCompleted.length\r\n    ) {\r\n        return null;\r\n    }\r\n\r\n    // const remaining = code_focus.substr(completed.length);\r\n\r\n    const nextPartIndexRaw = codeParts.findIndex(x => x.index > selection.index + codeFocusCompleted.length);\r\n    const nextPartIndex = nextPartIndexRaw < 0 ? codeParts.length : nextPartIndexRaw;\r\n    const activePartText = codeParts[nextPartIndex - 1]?.code;\r\n    const iDone = codeParts[nextPartIndex - 1]?.index;\r\n    // console.log(`updateAutoComplete`, { iNext, iDone, activePart: activePartText, codeParts, codeFocusCompleted });\r\n\r\n    if (!activePartText?.trim()) {\r\n        return null;\r\n    }\r\n\r\n    const lengthCompleted = codeFocusCompleted.length + selection.index - iDone;\r\n    const activePartTextCompleted = activePartText.substr(0, lengthCompleted);\r\n    const matchWords = distinct(codeParts\r\n        .filter(x =>\r\n            (!!activePartTextCompleted && x.code.startsWith(activePartTextCompleted))\r\n            || (!activePartTextCompleted && isSimilarCodeToken(x.code, activePartText)))\r\n        .map(x => x.code)\r\n        .filter(x => x !== activePartText)\r\n        .filter(x => !!x.trim()),\r\n    );\r\n    const choices = [activePartText, ...shuffle(matchWords).slice(0, 3)].map(x => ({\r\n        textCompleted: x.substr(0, lengthCompleted),\r\n        text: x.substr(lengthCompleted),\r\n    }));\r\n\r\n    console.log(`updateAutoComplete`, { iDone, activePartText, codeFocusCompleted, codeParts, activePartTextCompleted, matchWords, choices });\r\n\r\n    return {\r\n        choices: shuffle(choices).map((x, i) => ({ ...x, isSelected: i === 0, isWrong: false })),\r\n        activeIndex: iDone,\r\n    };\r\n};\r\n","import { isAbsolute } from 'path';\r\nimport React, { useEffect, useMemo, useRef, useState } from 'react';\r\nimport { TouchableOpacity, View } from 'react-native-lite';\r\nimport { CodePart } from './code-editor-helpers';\r\n\r\nexport type CodeDisplayPart = CodePart;\r\nexport type CodeDisplayInputOptions = {\r\n    isActive?: boolean;\r\n    cursorIndex?: number;\r\n    activeIndex?: number;\r\n    promptIndex?: number;\r\n    prompt?: CodeDisplayPrompt;\r\n    feedback?: CodeDisplayFeedback;\r\n    autoComplete?: { textCompleted: string, text: string, isSelected: boolean, isWrong: boolean }[];\r\n    onAutocomplete?: (value: string) => void;\r\n};\r\nexport const CodeDisplay = ({ codeParts, language, inputOptions }: {\r\n    codeParts: CodeDisplayPart[];\r\n    language: string;\r\n    inputOptions?: CodeDisplayInputOptions;\r\n}) => {\r\n\r\n    const Cursor = useMemo(() => <CursorComponent isActive={inputOptions?.isActive ?? false} />, [inputOptions?.isActive]);\r\n\r\n    console.log(`CodeDisplay`, { inputOptions, codeParts });\r\n    return (\r\n        <View>\r\n            <pre style={{ margin: 0, paddingBottom: inputOptions ? 100 : 0 }} className={`language-${language}`}>\r\n                <code className={`language-${language}`}>\r\n                    <CodeSpan key='-1' code={{ code: `\\n`, index: -1, indexAfterEnd: 0, length: 1, classes: [], isInSelection: false }} Cursor={Cursor} inputOptions={inputOptions ?? {}} />\r\n                    {codeParts.map(x => (\r\n                        <CodeSpan key={`${x.code}:${x.index}:${x.code.length}`} code={x} Cursor={Cursor} inputOptions={inputOptions ?? {}} />\r\n                    ))}\r\n                </code>\r\n            </pre>\r\n        </View>\r\n    );\r\n};\r\n\r\nconst CodeSpan = ({ code, Cursor, inputOptions }: { code: CodeDisplayPart, Cursor: JSX.Element, inputOptions: CodeDisplayInputOptions }) => {\r\n    const { cursorIndex, activeIndex = inputOptions.cursorIndex, promptIndex } = inputOptions;\r\n\r\n    const hasCursor = !!(cursorIndex != null\r\n        && cursorIndex >= code.index\r\n        && cursorIndex < code.index + code.code.length\r\n    );\r\n    const hasActive = !!(activeIndex != null\r\n        && activeIndex >= code.index\r\n        && activeIndex < code.index + code.code.length\r\n    );\r\n    const hasPrompt = !!(promptIndex != null\r\n        && promptIndex >= code.index\r\n        && promptIndex < code.index + code.code.length\r\n    );\r\n    return (\r\n        <>\r\n            {hasCursor && Cursor}\r\n            {hasActive && (\r\n                <>\r\n                    <AutoCompleteComponent inputOptions={inputOptions} />\r\n                </>\r\n            )}\r\n            {hasPrompt && (\r\n                <>\r\n                    <PromptComponent inputOptions={inputOptions} />\r\n                </>\r\n            )}\r\n            {!code.onPress && (\r\n                <span className={code.classes.join(` `)} style={!code.isInSelection ? { opacity: 0.5 } : {}} >{`${code.code}`}</span>\r\n            )}\r\n            {code.onPress && (\r\n                <TouchableOpacity style={{ display: `inline` }} onPress={() => code.onPress?.(code)}>\r\n                    <span className={code.classes.join(` `)} style={!code.isInSelection ? { opacity: 0.5 } : {}} >{`${code.code}`}</span>\r\n                </TouchableOpacity>\r\n            )}\r\n\r\n        </>\r\n    );\r\n};\r\n\r\n\r\nconst CursorComponent = ({ isActive }: { isActive: boolean }) => {\r\n    const [cursorBlinkState, setCursorBlinkState] = useState(true);\r\n    useEffect(() => {\r\n        const intervalId = setInterval(() => {\r\n            setCursorBlinkState(s => !s);\r\n        }, 500);\r\n        return () => {\r\n            clearInterval(intervalId);\r\n        };\r\n    }, []);\r\n    return (\r\n        <span style={{ display: `inline-block`, width: 0, margin: 0, position: `relative`, left: -4, opacity: isActive ? 1 : 0.5 }}>{cursorBlinkState ? ` ` : `|`}</span>\r\n    );\r\n};\r\n\r\nconst autoCompleteStyles = {\r\n    wrapper: { display: `inline-block`, position: `relative`, top: 4, width: 0 },\r\n    inner: { display: `block`, position: `absolute`, zIndex: 100, background: `#000000`, border: `solid 1 #CCCCFF` },\r\n    item: { display: `block`, padding: 4, color: `#FFFFFF` },\r\n    item_selected: { display: `block`, padding: 4, color: `#CCCCFF`, background: `#111133`, minWidth: 60 },\r\n    textCompleted: { color: `#CCCCFF`, opacity: 0.5 },\r\n    textNew: { color: `#CCCCFF` },\r\n} as const;\r\n\r\nconst AutoCompleteComponent = ({ inputOptions }: { inputOptions: CodeDisplayInputOptions }) => {\r\n    const { autoComplete } = inputOptions;\r\n    if (!autoComplete) { return (<></>); }\r\n\r\n    const s = autoCompleteStyles;\r\n    console.log(`AutoCompleteComponent`, { autoComplete });\r\n    return (\r\n        <>\r\n            <span style={s.wrapper}>\r\n                <span style={s.inner}>\r\n                    {autoComplete.map(x => (\r\n                        <TouchableOpacity key={x.text} onPress={() => { inputOptions.onAutocomplete?.(x.text); }}>\r\n                            <span style={x.isSelected ? s.item_selected : s.item}>\r\n                                <span style={s.textCompleted}>{x.isWrong ? ` ` : ``}{x.textCompleted}</span>\r\n                                <span style={s.textNew}>{x.text}</span>\r\n                            </span>\r\n                        </TouchableOpacity>\r\n                    ))}\r\n                </span>\r\n            </span>\r\n        </>\r\n    );\r\n};\r\n\r\nconst promptStyles = {\r\n    wrapper: {\r\n        position: `relative`,\r\n        background: `#111111`,\r\n        margin: 4,\r\n        padding: 4,\r\n        marginLeft: 20,\r\n        borderRadius: 4,\r\n        border: `1px solid #555555`,\r\n        // Remove extra line\r\n        marginBottom: -16,\r\n    },\r\n    text: { whiteSpace: `pre-wrap` },\r\n    text_positive: { whiteSpace: `pre-wrap`, color: `#88FF88` },\r\n    text_negative: { whiteSpace: `pre-wrap`, color: `#FF8888` },\r\n    emoji: { position: `absolute`, fontSize: 20, left: -24, top: 0 },\r\n} as const;\r\n\r\nexport type CodeDisplayFeedback = {\r\n    message: string;\r\n    emoji: string;\r\n    timestamp: number;\r\n    isNegative?: boolean;\r\n    timeoutMs?: number;\r\n};\r\nexport type CodeDisplayPrompt = {\r\n    message: string;\r\n    emoji: string;\r\n    timestamp: number;\r\n    timeout?: number;\r\n};\r\nconst PromptComponent = ({ inputOptions }: { inputOptions: CodeDisplayInputOptions }) => {\r\n    const { prompt: promptRaw, feedback } = inputOptions;\r\n\r\n    // Feedback\r\n    const [hideFeedback, setHideFeedback] = useState(true);\r\n    useEffect(() => {\r\n        setHideFeedback(false);\r\n\r\n        const id = setTimeout(() => {\r\n            setHideFeedback(true);\r\n        }, feedback?.timeoutMs ?? 3000);\r\n\r\n        return () => {\r\n            clearTimeout(id);\r\n        };\r\n    }, [feedback]);\r\n\r\n    const showFeedback = feedback && !hideFeedback;\r\n    const s = promptStyles;\r\n    const textStyle = showFeedback && feedback ? (feedback.isNegative ? s.text_negative : s.text_positive) : s.text;\r\n    const prompt = showFeedback ? feedback : promptRaw;\r\n    if (!prompt) { return <></>; }\r\n    return (\r\n        <>\r\n            <div style={s.wrapper} >\r\n                <div style={s.emoji}>{prompt.emoji}</div>\r\n                <span style={textStyle}>{prompt.message}</span>\r\n            </div>\r\n        </>\r\n    );\r\n};\r\n","export const goodEmojis = `       `.split(` `);\r\nexport const badEmojis = `       `.split(` `);\r\n","import React, { useEffect, useRef, useState } from 'react';\r\nimport { TouchableOpacity, View } from 'react-native-lite';\r\nimport { randomItem } from 'utils/random';\r\nimport { LessonData, LessonProjectFileSelection } from '../lesson-types';\r\nimport { CodePartsData, getAutoComplete, getCodeParts, getCodePartsCompleted } from './code-editor-helpers';\r\nimport { CodeDisplay, CodeDisplayFeedback, CodeDisplayPrompt } from './code-display';\r\nimport { badEmojis, goodEmojis } from './emojis';\r\n\r\nexport const LessonFileContentEditor_ConstructCode = ({ code, language, selection, onDone, lessonData }: {\r\n    code: string; language: 'tsx';\r\n    selection?: LessonProjectFileSelection;\r\n    onDone: () => void;\r\n    lessonData: LessonData;\r\n}) => {\r\n    const [codeParts, setCodeParts] = useState(null as null | CodePartsData);\r\n    const inputRef = useRef(null as null | HTMLTextAreaElement);\r\n\r\n    useEffect(() => {\r\n        const parts = getCodeParts(code, language, selection);\r\n        setCodeParts(parts);\r\n        setAutoComplete(null);\r\n\r\n        const timeoutId = setTimeout(() => {\r\n            inputRef.current?.focus();\r\n        }, 250);\r\n        return () => {\r\n            clearTimeout(timeoutId);\r\n        };\r\n    }, [code]);\r\n\r\n    const [inputText, setInputText] = useState(``);\r\n    const [isActive, setIsActive] = useState(false);\r\n    const [feedback, setFeedback] = useState(null as null | CodeDisplayFeedback);\r\n    const [autoComplete, setAutoComplete] = useState(null as null | { choices: { textCompleted: string, text: string, isSelected: boolean, isWrong: boolean }[], activeIndex: number });\r\n\r\n    useEffect(() => {\r\n        const timeoutId = setTimeout(() => {\r\n            const nextLetter = codeParts?.codeFocus.substr(inputText.length).trim()[0];\r\n            if (!nextLetter) { return; }\r\n\r\n            setFeedback(s => ({\r\n                message: ` Type: ${nextLetter}`,\r\n                emoji: ``,\r\n                timestamp: Date.now(),\r\n                timeoutMs: 5 * 1000,\r\n            }));\r\n        }, 5000);\r\n\r\n        return () => {\r\n            clearTimeout(timeoutId);\r\n        };\r\n    }, [codeParts, inputText]);\r\n\r\n    const onKeyDown = (e: React.KeyboardEvent<HTMLInputElement | HTMLTextAreaElement>) => {\r\n        const TABKEY = 9;\r\n        const RETURNKEY = 13;\r\n        const UPKEY = 38;\r\n        const DOWNKEY = 40;\r\n        // console.log(`CodeEditor onKeyPress`, { keyCode: e.keyCode });\r\n\r\n        if (e.keyCode === TABKEY) {\r\n            // console.log(`CodeEditor onKeyPress onTabKey`);\r\n            e.preventDefault();\r\n            e.stopPropagation();\r\n\r\n            changeInputText(`${inputText}\\t`);\r\n            return false;\r\n        }\r\n        if (e.keyCode === RETURNKEY) {\r\n            // console.log(`CodeEditor onKeyPress onTabKey`);\r\n            e.preventDefault();\r\n            e.stopPropagation();\r\n\r\n            changeInputText(`${inputText}\\n`);\r\n            return false;\r\n        }\r\n        if (e.keyCode === UPKEY) {\r\n            setAutoComplete(s => {\r\n                if (!s) { return null; }\r\n                const iSelected = s.choices.findIndex(x => x.isSelected);\r\n                const iSelectedNew = Math.max(0, iSelected - 1);\r\n                return { ...s, choices: [...s.choices.map((x, i) => ({ ...x, isSelected: iSelectedNew === i }))] };\r\n            });\r\n        }\r\n        if (e.keyCode === DOWNKEY) {\r\n            setAutoComplete(s => {\r\n                if (!s) { return null; }\r\n                const iSelected = s.choices.findIndex(x => x.isSelected);\r\n                const iSelectedNew = Math.min(s.choices.length - 1, iSelected + 1);\r\n                return { ...s, choices: [...s.choices.map((x, i) => ({ ...x, isSelected: iSelectedNew === i }))] };\r\n            });\r\n        }\r\n        return true;\r\n    };\r\n\r\n    const changeInputText = (valueRaw: string) => {\r\n        if (!codeParts) { return; }\r\n        const {\r\n            codeFocus,\r\n        } = codeParts;\r\n\r\n        const newInput = valueRaw.substr(inputText.length);\r\n        const wasBackspace = valueRaw.length < inputText.length;\r\n        const wasTab = valueRaw.endsWith(`\\t`);\r\n        const wasReturn = valueRaw.endsWith(`\\n`);\r\n        const wasPeriod = valueRaw.endsWith(`.`);\r\n        const wasSpace = valueRaw.endsWith(` `);\r\n\r\n        const remaining = codeFocus.substr(inputText.length);\r\n        const isWhitespace = remaining.trimStart() !== remaining;\r\n        const wasCorrectRaw = codeFocus.startsWith(valueRaw);\r\n        const wasAutoComplete = autoComplete && !wasCorrectRaw && (wasTab || wasReturn || wasPeriod || wasSpace);\r\n        const activeAutoComplete = autoComplete?.choices.find(x => x.isSelected);\r\n\r\n        const value2 = wasCorrectRaw ? valueRaw\r\n            : wasAutoComplete ? inputText + (activeAutoComplete?.text ?? ``)\r\n                : (wasReturn || wasTab || wasSpace) && isWhitespace ? codeFocus.substr(0, codeFocus.length - remaining.trimStart().length)\r\n                    : valueRaw\r\n            ;\r\n\r\n        const wasCorrect_ignoreWhitespace = remaining.trimStart().startsWith(newInput);\r\n        const value = wasCorrect_ignoreWhitespace ? codeFocus.substr(0, codeFocus.length - remaining.trimStart().length + newInput.length) : value2;\r\n\r\n        const wasCorrect = codeFocus.startsWith(value);\r\n\r\n        console.log(`changeInputText`, {\r\n            wasBackspace,\r\n            wasTab,\r\n            wasReturn,\r\n            wasPeriod,\r\n            wasSpace,\r\n            wasCorrectRaw,\r\n            wasAutoComplete,\r\n            activeAutoComplete,\r\n            value,\r\n            value2,\r\n            valueRaw,\r\n            codeFocus,\r\n            remaining,\r\n            isWhitespace,\r\n            wasCorrect,\r\n            wasCorrect_ignoreWhitespace,\r\n        });\r\n\r\n        if (codeFocus === inputText) {\r\n            setFeedback({ emoji: randomItem(goodEmojis), message: ` You're already done.`, timestamp: Date.now() });\r\n            return;\r\n        }\r\n        if (wasBackspace) {\r\n            setFeedback({ isNegative: true, emoji: randomItem(badEmojis), message: ` You're right so far, no need to backspace.`, timestamp: Date.now() });\r\n            return;\r\n        }\r\n        if (!wasCorrect) {\r\n            if (wasAutoComplete && activeAutoComplete) {\r\n                activeAutoComplete.isWrong = true;\r\n            }\r\n            if (!activeAutoComplete) {\r\n                const a = getAutoComplete(codeParts, inputText);\r\n                setAutoComplete(a);\r\n            }\r\n            setFeedback({ isNegative: true, emoji: randomItem(badEmojis), message: ` ${randomItem([`Wrong`, `Incorrect`, `No`, `Try Again`])}`, timestamp: Date.now() });\r\n            return;\r\n        }\r\n\r\n        const isDone = codeFocus === value;\r\n        if (isDone) {\r\n            onDone();\r\n        }\r\n\r\n        setIsActive(true);\r\n        setInputText(value);\r\n        setFeedback(!isDone ? null : { emoji: randomItem(goodEmojis), message: ``, timestamp: Date.now() });\r\n        const a = getAutoComplete(codeParts, value);\r\n        setAutoComplete(a);\r\n\r\n        inputRef.current?.focus();\r\n    };\r\n\r\n    const onAutocomplete = (text: string) => {\r\n        if (!autoComplete) { return; }\r\n\r\n        autoComplete.choices.forEach(x => { x.isSelected = false; });\r\n        const choice = autoComplete.choices.find(x => x.text === text);\r\n        if (!choice) { return; }\r\n\r\n        choice.isSelected = true;\r\n        changeInputText(inputText + text);\r\n    };\r\n\r\n\r\n    if (!codeParts || !code) {\r\n        return <></>;\r\n    }\r\n\r\n    const s = selection ?? { index: 0, length: code.length };\r\n    const cursorIndex = s.index + inputText.length;\r\n    const activeIndex = autoComplete?.activeIndex ?? cursorIndex;\r\n    const promptIndex = code.lastIndexOf(`\\n`, code.lastIndexOf(`\\n`, s.index) - 1);\r\n    const activeCodeParts = getCodePartsCompleted(codeParts.codeParts, { index: cursorIndex, length: codeParts.codeFocus.length - inputText.length }, { showBlank: true });\r\n    const nextChar = code.substr(cursorIndex, 1);\r\n    const prompt: CodeDisplayPrompt = {\r\n        emoji: ``,\r\n        message: lessonData.task,\r\n        timestamp: Date.now(),\r\n    };\r\n    console.log(`CodeEditor_TypeSelection`, { nextChar, inputText, codeParts, activeCodeParts, isActive, cursorIndex, activeIndex, feedback, autoComplete: autoComplete?.choices });\r\n\r\n    return (\r\n        <>\r\n            <TouchableOpacity onPress={() => inputRef.current?.focus()}>\r\n                <View style={{ position: `relative` }}>\r\n                    <View>\r\n                        <CodeDisplay codeParts={activeCodeParts} language={language} inputOptions={{\r\n                            isActive, cursorIndex, activeIndex, promptIndex,\r\n                            feedback: feedback ?? undefined,\r\n                            prompt: prompt ?? undefined,\r\n                            autoComplete: autoComplete?.choices,\r\n                            onAutocomplete,\r\n                        }} />\r\n                    </View>\r\n                    <View style={{ position: `absolute`, top: 0, left: 0, right: 0, bottom: 0, opacity: 0 }}>\r\n                        <textarea style={{ width: `100%`, height: `100%`, background: `#FF0000` }}\r\n                            value={inputText}\r\n                            onChange={(e) => changeInputText(e.target.value)}\r\n                            onFocus={() => setIsActive(true)}\r\n                            onBlur={() => setIsActive(false)}\r\n                            onKeyDown={(e) => onKeyDown(e)}\r\n                            ref={inputRef}\r\n                        />\r\n                    </View>\r\n                </View>\r\n                {/* <Text>{inputText}</Text> */}\r\n            </TouchableOpacity>\r\n        </>\r\n    );\r\n};\r\n","import React, { useEffect, useState } from 'react';\r\nimport { View } from 'react-native-lite';\r\nimport { randomItem } from 'utils/random';\r\nimport { LessonData, LessonProjectFileSelection } from '../lesson-types';\r\nimport { CodePart, CodePartsData, getCodeParts } from './code-editor-helpers';\r\nimport { CodeDisplay, CodeDisplayFeedback, CodeDisplayPrompt } from './code-display';\r\nimport { badEmojis, goodEmojis } from './emojis';\r\n\r\nexport const LessonFileContentEditor_UnderstandCode = ({ code, language, selection, onDone, lessonData }: {\r\n    code: string;\r\n    language: 'tsx';\r\n    selection?: LessonProjectFileSelection;\r\n    onDone: () => void;\r\n    lessonData: LessonData;\r\n}) => {\r\n    const [codeParts, setCodeParts] = useState(null as null | CodePartsData);\r\n    type FillInBlankProblem = { textWithBlanks: string, textWithoutBlanks: string };\r\n    const [fillInBlanks, setFillInBlanks] = useState(null as null | FillInBlankProblem[]);\r\n    const [fillInBlank, setFillInBlank] = useState(null as null | FillInBlankProblem);\r\n    const [feedback, setFeedback] = useState(null as null | CodeDisplayFeedback);\r\n\r\n    useEffect(() => {\r\n        const parts = getCodeParts(code, language, selection);\r\n        setCodeParts(parts);\r\n\r\n        // Create fill in blank description\r\n        const descriptionsWithBlanks = lessonData.descriptions.map(x => {\r\n            let d = x;\r\n            parts.codeParts\r\n                .filter(c => c.isInSelection)\r\n                .map(c => c.code.trim())\r\n                .filter(c => !!c)\r\n                // Require a space around it\r\n                .forEach(c => { d = d.replace(` ${c} `, ` ___ `); });\r\n\r\n            console.log(`LessonFileContentEditor_UnderstandCode - create fill in blank`, { parts, d, x });\r\n            return {\r\n                textWithBlanks: d,\r\n                textWithoutBlanks: x,\r\n            };\r\n        });\r\n        setFillInBlanks(descriptionsWithBlanks);\r\n        setFillInBlank(descriptionsWithBlanks[0] ?? null);\r\n\r\n    }, [code]);\r\n\r\n    const onPressCodePart = (part: CodePart) => {\r\n        if (!fillInBlank || !fillInBlanks) { return; }\r\n\r\n        const iBlank = fillInBlank.textWithBlanks.indexOf(`___`);\r\n        const nextWithBlanks = fillInBlank.textWithBlanks.replace(`___`, part.code.trim());\r\n        const isCorrect = nextWithBlanks.startsWith(fillInBlank.textWithoutBlanks.substr(0, iBlank + part.length));\r\n\r\n        console.log(`onPressCodePart`, { part, iBlank, withoutBlank: nextWithBlanks, isCorrect, fillInBlank });\r\n\r\n        if (!isCorrect) {\r\n            setFeedback({ isNegative: true, emoji: randomItem(badEmojis), message: ` ${randomItem([`Wrong`, `Incorrect`, `No`, `Try Again`])}`, timestamp: Date.now() });\r\n            return;\r\n        }\r\n\r\n        setFeedback({ emoji: randomItem(goodEmojis), message: ``, timestamp: Date.now(), timeoutMs: 1000 });\r\n\r\n        if (!nextWithBlanks.includes(`___`)) {\r\n            // Done\r\n            const remaining = fillInBlanks.filter(x => x.textWithoutBlanks !== fillInBlank.textWithoutBlanks);\r\n            setFillInBlanks(remaining);\r\n            setFillInBlank(remaining[0] ?? null);\r\n\r\n            if (remaining.length <= 0) {\r\n                onDone();\r\n            }\r\n\r\n            return;\r\n        }\r\n\r\n        setFillInBlank({\r\n            textWithoutBlanks: fillInBlank.textWithoutBlanks,\r\n            textWithBlanks: nextWithBlanks,\r\n        });\r\n    };\r\n\r\n    if (!codeParts) { return <></>; }\r\n\r\n    const s = selection ?? { index: 0, length: code.length };\r\n    const promptIndex = code.lastIndexOf(`\\n`, code.lastIndexOf(`\\n`, s.index) - 1);\r\n    const activeCodeParts = codeParts.codeParts.map(x => ({ ...x, onPress: onPressCodePart }));\r\n    const activePrompt: CodeDisplayPrompt = {\r\n        emoji: fillInBlank ? `` : randomItem(goodEmojis),\r\n        message: fillInBlank ? `${fillInBlank.textWithBlanks}\\r\\n\\r\\n Select the correct word below` : `${lessonData.descriptions.map(x => ` ${x}`).join(`\\r\\n`)}`,\r\n        timestamp: Date.now(),\r\n    };\r\n    console.log(`LessonFileContentEditor_UnderstandCode render`, { fillInBlank, activePrompt });\r\n    return (\r\n        <>\r\n            <View style={{ position: `relative` }}>\r\n                <View>\r\n                    <CodeDisplay codeParts={activeCodeParts} language={language} inputOptions={{\r\n                        prompt: activePrompt,\r\n                        promptIndex,\r\n                        feedback: feedback ?? undefined,\r\n                    }} />\r\n                </View>\r\n            </View>\r\n        </>\r\n    );\r\n};\r\n","/* eslint-disable unicorn/no-for-loop */\r\n/* eslint-disable react/no-danger */\r\nimport React, { useEffect, useRef, useState } from 'react';\r\nimport { View, Text, TextInput } from 'react-native-lite';\r\nimport { randomItem } from 'utils/random';\r\nimport { LessonData, LessonProjectFile, LessonProjectFileSelection, LessonProjectState } from '../lesson-types';\r\nimport { CodePartsData, getAutoComplete, getCodeParts, getCodePartsCompleted } from './code-editor-helpers';\r\nimport { CodeDisplay, CodeDisplayPrompt } from './code-display';\r\nimport { TabsListEditorComponent } from './tabs';\r\nimport { LessonFileContentEditor_ConstructCode } from './lesson-file-editor-construct-code';\r\nimport { LessonFileContentEditor_UnderstandCode } from './lesson-file-editor-understand-code';\r\nimport { calculateFilesHashCode } from '../lesson-hash';\r\n\r\nexport type LessonProjectEditorMode = 'display' | 'edit';\r\nexport const LessonProjectFilesEditor = ({\r\n    projectData,\r\n    projectEditorMode,\r\n    fileEditorMode_focus,\r\n    fileEditorMode_noFocus,\r\n    onProjectDataChange = () => { },\r\n    onTaskDone = () => { },\r\n    lessonData,\r\n}: {\r\n    projectData: {\r\n        projectState: LessonProjectState;\r\n        focus: LessonProjectFileSelection;\r\n    };\r\n    projectEditorMode: LessonProjectEditorMode;\r\n    fileEditorMode_focus: LessonFileEditorMode;\r\n    fileEditorMode_noFocus: LessonFileEditorMode;\r\n    onProjectDataChange?: (value: {\r\n        projectState?: LessonProjectState;\r\n        focus?: LessonProjectFileSelection;\r\n    }) => void;\r\n    onTaskDone?: () => void;\r\n    lessonData: LessonData;\r\n}) => {\r\n    const {\r\n        projectState,\r\n        focus,\r\n    } = projectData;\r\n    const [activeFilePath, setActiveFilePath] = useState(focus.filePath);\r\n    const lastFocusSet = useRef(null as null | LessonProjectFileSelection);\r\n\r\n    useEffect(() => {\r\n        const focusFile = projectState.files.find(x => x.path === focus.filePath);\r\n        if (projectState.files.length > 0\r\n            && (!focusFile\r\n                || focus.length <= 0\r\n                || focus.index >= (focusFile?.content.length ?? 0))\r\n            && lastFocusSet.current !== focus\r\n        ) {\r\n            const f = projectState.files.find(x => x.path === focus.filePath) ?? projectState.files[0];\r\n            const newFocus = {\r\n                filePath: f.path,\r\n                index: 0,\r\n                length: f.content.length,\r\n            };\r\n            lastFocusSet.current = newFocus;\r\n\r\n            onProjectDataChange({\r\n                focus: newFocus,\r\n            });\r\n            return;\r\n        }\r\n\r\n        const p = focusFile?.path ?? projectState.files[0]?.path ?? undefined;\r\n\r\n        setActiveFilePath(p);\r\n    }, [projectState, focus]);\r\n\r\n    const createNewFile = () => {\r\n        let path = `new.ts`;\r\n        let attempt = 1;\r\n        // eslint-disable-next-line no-loop-func\r\n        while (projectState.files.some(x => x.path === path)) {\r\n            path = `new${attempt}.ts`;\r\n            attempt++;\r\n        }\r\n        const newFile: LessonProjectFile = {\r\n            path,\r\n            content: ``,\r\n            language: `tsx`,\r\n        };\r\n        return newFile;\r\n    };\r\n\r\n    const changeFile = (file: LessonProjectFile) => {\r\n        const files = projectState.files.map(x => {\r\n            if (x.path === file.path) { return file; }\r\n            return x;\r\n        });\r\n        onProjectDataChange({\r\n            projectState: {\r\n                files,\r\n                filesHashCode: calculateFilesHashCode(files),\r\n            },\r\n        });\r\n    };\r\n    const changeSelection = (value: { index: number, length: number }) => {\r\n        const file = projectState.files.find(x => x.path === activeFilePath);\r\n        if (!file) { return; }\r\n\r\n        console.log(`changeSelection`, { ...value });\r\n        const f = file;\r\n        onProjectDataChange({\r\n            focus: {\r\n                filePath: f.path,\r\n                ...value,\r\n            },\r\n        });\r\n    };\r\n\r\n    console.log(`ProjectCodeEditor`, { activeFilePath, focus, projectState });\r\n    const activeFile = projectState.files.find(x => x.path === activeFilePath) ?? projectState.files[0] ?? undefined;\r\n    return (\r\n        <>\r\n            <TabsListEditorComponent\r\n                header='Files'\r\n                items={projectState.files}\r\n                onChange={projectEditorMode !== `edit` ? undefined : (x => onProjectDataChange({ projectState: { files: x, filesHashCode: calculateFilesHashCode(x) } }))}\r\n                getKey={x => x.path}\r\n                getLabel={x => focus.filePath === x.path ? ` ${x.path}` : x.path}\r\n                selected={activeFile}\r\n                onSelect={x => setActiveFilePath(x.path)}\r\n                onCreateNewItem={createNewFile}\r\n            />\r\n            {activeFile && (\r\n                <LessonFileEditor\r\n                    key={activeFile.path}\r\n                    projectEditorMode={projectEditorMode}\r\n                    file={activeFile} selection={focus.filePath === activeFile.path ? focus : undefined}\r\n                    fileEditorMode={focus.filePath === activeFile.path ? fileEditorMode_focus : fileEditorMode_noFocus}\r\n                    onChange={changeFile} onSelectionChange={changeSelection}\r\n                    onTaskDone={onTaskDone}\r\n                    lessonData={lessonData}\r\n                />\r\n            )}\r\n        </>\r\n    );\r\n};\r\n\r\nexport const LessonFileEditor = ({\r\n    projectEditorMode,\r\n    fileEditorMode,\r\n    file,\r\n    onChange,\r\n    selection,\r\n    onSelectionChange,\r\n    onTaskDone,\r\n    lessonData,\r\n}: {\r\n    projectEditorMode: LessonProjectEditorMode;\r\n    fileEditorMode: LessonFileEditorMode;\r\n    file: LessonProjectFile;\r\n    onChange: (value: LessonProjectFile) => void;\r\n    selection?: LessonProjectFileSelection;\r\n    onSelectionChange: (value: { index: number, length: number }) => void;\r\n    onTaskDone: () => void;\r\n    lessonData: LessonData;\r\n}) => {\r\n\r\n    const [filePathEdit, setFilePathEdit] = useState(file.path);\r\n    const changeFileName = () => {\r\n        file.path = filePathEdit;\r\n        onChange({ ...file, path: filePathEdit });\r\n    };\r\n\r\n    return (\r\n        <>\r\n            {projectEditorMode === `edit` && (\r\n                <View style={{ flexDirection: `row` }}>\r\n                    <TextInput\r\n                        style={{\r\n                            padding: 4,\r\n                            fontSize: 12,\r\n                            color: `#FFFFFF`,\r\n                            background: `#000000`,\r\n                        }}\r\n                        value={filePathEdit}\r\n                        onChange={setFilePathEdit}\r\n                        onBlur={changeFileName}\r\n                        autoCompleteType='off'\r\n                        keyboardType='default'\r\n                    />\r\n                </View>\r\n            )}\r\n            <LessonFileContentEditor\r\n                file={file}\r\n                onCodeChange={x => onChange({ ...file, content: x })}\r\n                mode={fileEditorMode}\r\n                selection={selection}\r\n                onSelectionChange={onSelectionChange}\r\n                onTaskDone={onTaskDone}\r\n                lessonData={lessonData}\r\n            />\r\n        </>\r\n    );\r\n};\r\n\r\nexport type LessonFileEditorMode = 'display' | 'edit' | 'construct-code' | 'understand-code';\r\nexport const LessonFileContentEditor = ({\r\n    file,\r\n    selection,\r\n    mode,\r\n    onCodeChange,\r\n    onSelectionChange,\r\n    onTaskDone,\r\n    lessonData,\r\n}: {\r\n    file: LessonProjectFile;\r\n    selection?: LessonProjectFileSelection;\r\n    mode: LessonFileEditorMode;\r\n    onCodeChange: (code: string) => void;\r\n    onSelectionChange: (value: { index: number, length: number }) => void;\r\n    onTaskDone: () => void;\r\n    lessonData: LessonData;\r\n}) => {\r\n    return (\r\n        <View style={{}}>\r\n            {/* <View style={{ background: `#1e1e1e`, alignSelf: `flex-start`, padding: 4 }}>\r\n                <Text>{` ${file.path}`}</Text>\r\n            </View> */}\r\n            <View style={{ padding: 0 }}>\r\n                {mode === `display` && (\r\n                    <LessonFileContentEditor_Display code={file.content} language={file.language} selection={selection} />\r\n                )}\r\n                {mode === `edit` && (\r\n                    <LessonFileContentEditor_Edit code={file.content} language={file.language} selection={selection} onCodeChange={onCodeChange} onSelectionChange={onSelectionChange} />\r\n                )}\r\n                {mode === `construct-code` && (\r\n                    <LessonFileContentEditor_ConstructCode code={file.content} language={file.language} selection={selection} onDone={onTaskDone} lessonData={lessonData} />\r\n                )}\r\n                {mode === `understand-code` && (\r\n                    <LessonFileContentEditor_UnderstandCode code={file.content} language={file.language} selection={selection} onDone={onTaskDone} lessonData={lessonData} />\r\n                )}\r\n            </View>\r\n        </View >\r\n    );\r\n};\r\n\r\nconst LessonFileContentEditor_Display = ({ code, language, selection }: { code: string, language: 'tsx', selection?: LessonProjectFileSelection }) => {\r\n    const codeParts = getCodeParts(code, language, selection);\r\n    return (\r\n        <CodeDisplay codeParts={codeParts.codeParts} language={language} />\r\n    );\r\n};\r\n\r\nconst LessonFileContentEditor_Edit = ({ code, language, selection, onCodeChange, onSelectionChange,\r\n}: {\r\n    code: string;\r\n    language: 'tsx';\r\n    selection?: LessonProjectFileSelection;\r\n    onCodeChange: (code: string) => void;\r\n    onSelectionChange: (value: { index: number, length: number }) => void;\r\n}) => {\r\n\r\n    const [inputText, setInputText] = useState(code);\r\n    const [codeParts, setCodeParts] = useState(null as null | CodePartsData);\r\n    const changeInputText = (value: string) => {\r\n        setInputText(value);\r\n        const parts = getCodeParts(code, language, selection);\r\n        setCodeParts(parts);\r\n    };\r\n    const onBlur = () => {\r\n        setInputText(inputText);\r\n        const parts = getCodeParts(code, language, selection);\r\n        setCodeParts(parts);\r\n        onCodeChange(inputText);\r\n    };\r\n    useEffect(() => {\r\n        const parts = getCodeParts(code, language, selection);\r\n        setCodeParts(parts);\r\n    }, [code, selection]);\r\n\r\n    return (\r\n        <View >\r\n            <View style={{}}>\r\n                <TextInput\r\n                    style={{\r\n                        padding: 4,\r\n                        fontSize: 12,\r\n                        color: `#FFFFFF`,\r\n                        background: `#000000`,\r\n                    }}\r\n                    value={inputText}\r\n                    onChange={changeInputText}\r\n                    onBlur={onBlur}\r\n                    autoCompleteType='off'\r\n                    keyboardType='default'\r\n                    multiline\r\n                    numberOfLines={16}\r\n                    onSelectionChange={x => onSelectionChange({ index: x.start, length: x.end - x.start })}\r\n                />\r\n            </View>\r\n            <View>\r\n                {codeParts && (<CodeDisplay codeParts={codeParts.codeParts} language={language} />)}\r\n            </View>\r\n        </View>\r\n    );\r\n};\r\n"],"sourceRoot":""}